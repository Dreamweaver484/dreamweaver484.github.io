<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>welcome</title>
  
  <subtitle>拾忆生活--Lewis</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lewis.qi.tk/"/>
  <updated>2020-05-16T12:05:39.170Z</updated>
  <id>http://lewis.qi.tk/</id>
  
  <author>
    <name>Lewis-qi</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>js中let、const、var区别-浅谈</title>
    <link href="http://lewis.qi.tk/2020/05/16/js%E4%B8%ADlet%E3%80%81const%E3%80%81var%E5%8C%BA%E5%88%AB-%E6%B5%85%E8%B0%88/"/>
    <id>http://lewis.qi.tk/2020/05/16/js%E4%B8%ADlet%E3%80%81const%E3%80%81var%E5%8C%BA%E5%88%AB-%E6%B5%85%E8%B0%88/</id>
    <published>2020-05-16T11:56:24.000Z</published>
    <updated>2020-05-16T12:05:39.170Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104784380" target="_blank" rel="noopener">js中let、const、var区别-浅谈</a></p><h2 id="var变量"><a href="#var变量" class="headerlink" title="var变量"></a>var变量</h2><p>1.var变量：可以不初始化，可以修改，若不初始化输出undefined<br>2.var变量：跨块访问,。（没有块的概念）<br>3.var变量：不能跨函数访问</p><h2 id="let变量（es6块级作用域）"><a href="#let变量（es6块级作用域）" class="headerlink" title="let变量（es6块级作用域）"></a>let变量（es6块级作用域）</h2><p>1.let变量：函数内部let定义，对函数外部无影响<br>2.let变量：块作用域里访问，<br>3.let变量：不能跨块访问，不能跨函数访问</p><h2 id="const-常量（同宏定义一样）"><a href="#const-常量（同宏定义一样）" class="headerlink" title="const 常量（同宏定义一样）"></a>const 常量（同宏定义一样）</h2><p>1.const常量：必须初始化，不可以修改<br>2.const常量：块作用域里访问，<br>3.const常量：不能跨块访问，不能跨函数访问</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104784380&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;js中let、const、var区别-浅谈&lt;/a&gt;&lt;/
      
    
    </summary>
    
    
      <category term="es6" scheme="http://lewis.qi.tk/categories/es6/"/>
    
    
      <category term="es6" scheme="http://lewis.qi.tk/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB学习（中级）</title>
    <link href="http://lewis.qi.tk/2020/05/16/MongoDB%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%AD%E7%BA%A7%EF%BC%89/"/>
    <id>http://lewis.qi.tk/2020/05/16/MongoDB%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%AD%E7%BA%A7%EF%BC%89/</id>
    <published>2020-05-16T11:56:04.000Z</published>
    <updated>2020-05-16T12:04:23.562Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105012851" target="_blank" rel="noopener">MongoDB学习（中级）</a></p><h2 id="10-mongoose"><a href="#10-mongoose" class="headerlink" title="10.mongoose"></a>10.mongoose</h2><ul><li>nodejs用对象的形式表示MongoDB的文档，即数据把文档转换为对象<ul><li>用中间件和应用逻辑挂钩</li><li>创建schema的文档结构约束</li><li>Model对象是集合中的所有文档的表示，相当于MongoDB数据库中的集合</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-comment">//连接数据库(端口号默认27017，可以省略不写)</span><br><span class="hljs-comment">//因为没有事务操作，所以只需要连接一次</span><br><span class="hljs-comment">//mongoose.connect('mongodb://数据库的ip地址：端口号/数据库名',&#123;useMongoClient:true&#125;);</span><br><span class="hljs-comment">// mongoose.connect('mongodb://localhost:27017/test',&#123;useMongoClient:true&#125;);</span><br><br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        type:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-comment">//通过Scheme来创建Model模型，就是来映射数据库的集合</span><br><span class="hljs-comment">//mongoose.model(modelName,Schema);</span><br><span class="hljs-comment">//modelName是数据库的集合名（表）</span><br><span class="hljs-comment">//注意：自动将集合名添加s（复数）</span><br><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment">//向数据库插入文档</span><br>StuModel.create([<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span>,<br>        age:<span class="hljs-number">20</span>,<br>        gender:<span class="hljs-string">"famale"</span>,<br>        address:<span class="hljs-string">"HangZhou"</span><br>    &#125;,<br>    &#123;<br>        name:<span class="hljs-string">"lisi"</span>,<br>        age:<span class="hljs-number">22</span>,<br>        gender:<span class="hljs-string">"male"</span>,<br>        address:<span class="hljs-string">"ShangHai"</span> <br>    &#125;<br>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!err)&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"插入成功"</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"插入失败"</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">//监听数据库的连接状态</span><br>mongoose.connection.once(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接成功"</span>);<br>    <span class="hljs-comment">//在node控制台显示</span><br>    <span class="hljs-comment">//console.log(arguments);</span><br>&#125;);<br><br>mongoose.connection.once(<span class="hljs-string">'close'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接断开"</span>);<br>&#125;);<br><br><span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-comment">//连接数据库(端口号默认27017，可以省略不写)</span><br><span class="hljs-comment">//因为没有事务操作，所以只需要连接一次</span><br><span class="hljs-comment">//mongoose.connect('mongodb://数据库的ip地址：端口号/数据库名',&#123;useMongoClient:true&#125;);</span><br><span class="hljs-comment">// mongoose.connect('mongodb://localhost:27017/test',&#123;useMongoClient:true&#125;);</span><br><br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        type:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-comment">//通过Scheme来创建Model模型，就是来映射数据库的集合</span><br><span class="hljs-comment">//mongoose.model(modelName,Schema);</span><br><span class="hljs-comment">//modelName是数据库的集合名（表）</span><br><span class="hljs-comment">//注意：自动将集合名添加s（复数）</span><br><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment">//向数据库插入文档</span><br>StuModel.create([<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span>,<br>        age:<span class="hljs-number">20</span>,<br>        gender:<span class="hljs-string">"famale"</span>,<br>        address:<span class="hljs-string">"HangZhou"</span><br>    &#125;,<br>    &#123;<br>        name:<span class="hljs-string">"lisi"</span>,<br>        age:<span class="hljs-number">22</span>,<br>        gender:<span class="hljs-string">"male"</span>,<br>        address:<span class="hljs-string">"ShangHai"</span> <br>    &#125;<br>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!err)&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"插入成功"</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"插入失败"</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">//监听数据库的连接状态</span><br>mongoose.connection.once(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接成功"</span>);<br>    <span class="hljs-comment">//在node控制台显示</span><br>    <span class="hljs-comment">//console.log(arguments);</span><br>&#125;);<br><br>mongoose.connection.once(<span class="hljs-string">'close'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接断开"</span>);<br>&#125;);<br><br><span class="hljs-comment">// //断开数据库连接（不常用）</span><br>mongoose.disconnect();<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="注：node中Model用法"><a href="#注：node中Model用法" class="headerlink" title="注：node中Model用法"></a>注：node中Model用法</h3><p> $\color{red}10.1创建、查询$</p><ul><li>1.向数据库插入文档<ul><li>Model名.create(doc,function(err){});</li></ul></li><li>2.查询符合条件的第一个文档<ul><li>Model名.findOne(conditions,projection,options,callback)</li></ul></li><li>3.查询所有符合条件的文档<ul><li>Model名.find(conditions,projection,options,callback)</li></ul></li><li>4.根据文档的id属性查询文档<ul><li>Model名.findById(id,projection,options,callback)<ul><li>doc是要插入的文档,function(err){}是回调函数</li><li>conditions查询条件</li><li>projection投影</li><li>options查询选项（skip、limit）</li><li>callback查询结果通过回调函数返回</li></ul></li></ul></li><li>5.还可以在Navicat中用db.students.find();查询，</li><li>$\color{red}查询结果都是文档对象，是Model的实例$</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//查询符合条件的第一个文档</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br>StuModel.find(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//查询所有符合条件的文档</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第二个参数，投影：是否显示（用数字表示）</span><br>StuModel.find(<br>    &#123;&#125;,<br>    &#123;<br>        name:<span class="hljs-number">1</span>,<br>        _id:<span class="hljs-number">0</span><br>    &#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第二个参数，投影：是否显示（用字符串表示，加-为不显示）</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-string">'name age -_id'</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第三个参数，skip、limit</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-string">'name age -_id'</span>,<br>    &#123;<br>        skip:<span class="hljs-number">1</span>,<span class="hljs-attr">limit</span>:<span class="hljs-number">1</span><br>    &#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//根据文档的id属性查询文档</span><br><span class="hljs-comment">//第一个参数id</span><br>StuModel.findById(<br>    <span class="hljs-string">"5e7434c09a64954b6077c4a1"</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in"><code class="language-hljs javascript"><span class="hljs-comment">//查询符合条件的第一个文档</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br>StuModel.find(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//查询所有符合条件的文档</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第二个参数，投影：是否显示（用数字表示）</span><br>StuModel.find(<br>    &#123;&#125;,<br>    &#123;<br>        name:<span class="hljs-number">1</span>,<br>        _id:<span class="hljs-number">0</span><br>    &#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第二个参数，投影：是否显示（用字符串表示，加-为不显示）</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-string">'name age -_id'</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span class="hljs-comment">//查询所有符合条件的文档</span><br><span class="hljs-comment">//第三个参数，skip、limit</span><br>StuModel.find(<br>    &#123;&#125;,<br>    <span class="hljs-string">'name age -_id'</span>,<br>    &#123;<br>        skip:<span class="hljs-number">1</span>,<span class="hljs-attr">limit</span>:<span class="hljs-number">1</span><br>    &#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><br><span class="hljs-comment">//根据文档的id属性查询文档</span><br><span class="hljs-comment">//第一个参数id</span><br>StuModel.findById(<br>    <span class="hljs-string">"5e7434c09a64954b6077c4a1"</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}10.2更新$</p><ul><li>1.修改一个或多个文档<ul><li>Model名.update(conditions,doc,options,callback);</li></ul></li><li>2.修改一个文档<ul><li>Model名.updateOne(conditions,doc,options,callback);</li></ul></li><li>3.修改多个文档<ul><li>Model名.updateMany(conditions,doc,options,callback);</li></ul></li><li>4.替换一个文档<ul><li>Model名.replaceOne(conditions,doc,options,callback);<ul><li>conditions修改条件</li><li>doc是修改后的文档对象</li><li>options修改选项（oldEnough、ferret、multi）</li><li>callback修改结果通过回调函数返回</li></ul></li></ul></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs less"><span class="hljs-comment">//更新操作</span><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.update</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,<br>    &#123;<br>        <span class="hljs-comment">//更新所有文档</span><br>        <span class="hljs-attribute">multi</span>:true<br>        <span class="hljs-comment">//更新一个文档</span><br>        <span class="hljs-comment">//multi:false</span><br>    &#125;,<br>    <span class="hljs-selector-tag">function</span>(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.updateOne</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,function(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.updateMany</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,function(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string"><code class="language-hljs less"><span class="hljs-comment">//更新操作</span><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.update</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,<br>    &#123;<br>        <span class="hljs-comment">//更新所有文档</span><br>        <span class="hljs-attribute">multi</span>:true<br>        <span class="hljs-comment">//更新一个文档</span><br>        <span class="hljs-comment">//multi:false</span><br>    &#125;,<br>    <span class="hljs-selector-tag">function</span>(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.updateOne</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,function(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-selector-tag">StuModel</span><span class="hljs-selector-class">.updateMany</span>(<br>    &#123;<br>        <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<br>    &#123;<br>        $<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">22</span>&#125;<br>    &#125;,function(err)&#123;<br>        <span class="hljs-selector-tag">if</span>(!err)&#123;<br>            <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}10.3删除、计数$</p><ul><li>1.删除一个或多个文档（包括文档结构）<ul><li>Model名.remove(conditions,callback);</li></ul></li><li>2.删除一个文档<ul><li>Model名.deleteOne(conditions,callback);</li></ul></li><li>3.删除多个文档<ul><li>Model名.deleteMany(conditions,callback);</li></ul></li><li>4.统计文档数量<ul><li>Model名.count(conditions,callback);<ul><li>conditions修改条件</li><li>callback修改结果通过回调函数返回</li></ul></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//删除操作</span><br>StuModel.remove(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br>StuModel.deleteOne(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br>StuModel.deleteMany(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-comment">//统计文档数量</span><br>StuModel.count(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in"><code class="language-hljs javascript"><span class="hljs-comment">//删除操作</span><br>StuModel.remove(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br>StuModel.deleteOne(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br>StuModel.deleteMany(<br>    &#123;<br>        name:<span class="hljs-string">"zhangsan"</span><br>    &#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-comment">//统计文档数量</span><br>StuModel.count(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(count);<br>        &#125;<br>    &#125;<br>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="color-red-10-4-document和集合中的文档一一对应，document是Model的实例"><a href="#color-red-10-4-document和集合中的文档一一对应，document是Model的实例" class="headerlink" title="$\color{red}10.4 document和集合中的文档一一对应，document是Model的实例$"></a>$\color{red}10.4 document和集合中的文档一一对应，document是Model的实例$</h2><ul><li>1.var doc = new StuModel({…});</li><li>doc.save(options,fn)</li><li>doc.updata(updata,options,callback)</li><li>doc.get(“age”);</li><li>doc.set(“age”,”123”);doc.save();</li><li>doc._id;</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是来文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        type:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment">//document(doc)的方法</span><br><span class="hljs-comment">//创建一个document</span><br><span class="hljs-comment">//方式1</span><br><span class="hljs-keyword">var</span> stu = <span class="hljs-keyword">new</span> StuModel(&#123;<br>    name:<span class="hljs-string">"lisi"</span>,<br>    age:<span class="hljs-string">"30"</span>,<br>    gender:<span class="hljs-string">"male"</span>,<br>    address:<span class="hljs-string">"HangZhou"</span><br>&#125;);<br><br><br><span class="hljs-comment">//doc.save(options,fn)</span><br>stu.save(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!err)&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"保存成功"</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">//方式2</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-comment">//doc.updata(updata,options,callback)</span><br>        doc.update(&#123;<span class="hljs-attr">$set</span>:&#123;<span class="hljs-attr">age</span>:<span class="hljs-number">28</span>&#125;&#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!err)&#123;<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"修改成功"</span>);<br>            &#125;<br>        &#125;)<br>        <span class="hljs-comment">//doc.remove(callback)</span><br>        doc.remove(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!err)&#123;<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>            &#125;<br>        &#125;)<br>    &#125;<br>);<br><br><span class="hljs-comment">//方式3(方式2的化简，直接调用属性)</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            doc.age = <span class="hljs-number">28</span>;<br>            doc.save();<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-comment">//doc.get("age");</span><br><span class="hljs-comment">//doc.set("age","123");doc.save();</span><br><span class="hljs-comment">//doc.id;</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-comment">//doc.get("age");</span><br>            <span class="hljs-comment">//等价于doc.age；</span><br>            <span class="hljs-comment">//doc.set("age","123");doc.save();</span><br>            <span class="hljs-comment">//等价于doc.age = 28;doc.save();</span><br>            <span class="hljs-comment">//console.log(doc._id);</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是来文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        type:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment">//document(doc)的方法</span><br><span class="hljs-comment">//创建一个document</span><br><span class="hljs-comment">//方式1</span><br><span class="hljs-keyword">var</span> stu = <span class="hljs-keyword">new</span> StuModel(&#123;<br>    name:<span class="hljs-string">"lisi"</span>,<br>    age:<span class="hljs-string">"30"</span>,<br>    gender:<span class="hljs-string">"male"</span>,<br>    address:<span class="hljs-string">"HangZhou"</span><br>&#125;);<br><br><br><span class="hljs-comment">//doc.save(options,fn)</span><br>stu.save(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!err)&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"保存成功"</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">//方式2</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-comment">//doc.updata(updata,options,callback)</span><br>        doc.update(&#123;<span class="hljs-attr">$set</span>:&#123;<span class="hljs-attr">age</span>:<span class="hljs-number">28</span>&#125;&#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!err)&#123;<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"修改成功"</span>);<br>            &#125;<br>        &#125;)<br>        <span class="hljs-comment">//doc.remove(callback)</span><br>        doc.remove(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!err)&#123;<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"删除成功"</span>);<br>            &#125;<br>        &#125;)<br>    &#125;<br>);<br><br><span class="hljs-comment">//方式3(方式2的化简，直接调用属性)</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            doc.age = <span class="hljs-number">28</span>;<br>            doc.save();<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><br><span class="hljs-comment">//doc.get("age");</span><br><span class="hljs-comment">//doc.set("age","123");doc.save();</span><br><span class="hljs-comment">//doc.id;</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-comment">//doc.get("age");</span><br>            <span class="hljs-comment">//等价于doc.age；</span><br>            <span class="hljs-comment">//doc.set("age","123");doc.save();</span><br>            <span class="hljs-comment">//等价于doc.age = 28;doc.save();</span><br>            <span class="hljs-comment">//console.log(doc._id);</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"修改成功"</span>);<br>        &#125;<br>    &#125;<br>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="color-red-10-5mongoose模块化"><a href="#color-red-10-5mongoose模块化" class="headerlink" title="$\color{red}10.5mongoose模块化$"></a>$\color{red}10.5mongoose模块化$</h2><p>把连接数据库、创建model模型约束、增删查改分成三个js文件</p><p>连接数据库tools/connect-mongoose.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-comment">//连接数据库(端口号默认27017，可以省略不写)</span><br><span class="hljs-comment">//mongoose.connect('mongodb://数据库的ip地址：端口号/数据库名',&#123;useMongoClient:true&#125;);</span><br><span class="hljs-comment">// mongoose.connect('mongodb://localhost:27017/test',&#123;useMongoClient:true&#125;);</span><br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><span class="hljs-comment">//监听数据库的连接状态</span><br>mongoose.connection.once(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接成功"</span>);<br>    <span class="hljs-comment">//在node控制台显示</span><br>    <span class="hljs-comment">//console.log(arguments);</span><br>&#125;);<br><br><br><span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-comment">//连接数据库(端口号默认27017，可以省略不写)</span><br><span class="hljs-comment">//mongoose.connect('mongodb://数据库的ip地址：端口号/数据库名',&#123;useMongoClient:true&#125;);</span><br><span class="hljs-comment">// mongoose.connect('mongodb://localhost:27017/test',&#123;useMongoClient:true&#125;);</span><br>mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);<br><span class="hljs-comment">//监听数据库的连接状态</span><br>mongoose.connection.once(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库连接成功"</span>);<br>    <span class="hljs-comment">//在node控制台显示</span><br>    <span class="hljs-comment">//console.log(arguments);</span><br>&#125;);<br><br><br><span class="hljs-comment">//没有暴露变量</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>创建model模型约束models/student-model.js</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs typescript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是来文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        <span class="hljs-keyword">type</span>:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-comment">//通过Scheme来创建Model模型，就是来映射数据库的集合</span><br><span class="hljs-comment">//注意：自动将集合名添加s（复数）</span><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment"><code class="language-hljs typescript"><span class="hljs-comment">//引入</span><br><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);<br><br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">//创建Scheme（模式）对象，就是来文档结构约束</span><br><span class="hljs-keyword">var</span> stuSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>    name:<span class="hljs-built_in">String</span>,<br>    age:<span class="hljs-built_in">Number</span>,<br>    gender:&#123;<br>        <span class="hljs-keyword">type</span>:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-keyword">default</span>:<span class="hljs-string">"male"</span><br>    &#125;,<br>    address:<span class="hljs-built_in">String</span><br>&#125;);<br><br><span class="hljs-comment">//通过Scheme来创建Model模型，就是来映射数据库的集合</span><br><span class="hljs-comment">//注意：自动将集合名添加s（复数）</span><br><span class="hljs-keyword">var</span> StuModel = mongoose.model(<span class="hljs-string">"student"</span>,stuSchema);<br><br><br><span class="hljs-comment">//暴露</span><br>model.exports = StuModel;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>增删查改student.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//引入连接</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">"./static/tools/connect-mongoose"</span>);<br><span class="hljs-comment">//引入模型（文档约束）</span><br><span class="hljs-keyword">var</span> StuModel = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./static/models/student-model"</span>);<br><br><span class="hljs-comment">//查询符合条件的第一个文档</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in"><code class="language-hljs javascript"><span class="hljs-comment">//引入连接</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">"./static/tools/connect-mongoose"</span>);<br><span class="hljs-comment">//引入模型（文档约束）</span><br><span class="hljs-keyword">var</span> StuModel = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./static/models/student-model"</span>);<br><br><span class="hljs-comment">//查询符合条件的第一个文档</span><br>StuModel.findOne(<br>    &#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,doc</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!err)&#123;<br>            <span class="hljs-built_in">console</span>.log(doc);<br>        &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="11-用户"><a href="#11-用户" class="headerlink" title="11.用户"></a>11.用户</h2><p>1.默认情况下，MongoDB 不会进行身份验证，也没有账号<br>2.超级用户和数据库用户。用户信息保存在 db.system.users<br>3.一个数据库可以包含多个用户，$\color{red}一个用户只能在一个数据库下，不同数据库中的用户可以同名$<br>4.特定数据库比如 test1 下的用户 test_user1，不能够访问其他数据库 test2，但是可以访问本数据库下其他用户创建的数据  </p><p>一、添加用户<br>$\color{red}用户在哪个库创建，就要在哪个库auth认证，并在mongo登录时也要先连接认证库$</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs vim">&gt;use admin<br>&gt;db.createUser(&#123;<br>  user:<span class="hljs-string">'test_user'</span>,<br>  <span class="hljs-keyword">pwd</span>:<span class="hljs-string">'123456'</span>,<br>  customDat<span class="hljs-variable">a:</span>&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"这是介绍"</span>&#125;，<br>  role<span class="hljs-variable">s:</span>[&#123;role:<span class="hljs-string">'userAdminAnyDatabase'</span>,d<span class="hljs-variable">b:</span><span class="hljs-string">'admin'</span>&#125; | <span class="hljs-string">"&lt;role&gt;"</span> ]<br> &#125;)<br>//验证是否存在对应用户<br>&gt; db.auth(<span class="hljs-string">"test_user"</span>,<span class="hljs-string"><code class="language-hljs vim">&gt;use admin<br>&gt;db.createUser(&#123;<br>  user:<span class="hljs-string">'test_user'</span>,<br>  <span class="hljs-keyword">pwd</span>:<span class="hljs-string">'123456'</span>,<br>  customDat<span class="hljs-variable">a:</span>&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"这是介绍"</span>&#125;，<br>  role<span class="hljs-variable">s:</span>[&#123;role:<span class="hljs-string">'userAdminAnyDatabase'</span>,d<span class="hljs-variable">b:</span><span class="hljs-string">'admin'</span>&#125; | <span class="hljs-string">"&lt;role&gt;"</span> ]<br> &#125;)<br>//验证是否存在对应用户<br>&gt; db.auth(<span class="hljs-string">"test_user"</span>,<span class="hljs-string">"password"</span>)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>user用户名</li><li>pwd密码</li><li>customData介绍</li><li>roles<ul><li>role用户的角色</li><li>db数据库</li><li>roles字段，指定内置角色和用户定义的角色</li></ul></li></ul><p>注：用户的角色:</p><ul><li><ol><li>数据库用户角色</li></ol><ul><li>read;允许用户读取指定数据库</li><li>readWrite;  允许用户读写指定数据库</li></ul></li><li><ol start="2"><li>数据库管理角色</li></ol><ul><li>dbAdmin:允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</li><li>dbOwner</li><li>userAdmin:允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</li></ul></li><li><ol start="3"><li>集群管理角色(只在admin数据库中可用)</li></ol><ul><li>clusterAdmin:赋予用户所有分片和复制集相关函数的管理权限</li><li>clusterManager</li><li>clusterMonitor</li><li>hostManager；  </li></ul></li><li><ol start="4"><li>备份恢复角色</li></ol><ul><li>backup</li><li>restore</li></ul></li><li><ol start="5"><li>所有数据库角色(只在admin数据库中可用)</li></ol><ul><li>readAnyDatabase:赋予用户所有数据库的读权限</li><li>readWriteAnyDatabase:赋予用户所有数据库的读写权限</li><li>userAdminAnyDatabase:赋予用户所有数据库的userAdmin权限</li><li>dbAdminAnyDatabase  :赋予用户所有数据库的dbAdmin权限</li></ul></li><li><ol start="6"><li>超级用户角色(只在admin数据库中可用)</li></ol><ul><li>root:赋予用户所有数据库的dbAdmin权限</li></ul></li><li><ol start="7"><li>内部角色</li></ol><ul><li>__system  </li></ul></li></ul><p>二、修改用户</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs groovy">db.updateUser(<br>  <span class="hljs-string">"&lt;username&gt;"</span>,<br>  &#123;<br>    <span class="hljs-string">customData :</span> &#123; 这是介绍 &#125;,<br>    <span class="hljs-string">roles :</span> [<br>              &#123; <span class="hljs-string">role:</span> <span class="hljs-string">"readWriteAnyDatabase"</span>, <span class="hljs-string">db:</span> <span class="hljs-string">"admin"</span> &#125; | <span class="hljs-string">"&lt;role&gt;"</span>,<br>              ...<br>            ],<br><span class="hljs-symbol">    pwd:</span> <span class="hljs-string">"123456"</span><br>    &#125;,<br><span class="hljs-symbol">    writeConcern:</span> &#123;<span class="hljs-string"><code class="language-hljs groovy">db.updateUser(<br>  <span class="hljs-string">"&lt;username&gt;"</span>,<br>  &#123;<br>    <span class="hljs-string">customData :</span> &#123; 这是介绍 &#125;,<br>    <span class="hljs-string">roles :</span> [<br>              &#123; <span class="hljs-string">role:</span> <span class="hljs-string">"readWriteAnyDatabase"</span>, <span class="hljs-string">db:</span> <span class="hljs-string">"admin"</span> &#125; | <span class="hljs-string">"&lt;role&gt;"</span>,<br>              ...<br>            ],<br><span class="hljs-symbol">    pwd:</span> <span class="hljs-string">"123456"</span><br>    &#125;,<br><span class="hljs-symbol">    writeConcern:</span> &#123;<span class="hljs-string">"xxx"</span>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>username用户名</li><li>customData介绍</li><li>roles修改的角色们<ul><li>role用户的角色</li><li>db数据库</li></ul></li><li>pwd密码</li><li>writeConcern：用来指定mongod对写操作的回执行为</li></ul><p>三、修改用户权限，不会覆盖原权限信息，只新增权限</p><ul><li>db.grantRolesToUser(<br>  “jianlong”,<br>  [<pre><code>{    role:&apos;readWrite&apos;,    db:&apos;test&apos;}</code></pre>  ]<br>);</li></ul><p>四、修改用户密码</p><ul><li>db.changeUserPassword(“username”,”newPasswd”)</li></ul><p>五、删除用户</p><ul><li>db.dropUser(“username”)</li></ul><p>六、查看角色的具体privilege（权限）</p><ul><li>db.getRole(“SenderHis_Read”,{showPrivileges:true})</li></ul><p>测试：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs stata">1.查看数据库<br>&gt; show dbs<br>2.转到 <span class="hljs-keyword">test</span> 数据库，查看 admin 数据库中的用户信息<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br>3.转到 <span class="hljs-keyword">test</span> 数据库，查看 admin 数据库中的用户信息<br>&gt; <span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br>4.在 <span class="hljs-keyword">test</span> 数据库，插入test_data 集合，测试数据<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.find();<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b23efc2d5603a1090b4c"</span>), <span class="hljs-string">"id"</span> : 1, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b247fc2d5603a1090b4d"</span>), <span class="hljs-string">"id"</span> : 2, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b24dfc2d5603a1090b4e"</span>), <span class="hljs-string">"id"</span> : 3, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br><br>5.在 <span class="hljs-keyword">test</span> 数据库创建用户<br>&gt;<span class="hljs-keyword">db</span>.createUser(&#123;<br>  user:'test_user',<br>  <span class="hljs-keyword">pwd</span>:'123456',<br>  customData:&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"测试testuser用户"</span>&#125;,<br>  roles:[&#123;role:'readWrite',<span class="hljs-keyword">db</span>:'<span class="hljs-keyword">test</span>'&#125;]<br> &#125;)<br><br>6.验证数据库中是否存在对应的用户<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br><br>7.以认证的方式启动数据库（在<span class="hljs-keyword">test</span>中实现）<br>&gt; <span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.auth(<span class="hljs-string">"test_user"</span>,<span class="hljs-string">"123456"</span>)<br><br><br>8.再创建 test1 数据库，创建对象 test1_data，插入数据<br>&gt; <span class="hljs-keyword">use</span> test1<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.find()<br><br><br>9.再创建 test2 数据库，创建对象 test2_data，插入数据<br>&gt; <span class="hljs-keyword">use</span> test2<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.find()<br><br><br>10.重新以认证的方式启动数据库，启动时添加 –auth 参数<br>mongod --dbpath=<span class="hljs-keyword">D</span>:\mongoDB\data\<span class="hljs-keyword">db</span> --logpath=<span class="hljs-keyword">D</span>:\mongoDB\data\<span class="hljs-keyword">log</span>\mongod.<span class="hljs-keyword">log</span> --auth<br><br>11.先登录<br>   再 admin.system.users 中添加super用户，使认证授权服务生效<br>   再 admin 数据库中创建用户 supper，密码为 123456<br>&gt; mongo<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.createUser(&#123;<br>  user:'super',<br>  <span class="hljs-keyword">pwd</span>:'123456',<br>  customData:&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"测试super用户"</span>&#125;,<br>  roles:[&#123;role:'readWriteAnyDatabase',<span class="hljs-keyword">db</span>:'admin'&#125;]<br> &#125;)<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.auth(<span class="hljs-string">"super"</span>,<span class="hljs-string">"123456"</span>)<br><br><br>12.总结<br><br>以默认方式登录，即以无认证用户登录，查询的时候会显示无权限<br>&gt; mongo<br>&gt; show dbs<br><br>使用 <span class="hljs-keyword">test</span> 数据库中的用户可以查询 <span class="hljs-keyword">test</span> 的数据，但是不能查看其他的数据库的数据(已经在<span class="hljs-keyword">test</span>数据库中认证的)<br>&gt; mongo 127.0.0.1/<span class="hljs-keyword">test</span> -<span class="hljs-keyword">u</span> test_user -p 123456<br>&gt; show dbs<br><br>使用 supper 用户登录，可以对 MongoDB 系统内的所有数据库进行操作(已经在admin数据库中认证的)<br>&gt; mongo 127.0.0.1/admin -<span class="hljs-keyword"><code class="language-hljs stata">1.查看数据库<br>&gt; show dbs<br>2.转到 <span class="hljs-keyword">test</span> 数据库，查看 admin 数据库中的用户信息<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br>3.转到 <span class="hljs-keyword">test</span> 数据库，查看 admin 数据库中的用户信息<br>&gt; <span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br>4.在 <span class="hljs-keyword">test</span> 数据库，插入test_data 集合，测试数据<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am a test"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test_data.find();<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b23efc2d5603a1090b4c"</span>), <span class="hljs-string">"id"</span> : 1, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b247fc2d5603a1090b4d"</span>), <span class="hljs-string">"id"</span> : 2, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br>输出：&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5e75b24dfc2d5603a1090b4e"</span>), <span class="hljs-string">"id"</span> : 3, <span class="hljs-string">"info"</span> : <span class="hljs-string">"I am a test"</span> &#125;<br><br>5.在 <span class="hljs-keyword">test</span> 数据库创建用户<br>&gt;<span class="hljs-keyword">db</span>.createUser(&#123;<br>  user:'test_user',<br>  <span class="hljs-keyword">pwd</span>:'123456',<br>  customData:&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"测试testuser用户"</span>&#125;,<br>  roles:[&#123;role:'readWrite',<span class="hljs-keyword">db</span>:'<span class="hljs-keyword">test</span>'&#125;]<br> &#125;)<br><br>6.验证数据库中是否存在对应的用户<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.system.users.find()<br><br><br>7.以认证的方式启动数据库（在<span class="hljs-keyword">test</span>中实现）<br>&gt; <span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.auth(<span class="hljs-string">"test_user"</span>,<span class="hljs-string">"123456"</span>)<br><br><br>8.再创建 test1 数据库，创建对象 test1_data，插入数据<br>&gt; <span class="hljs-keyword">use</span> test1<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test1"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test1_data.find()<br><br><br>9.再创建 test2 数据库，创建对象 test2_data，插入数据<br>&gt; <span class="hljs-keyword">use</span> test2<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.insert(&#123;<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"info"</span>:<span class="hljs-string">"I am in test2"</span>&#125;)<br>&gt; <span class="hljs-keyword">db</span>.test2_data.find()<br><br><br>10.重新以认证的方式启动数据库，启动时添加 –auth 参数<br>mongod --dbpath=<span class="hljs-keyword">D</span>:\mongoDB\data\<span class="hljs-keyword">db</span> --logpath=<span class="hljs-keyword">D</span>:\mongoDB\data\<span class="hljs-keyword">log</span>\mongod.<span class="hljs-keyword">log</span> --auth<br><br>11.先登录<br>   再 admin.system.users 中添加super用户，使认证授权服务生效<br>   再 admin 数据库中创建用户 supper，密码为 123456<br>&gt; mongo<br>&gt; <span class="hljs-keyword">use</span> admin<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.createUser(&#123;<br>  user:'super',<br>  <span class="hljs-keyword">pwd</span>:'123456',<br>  customData:&#123;<span class="hljs-string">"desc"</span>:<span class="hljs-string">"测试super用户"</span>&#125;,<br>  roles:[&#123;role:'readWriteAnyDatabase',<span class="hljs-keyword">db</span>:'admin'&#125;]<br> &#125;)<br>&gt; <span class="hljs-keyword">db</span>.getUsers()<br>&gt; <span class="hljs-keyword">db</span>.auth(<span class="hljs-string">"super"</span>,<span class="hljs-string">"123456"</span>)<br><br><br>12.总结<br><br>以默认方式登录，即以无认证用户登录，查询的时候会显示无权限<br>&gt; mongo<br>&gt; show dbs<br><br>使用 <span class="hljs-keyword">test</span> 数据库中的用户可以查询 <span class="hljs-keyword">test</span> 的数据，但是不能查看其他的数据库的数据(已经在<span class="hljs-keyword">test</span>数据库中认证的)<br>&gt; mongo 127.0.0.1/<span class="hljs-keyword">test</span> -<span class="hljs-keyword">u</span> test_user -p 123456<br>&gt; show dbs<br><br>使用 supper 用户登录，可以对 MongoDB 系统内的所有数据库进行操作(已经在admin数据库中认证的)<br>&gt; mongo 127.0.0.1/admin -<span class="hljs-keyword">u</span> super -p 123456<br>> show dbs<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="12-复制（最好使用逻辑DNS主机名而不是IP地址）"><a href="#12-复制（最好使用逻辑DNS主机名而不是IP地址）" class="headerlink" title="12.复制（最好使用逻辑DNS主机名而不是IP地址）"></a>12.复制（最好使用逻辑DNS主机名而不是IP地址）</h2><ul><li>mongodb的复制至少需要两个节点。</li><li>各个节点常见的搭配方式为：一主一从、一主多从。<ul><li>主节点，负责处理客户端请求，同步主节点的数据；</li><li>其余的都是从节点，负责复制主节点上的数据</li></ul></li><li>副本集<ul><li>N 个节点的集群</li><li>任何节点可作为主节点</li><li>所有写入操作都在主节点上</li></ul></li></ul><p>1.副本集各节点IP如下：</p><ul><li>172.16.250.238  </li><li>172.16.250.239  </li><li>172.16.250.240  </li></ul><p>2.依次修改各个节点的 $\color{red}mongodb.conf$ 配置文件，增加副本集相关配置:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs ini"><span class="hljs-attr">dbpath</span>=D:\mongoDB\data\db<br><span class="hljs-attr">logpath</span>=D:\mongoDB\data\log<br><span class="hljs-attr">fork</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">logappend</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">bind_ip</span>=<span class="hljs-number">172.16</span>.<span class="hljs-number">250.238</span>   <span class="hljs-comment"># 此处填写服务器的IP(三个不同的写三次)</span><br><span class="hljs-attr">port</span>=<span class="hljs-number">27017</span><br><span class="hljs-attr">replSet</span>=rs0             <span class="hljs-comment"><code class="language-hljs ini"><span class="hljs-attr">dbpath</span>=D:\mongoDB\data\db<br><span class="hljs-attr">logpath</span>=D:\mongoDB\data\log<br><span class="hljs-attr">fork</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">logappend</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">bind_ip</span>=<span class="hljs-number">172.16</span>.<span class="hljs-number">250.238</span>   <span class="hljs-comment"># 此处填写服务器的IP(三个不同的写三次)</span><br><span class="hljs-attr">port</span>=<span class="hljs-number">27017</span><br><span class="hljs-attr">replSet</span>=rs0             <span class="hljs-comment"># 设置副本集名称，在各个配置文件中，其值必须相同</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>3.在三个节点上执行,加载文件配置,启动MongoDB服务:<br>mongod -config D:\mongoDB\mongodb.conf</p><p>4.副本集初始化(连接到任意一个MongoDB实例，对副本集进行初始化)<br>出现rs0:SECONDARY&gt;即可</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs arcade">&gt; mongo <span class="hljs-number">172.16</span><span class="hljs-number">.250</span><span class="hljs-number">.238</span>:<span class="hljs-number">27017</span><br>&gt; conf=&#123;<br>    <span class="hljs-string">"_id"</span> : <span class="hljs-string">"rs0"</span>,<br>    <span class="hljs-string">"members"</span> : [<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.234:27017"</span> &#125;,<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.239:27017"</span> &#125;,<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">2</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.240:27017"</span> &#125;<br>        ]<br>  &#125;<br>&gt; rs.initiate(conf)<br>输出：&#123;<br>    <span class="hljs-string">"ok"</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-string">"operationTime"</span> : <span class="hljs-built_in">Timestamp</span>(<span class="hljs-number">1542247326</span>, <span class="hljs-number">1</span>),<br>    <span class="hljs-string">"$clusterTime"</span> : &#123;<br>        <span class="hljs-string">"clusterTime"</span> : <span class="hljs-built_in">Timestamp</span>(<span class="hljs-number">1542247326</span>, <span class="hljs-number">1</span>),<br>        <span class="hljs-string">"signature"</span> : &#123;<br>            <span class="hljs-string">"hash"</span> : BinData(<span class="hljs-number">0</span>,<span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span>),<br>            <span class="hljs-string">"keyId"</span> : NumberLong(<span class="hljs-number"><code class="language-hljs arcade">&gt; mongo <span class="hljs-number">172.16</span><span class="hljs-number">.250</span><span class="hljs-number">.238</span>:<span class="hljs-number">27017</span><br>&gt; conf=&#123;<br>    <span class="hljs-string">"_id"</span> : <span class="hljs-string">"rs0"</span>,<br>    <span class="hljs-string">"members"</span> : [<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.234:27017"</span> &#125;,<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.239:27017"</span> &#125;,<br>        &#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">2</span>, <span class="hljs-string">"host"</span> : <span class="hljs-string">"172.16.250.240:27017"</span> &#125;<br>        ]<br>  &#125;<br>&gt; rs.initiate(conf)<br>输出：&#123;<br>    <span class="hljs-string">"ok"</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-string">"operationTime"</span> : <span class="hljs-built_in">Timestamp</span>(<span class="hljs-number">1542247326</span>, <span class="hljs-number">1</span>),<br>    <span class="hljs-string">"$clusterTime"</span> : &#123;<br>        <span class="hljs-string">"clusterTime"</span> : <span class="hljs-built_in">Timestamp</span>(<span class="hljs-number">1542247326</span>, <span class="hljs-number">1</span>),<br>        <span class="hljs-string">"signature"</span> : &#123;<br>            <span class="hljs-string">"hash"</span> : BinData(<span class="hljs-number">0</span>,<span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span>),<br>            <span class="hljs-string">"keyId"</span> : NumberLong(<span class="hljs-number">0</span>)<br>        &#125;<br>    &#125;<br>&#125;<br>rs0:SECONDARY><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>5.副本集更新</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros"><span class="hljs-comment"># 1.向副本集中添加成员</span><br>&gt; rs.<span class="hljs-builtin-name">add</span>(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 2.从副本集中删除成员</span><br>&gt; rs.<span class="hljs-builtin-name">remove</span>(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 3.向副本集中添加仲裁</span><br>&gt; rs.addArb(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 4.向副本集中添加备份节点</span><br>&gt; rs.<span class="hljs-builtin-name">add</span>(&#123;<span class="hljs-string">"_id"</span>:3,<span class="hljs-string">"host"</span>:<span class="hljs-string">"172.16.250.239:27017"</span>,<span class="hljs-string">"priority"</span>:0,<span class="hljs-string"><code class="language-hljs routeros"><span class="hljs-comment"># 1.向副本集中添加成员</span><br>&gt; rs.<span class="hljs-builtin-name">add</span>(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 2.从副本集中删除成员</span><br>&gt; rs.<span class="hljs-builtin-name">remove</span>(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 3.向副本集中添加仲裁</span><br>&gt; rs.addArb(<span class="hljs-string">"172.16.250.239:27017"</span>)<br> <br><span class="hljs-comment"># 4.向副本集中添加备份节点</span><br>&gt; rs.<span class="hljs-builtin-name">add</span>(&#123;<span class="hljs-string">"_id"</span>:3,<span class="hljs-string">"host"</span>:<span class="hljs-string">"172.16.250.239:27017"</span>,<span class="hljs-string">"priority"</span>:0,<span class="hljs-string">"hidden"</span>:true&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>6.强制让一个从节点成为Primary主节点<br>$\color{red}优先级越高，级别越高，，在主节点崩溃时，按顺位继承主节点$</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs avrasm"><span class="hljs-meta"># 更改副本集主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; var conf=rs.conf()<br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">2</span>   <span class="hljs-meta"># 原来的主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">3</span>   <span class="hljs-meta"># 现在的主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">1</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.reconfig(cfg)               <span class="hljs-meta"><code class="language-hljs avrasm"><span class="hljs-meta"># 更改副本集主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; var conf=rs.conf()<br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">2</span>   <span class="hljs-meta"># 原来的主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">3</span>   <span class="hljs-meta"># 现在的主节点</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; conf.members[<span class="hljs-number">0</span>].priority = <span class="hljs-number">1</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.reconfig(cfg)               <span class="hljs-meta"># 刷新配置</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>7.副本集监控  </p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs avrasm"><span class="hljs-meta"># 1.查看副本集的配置信息</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.conf()<br><br><span class="hljs-meta"># 2.查看副本集运行状态</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.status()<br><br><span class="hljs-meta"># 3.查看主从关系</span><br><span class="hljs-symbol"><code class="language-hljs avrasm"><span class="hljs-meta"># 1.查看副本集的配置信息</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.conf()<br><br><span class="hljs-meta"># 2.查看副本集运行状态</span><br><span class="hljs-symbol">rs0:</span>PRIMARY&gt; rs.status()<br><br><span class="hljs-meta"># 3.查看主从关系</span><br><span class="hljs-symbol">rs0:</span>PRIMARY> rs.isMaster()<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>8.副本集复制测试</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">步骤一：在 <span class="hljs-keyword">Primary</span> 主节点上插入一万条客户数据<br>rs0:<span class="hljs-keyword">PRIMARY</span>&gt; <span class="hljs-keyword">for</span>(var i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10000</span>;i++)&#123;db.customer.<span class="hljs-keyword">insert</span>(&#123;"name":"user"+i&#125;)&#125;<br>输出：WriteResult(&#123; "nInserted" : <span class="hljs-number">1</span> &#125;)<br>rs0:<span class="hljs-keyword">PRIMARY</span>&gt; db.customer.count()<br>输出：<span class="hljs-number">10000</span><br><br><br>步骤二：在 Secondary 从节点上查看客户数据是否已经同步<br>rs0:SECONDARY&gt; rs.slaveOk()<br>rs0:SECONDARY&gt; db.customer.count()<br>输出：<span class="hljs-number"><code class="language-hljs pgsql">步骤一：在 <span class="hljs-keyword">Primary</span> 主节点上插入一万条客户数据<br>rs0:<span class="hljs-keyword">PRIMARY</span>&gt; <span class="hljs-keyword">for</span>(var i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10000</span>;i++)&#123;db.customer.<span class="hljs-keyword">insert</span>(&#123;"name":"user"+i&#125;)&#125;<br>输出：WriteResult(&#123; "nInserted" : <span class="hljs-number">1</span> &#125;)<br>rs0:<span class="hljs-keyword">PRIMARY</span>&gt; db.customer.count()<br>输出：<span class="hljs-number">10000</span><br><br><br>步骤二：在 Secondary 从节点上查看客户数据是否已经同步<br>rs0:SECONDARY&gt; rs.slaveOk()<br>rs0:SECONDARY&gt; db.customer.count()<br>输出：<span class="hljs-number">10000</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>9.副本集故障转移测试</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs css">步骤一：关闭<span class="hljs-selector-tag">Primar</span>主节点的数据库<br><span class="hljs-selector-tag">mongod</span> <span class="hljs-selector-tag">--shutdown</span> <span class="hljs-selector-tag">--dbpath</span> <span class="hljs-selector-tag">D</span>:\<span class="hljs-selector-tag">mongoDB</span>\<span class="hljs-selector-tag">data</span><br><br>步骤二：查看<span class="hljs-selector-tag">Primary</span>节点关闭之前的状态<br><span class="hljs-selector-tag">rs0</span><span class="hljs-selector-pseudo">:PRIMARY</span>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br><span class="hljs-selector-tag">rs0</span><span class="hljs-selector-pseudo">:PRIMARY</span>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.status</span>()<br><br>步骤三：登录任意其他节点上查看<span class="hljs-selector-tag">Primary</span>节点关闭之后的状态<br>&gt; <span class="hljs-selector-tag">mongo</span> 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.239</span><span class="hljs-selector-pseudo">:27017</span><br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.status</span>()<br><br>步骤四：再次启动 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.238</span><span class="hljs-selector-pseudo">:27017</span> 节点，由于其选举优先级最高，自动被选举为<span class="hljs-selector-tag">Primary</span><br>&gt; <span class="hljs-selector-tag">mongo</span> 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.238</span><span class="hljs-selector-pseudo">:27017</span><br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class"><code class="language-hljs css">步骤一：关闭<span class="hljs-selector-tag">Primar</span>主节点的数据库<br><span class="hljs-selector-tag">mongod</span> <span class="hljs-selector-tag">--shutdown</span> <span class="hljs-selector-tag">--dbpath</span> <span class="hljs-selector-tag">D</span>:\<span class="hljs-selector-tag">mongoDB</span>\<span class="hljs-selector-tag">data</span><br><br>步骤二：查看<span class="hljs-selector-tag">Primary</span>节点关闭之前的状态<br><span class="hljs-selector-tag">rs0</span><span class="hljs-selector-pseudo">:PRIMARY</span>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br><span class="hljs-selector-tag">rs0</span><span class="hljs-selector-pseudo">:PRIMARY</span>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.status</span>()<br><br>步骤三：登录任意其他节点上查看<span class="hljs-selector-tag">Primary</span>节点关闭之后的状态<br>&gt; <span class="hljs-selector-tag">mongo</span> 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.239</span><span class="hljs-selector-pseudo">:27017</span><br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.status</span>()<br><br>步骤四：再次启动 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.238</span><span class="hljs-selector-pseudo">:27017</span> 节点，由于其选举优先级最高，自动被选举为<span class="hljs-selector-tag">Primary</span><br>&gt; <span class="hljs-selector-tag">mongo</span> 172<span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.250</span><span class="hljs-selector-class">.238</span><span class="hljs-selector-pseudo">:27017</span><br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.isMaster</span>()<br>&gt; <span class="hljs-selector-tag">rs</span><span class="hljs-selector-class">.status</span>()<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="13-MongoDB分片"><a href="#13-MongoDB分片" class="headerlink" title="13.MongoDB分片"></a>13.MongoDB分片</h2><ul><li><p>Shard:(Shard Server)<br>用于存储实际的数据块。一个shard server角色可由几台机器组个一个replica set承担，防止主机单点故障</p></li><li><p>Config Server:<br>mongod实例。存储了整个 ClusterMetadata，其中包括 chunk信息。</p></li><li><p>Query Routers:（Route Process）<br>前端路由。客户端由此接入，且让整个集群看上去像单一数据库，前端应用可以透明使用。</p></li></ul><p>1.分片结构端口分布</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">Shard<span class="hljs-built_in"> Server </span>1：27020<br>Shard<span class="hljs-built_in"> Server </span>2：27021<br>Shard<span class="hljs-built_in"> Server </span>3：27022<br>Config<span class="hljs-built_in"><code class="language-hljs routeros">Shard<span class="hljs-built_in"> Server </span>1：27020<br>Shard<span class="hljs-built_in"> Server </span>2：27021<br>Shard<span class="hljs-built_in"> Server </span>3：27022<br>Config<span class="hljs-built_in"> Server </span>：27100<br>Route Process：40000<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs dsconfig">步骤一：启动<span class="hljs-string">Shard </span><span class="hljs-string">Server</span><br><span class="hljs-string">新</span>建D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared（</span>在里面新建<span class="hljs-string">s0、</span><span class="hljs-string">s1、</span><span class="hljs-string">s2、</span><span class="hljs-string">log文</span>件夹）<br><span class="hljs-string">bin目</span>录下运行下列命令：<br>&gt; <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27020 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s0"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s0.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in">&gt;</span> <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27021 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s1"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s1.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in">&gt;</span> <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27022 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s2"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s2.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">步骤二：</span> 启动<span class="hljs-string">Config </span><span class="hljs-string">Server</span><br><span class="hljs-string">新</span>建D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared（</span>在里面新建<span class="hljs-string">config文</span>件夹）<br><span class="hljs-string">bin目</span>录下运行下列命令：<br>&gt; <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27100 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\sconfig"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\config.log --logappend --fork</span><br><span class="hljs-string"></span><br><span class="hljs-string">步骤三： 启动Route Process</span><br><span class="hljs-string">【chunkSize这一项是用来指定chunk的大小的，单位是MB，默认大小为200MB】</span><br><span class="hljs-string">&gt; mongos --port 40000 --configdb localhost:27100 --fork --logpath "</span>D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared\</span><span class="hljs-string">log\</span><span class="hljs-string">route.</span><span class="hljs-string">log"</span> <span class="hljs-built_in">--chunkSize</span> <span class="hljs-string">500</span><br><span class="hljs-string"></span><br><span class="hljs-string">步</span>骤四： 配置<span class="hljs-string">Sharding</span><br><span class="hljs-string">登</span>录到<span class="hljs-string">mongos，</span>添加<span class="hljs-string">Shard节</span>点<br>&gt; <span class="hljs-string">mongo </span><span class="hljs-string">admin </span><span class="hljs-built_in">--port</span> <span class="hljs-string">40000</span><br><span class="hljs-string"></span><br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">addshard:</span><span class="hljs-string">"localhost:27020"</span> &#125;)<br>输出：&#123; <span class="hljs-string">"shardAdded"</span> : <span class="hljs-string">"shard0000"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br>...(一共添加<span class="hljs-string">10个</span>)<br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">addshard:</span><span class="hljs-string">"localhost:27029"</span> &#125;)<br>输出：&#123; <span class="hljs-string">"shardAdded"</span> : <span class="hljs-string">"shard0009"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br><br><br><span class="hljs-comment">#设置分片存储的数据库</span><br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">enablesharding:</span><span class="hljs-string">"test"</span> &#125;)<br>输出&#123; <span class="hljs-string">"ok"</span> : 1 &#125;<br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">shardcollection:</span> <span class="hljs-string">"test.log"</span>, <span class="hljs-string">key:</span> &#123; <span class="hljs-string">id:1,</span><span class="hljs-string">time:1&#125;</span>&#125;)<br>输出：&#123; <span class="hljs-string">"collectionsharded"</span> : <span class="hljs-string">"test.log"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br><br><br>步骤五：将数据库连接接入接口<span class="hljs-string"><code class="language-hljs dsconfig">步骤一：启动<span class="hljs-string">Shard </span><span class="hljs-string">Server</span><br><span class="hljs-string">新</span>建D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared（</span>在里面新建<span class="hljs-string">s0、</span><span class="hljs-string">s1、</span><span class="hljs-string">s2、</span><span class="hljs-string">log文</span>件夹）<br><span class="hljs-string">bin目</span>录下运行下列命令：<br>&gt; <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27020 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s0"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s0.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in">&gt;</span> <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27021 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s1"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s1.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in">&gt;</span> <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27022 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\s2"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\s2.log"</span> <span class="hljs-built_in">--logappend</span> <span class="hljs-built_in">--fork</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">步骤二：</span> 启动<span class="hljs-string">Config </span><span class="hljs-string">Server</span><br><span class="hljs-string">新</span>建D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared（</span>在里面新建<span class="hljs-string">config文</span>件夹）<br><span class="hljs-string">bin目</span>录下运行下列命令：<br>&gt; <span class="hljs-string">mongod </span><span class="hljs-built_in">--port</span> <span class="hljs-string">27100 </span><span class="hljs-built_in">--dbpath</span> <span class="hljs-string">"D:\mongoDB\shared\sconfig"</span> <span class="hljs-built_in">--logpath</span> <span class="hljs-string">"D:\mongoDB\shared\log\config.log --logappend --fork</span><br><span class="hljs-string"></span><br><span class="hljs-string">步骤三： 启动Route Process</span><br><span class="hljs-string">【chunkSize这一项是用来指定chunk的大小的，单位是MB，默认大小为200MB】</span><br><span class="hljs-string">&gt; mongos --port 40000 --configdb localhost:27100 --fork --logpath "</span>D:\<span class="hljs-string">mongoDB\</span><span class="hljs-string">shared\</span><span class="hljs-string">log\</span><span class="hljs-string">route.</span><span class="hljs-string">log"</span> <span class="hljs-built_in">--chunkSize</span> <span class="hljs-string">500</span><br><span class="hljs-string"></span><br><span class="hljs-string">步</span>骤四： 配置<span class="hljs-string">Sharding</span><br><span class="hljs-string">登</span>录到<span class="hljs-string">mongos，</span>添加<span class="hljs-string">Shard节</span>点<br>&gt; <span class="hljs-string">mongo </span><span class="hljs-string">admin </span><span class="hljs-built_in">--port</span> <span class="hljs-string">40000</span><br><span class="hljs-string"></span><br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">addshard:</span><span class="hljs-string">"localhost:27020"</span> &#125;)<br>输出：&#123; <span class="hljs-string">"shardAdded"</span> : <span class="hljs-string">"shard0000"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br>...(一共添加<span class="hljs-string">10个</span>)<br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">addshard:</span><span class="hljs-string">"localhost:27029"</span> &#125;)<br>输出：&#123; <span class="hljs-string">"shardAdded"</span> : <span class="hljs-string">"shard0009"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br><br><br><span class="hljs-comment">#设置分片存储的数据库</span><br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">enablesharding:</span><span class="hljs-string">"test"</span> &#125;)<br>输出&#123; <span class="hljs-string">"ok"</span> : 1 &#125;<br><span class="hljs-string">mongos&gt;</span> <span class="hljs-string">db.</span><span class="hljs-string">runCommand(</span>&#123; <span class="hljs-string">shardcollection:</span> <span class="hljs-string">"test.log"</span>, <span class="hljs-string">key:</span> &#123; <span class="hljs-string">id:1,</span><span class="hljs-string">time:1&#125;</span>&#125;)<br>输出：&#123; <span class="hljs-string">"collectionsharded"</span> : <span class="hljs-string">"test.log"</span>, <span class="hljs-string">"ok"</span> : 1 &#125;<br><br><br>步骤五：将数据库连接接入接口<span class="hljs-string">40000</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="14-数据库的备份-恢复-监控"><a href="#14-数据库的备份-恢复-监控" class="headerlink" title="14.数据库的备份\恢复\监控"></a>14.数据库的备份\恢复\监控</h2><p>数据备份</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript">&gt;mongodump -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number"><code class="language-hljs angelscript">&gt;mongodump -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">27017</span> -d test -o D:\mongoDB\data\dump<br>-h：MongDB所在服务器地址:端口号<br>-d：需要备份的数据库<br>-o：备份的数据存放位置<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>数据恢复</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript">&gt;mongorestore -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number"><code class="language-hljs angelscript">&gt;mongorestore -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">27017</span> -d test<br>-h：MongDB所在服务器地址:端口号<br>-d：需要备份的数据库<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>数据监控</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs shell">间隔固定时间获取mongodb的当前运行状态<br><span class="hljs-meta">&gt;</span><span class="bash">mongostat</span><br>跟踪一个MongoDB的实例，查看哪些大量的时间花费在读取和写入数据<br>(后跟参数，默认情况下，mongotop返回值的每一秒)<br><span class="hljs-meta">&gt;</span><span class="bash">mongotop</span><br><span class="hljs-meta">&gt;</span><span class="bash"><code class="language-hljs shell">间隔固定时间获取mongodb的当前运行状态<br><span class="hljs-meta">&gt;</span><span class="bash">mongostat</span><br>跟踪一个MongoDB的实例，查看哪些大量的时间花费在读取和写入数据<br>(后跟参数，默认情况下，mongotop返回值的每一秒)<br><span class="hljs-meta">&gt;</span><span class="bash">mongotop</span><br><span class="hljs-meta">&gt;</span><span class="bash">mongotop 10</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="15-DBRefs数据库引用"><a href="#15-DBRefs数据库引用" class="headerlink" title="15.DBRefs数据库引用"></a>15.DBRefs数据库引用</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">&#123; <span class="hljs-variable">$ref</span> : , <span class="hljs-variable">$id</span> : , <span class="hljs-variable">$db</span> :  &#125;<br><span class="hljs-variable">$ref</span>：  集合名称<br><span class="hljs-variable">$id</span>：   引用的id<br><span class="hljs-variable">$db</span>:    数据库名称，可选参数<br><br>实例：（3.0版本）<br>&gt;var<span class="hljs-built_in"> user </span>= db.users.findOne(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"Tom Benzamin"</span>&#125;)<br>&gt;var dbRef = user.address<br>&gt;db[dbRef.<span class="hljs-variable">$ref</span>].findOne(&#123;<span class="hljs-string">"_id"</span>:(dbRef.<span class="hljs-variable">$id</span>)&#125;)<br><br><br>实例：（4.0版本）<br>&gt;var<span class="hljs-built_in"> user </span>= db.users.findOne(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"Tom Benzamin"</span>&#125;)<br>&gt;var dbRef = user.address<br>&gt;db[dbRef.<span class="hljs-variable">$ref</span>].findOne(&#123;<span class="hljs-string">"_id"</span>:ObjectId(dbRef.<span class="hljs-variable"><code class="language-hljs routeros">&#123; <span class="hljs-variable">$ref</span> : , <span class="hljs-variable">$id</span> : , <span class="hljs-variable">$db</span> :  &#125;<br><span class="hljs-variable">$ref</span>：  集合名称<br><span class="hljs-variable">$id</span>：   引用的id<br><span class="hljs-variable">$db</span>:    数据库名称，可选参数<br><br>实例：（3.0版本）<br>&gt;var<span class="hljs-built_in"> user </span>= db.users.findOne(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"Tom Benzamin"</span>&#125;)<br>&gt;var dbRef = user.address<br>&gt;db[dbRef.<span class="hljs-variable">$ref</span>].findOne(&#123;<span class="hljs-string">"_id"</span>:(dbRef.<span class="hljs-variable">$id</span>)&#125;)<br><br><br>实例：（4.0版本）<br>&gt;var<span class="hljs-built_in"> user </span>= db.users.findOne(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"Tom Benzamin"</span>&#125;)<br>&gt;var dbRef = user.address<br>&gt;db[dbRef.<span class="hljs-variable">$ref</span>].findOne(&#123;<span class="hljs-string">"_id"</span>:ObjectId(dbRef.<span class="hljs-variable">$id</span>)&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105012851&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MongoDB学习（中级）&lt;/a&gt;&lt;/p&gt;
&lt;h2 i
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://lewis.qi.tk/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="http://lewis.qi.tk/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB简单学习（初级）</title>
    <link href="http://lewis.qi.tk/2020/05/16/MongoDB%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%88%9D%E7%BA%A7%EF%BC%89/"/>
    <id>http://lewis.qi.tk/2020/05/16/MongoDB%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%88%9D%E7%BA%A7%EF%BC%89/</id>
    <published>2020-05-16T11:55:44.000Z</published>
    <updated>2020-05-16T12:03:04.023Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104993090" target="_blank" rel="noopener">MongoDB简单学习（初级）</a></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>1.NoSQL(NoSQL = Not Only SQL )，意即”不仅仅是SQL”。非关系型的数据存储库<br>2.分布式系统是建立在网络之上的软件系统，是一个基于分布式文件存储的开源数据库系统。<br>3.文档存储一般用类似json的格式存储，存储的内容是文档型的.这样也就有机会对某些字段建立索引，实现关系数据库的某些功能。  </p><p>4.MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成。<br>2.MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">&#123;<br>    <span class="hljs-type">name</span>:"Lewis",               &lt;<span class="hljs-comment">--fields:value</span><br>    age:<span class="hljs-number">20</span>,                     &lt;<span class="hljs-comment">--fields:value</span><br>    <span class="hljs-keyword">group</span>:["news","sports"]     &lt;<span class="hljs-comment"><code class="language-hljs pgsql">&#123;<br>    <span class="hljs-type">name</span>:"Lewis",               &lt;<span class="hljs-comment">--fields:value</span><br>    age:<span class="hljs-number">20</span>,                     &lt;<span class="hljs-comment">--fields:value</span><br>    <span class="hljs-keyword">group</span>:["news","sports"]     &lt;<span class="hljs-comment">--fields:value</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>配置：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs taggerscript">1.创建数据目录<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b<br>2.运行 MongoDB 服务器<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in<br>mongod.exe --dbpath "D:<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b"<br>3.在浏览器输入http://localhost:27017 （27017是mongodb的端口号）查看，若显示如下，则表示连接成功。如果不成功，可以查看端口是否被占用。<br>4.添加你安装MongoDB的bin目录到环境变量中的path<br>D:<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\b</span>in<br>5.一定不要关闭，保持MongoDB开启连接MongoDB<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in&gt;<br>mongo<br><br>将MongoDB设置为系统服务，可以自动在后台启动<br>1.创建D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\l</span>og<br>2.创建D:<span class="hljs-symbol">\m</span>ongoDB，添加配置文件mongod.cfg<br><br>systemLog:<br>    destination: file<br>    path: D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\l</span>og<span class="hljs-symbol">\m</span>ongod.log<br>storage:<br>    dbPath: D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b<br><br>3.管理员打开cmd<br>sc.exe create MongoDB binPath= "<span class="hljs-symbol">\"</span>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in<span class="hljs-symbol">\m</span>ongod.exe<span class="hljs-symbol">\"</span> --service --config=<span class="hljs-symbol">\"</span>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\m</span>ongod.cfg<span class="hljs-symbol"><code class="language-hljs taggerscript">1.创建数据目录<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b<br>2.运行 MongoDB 服务器<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in<br>mongod.exe --dbpath "D:<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b"<br>3.在浏览器输入http://localhost:27017 （27017是mongodb的端口号）查看，若显示如下，则表示连接成功。如果不成功，可以查看端口是否被占用。<br>4.添加你安装MongoDB的bin目录到环境变量中的path<br>D:<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\b</span>in<br>5.一定不要关闭，保持MongoDB开启连接MongoDB<br>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in&gt;<br>mongo<br><br>将MongoDB设置为系统服务，可以自动在后台启动<br>1.创建D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\l</span>og<br>2.创建D:<span class="hljs-symbol">\m</span>ongoDB，添加配置文件mongod.cfg<br><br>systemLog:<br>    destination: file<br>    path: D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\l</span>og<span class="hljs-symbol">\m</span>ongod.log<br>storage:<br>    dbPath: D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>b<br><br>3.管理员打开cmd<br>sc.exe create MongoDB binPath= "<span class="hljs-symbol">\"</span>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\b</span>in<span class="hljs-symbol">\m</span>ongod.exe<span class="hljs-symbol">\"</span> --service --config=<span class="hljs-symbol">\"</span>D:<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\m</span>ongod.cfg<span class="hljs-symbol">\"</span>" DisplayName= "MongoDB" start= "auto"<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}介绍$</p><ul><li>数据库的服务器<ul><li>用来保存数据</li><li>mongod用来启动服务器</li></ul></li><li>数据库的客户端<ul><li>用来操作服务器，对数据增删查改</li><li>mongo用来启动客户端</li></ul></li></ul><p>$\color{red}设置系统服务前的打开方式$</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs dockerfile"><span class="hljs-number">1</span>.在一个<span class="hljs-keyword">cmd</span><span class="bash">中打开：D:\mongoDB\bin</span><br>指定数据库路径和其使用的端口号<br>输入：mongod.exe --dbpath <span class="hljs-string">"D:\MongoDB\data\db"</span> --port <span class="hljs-number">27017</span><br><span class="hljs-number">2</span>.在另一个<span class="hljs-keyword">cmd</span><span class="bash"><code class="language-hljs dockerfile"><span class="hljs-number">1</span>.在一个<span class="hljs-keyword">cmd</span><span class="bash">中打开：D:\mongoDB\bin</span><br>指定数据库路径和其使用的端口号<br>输入：mongod.exe --dbpath <span class="hljs-string">"D:\MongoDB\data\db"</span> --port <span class="hljs-number">27017</span><br><span class="hljs-number">2</span>.在另一个<span class="hljs-keyword">cmd</span><span class="bash">中打开</span><br>输入：mongo<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}设置系统服务后的打开方式$</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript"><span class="hljs-number">1.</span>启动MongoDB服务(管理员身份cmd)<br>net start MongoDB  <br><span class="hljs-number">2.</span>关闭MongoDB服务  <br>net stop MongoDB  <br><span class="hljs-number">3.</span>移除 MongoDB 服务  <br>C:\mongodb\bin\mongod.exe --remove <br><br><span class="hljs-number"><code class="language-hljs angelscript"><span class="hljs-number">1.</span>启动MongoDB服务(管理员身份cmd)<br>net start MongoDB  <br><span class="hljs-number">2.</span>关闭MongoDB服务  <br>net stop MongoDB  <br><span class="hljs-number">3.</span>移除 MongoDB 服务  <br>C:\mongodb\bin\mongod.exe --remove <br><br><span class="hljs-number">4.</span>在另一个cmd中打开<br>输入：mongo<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}基本概念$<br>数据库（database），不需要手动创建，数据库中包含集合<br>集合（collection），不需要手动创建，集合中包含文档<br>文档（document）  </p><p>$\color{red}navicat for MongoDB$</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs bash">F6            打开一个mongodb命令行窗口<br>ctrl+r        运行查询窗口的mongodb语句<br>ctrl+/        注释sql语句<br>ctrl+<span class="hljs-built_in"><code class="language-hljs bash">F6            打开一个mongodb命令行窗口<br>ctrl+r        运行查询窗口的mongodb语句<br>ctrl+/        注释sql语句<br>ctrl+<span class="hljs-built_in">shift</span> +/ 解除注释<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}连接$</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs markdown">mongodb://[<span class="hljs-string">username:password@</span>]host1[<span class="hljs-string">:port1</span>][<span class="hljs-symbol">,host2[:port2</span>],...[<span class="hljs-string">,hostN[:portN</span>]]][<span class="hljs-string">/[database</span>][<span class="hljs-symbol"><code class="language-hljs markdown">mongodb://[<span class="hljs-string">username:password@</span>]host1[<span class="hljs-string">:port1</span>][<span class="hljs-symbol">,host2[:port2</span>],...[<span class="hljs-string">,hostN[:portN</span>]]][<span class="hljs-string">/[database</span>][<span class="hljs-symbol">?options</span>]<br><br>mongodb://<br>固定格式<br><br>username:password@<br>可选登录用户名密码<br><br>host<br>连接服务器的地址。<br>如果要连接复制集，请指定多个主机地址。<br><br>portX<br>可选端口，如果不填，默认为27017<br><br>/database<br>如果指定username:password@，连接并验证登陆指定数据库。<br>若不指定，默认打开 test 数据库。<br><br>?options<br>是连接选项。如果不使用/database，则前面需要加上/。<br>所有连接选项都是键值对name=value，键值对之间通过&或;（分号）隔开<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>举例：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript"><span class="hljs-number">1.</span>使用用户名和密码连接登陆到本地指定数据库服务器<br>mongodb:<span class="hljs-comment">//admin:123456@localhost/test</span><br><span class="hljs-number">2.</span>连接 replica pair, 服务器<span class="hljs-number">1</span>为example1.com服务器<span class="hljs-number">2</span>为example2。<br>mongodb:<span class="hljs-comment">//example1.com:27017,example2.com:27017</span><br><span class="hljs-number">3.</span>连接 replica <span class="hljs-keyword">set</span> 三台服务器, 写入操作应用在主服务器 并且分布查询到从服务器。<br>mongodb:<span class="hljs-comment">//host1,host2,host3/?slaveOk=true</span><br><span class="hljs-number">4.</span>直接连接第一个服务器，无论是replica <span class="hljs-keyword">set</span>一部分或者主服务器或者从服务器。<br>mongodb:<span class="hljs-comment">//host1,host2,host3/?connect=direct;slaveOk=true</span><br><span class="hljs-number">5.</span>安全模式连接到localhost:<br>mongodb:<span class="hljs-comment">//localhost/?safe=true</span><br>以安全模式连接到replica <span class="hljs-keyword">set</span>，并且等待至少两个复制服务器成功写入，超时时间设置为<span class="hljs-number">2</span>秒。<br>mongodb:<span class="hljs-comment"><code class="language-hljs angelscript"><span class="hljs-number">1.</span>使用用户名和密码连接登陆到本地指定数据库服务器<br>mongodb:<span class="hljs-comment">//admin:123456@localhost/test</span><br><span class="hljs-number">2.</span>连接 replica pair, 服务器<span class="hljs-number">1</span>为example1.com服务器<span class="hljs-number">2</span>为example2。<br>mongodb:<span class="hljs-comment">//example1.com:27017,example2.com:27017</span><br><span class="hljs-number">3.</span>连接 replica <span class="hljs-keyword">set</span> 三台服务器, 写入操作应用在主服务器 并且分布查询到从服务器。<br>mongodb:<span class="hljs-comment">//host1,host2,host3/?slaveOk=true</span><br><span class="hljs-number">4.</span>直接连接第一个服务器，无论是replica <span class="hljs-keyword">set</span>一部分或者主服务器或者从服务器。<br>mongodb:<span class="hljs-comment">//host1,host2,host3/?connect=direct;slaveOk=true</span><br><span class="hljs-number">5.</span>安全模式连接到localhost:<br>mongodb:<span class="hljs-comment">//localhost/?safe=true</span><br>以安全模式连接到replica <span class="hljs-keyword">set</span>，并且等待至少两个复制服务器成功写入，超时时间设置为<span class="hljs-number">2</span>秒。<br>mongodb:<span class="hljs-comment">//host1,host2,host3/?safe=true;w=2;wtimeoutMS=2000</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}使用数据库$</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros"><code class="language-hljs routeros">1.显示当前的数据库名称<br>> db<br>test<br><br>2.显示当前服务器下所有数据库database<br>> show dbs<br>admin   0.000GB<br>config  0.000GB<br>local   0.000GB<br><br>3.如果test数据库不存在，则创建test数据库;<br>  如果test已存在，则切换到test数据库。<br>> use test<br><br>4.删除当前数据库<br>>db.dropDatabase()<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}使用集合$</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript"><span class="hljs-number">1.</span>显示当前数据库下集合collections<br>&gt; show collections<br><br><br><span class="hljs-number">2.</span>当前数据库自动创建stu集合<br>db.stu.insert(&#123;<span class="hljs-string">"name"</span> : <span class="hljs-string">"菜鸟教程"</span>&#125;)<br><br><span class="hljs-number">3.</span>当前数据库手动创建stu集合<br>&gt; db.createCollection(<span class="hljs-string">"stu"</span>)     # 先创建集合，类似数据库中的表<br><br><span class="hljs-number">4.</span>当前数据库创建固定stu集合，整个集合空间大小 <span class="hljs-number">6142800</span> KB, 文档最大个数为 <span class="hljs-number">10000</span> 个<br>&gt; db.createCollection(<span class="hljs-string">"stu"</span>, &#123; capped:<span class="hljs-literal">true</span>, <span class="hljs-built_in">auto</span>IndexId:<span class="hljs-literal">true</span>, size:<span class="hljs-number">6142800</span>, max:<span class="hljs-number">10000</span> &#125; )<br><br><span class="hljs-number"><code class="language-hljs angelscript"><span class="hljs-number">1.</span>显示当前数据库下集合collections<br>&gt; show collections<br><br><br><span class="hljs-number">2.</span>当前数据库自动创建stu集合<br>db.stu.insert(&#123;<span class="hljs-string">"name"</span> : <span class="hljs-string">"菜鸟教程"</span>&#125;)<br><br><span class="hljs-number">3.</span>当前数据库手动创建stu集合<br>&gt; db.createCollection(<span class="hljs-string">"stu"</span>)     # 先创建集合，类似数据库中的表<br><br><span class="hljs-number">4.</span>当前数据库创建固定stu集合，整个集合空间大小 <span class="hljs-number">6142800</span> KB, 文档最大个数为 <span class="hljs-number">10000</span> 个<br>&gt; db.createCollection(<span class="hljs-string">"stu"</span>, &#123; capped:<span class="hljs-literal">true</span>, <span class="hljs-built_in">auto</span>IndexId:<span class="hljs-literal">true</span>, size:<span class="hljs-number">6142800</span>, max:<span class="hljs-number">10000</span> &#125; )<br><br><span class="hljs-number">5.</span>删除当前数据库指定的stu集合<br>>db.stu.drop()<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}CRUD使用$</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs stata">先明确使用数据库<br><span class="hljs-keyword">db</span>    (加入返回<span class="hljs-keyword">test</span>，则当前在<span class="hljs-keyword"><code class="language-hljs stata">先明确使用数据库<br><span class="hljs-keyword">db</span>    (加入返回<span class="hljs-keyword">test</span>，则当前在<span class="hljs-keyword">test</span>数据库)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="1-插入文档"><a href="#1-插入文档" class="headerlink" title="1.插入文档"></a>1.插入文档</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs objectivec">注：<br>向集合中添加文档，如果文档没有指定_<span class="hljs-keyword">id</span>属性，会自动添加  <br>&#123;<span class="hljs-string">"_id"</span>:objectId(xxxxxx),···&#125;，作为文档的唯一标识  <br>根据时间戳和机器码来生成  <br>自己指定<span class="hljs-keyword">id</span>：<br>db.stu.insert(&#123;_<span class="hljs-keyword">id</span>:<span class="hljs-string">"id123"</span>,name:<span class="hljs-string">"zhangsan"</span>&#125;);<br>查询<span class="hljs-keyword"><code class="language-hljs objectivec">注：<br>向集合中添加文档，如果文档没有指定_<span class="hljs-keyword">id</span>属性，会自动添加  <br>&#123;<span class="hljs-string">"_id"</span>:objectId(xxxxxx),···&#125;，作为文档的唯一标识  <br>根据时间戳和机器码来生成  <br>自己指定<span class="hljs-keyword">id</span>：<br>db.stu.insert(&#123;_<span class="hljs-keyword">id</span>:<span class="hljs-string">"id123"</span>,name:<span class="hljs-string">"zhangsan"</span>&#125;);<br>查询<span class="hljs-keyword">id</span>：<br>ObjectId();<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs livescript"><span class="hljs-number">1.</span>插入json格式文档<br>&gt;db.stu.insert(&#123;<br>  title: <span class="hljs-string">'MongoDB'</span>,<br>    description: <span class="hljs-string">'MongoDB 是一个 Nosql 数据库'</span>,<br>    by: <span class="hljs-string">'教程'</span>,<br>    url: <span class="hljs-string">'https://www.baidu.com'</span>,<br>    tags: [<span class="hljs-string">'mongodb'</span>, <span class="hljs-string">'database'</span>, <span class="hljs-string">'NoSQL'</span>],<br>    likes: <span class="hljs-number">100</span><br>&#125;)<br><br><br><span class="hljs-number">2.</span>插入的文档定义为变量<br>&gt; <span class="hljs-built_in">document</span>=(&#123;title: <span class="hljs-string">'MongoDB 教程'</span>, <br>    description: <span class="hljs-string">'MongoDB 是一个 Nosql 数据库'</span>,<br>    by: <span class="hljs-string">'菜鸟教程'</span>,<br>    url: <span class="hljs-string">'http://www.runoob.com'</span>,<br>    tags: [<span class="hljs-string">'mongodb'</span>, <span class="hljs-string">'database'</span>, <span class="hljs-string">'NoSQL'</span>],<br>    likes: <span class="hljs-number">100</span><br>&#125;);<br>db.stu.insert(<span class="hljs-built_in">document</span>);<br><br><br><span class="hljs-number">3.</span>插入方法<br> db.collection.insertOne():向指定集合中插入一条文档数据<br> db.collection.insertMany():向指定集合中插入多条文档数据<br><br><span class="hljs-comment">#  插入单条数据</span><br>&gt; <span class="hljs-keyword">var</span> <span class="hljs-built_in">document</span> = db.collection.insertOne(&#123;<span class="hljs-string">"a"</span>: <span class="hljs-number">3</span>&#125;)<br>返回：<span class="hljs-built_in">document</span><br>&#123;<br>        <span class="hljs-string">"acknowledged"</span> : <span class="hljs-literal">true</span>,<br>        <span class="hljs-string">"insertedId"</span> : ObjectId(<span class="hljs-string">"571a218011a82a1d94c02333"</span>)<br>&#125;<br><br><span class="hljs-comment">#  插入多条数据</span><br>&gt; <span class="hljs-keyword">var</span> res = db.collection.insertMany([&#123;<span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-string">'c'</span>: <span class="hljs-number">4</span>&#125;])<br>返回：res<br>&#123;<br>        <span class="hljs-string">"acknowledged"</span> : <span class="hljs-literal">true</span>,<br>        <span class="hljs-string">"insertedIds"</span> : [<br>                ObjectId(<span class="hljs-string">"571a22a911a82a1d94c02337"</span>),<br>                ObjectId(<span class="hljs-string"><code class="language-hljs livescript"><span class="hljs-number">1.</span>插入json格式文档<br>&gt;db.stu.insert(&#123;<br>  title: <span class="hljs-string">'MongoDB'</span>,<br>    description: <span class="hljs-string">'MongoDB 是一个 Nosql 数据库'</span>,<br>    by: <span class="hljs-string">'教程'</span>,<br>    url: <span class="hljs-string">'https://www.baidu.com'</span>,<br>    tags: [<span class="hljs-string">'mongodb'</span>, <span class="hljs-string">'database'</span>, <span class="hljs-string">'NoSQL'</span>],<br>    likes: <span class="hljs-number">100</span><br>&#125;)<br><br><br><span class="hljs-number">2.</span>插入的文档定义为变量<br>&gt; <span class="hljs-built_in">document</span>=(&#123;title: <span class="hljs-string">'MongoDB 教程'</span>, <br>    description: <span class="hljs-string">'MongoDB 是一个 Nosql 数据库'</span>,<br>    by: <span class="hljs-string">'菜鸟教程'</span>,<br>    url: <span class="hljs-string">'http://www.runoob.com'</span>,<br>    tags: [<span class="hljs-string">'mongodb'</span>, <span class="hljs-string">'database'</span>, <span class="hljs-string">'NoSQL'</span>],<br>    likes: <span class="hljs-number">100</span><br>&#125;);<br>db.stu.insert(<span class="hljs-built_in">document</span>);<br><br><br><span class="hljs-number">3.</span>插入方法<br> db.collection.insertOne():向指定集合中插入一条文档数据<br> db.collection.insertMany():向指定集合中插入多条文档数据<br><br><span class="hljs-comment">#  插入单条数据</span><br>&gt; <span class="hljs-keyword">var</span> <span class="hljs-built_in">document</span> = db.collection.insertOne(&#123;<span class="hljs-string">"a"</span>: <span class="hljs-number">3</span>&#125;)<br>返回：<span class="hljs-built_in">document</span><br>&#123;<br>        <span class="hljs-string">"acknowledged"</span> : <span class="hljs-literal">true</span>,<br>        <span class="hljs-string">"insertedId"</span> : ObjectId(<span class="hljs-string">"571a218011a82a1d94c02333"</span>)<br>&#125;<br><br><span class="hljs-comment">#  插入多条数据</span><br>&gt; <span class="hljs-keyword">var</span> res = db.collection.insertMany([&#123;<span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-string">'c'</span>: <span class="hljs-number">4</span>&#125;])<br>返回：res<br>&#123;<br>        <span class="hljs-string">"acknowledged"</span> : <span class="hljs-literal">true</span>,<br>        <span class="hljs-string">"insertedIds"</span> : [<br>                ObjectId(<span class="hljs-string">"571a22a911a82a1d94c02337"</span>),<br>                ObjectId(<span class="hljs-string">"571a22a911a82a1d94c02338"</span>)<br>        ]<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}极重要的实例$<br>插入20000条记录</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript"><span class="hljs-number">1.</span>（执行<span class="hljs-number">20000</span>次）该方法<span class="hljs-number">7.2</span>s<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;<span class="hljs-number">1</span>&lt;=<span class="hljs-number">20000</span>;i++)&#123;<br>  db.stu.insert(&#123;num:i&#125;);<br>&#125;<br><br><span class="hljs-number">2.</span>（执行一次，添加到数组）该方法<span class="hljs-number">0.4</span>s<br>var arr = [];<br><span class="hljs-keyword">for</span>(var i=<span class="hljs-number">1</span> ; i&lt;=<span class="hljs-number"><code class="language-hljs angelscript"><span class="hljs-number">1.</span>（执行<span class="hljs-number">20000</span>次）该方法<span class="hljs-number">7.2</span>s<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;<span class="hljs-number">1</span>&lt;=<span class="hljs-number">20000</span>;i++)&#123;<br>  db.stu.insert(&#123;num:i&#125;);<br>&#125;<br><br><span class="hljs-number">2.</span>（执行一次，添加到数组）该方法<span class="hljs-number">0.4</span>s<br>var arr = [];<br><span class="hljs-keyword">for</span>(var i=<span class="hljs-number">1</span> ; i&lt;=<span class="hljs-number">20000</span> ; i++)&#123;<br>    arr.push(&#123;num:i&#125;);<br>&#125;<br>db.numbers.insert(arr);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="2-查询"><a href="#2-查询" class="headerlink" title="2.查询"></a>2.查询</h2><h3 id="find查询函数的属性"><a href="#find查询函数的属性" class="headerlink" title="find查询函数的属性"></a>find查询函数的属性</h3><p>注：<br>find（）        返回的是一个数组<br>findOne（）        返回的是第一个文档对象<br>findMany（）</p><p>所以</p><ul><li><p>1.返回所有文档对象</p><ul><li>db.stu.find({});</li><li>db.col.find({},{“title”:1,_id:0})<br>$\color{red}第一个 {} 放 where 条件，为空表示返回集合中所有文档$<br>$\color{red}第二个 {} 指定那些列显示和不显示 （0表示不显示,1表示显示)$</li></ul></li><li><p>2.返回文档对象有几个</p><ul><li>db.stu.find({}).count();</li></ul></li><li><p>3.返回符合条件的第一个文档对象</p><ul><li>db.stu.find({name:’a’})[0];</li></ul></li><li><p>4.返回符合条件的第一个文档对象的name属性</p><ul><li>db.stu.findOne({age:’a’}).name;</li></ul></li><li><p>5.查询stu集合中的第一个文档对象</p><ul><li>db.stu.findOne()</li></ul></li><li><p>6.查询stu集合中前5条数据</p><ul><li>db.stu.find().limit(5)</li></ul></li><li><p>7.查询stu集合中跳过前5条后的数据<br>  $\color{red}skip()方法来跳过指定数量的数据，默认参数为0$</p><ul><li>db.stu.find().skip(5)</li></ul></li><li><p>8.查询stu集合中的全部数据，并按name属性正序排列  注：1：正序 -1: 倒序</p><ul><li>db.stu.find().sort({name:1})</li></ul></li><li><p>pretty() 方法以格式化的方式来显示所有文档</p><ul><li>db.stu.find().pretty()</li></ul></li></ul><p>注：limit和skip可用于分页<br>skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是<br>$\color{red}先 sort(), 然后 skip()，最后 limit()$<br>    查看第11条到20条的记录  </p><blockquote><p>db.stu.find().skip(10).limit(10);</p></blockquote><h3 id="find查询函数"><a href="#find查询函数" class="headerlink" title="find查询函数"></a>find查询函数</h3><ul><li>1.查询stu集合中所有的数据<ul><li>db.stu.find()</li></ul></li><li>2.查询stu集合中name=’a’的数据<ul><li>db.stu.find({name:’a’})</li></ul></li><li>3.查询stu集合中name=’a’的数据<ul><li>db.stu.find({name:{$eq:’a’}})</li></ul></li><li>4.查询stu集合中age&gt;18的数据<ul><li>db.stu.find({age:{$gt:18}})</li></ul></li><li>5.如果是 age 大于 50 小于 80<ul><li>不能这样写：db.posts.find( {  age: { $gt: 50 }, qty: { $lt: 80 } } )</li><li>应该这样写：db.posts.find( {  age: { $gt: 50 ,$lt: 80}} )</li></ul></li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams">格式：&#123; field: &#123;符号: value&#125;&#125;<br><span class="hljs-meta"><span class="hljs-meta-keyword">$eq</span>   等号        equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$gt</span>   大于        great  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$gte</span>  大于等于    great equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$lt</span>   小于        less than  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$lte</span>  小于等于    less than equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$ne</span>   不等于      not equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$in</span>   在范围内  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword"><code class="language-hljs gams">格式：&#123; field: &#123;符号: value&#125;&#125;<br><span class="hljs-meta"><span class="hljs-meta-keyword">$eq</span>   等号        equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$gt</span>   大于        great  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$gte</span>  大于等于    great equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$lt</span>   小于        less than  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$lte</span>  小于等于    less than equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$ne</span>   不等于      not equal  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$in</span>   在范围内  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$nin</span>  不在范围内</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li><p>5.查找stu集合中name域中以“华为”字符的开头的数据</p><ul><li>db.stu.find({name:/^华为/})</li></ul></li><li><p>6.查询stu集合中name=’手机1’和name=’手机2’的数据</p><ul><li>db.stu.find({name:{$in:[‘手机1’,’手机2’]}})</li></ul></li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams">格式：&#123; field:&#123;符号:[value1,value2,....]&#125;&#125;<br><span class="hljs-meta"><span class="hljs-meta-keyword">$in</span>在范围内</span><br><span class="hljs-meta"><span class="hljs-meta-keyword"><code class="language-hljs gams">格式：&#123; field:&#123;符号:[value1,value2,....]&#125;&#125;<br><span class="hljs-meta"><span class="hljs-meta-keyword">$in</span>在范围内</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$nin</span>不在范围内</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li><p>7.查找name=”华为手机”并且price:800的数据</p><ul><li>db.stu.find({name:”华为手机”,price:800})</li></ul></li><li><p>8.查询stu集合中name=’华为手机’ 或者 price&lt;1000的数据</p><ul><li>db.stu.find({$or:[ {name:’华为手机’},{price:{$lt:1000}} ]})</li></ul></li><li><p>9.查询stu集合中price&lt;=100的数据，不存在price属性的数据也会查询出来</p><ul><li>db.stu.find({price:{$not:{$gt:100}}})</li></ul></li><li><p>10.AND 和 OR联合使用</p><ul><li>db.col.find({“likes”: {$gt:50}, $or: [{“by”: “菜鸟教程”},{“title”: “MongoDB 教程”}]}).pretty()</li></ul></li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams">格式：<span class="hljs-symbol">$</span><span class="hljs-keyword">or</span>:[&#123;&#125;,&#123;&#125;,....]<br><span class="hljs-meta"><span class="hljs-meta-keyword">$or</span>或者  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$and</span>并且  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$nor</span>与$or相反 </span><br><span class="hljs-meta"><span class="hljs-meta-keyword"><code class="language-hljs gams">格式：<span class="hljs-symbol">$</span><span class="hljs-keyword">or</span>:[&#123;&#125;,&#123;&#125;,....]<br><span class="hljs-meta"><span class="hljs-meta-keyword">$or</span>或者  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$and</span>并且  </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$nor</span>与$or相反 </span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$not</span>取反</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>11.查询stu集合中包含域名称为price的数据<ul><li>db.stu.find({price:{$exists: true}})</li></ul></li><li>12.查询stu集合中name属性为字符串类型的数据<ul><li>db.stu.find({name:{$type:2}})</li></ul></li></ul><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs fsharp">格式：<br>$exists: <span class="hljs-keyword">true</span><br>$<span class="hljs-class"><span class="hljs-keyword">type</span>:2       </span>(<span class="hljs-class"><span class="hljs-keyword"><code class="language-hljs fsharp">格式：<br>$exists: <span class="hljs-keyword">true</span><br>$<span class="hljs-class"><span class="hljs-keyword">type</span>:2       </span>(<span class="hljs-class"><span class="hljs-keyword">type</span>操作符不细讲)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>13.查询products集合中name=’华为手机’的数据</li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs actionscript">db.products.find(&#123;<br>  $where: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name == <span class="hljs-string"><code class="language-hljs actionscript">db.products.find(&#123;<br>  $where: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name == <span class="hljs-string">'华为手机'</span><br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>14.查询products集合中name域中包含“华为手机”字符的数据</li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs actionscript">db.products.find(&#123;<br>  $where: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">this</span>.name.indexOf(<span class="hljs-string">'华为手机'</span>) &gt; <span class="hljs-number"><code class="language-hljs actionscript">db.products.find(&#123;<br>  $where: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">this</span>.name.indexOf(<span class="hljs-string">'华为手机'</span>) &gt; <span class="hljs-number">-1</span>;<br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs arcade">格式：<br><span class="hljs-symbol">$w</span>here: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword"><code class="language-hljs arcade">格式：<br><span class="hljs-symbol">$w</span>here: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span>  xxx;<br>  &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>15.$\color{red}修改内嵌文档的属性$（外文档的内文档的属性）  </li></ul><p>$\color{red}极重要的实例$</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs less">&#123;<br>  <span class="hljs-attribute">_id</span>:xxxxxxxx,<br>  <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>,<br>  <span class="hljs-attribute">hobby</span>:&#123;<br>    <span class="hljs-attribute">citys</span>:[<br>      <span class="hljs-string">"hangzhou"</span>,<span class="hljs-string">"BeiJing"</span>,<span class="hljs-string">"shanghai"</span><br>    ],<br>    <span class="hljs-attribute">movie</span>:[<br>      <span class="hljs-string">"movie-a"</span>,<span class="hljs-string">"movie-b"</span><br>    ]<br>  &#125;<br>&#125;<br><br>向<span class="hljs-attribute">name</span>:zhangsan的文档中添加一个<span class="hljs-attribute">age</span>:<span class="hljs-number">20</span><br>db.stu.update(&#123;<span class="hljs-attribute">name</span>:zhangsan&#125;,&#123;$<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">20</span>&#125;&#125;)<br><br><br><span class="hljs-comment">//通过内嵌文档来对文档查询，必须其属性名要加引号“”和'.'号连接</span><br>查询喜欢电影movie-a的文档<br>db.stu.find(&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string">"movie-a"</span>&#125;)<br><br><span class="hljs-comment">//push在数组中添加,如果数组中已存在，还继续添加</span><br>向<span class="hljs-attribute">name</span>:zhangsan中添加一个新的元素movie-c<br>db.ustu.updata(&#123;<span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>&#125;,&#123;$<span class="hljs-attribute">push</span>:&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string">"movie-c"</span>&#125;&#125;)<br><br><span class="hljs-comment">//addToSet在数组中添加,如果数组中已存在，不添加</span><br>向<span class="hljs-attribute">name</span>:zhangsan中添加一个新的元素movie-c<br>db.ustu.updata(&#123;<span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>&#125;,&#123;$<span class="hljs-attribute">addToSet</span>:&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string"><code class="language-hljs less">&#123;<br>  <span class="hljs-attribute">_id</span>:xxxxxxxx,<br>  <span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>,<br>  <span class="hljs-attribute">hobby</span>:&#123;<br>    <span class="hljs-attribute">citys</span>:[<br>      <span class="hljs-string">"hangzhou"</span>,<span class="hljs-string">"BeiJing"</span>,<span class="hljs-string">"shanghai"</span><br>    ],<br>    <span class="hljs-attribute">movie</span>:[<br>      <span class="hljs-string">"movie-a"</span>,<span class="hljs-string">"movie-b"</span><br>    ]<br>  &#125;<br>&#125;<br><br>向<span class="hljs-attribute">name</span>:zhangsan的文档中添加一个<span class="hljs-attribute">age</span>:<span class="hljs-number">20</span><br>db.stu.update(&#123;<span class="hljs-attribute">name</span>:zhangsan&#125;,&#123;$<span class="hljs-attribute">set</span>:&#123;<span class="hljs-attribute">age</span>:<span class="hljs-number">20</span>&#125;&#125;)<br><br><br><span class="hljs-comment">//通过内嵌文档来对文档查询，必须其属性名要加引号“”和'.'号连接</span><br>查询喜欢电影movie-a的文档<br>db.stu.find(&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string">"movie-a"</span>&#125;)<br><br><span class="hljs-comment">//push在数组中添加,如果数组中已存在，还继续添加</span><br>向<span class="hljs-attribute">name</span>:zhangsan中添加一个新的元素movie-c<br>db.ustu.updata(&#123;<span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>&#125;,&#123;$<span class="hljs-attribute">push</span>:&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string">"movie-c"</span>&#125;&#125;)<br><br><span class="hljs-comment">//addToSet在数组中添加,如果数组中已存在，不添加</span><br>向<span class="hljs-attribute">name</span>:zhangsan中添加一个新的元素movie-c<br>db.ustu.updata(&#123;<span class="hljs-attribute">name</span>:<span class="hljs-string">"zhangsan"</span>&#125;,&#123;$<span class="hljs-attribute">addToSet</span>:&#123;<span class="hljs-string">"hobby.movie"</span>:<span class="hljs-string">"movie-c"</span>&#125;&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="集合查询函数"><a href="#集合查询函数" class="headerlink" title="集合查询函数"></a>集合查询函数</h3><ul><li><p>14.查询users集合中不重复的name属性，返回的是数组</p><ul><li>db.stu.distinct(‘name’)</li></ul></li><li><p>15.查询stu集合中name=’zhangshan’的数据数量</p><ul><li>db.stu.count({name:’zhangshan’})</li></ul></li></ul><h2 id="3-更新"><a href="#3-更新" class="headerlink" title="3.更新"></a>3.更新</h2><ul><li>1.update()$\color{red}更新已存在的文档$<ul><li>$set&emsp;&emsp;&emsp;数据存在则更新,更改属性列表,不在列表中其他属性会被保留，如果不加此符号，其它属性会被丢弃（_id属性不会丢失）</li><li>$unset&emsp;&emsp;数据存在时不进行操作,移除集合中的键值对</li><li>$setOnInsert&emsp;数据存在时不进行操作</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql">db.collection.update(<br>   &lt;<span class="hljs-keyword">query</span>&gt;,<br>   &lt;<span class="hljs-keyword">update</span>&gt;,<br>   &#123;<br>     <span class="hljs-keyword">upsert</span>: &lt;<span class="hljs-built_in">boolean</span>&gt;,<br>     multi: &lt;<span class="hljs-built_in">boolean</span>&gt;,<br>     writeConcern: &lt;<span class="hljs-keyword">document</span>&gt;<br>   &#125;<br>)<br><span class="hljs-keyword">query</span>         查询条件，类似<span class="hljs-keyword">sql</span>内<span class="hljs-keyword">where</span>后面的<br><br><span class="hljs-keyword">update</span>        类似<span class="hljs-keyword">sql</span>内<span class="hljs-keyword">set</span>后面的<br><br><span class="hljs-keyword">upsert</span>        可选，如果不存在，是否插入,<br>              <span class="hljs-literal">true</span>为插入，默认是<span class="hljs-literal">false</span>，不插入。<br><br>multi         可选，默认是<span class="hljs-literal">false</span>,只更新找到的第一条记录，<br>              <span class="hljs-literal"><code class="language-hljs sql">db.collection.update(<br>   &lt;<span class="hljs-keyword">query</span>&gt;,<br>   &lt;<span class="hljs-keyword">update</span>&gt;,<br>   &#123;<br>     <span class="hljs-keyword">upsert</span>: &lt;<span class="hljs-built_in">boolean</span>&gt;,<br>     multi: &lt;<span class="hljs-built_in">boolean</span>&gt;,<br>     writeConcern: &lt;<span class="hljs-keyword">document</span>&gt;<br>   &#125;<br>)<br><span class="hljs-keyword">query</span>         查询条件，类似<span class="hljs-keyword">sql</span>内<span class="hljs-keyword">where</span>后面的<br><br><span class="hljs-keyword">update</span>        类似<span class="hljs-keyword">sql</span>内<span class="hljs-keyword">set</span>后面的<br><br><span class="hljs-keyword">upsert</span>        可选，如果不存在，是否插入,<br>              <span class="hljs-literal">true</span>为插入，默认是<span class="hljs-literal">false</span>，不插入。<br><br>multi         可选，默认是<span class="hljs-literal">false</span>,只更新找到的第一条记录，<br>              <span class="hljs-literal">true</span>,就把按条件查出来多条记录全部更新。<br><br>writeConcern  可选，抛出异常的级别。<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>例子：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xquery">只会修改第一条发现的文档<br>&gt;db.stu.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB 教程'</span>&#125;,&#123;<span class="hljs-variable">$set:</span>&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB'</span>&#125;&#125;)<br><br>修改多条相同的文档<br>&gt;db.stu.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB 教程'</span>&#125;,&#123;<span class="hljs-variable">$set:</span>&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB'</span>&#125;&#125;,&#123;multi:true&#125;)<br><br><br><br><span class="hljs-variable">$set</span>用来在原有属性上，添加指定属性<br><span class="hljs-variable">$unset</span>用来删除指定属性，其他属性不变<br><br>不存在-只添加第一条：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">4</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test5"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,true</span><span class="hljs-built_in">,false</span> );<br>不存在-全部添加进去:<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">5</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test5"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,true</span><span class="hljs-built_in">,true</span> );<br><br>已存在-只更新第一条记录：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">10</span> &#125; &#125; , &#123; <span class="hljs-variable">$inc</span> : &#123; <span class="hljs-string">"count"</span> : <span class="hljs-number">1</span>&#125; &#125;<span class="hljs-built_in">,false</span><span class="hljs-built_in">,false</span> );<br>已存在-全部更新：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">3</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test2"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,false</span><span class="hljs-built_in"><code class="language-hljs xquery">只会修改第一条发现的文档<br>&gt;db.stu.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB 教程'</span>&#125;,&#123;<span class="hljs-variable">$set:</span>&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB'</span>&#125;&#125;)<br><br>修改多条相同的文档<br>&gt;db.stu.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB 教程'</span>&#125;,&#123;<span class="hljs-variable">$set:</span>&#123;<span class="hljs-string">'title'</span>:<span class="hljs-string">'MongoDB'</span>&#125;&#125;,&#123;multi:true&#125;)<br><br><br><br><span class="hljs-variable">$set</span>用来在原有属性上，添加指定属性<br><span class="hljs-variable">$unset</span>用来删除指定属性，其他属性不变<br><br>不存在-只添加第一条：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">4</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test5"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,true</span><span class="hljs-built_in">,false</span> );<br>不存在-全部添加进去:<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">5</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test5"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,true</span><span class="hljs-built_in">,true</span> );<br><br>已存在-只更新第一条记录：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">10</span> &#125; &#125; , &#123; <span class="hljs-variable">$inc</span> : &#123; <span class="hljs-string">"count"</span> : <span class="hljs-number">1</span>&#125; &#125;<span class="hljs-built_in">,false</span><span class="hljs-built_in">,false</span> );<br>已存在-全部更新：<br>db.col.<span class="hljs-keyword">update</span>( &#123; <span class="hljs-string">"count"</span> : &#123; <span class="hljs-variable">$gt</span> : <span class="hljs-number">3</span> &#125; &#125; , &#123; <span class="hljs-variable">$set</span> : &#123; <span class="hljs-string">"test2"</span> : <span class="hljs-string">"OK"</span>&#125; &#125;<span class="hljs-built_in">,false</span><span class="hljs-built_in">,true</span> );<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>2.save()$\color{red}传入的文档来替换已有文档$</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.save</span>(<br>   &lt;<span class="hljs-selector-tag">document</span>&gt;,<br>   &#123;<br>     <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;<br>   &#125;<br>)<br><span class="hljs-selector-tag">document</span>      文档数据。<br><span class="hljs-selector-tag"><code class="language-hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.save</span>(<br>   &lt;<span class="hljs-selector-tag">document</span>&gt;,<br>   &#123;<br>     <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;<br>   &#125;<br>)<br><span class="hljs-selector-tag">document</span>      文档数据。<br><span class="hljs-selector-tag">writeConcern</span>  可选，抛出异常的级别。<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>例子：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs maxima">替换了 _id 为 56064f89ade2f21f36b03136 的已存在的文档数据<br>&gt;db.<span class="hljs-built_in">col</span>.<span class="hljs-built_in">save</span>(&#123;<br>    <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"56064f89ade2f21f36b03136"</span>),<br>    <span class="hljs-string">"title"</span> : <span class="hljs-string"><code class="language-hljs maxima">替换了 _id 为 56064f89ade2f21f36b03136 的已存在的文档数据<br>&gt;db.<span class="hljs-built_in">col</span>.<span class="hljs-built_in">save</span>(&#123;<br>    <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"56064f89ade2f21f36b03136"</span>),<br>    <span class="hljs-string">"title"</span> : <span class="hljs-string">"MongoDB"</span><br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>3.updateOne()$\color{red}向指定集合更新单个文档$</li><li>4.updateMany()$\color{red}向指定集合更新多个文档$</li></ul><p>例子：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs reasonml">更新单个文档<br>&gt; db.stu.update<span class="hljs-constructor">One(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"abc"</span>&#125;,&#123;$<span class="hljs-params">set</span>:&#123;<span class="hljs-string">"age"</span>:<span class="hljs-string">"28"</span>&#125;&#125;)</span><br>更新多个文档<br>&gt; db.stu.update<span class="hljs-constructor">Many(&#123;<span class="hljs-string">"age"</span>:&#123;$<span class="hljs-params">gt</span>:<span class="hljs-string">"10"</span>&#125;&#125;,&#123;$<span class="hljs-params">set</span>:&#123;<span class="hljs-string">"status"</span>:<span class="hljs-string"><code class="language-hljs reasonml">更新单个文档<br>&gt; db.stu.update<span class="hljs-constructor">One(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"abc"</span>&#125;,&#123;$<span class="hljs-params">set</span>:&#123;<span class="hljs-string">"age"</span>:<span class="hljs-string">"28"</span>&#125;&#125;)</span><br>更新多个文档<br>&gt; db.stu.update<span class="hljs-constructor">Many(&#123;<span class="hljs-string">"age"</span>:&#123;$<span class="hljs-params">gt</span>:<span class="hljs-string">"10"</span>&#125;&#125;,&#123;$<span class="hljs-params">set</span>:&#123;<span class="hljs-string">"status"</span>:<span class="hljs-string">"xyz"</span>&#125;&#125;)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>5.replaceOne()$\color{red}替换单个文档$</li></ul><h2 id="4-删除"><a href="#4-删除" class="headerlink" title="4.删除"></a>4.删除</h2><ul><li><p>1.remove()即使把集合stu中的所有数据都删除了stu集合仍然存在</p><ul><li>需要继续执行 db.repairDatabase() 来回收磁盘空间。</li></ul></li><li><p>2.drop()不仅会删除数据，还会把集合的结构给删除</p></li><li><p>3.deleteOne()</p></li><li><p>4.deleteMany()</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs yaml"><span class="hljs-string">db.collection.remove(</span><br>   <span class="hljs-string">&lt;query&gt;,</span><br>   <span class="hljs-string">&lt;justOne&gt;</span><br><span class="hljs-string">)</span><br><br><span class="hljs-string">query</span>           <span class="hljs-string">可选,删除文档的条件。</span><br><br><span class="hljs-string">justOne</span>         <span class="hljs-string">可选,如果设为</span> <span class="hljs-literal">true</span> <span class="hljs-string">或</span> <span class="hljs-number">1</span><span class="hljs-string">，则只删除一个文档，</span><br>                <span class="hljs-string">如果不设置，或默认值</span> <span class="hljs-literal">false</span><span class="hljs-string">，则删除所有匹配条件的文档。</span><br><br><span class="hljs-string">writeConcern</span>    <span class="hljs-string"><code class="language-hljs yaml"><span class="hljs-string">db.collection.remove(</span><br>   <span class="hljs-string">&lt;query&gt;,</span><br>   <span class="hljs-string">&lt;justOne&gt;</span><br><span class="hljs-string">)</span><br><br><span class="hljs-string">query</span>           <span class="hljs-string">可选,删除文档的条件。</span><br><br><span class="hljs-string">justOne</span>         <span class="hljs-string">可选,如果设为</span> <span class="hljs-literal">true</span> <span class="hljs-string">或</span> <span class="hljs-number">1</span><span class="hljs-string">，则只删除一个文档，</span><br>                <span class="hljs-string">如果不设置，或默认值</span> <span class="hljs-literal">false</span><span class="hljs-string">，则删除所有匹配条件的文档。</span><br><br><span class="hljs-string">writeConcern</span>    <span class="hljs-string">可选,抛出异常的级别。</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>例子：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">1.<br>删除stu集合中<span class="hljs-attribute">name</span>=<span class="hljs-string">'abc'</span>的文档(所有)<br>db.stu.<span class="hljs-builtin-name">remove</span>(&#123;name:<span class="hljs-string">'abc'</span>&#125;)<br>删除stu集合中<span class="hljs-attribute">name</span>=<span class="hljs-string">'abc'</span>的文档(一个)<br>db.stu.<span class="hljs-builtin-name">remove</span>(&#123;name:<span class="hljs-string">'abc'</span>&#125;，<span class="hljs-literal">true</span>)<br><br>2.删除 status 等于 A 的一个文档<br>db.stu.deleteOne( &#123; status: <span class="hljs-string">"A"</span> &#125; )<br>3.删除 status 等于 A 的全部文档<br>db.stu.deleteMany(&#123; status : <span class="hljs-string">"A"</span> &#125;)<br><br>4.清空集合stu文档,保留数据【性能差】<br>db.stu.<span class="hljs-builtin-name"><code class="language-hljs routeros">1.<br>删除stu集合中<span class="hljs-attribute">name</span>=<span class="hljs-string">'abc'</span>的文档(所有)<br>db.stu.<span class="hljs-builtin-name">remove</span>(&#123;name:<span class="hljs-string">'abc'</span>&#125;)<br>删除stu集合中<span class="hljs-attribute">name</span>=<span class="hljs-string">'abc'</span>的文档(一个)<br>db.stu.<span class="hljs-builtin-name">remove</span>(&#123;name:<span class="hljs-string">'abc'</span>&#125;，<span class="hljs-literal">true</span>)<br><br>2.删除 status 等于 A 的一个文档<br>db.stu.deleteOne( &#123; status: <span class="hljs-string">"A"</span> &#125; )<br>3.删除 status 等于 A 的全部文档<br>db.stu.deleteMany(&#123; status : <span class="hljs-string">"A"</span> &#125;)<br><br>4.清空集合stu文档,保留数据【性能差】<br>db.stu.<span class="hljs-builtin-name">remove</span>(&#123;&#125;)<br>5.清空集合stu文档,不保留数据【性能好】<br>db.stu.drop()<br>6.删除集合下全部文档<br>db.stu.deleteMany(&#123;&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>$\color{red}极重要的实例：（现实中不能真的删除数据）$</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs dts">设置isDel为已经删除的意思：<span class="hljs-number">0</span>=未删除，<span class="hljs-number">1</span>=删除<br>db.stu.insert(&#123;<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"zhangsan"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"lisi"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"wangwu"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>&#125;)<br><br><span class="hljs-comment">//更新name:zhangsan，将isDel:0改为1，即表示删除了，但实际并没有删</span><br>db.stu.updataOne(&#123;name:zhangsan&#125;,&#123;$set:&#123;isDel:<span class="hljs-number">1</span>&#125;&#125;);<br><br><span class="hljs-comment">//给用户看的显示数据只需调用isDel:0的数据即可</span><br>db.stu.finf(&#123;isDel:<span class="hljs-number"><code class="language-hljs dts">设置isDel为已经删除的意思：<span class="hljs-number">0</span>=未删除，<span class="hljs-number">1</span>=删除<br>db.stu.insert(&#123;<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"zhangsan"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"lisi"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    name:</span><span class="hljs-string">"wangwu"</span>,<br><span class="hljs-symbol">    idDel:</span><span class="hljs-number">0</span><br>  &#125;,<br>&#125;)<br><br><span class="hljs-comment">//更新name:zhangsan，将isDel:0改为1，即表示删除了，但实际并没有删</span><br>db.stu.updataOne(&#123;name:zhangsan&#125;,&#123;$set:&#123;isDel:<span class="hljs-number">1</span>&#125;&#125;);<br><br><span class="hljs-comment">//给用户看的显示数据只需调用isDel:0的数据即可</span><br>db.stu.finf(&#123;isDel:<span class="hljs-number">0</span>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="5-排序"><a href="#5-排序" class="headerlink" title="5.排序"></a>5.排序</h2><ul><li>sort(keys)<ul><li>Keys 为要创建的索引字段：1 为升序排列，-1 是降序排列</li></ul></li></ul><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sqf">按字段 key 的升序排列<br>&gt;db.COLLECTION_NAME.<span class="hljs-built_in">find</span>().<span class="hljs-built_in">sort</span>(&#123;KEY:<span class="hljs-number">1</span>&#125;)<br><br>按字段 likes 的降序排列,且显示title，不显示<span class="hljs-variable">_id</span>字段<br>&gt;db.col.<span class="hljs-built_in">find</span>(&#123;&#125;,&#123;<span class="hljs-string">"title"</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).<span class="hljs-built_in">sort</span>(&#123;<span class="hljs-string">"likes"</span>:-<span class="hljs-number"><code class="language-hljs sqf">按字段 key 的升序排列<br>&gt;db.COLLECTION_NAME.<span class="hljs-built_in">find</span>().<span class="hljs-built_in">sort</span>(&#123;KEY:<span class="hljs-number">1</span>&#125;)<br><br>按字段 likes 的降序排列,且显示title，不显示<span class="hljs-variable">_id</span>字段<br>&gt;db.col.<span class="hljs-built_in">find</span>(&#123;&#125;,&#123;<span class="hljs-string">"title"</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).<span class="hljs-built_in">sort</span>(&#123;<span class="hljs-string">"likes"</span>:-<span class="hljs-number">1</span>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：<br>skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是<br>先 sort(), 然后 skip()，最后 limit()。</p><h2 id="6-1索引"><a href="#6-1索引" class="headerlink" title="6.1索引"></a>6.1索引</h2><ul><li>createIndex(keys, options)<ul><li>Keys 为要创建的索引字段：1 为升序排列，-1 是降序排列</li><li>options 有很多</li></ul></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs reasonml"><span class="hljs-number">1.</span>对title字段按升序索引<br>&gt;db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"title"</span>:1&#125;)</span><br><br><span class="hljs-number">2.</span>多个字段创建索引<br>&gt;db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"title"</span>:1,<span class="hljs-string">"description"</span>:-1&#125;)</span><br><br><span class="hljs-number">3.</span>后台创建索引<br>db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-params">open</span>: 1, <span class="hljs-params">close</span>: 1&#125;, &#123;<span class="hljs-params">background</span>: <span class="hljs-params">true</span>&#125;)</span><br><br><span class="hljs-number">4.</span>查看集合索引<br>db.stu.get<span class="hljs-constructor">Indexes()</span><br><br><span class="hljs-number">5.</span>查看集合索引大小<br>db.stu.total<span class="hljs-constructor">IndexSize()</span><br><br><span class="hljs-number">6.</span>删除集合所有索引<br>db.stu.drop<span class="hljs-constructor">Indexes()</span><br><br><span class="hljs-number">7.</span>删除集合指定索引<br>db.stu.drop<span class="hljs-constructor">Index(<span class="hljs-string">"索引名称"</span>)</span><br><br><br>另：<br>数据记录中有日期类型，可以设置定时自动删除任务（单字段索引，混合索引不支持）<br>&#123;expireAfterSeconds: <span class="hljs-number">180</span>&#125;设置为<span class="hljs-number">180</span>秒后删除索引<br>db.col.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"createDate"</span>: 1&#125;,&#123;<span class="hljs-params"><code class="language-hljs reasonml"><span class="hljs-number">1.</span>对title字段按升序索引<br>&gt;db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"title"</span>:1&#125;)</span><br><br><span class="hljs-number">2.</span>多个字段创建索引<br>&gt;db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"title"</span>:1,<span class="hljs-string">"description"</span>:-1&#125;)</span><br><br><span class="hljs-number">3.</span>后台创建索引<br>db.stu.create<span class="hljs-constructor">Index(&#123;<span class="hljs-params">open</span>: 1, <span class="hljs-params">close</span>: 1&#125;, &#123;<span class="hljs-params">background</span>: <span class="hljs-params">true</span>&#125;)</span><br><br><span class="hljs-number">4.</span>查看集合索引<br>db.stu.get<span class="hljs-constructor">Indexes()</span><br><br><span class="hljs-number">5.</span>查看集合索引大小<br>db.stu.total<span class="hljs-constructor">IndexSize()</span><br><br><span class="hljs-number">6.</span>删除集合所有索引<br>db.stu.drop<span class="hljs-constructor">Indexes()</span><br><br><span class="hljs-number">7.</span>删除集合指定索引<br>db.stu.drop<span class="hljs-constructor">Index(<span class="hljs-string">"索引名称"</span>)</span><br><br><br>另：<br>数据记录中有日期类型，可以设置定时自动删除任务（单字段索引，混合索引不支持）<br>&#123;expireAfterSeconds: <span class="hljs-number">180</span>&#125;设置为<span class="hljs-number">180</span>秒后删除索引<br>db.col.create<span class="hljs-constructor">Index(&#123;<span class="hljs-string">"createDate"</span>: 1&#125;,&#123;<span class="hljs-params">expireAfterSeconds</span>: 180&#125;)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="6-2覆盖索引查询、查询分析、查询限制、全文检索"><a href="#6-2覆盖索引查询、查询分析、查询限制、全文检索" class="headerlink" title="6.2覆盖索引查询、查询分析、查询限制、全文检索"></a>6.2覆盖索引查询、查询分析、查询限制、全文检索</h2><p>1.索引存在于RAM中，从索引中获取数据比通过扫描文档读取数据要快得多<br>很少对集合进行读取操作，建议不使用索引<br>2.$\color{red}所有索引字段是一个子文档$<br>3.db.xxx.ensureIndex()<br>4.db.xxx.ensureIndex().explain()<br>5.db.xxx.ensureIndex().hint()<br>6.$search</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sqf">现有例子<br>&#123;<br>   <span class="hljs-string">"_id"</span>: ObjectId(<span class="hljs-string">"53402597d852426020000002"</span>),<br>   <span class="hljs-string">"gender"</span>: <span class="hljs-string">"male"</span>,<br>   <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span>,<br>   <span class="hljs-string">"tags"</span>: [<br>      <span class="hljs-string">"music"</span>,<br>      <span class="hljs-string">"cricket"</span>,<br>      <span class="hljs-string">"blogs"</span><br>   ],<br>   <span class="hljs-string">"address"</span>: &#123;<br>      <span class="hljs-string">"city"</span>: <span class="hljs-string">"Los Angeles"</span>,<br>      <span class="hljs-string">"state"</span>: <span class="hljs-string">"California"</span>,<br>      <span class="hljs-string">"pincode"</span>: <span class="hljs-string">"123"</span><br>   &#125;,<br>   <span class="hljs-string">"commit"</span>:<span class="hljs-string">"This ia a commint"</span><br>&#125;<br><br><br><span class="hljs-number">1</span>.创建索引（<span class="hljs-number">0</span>不显示，<span class="hljs-number">1</span>显示）<br>&gt;db.users.ensureIndex(&#123;gender:<span class="hljs-number">1</span>,<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;)<br><span class="hljs-number">3</span>.查询分析<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).explain()<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).<span class="hljs-built_in">hint</span>()  <br><br><br><span class="hljs-number">1</span>.索引数组字段，加引号（tags是数组）<br>&gt;db.users.ensureIndex(&#123;<span class="hljs-string">"tags"</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找包含的字段的文档<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;tags:<span class="hljs-string">"cricket"</span>&#125;)<br><br><br><span class="hljs-number">1</span>.索引子文档字段，加引号（address是子文档对象）<br>&gt;db.users.ensureIndex(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"address.state"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"address.pincode"</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-string">"Los Angeles"</span>&#125;)  <br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-string">"Los Angeles"</span>,<span class="hljs-string">"address.state"</span>:<span class="hljs-string">"California"</span>,<span class="hljs-string">"address.pincode"</span>:<span class="hljs-string"><code class="language-hljs sqf">现有例子<br>&#123;<br>   <span class="hljs-string">"_id"</span>: ObjectId(<span class="hljs-string">"53402597d852426020000002"</span>),<br>   <span class="hljs-string">"gender"</span>: <span class="hljs-string">"male"</span>,<br>   <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span>,<br>   <span class="hljs-string">"tags"</span>: [<br>      <span class="hljs-string">"music"</span>,<br>      <span class="hljs-string">"cricket"</span>,<br>      <span class="hljs-string">"blogs"</span><br>   ],<br>   <span class="hljs-string">"address"</span>: &#123;<br>      <span class="hljs-string">"city"</span>: <span class="hljs-string">"Los Angeles"</span>,<br>      <span class="hljs-string">"state"</span>: <span class="hljs-string">"California"</span>,<br>      <span class="hljs-string">"pincode"</span>: <span class="hljs-string">"123"</span><br>   &#125;,<br>   <span class="hljs-string">"commit"</span>:<span class="hljs-string">"This ia a commint"</span><br>&#125;<br><br><br><span class="hljs-number">1</span>.创建索引（<span class="hljs-number">0</span>不显示，<span class="hljs-number">1</span>显示）<br>&gt;db.users.ensureIndex(&#123;gender:<span class="hljs-number">1</span>,<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;)<br><span class="hljs-number">3</span>.查询分析<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).explain()<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;gender:<span class="hljs-string">"male"</span>&#125;,&#123;<span class="hljs-built_in">name</span>:<span class="hljs-number">1</span>,<span class="hljs-variable">_id</span>:<span class="hljs-number">0</span>&#125;).<span class="hljs-built_in">hint</span>()  <br><br><br><span class="hljs-number">1</span>.索引数组字段，加引号（tags是数组）<br>&gt;db.users.ensureIndex(&#123;<span class="hljs-string">"tags"</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找包含的字段的文档<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;tags:<span class="hljs-string">"cricket"</span>&#125;)<br><br><br><span class="hljs-number">1</span>.索引子文档字段，加引号（address是子文档对象）<br>&gt;db.users.ensureIndex(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"address.state"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"address.pincode"</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-number">2</span>.通过索引查找<br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-string">"Los Angeles"</span>&#125;)  <br>&gt;db.users.<span class="hljs-built_in">find</span>(&#123;<span class="hljs-string">"address.city"</span>:<span class="hljs-string">"Los Angeles"</span>,<span class="hljs-string">"address.state"</span>:<span class="hljs-string">"California"</span>,<span class="hljs-string">"address.pincode"</span>:<span class="hljs-string">"123"</span>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs shell">1.全文检索，加引号（a是commit的自定义别名,加引号）<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.ensureIndex(&#123;<span class="hljs-string">"commit"</span>:<span class="hljs-string">"a"</span>&#125;)</span><br>2.查找包含特定的内容<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.find(&#123;<span class="hljs-variable">$a</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"This"</span>&#125;&#125;)</span><br>3.删除全文索引(先查找全文索引名，再删除)<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.getIndexes()</span><br><span class="hljs-meta">&gt;</span><span class="bash">db.posts.dropIndex(<span class="hljs-string"><code class="language-hljs shell">1.全文检索，加引号（a是commit的自定义别名,加引号）<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.ensureIndex(&#123;<span class="hljs-string">"commit"</span>:<span class="hljs-string">"a"</span>&#125;)</span><br>2.查找包含特定的内容<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.find(&#123;<span class="hljs-variable">$a</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"This"</span>&#125;&#125;)</span><br>3.删除全文索引(先查找全文索引名，再删除)<br><span class="hljs-meta">&gt;</span><span class="bash">db.users.getIndexes()</span><br><span class="hljs-meta">&gt;</span><span class="bash">db.posts.dropIndex(<span class="hljs-string">"a"</span>)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams">查询限制<br><span class="hljs-number">1.</span>正则表达式及非操作符，如 <span class="hljs-symbol">$</span>nin, <span class="hljs-symbol">$</span><span class="hljs-keyword">not</span>, 等。<br><span class="hljs-number">2.</span>算术运算符，如 <span class="hljs-symbol">$</span><span class="hljs-built-in">mod</span>等。<br><span class="hljs-number">3.</span><span class="hljs-symbol"><code class="language-hljs gams">查询限制<br><span class="hljs-number">1.</span>正则表达式及非操作符，如 <span class="hljs-symbol">$</span>nin, <span class="hljs-symbol">$</span><span class="hljs-keyword">not</span>, 等。<br><span class="hljs-number">2.</span>算术运算符，如 <span class="hljs-symbol">$</span><span class="hljs-built-in">mod</span>等。<br><span class="hljs-number">3.</span><span class="hljs-symbol">$</span>where 子句<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="7-聚合"><a href="#7-聚合" class="headerlink" title="7.聚合"></a>7.聚合</h2><p>用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果</p><ul><li>db.stu.aggregate(AGGREGATE_OPERATION)</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams">聚合框架常用操作：<br><span class="hljs-meta"><span class="hljs-meta-keyword">$match</span>      过滤数据，只输出符合条件的文档。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$limit</span>      限制返回的文档数。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$skip</span>       跳过指定数量的文档，并返回余下的文档。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$project</span>    是否显示文档结构。重命名、增加、删除域、创建计算结果、嵌套文档</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$unwind</span>     文档中某一个数组类型字段拆分成多条，每条包含数组中的一个值。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$group</span>      文档分组，用于统计结果。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$sort</span>       文档排序后输出。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword"><code class="language-hljs gams">聚合框架常用操作：<br><span class="hljs-meta"><span class="hljs-meta-keyword">$match</span>      过滤数据，只输出符合条件的文档。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$limit</span>      限制返回的文档数。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$skip</span>       跳过指定数量的文档，并返回余下的文档。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$project</span>    是否显示文档结构。重命名、增加、删除域、创建计算结果、嵌套文档</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$unwind</span>     文档中某一个数组类型字段拆分成多条，每条包含数组中的一个值。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$group</span>      文档分组，用于统计结果。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$sort</span>       文档排序后输出。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$geoNear</span>    输出接近某一地理位置的有序文档。</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$group</span>实例</span><br>聚合表达式<br><span class="hljs-meta"><span class="hljs-meta-keyword">$sum</span>      计算总和。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$avg</span>      计算平均值。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$min</span>      获取集合中所有文档对应值得最小值。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$max</span>      获取集合中所有文档对应值得最大值。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$push</span>     在结果文档中插入值到一个数组中，若重复会再创建。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$pushAll</span>  同$push,只是一次可以追加多个值到一个数组字段内。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$pop</span>      在结果文档中删除数组的第一个或最后一个元素。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$addToSet</span> 在结果文档中插入值到一个数组中，若重复不会再创建。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$first</span>    根据资源文档的排序获取第一个文档数据。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$last</span>     根据资源文档的排序获取最后一个文档数据。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$rename</span>   修改字段名称</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$bit</span>      位操作，integer类型</span><br><br>例：<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,url:&#123;<span class="hljs-symbol">$</span>push:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;])<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,first_url:&#123;<span class="hljs-symbol">$</span>first:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,last_url:&#123;<span class="hljs-symbol">$</span>last:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;])<br><br>&#123; <span class="hljs-symbol">$</span>push : &#123; field : value &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pushAll : &#123; field : value_array &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pull : &#123; field : _value &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pop : &#123; field : <span class="hljs-number">1</span> &#125; &#125;<br><br>&#123; <span class="hljs-symbol">$</span>rename : &#123; old_field_name : new_field_name &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>bit : &#123; field : &#123;<span class="hljs-keyword">and</span> : <span class="hljs-number"><code class="language-hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$group</span>实例</span><br>聚合表达式<br><span class="hljs-meta"><span class="hljs-meta-keyword">$sum</span>      计算总和。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$avg</span>      计算平均值。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$min</span>      获取集合中所有文档对应值得最小值。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$max</span>      获取集合中所有文档对应值得最大值。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$push</span>     在结果文档中插入值到一个数组中，若重复会再创建。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$pushAll</span>  同$push,只是一次可以追加多个值到一个数组字段内。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$pop</span>      在结果文档中删除数组的第一个或最后一个元素。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$addToSet</span> 在结果文档中插入值到一个数组中，若重复不会再创建。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$first</span>    根据资源文档的排序获取第一个文档数据。</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$last</span>     根据资源文档的排序获取最后一个文档数据。</span><br><br><span class="hljs-meta"><span class="hljs-meta-keyword">$rename</span>   修改字段名称</span><br><span class="hljs-meta"><span class="hljs-meta-keyword">$bit</span>      位操作，integer类型</span><br><br>例：<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,url:&#123;<span class="hljs-symbol">$</span>push:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;])<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,first_url:&#123;<span class="hljs-symbol">$</span>first:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;<br>db.stu.aggregate([&#123;<span class="hljs-symbol">$</span>group:&#123;_id:<span class="hljs-string">"$by_user"</span>,last_url:&#123;<span class="hljs-symbol">$</span>last:<span class="hljs-string">"$url"</span>&#125;&#125;&#125;])<br><br>&#123; <span class="hljs-symbol">$</span>push : &#123; field : value &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pushAll : &#123; field : value_array &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pull : &#123; field : _value &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>pop : &#123; field : <span class="hljs-number">1</span> &#125; &#125;<br><br>&#123; <span class="hljs-symbol">$</span>rename : &#123; old_field_name : new_field_name &#125; &#125;<br>&#123; <span class="hljs-symbol">$</span>bit : &#123; field : &#123;<span class="hljs-keyword">and</span> : <span class="hljs-number">5</span>&#125;&#125;&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs yaml"><span class="hljs-string">$project实例</span><br><span class="hljs-number">0</span><span class="hljs-string">显示，1不显示，默认情况下_id字段是被包含的，想不包含的话_id</span> <span class="hljs-string">:</span> <span class="hljs-number">0</span><br><span class="hljs-string">db.stu.aggregate(</span><br>    <span class="hljs-string">&#123;</span><br>      <span class="hljs-string">$project</span> <span class="hljs-string">:</span> <span class="hljs-string">&#123;</span><br>        <span class="hljs-attr">title :</span> <span class="hljs-number">1</span> <span class="hljs-string">,</span><br>        <span class="hljs-attr">author :</span> <span class="hljs-number">1</span> <span class="hljs-string">,</span><br>      <span class="hljs-string">&#125;</span><br>    <span class="hljs-string">&#125;</span><br> <span class="hljs-string"><code class="language-hljs yaml"><span class="hljs-string">$project实例</span><br><span class="hljs-number">0</span><span class="hljs-string">显示，1不显示，默认情况下_id字段是被包含的，想不包含的话_id</span> <span class="hljs-string">:</span> <span class="hljs-number">0</span><br><span class="hljs-string">db.stu.aggregate(</span><br>    <span class="hljs-string">&#123;</span><br>      <span class="hljs-string">$project</span> <span class="hljs-string">:</span> <span class="hljs-string">&#123;</span><br>        <span class="hljs-attr">title :</span> <span class="hljs-number">1</span> <span class="hljs-string">,</span><br>        <span class="hljs-attr">author :</span> <span class="hljs-number">1</span> <span class="hljs-string">,</span><br>      <span class="hljs-string">&#125;</span><br>    <span class="hljs-string">&#125;</span><br> <span class="hljs-string">);</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$match</span>实例</span><br>db.articles.aggregate( [<br>   &#123; <span class="hljs-symbol">$</span>match : &#123; score : &#123; <span class="hljs-symbol">$</span><span class="hljs-keyword">gt</span> : <span class="hljs-number">70</span>, <span class="hljs-symbol">$</span>lte : <span class="hljs-number">90</span> &#125; &#125; &#125;,<br>   &#123; <span class="hljs-symbol">$</span>group: &#123; _id: null, count: &#123; <span class="hljs-symbol">$</span><span class="hljs-keyword">sum</span>: <span class="hljs-number"><code class="language-hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$match</span>实例</span><br>db.articles.aggregate( [<br>   &#123; <span class="hljs-symbol">$</span>match : &#123; score : &#123; <span class="hljs-symbol">$</span><span class="hljs-keyword">gt</span> : <span class="hljs-number">70</span>, <span class="hljs-symbol">$</span>lte : <span class="hljs-number">90</span> &#125; &#125; &#125;,<br>   &#123; <span class="hljs-symbol">$</span>group: &#123; _id: null, count: &#123; <span class="hljs-symbol">$</span><span class="hljs-keyword">sum</span>: <span class="hljs-number">1</span> &#125; &#125; &#125;<br>                    ] );<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="8-一对一、一对多、多对多的联系"><a href="#8-一对一、一对多、多对多的联系" class="headerlink" title="8.一对一、一对多、多对多的联系"></a>8.一对一、一对多、多对多的联系</h2><h3 id="8-1-ObjectId"><a href="#8-1-ObjectId" class="headerlink" title="8.1 ObjectId"></a>8.1 ObjectId</h3><ul><li>ObjectId 是一个12字节 BSON 类型数据<ul><li>前4个字节：时间戳</li><li>紧接的3个字节：机器标识码</li><li>紧接的两个字节：进程id组成（PID）</li><li>最后三个字节：随机数。</li></ul></li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs isbl"><span class="hljs-number">1</span>.创建新的<span class="hljs-variable">ObjectId</span><br>&gt;<span class="hljs-variable">newObjectId</span> = <span class="hljs-function"><span class="hljs-title">ObjectId</span>()</span><br><br><span class="hljs-number">2</span>.获取文档的创建时间<br>&gt;<span class="hljs-function"><span class="hljs-title">ObjectId</span>(<span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxx"</span>).getTimestamp()</span><br><br><span class="hljs-number">3</span>.ObjectId 转换为字符串<br>&gt;<span class="hljs-variable">new</span> <span class="hljs-function"><span class="hljs-title"><code class="language-hljs isbl"><span class="hljs-number">1</span>.创建新的<span class="hljs-variable">ObjectId</span><br>&gt;<span class="hljs-variable">newObjectId</span> = <span class="hljs-function"><span class="hljs-title">ObjectId</span>()</span><br><br><span class="hljs-number">2</span>.获取文档的创建时间<br>&gt;<span class="hljs-function"><span class="hljs-title">ObjectId</span>(<span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxx"</span>).getTimestamp()</span><br><br><span class="hljs-number">3</span>.ObjectId 转换为字符串<br>&gt;<span class="hljs-variable">new</span> <span class="hljs-function"><span class="hljs-title">ObjectId</span>().str</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="8-2-指定的序列会自动增长-1-并返回最新序列值"><a href="#8-2-指定的序列会自动增长-1-并返回最新序列值" class="headerlink" title="8.2 指定的序列会自动增长 1 并返回最新序列值"></a>8.2 指定的序列会自动增长 1 并返回最新序列值</h3><p>（最好不要对_id调用这个函数）</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql"><span class="hljs-number">1.</span>自己创建自增函数<br>&gt;<span class="hljs-keyword">function</span> Autoincrement(sequenceName)&#123;<br>   var sequenceDocument = db.counters.findAndModify(<br>      &#123;<br>         query:&#123;_id: sequenceName &#125;,<br>         <span class="hljs-keyword">update</span>: &#123;$inc:&#123;sequence_value:<span class="hljs-number">1</span>&#125;&#125;,<br>         "new":<span class="hljs-keyword">true</span><br>      &#125;);<br>   <span class="hljs-keyword">return</span> sequenceDocument.sequence_value;<br>&#125;<br><br><span class="hljs-number">2.</span>调用自增函数<br>&gt;db.<span class="hljs-keyword">user</span>.<span class="hljs-keyword">insert</span>(&#123;<br>   "userid":Autoincrement("userid"),<br>   "name":"zhangsan"&#125;)<br>&gt;db.<span class="hljs-keyword">user</span>.<span class="hljs-keyword">insert</span>(&#123;<br>   "userid":Autoincrement("userid"),<br>   "name":"lisi"&#125;)<br><br><span class="hljs-number">3.</span>读取文档<br>&gt;db.<span class="hljs-keyword">user</span>.find()<br>输出：<br>&#123; "_id" : ObjectId(xxxxxxx), "userid" : <span class="hljs-number">1</span>, "name" : "zhangsan"&#125;<br>&#123; "_id" : ObjectId(xxxxxxx), "userid" : <span class="hljs-number"><code class="language-hljs pgsql"><span class="hljs-number">1.</span>自己创建自增函数<br>&gt;<span class="hljs-keyword">function</span> Autoincrement(sequenceName)&#123;<br>   var sequenceDocument = db.counters.findAndModify(<br>      &#123;<br>         query:&#123;_id: sequenceName &#125;,<br>         <span class="hljs-keyword">update</span>: &#123;$inc:&#123;sequence_value:<span class="hljs-number">1</span>&#125;&#125;,<br>         "new":<span class="hljs-keyword">true</span><br>      &#125;);<br>   <span class="hljs-keyword">return</span> sequenceDocument.sequence_value;<br>&#125;<br><br><span class="hljs-number">2.</span>调用自增函数<br>&gt;db.<span class="hljs-keyword">user</span>.<span class="hljs-keyword">insert</span>(&#123;<br>   "userid":Autoincrement("userid"),<br>   "name":"zhangsan"&#125;)<br>&gt;db.<span class="hljs-keyword">user</span>.<span class="hljs-keyword">insert</span>(&#123;<br>   "userid":Autoincrement("userid"),<br>   "name":"lisi"&#125;)<br><br><span class="hljs-number">3.</span>读取文档<br>&gt;db.<span class="hljs-keyword">user</span>.find()<br>输出：<br>&#123; "_id" : ObjectId(xxxxxxx), "userid" : <span class="hljs-number">1</span>, "name" : "zhangsan"&#125;<br>&#123; "_id" : ObjectId(xxxxxxx), "userid" : <span class="hljs-number">2</span>, "name" : "lisi"&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>1.一对一：如夫妻</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs less"><span class="hljs-selector-tag">wifeAndHusband</span>集合<br><br><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.wifeAndHusband</span><span class="hljs-selector-class">.insert</span>([<br>  &#123;<br>    <span class="hljs-attribute">name</span>:<span class="hljs-string">"男1"</span><br>    <span class="hljs-attribute">wife</span>:&#123;<br>      <span class="hljs-attribute">name</span>:<span class="hljs-string">"女1"</span><br>      &#125;<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attribute">name</span>:<span class="hljs-string">"男2"</span><br>    <span class="hljs-attribute">wife</span>:&#123;<br>      <span class="hljs-attribute">name</span>:<span class="hljs-string"><code class="language-hljs less"><span class="hljs-selector-tag">wifeAndHusband</span>集合<br><br><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.wifeAndHusband</span><span class="hljs-selector-class">.insert</span>([<br>  &#123;<br>    <span class="hljs-attribute">name</span>:<span class="hljs-string">"男1"</span><br>    <span class="hljs-attribute">wife</span>:&#123;<br>      <span class="hljs-attribute">name</span>:<span class="hljs-string">"女1"</span><br>      &#125;<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attribute">name</span>:<span class="hljs-string">"男2"</span><br>    <span class="hljs-attribute">wife</span>:&#123;<br>      <span class="hljs-attribute">name</span>:<span class="hljs-string">"女2"</span><br>      &#125;<br>  &#125;,<br>]);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>2.$\color{red}一对多（相当于mysql的外键、多表查询）:如文章和评论$</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sqf">article集合（文章）<br>db.article.insert([<br>  &#123;<br>    article:<span class="hljs-string">"a"</span><br>  &#125;,<br>  &#123;<br>    article:<span class="hljs-string">"b"</span><br>  &#125;<br>]);<br><br>假设<span class="hljs-built_in">find</span>（）后,id为<span class="hljs-number">12</span>个标准字节<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<span class="hljs-string">"article"</span>:<span class="hljs-string">"a"</span>&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<span class="hljs-string">"article"</span>:<span class="hljs-string">"b"</span>&#125;<br><br><br><span class="hljs-built_in">comment</span>集合（评论）<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论1"</span>,<span class="hljs-string">"评论2"</span>,<span class="hljs-string">"评论3"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>)<br>]);<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论4"</span>,<span class="hljs-string">"评论5"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>)<br>]);<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论1"</span>,<span class="hljs-string">"评论2"</span>,<span class="hljs-string">"评论3"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>)<br>]);<br><br>此时两表已关联<br>先查找文章a(一篇)的评论的所有<span class="hljs-variable">_id</span>：<br>var article = db.article.findOne(&#123;article:<span class="hljs-string">"a"</span>&#125;).<span class="hljs-variable">_id</span>;<br>再查找所有与文章a的<span class="hljs-variable">_id</span>有关的评论：<br>db.<span class="hljs-built_in">comment</span>.<span class="hljs-built_in"><code class="language-hljs sqf">article集合（文章）<br>db.article.insert([<br>  &#123;<br>    article:<span class="hljs-string">"a"</span><br>  &#125;,<br>  &#123;<br>    article:<span class="hljs-string">"b"</span><br>  &#125;<br>]);<br><br>假设<span class="hljs-built_in">find</span>（）后,id为<span class="hljs-number">12</span>个标准字节<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<span class="hljs-string">"article"</span>:<span class="hljs-string">"a"</span>&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<span class="hljs-string">"article"</span>:<span class="hljs-string">"b"</span>&#125;<br><br><br><span class="hljs-built_in">comment</span>集合（评论）<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论1"</span>,<span class="hljs-string">"评论2"</span>,<span class="hljs-string">"评论3"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>)<br>]);<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论4"</span>,<span class="hljs-string">"评论5"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>)<br>]);<br>db.<span class="hljs-built_in">comment</span>.insert([<br>  <span class="hljs-built_in">list</span>:[<span class="hljs-string">"评论1"</span>,<span class="hljs-string">"评论2"</span>,<span class="hljs-string">"评论3"</span>]<br>  article_id:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>)<br>]);<br><br>此时两表已关联<br>先查找文章a(一篇)的评论的所有<span class="hljs-variable">_id</span>：<br>var article = db.article.findOne(&#123;article:<span class="hljs-string">"a"</span>&#125;).<span class="hljs-variable">_id</span>;<br>再查找所有与文章a的<span class="hljs-variable">_id</span>有关的评论：<br>db.<span class="hljs-built_in">comment</span>.<span class="hljs-built_in">find</span>(&#123;article_id:article&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>3.$\color{red}多对多（相当于mysql的外键、多表查询）:如老师和学生$<br>把_id变成一个数组</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs dts">teachers集合<br>db.teachers.insert([<br>  &#123;teachername:<span class="hljs-string">"老师1"</span>&#125;,<br>  &#123;teachername:<span class="hljs-string">"老师2"</span>&#125;,<br>  &#123;teachername:<span class="hljs-string">"老师3"</span>&#125;,<br>]);<br><br>假设find（）后,id为<span class="hljs-number">12</span>个标准字节<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师1"</span>&#125;&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师2"</span>&#125;&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师2"</span>&#125;&#125;<br><br>students集合<br>db.students.insert([<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生1"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>)<br>    ]<br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生2"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>)<br>    ]<br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生3"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>)<br>    ]<br>  &#125;,<br>]);<br><br><br>此时两表已关联<br>先查找老师<span class="hljs-number">1</span>(一个)的所有_id：<br>var teacher = db.teachers.findOne(&#123;teachername:<span class="hljs-string">"老师1"</span>&#125;)._id;<br>再查找所有与老师<span class="hljs-number"><code class="language-hljs dts">teachers集合<br>db.teachers.insert([<br>  &#123;teachername:<span class="hljs-string">"老师1"</span>&#125;,<br>  &#123;teachername:<span class="hljs-string">"老师2"</span>&#125;,<br>  &#123;teachername:<span class="hljs-string">"老师3"</span>&#125;,<br>]);<br><br>假设find（）后,id为<span class="hljs-number">12</span>个标准字节<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师1"</span>&#125;&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师2"</span>&#125;&#125;<br>&#123;<span class="hljs-string">"_id"</span>:ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>),<span class="hljs-string">"teachername"</span>:<span class="hljs-string">"老师2"</span>&#125;&#125;<br><br>students集合<br>db.students.insert([<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生1"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>)<br>    ]<br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生2"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx1"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>)<br>    ]<br>  &#125;,<br>  &#123;<br><span class="hljs-symbol">    stuname:</span><span class="hljs-string">"学生3"</span>，<br><span class="hljs-symbol">    teacher_id:</span>[<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx2"</span>),<br>      ObjectId(<span class="hljs-string">"xxxxxxxxxxx3"</span>)<br>    ]<br>  &#125;,<br>]);<br><br><br>此时两表已关联<br>先查找老师<span class="hljs-number">1</span>(一个)的所有_id：<br>var teacher = db.teachers.findOne(&#123;teachername:<span class="hljs-string">"老师1"</span>&#125;)._id;<br>再查找所有与老师<span class="hljs-number">1</span>的_id有关的学生：<br>db.students.find(&#123;teacher_id:teacher&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="9-多表查询深入"><a href="#9-多表查询深入" class="headerlink" title="9.多表查询深入"></a>9.多表查询深入</h2><p>第13课</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104993090&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MongoDB简单学习（初级）&lt;/a&gt;&lt;/p&gt;
&lt;h2
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://lewis.qi.tk/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="http://lewis.qi.tk/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>webpack--打包基础</title>
    <link href="http://lewis.qi.tk/2020/05/16/webpack-%E6%89%93%E5%8C%85%E5%9F%BA%E7%A1%80/"/>
    <id>http://lewis.qi.tk/2020/05/16/webpack-%E6%89%93%E5%8C%85%E5%9F%BA%E7%A1%80/</id>
    <published>2020-05-16T11:55:22.000Z</published>
    <updated>2020-05-16T11:58:14.609Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104749506" target="_blank" rel="noopener">webpack–打包基础</a></p><h1 id="webpack打包"><a href="#webpack打包" class="headerlink" title="webpack打包"></a>webpack打包</h1><p>异步编程的直接体现就是回调,处理大量的并发请求<br>一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作</p><h2 id="cmd（npm、node-js）"><a href="#cmd（npm、node-js）" class="headerlink" title="cmd（npm、node.js）"></a>cmd（npm、node.js）</h2><p>允许用户从NPM服务器下载别人编写的第三方包到本地使用。<br>允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。<br>允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。  </p><h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><ul><li><p>webpack是前端资源构建工具，静态模块打包器。</p></li><li><p>资源文件（js/json/css/img/less/sass/jq····）都作为模块处理</p></li><li><p>1.查看版本</p><ul><li><code>node -v</code></li><li><code>npm -v</code></li></ul></li><li><p>2.npm安装指令</p><ul><li>安装一个用于<strong>生产环境</strong>的安装包  </li><li><code>npm install --save  xxx</code></li><li>安装一个用于<strong>开发环境</strong>的安装包（例如linter, 测试库等）</li><li><code>npm install --save-dev  xxx</code></li></ul></li><li><p>3.升级npm</p><ul><li><code>npm install -g npm</code></li></ul></li><li><p>4.引入资源（简称：打包）</p><ul><li><code>import $ from &#39;jquery&#39;;</code>  【引入js资源】</li><li><code>import &#39;./index.less&#39;;</code>  【引入less资源（路径）】  </li><li><code>import x from &#39;./data.json&#39;;</code>  【引入json资源，用x作为变量】</li></ul></li></ul><blockquote><p>在E:\webpack-demo新建文件如webpack-test并进入<br>cd E:\webpack-demo\webpack-test  </p></blockquote><ul><li>5.创建一个新的本地项目目录名为webpack-demo<ul><li><code>mkdir webpack-test</code></li></ul></li><li>6.进入目录<ul><li><code>cd webpack-test</code></li></ul></li><li>7.安装webpack<ul><li><code>npm install --save-dev webpack</code> 【安装最新版本】</li><li><code>npm install --save-dev webpack@3.12.0</code>  【安装你需要的版本】</li></ul></li><li>8.安装webpack-cli<ul><li><code>npm install --save-dev webpack-cli</code></li></ul></li></ul><p>注：7和8混合：</p><ul><li><code>npm install webpack webpack-cli -D</code></li></ul><hr><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul><li>1.删除全局webpack-cli  <ul><li><code>npm uninstall -g webpack-cli</code>  </li></ul></li><li>2.删除全局webpack  <ul><li><code>npm uninstall -g webpack</code>  </li></ul></li><li>3.删除本地（局部）webpack-cli  <ul><li><code>npm uninstall webpack-cli</code>  </li></ul></li><li>4.删除本地（局部）webpack  <ul><li><code>npm uninstall webpack</code>  </li></ul></li><li>5.检查webpack残余文件  <ul><li><code>rm -rf node_modules package-lock.json package.json</code></li></ul></li></ul><hr><h2 id="webpack-5个核心概念"><a href="#webpack-5个核心概念" class="headerlink" title="webpack 5个核心概念"></a>webpack 5个核心概念</h2><ol><li><p><code>entry</code> 入口<br>指示webpack从哪个文件作为入口起点开始打包  </p></li><li><p><code>output</code> 输出<br>指示webpack打包后的资源bundles输出到哪里及如何命名  </p></li><li><p><code>loader</code> 编译<br>让webpack处理非js文件（webpack只能处理打包js、json文件，不能处理打包css、img文件）  </p></li><li><p><code>plugins</code> 插件<br>更广的任务（压缩、优化）  </p></li><li><p><code>mode</code> 编译模式  </p></li></ol><ul><li><code>development</code> （开发环境）<ul><li>处于开发阶段，不会进行压缩和混淆，打包速度会快一些</li></ul></li><li><code>production</code> （生产环境）<ul><li>项目处于上线发布阶段，会进行压缩和混淆，打包速度会慢一些</li></ul></li></ul><hr><h2 id="webpack-config-js-webpack的配置文件"><a href="#webpack-config-js-webpack的配置文件" class="headerlink" title="webpack.config.js: webpack的配置文件"></a>webpack.config.js: webpack的配置文件</h2><p>作用：指示webpack干哪些活（当运行webpack指令时，加载里面的配置）  </p><ul><li>src文件夹内文件采用 <code>es6</code> 编写</li><li>webpack.config.js采用 <code>commonjs</code> 编写</li></ul><h3 id="color-red-基本配置"><a href="#color-red-基本配置" class="headerlink" title="$\color{red}基本配置$"></a>$\color{red}基本配置$</h3><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-comment">//resolve用来拼接绝对路径的方法</span><br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-comment">//webpack配置</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br><br>    <span class="hljs-comment">//入口</span><br>    entry: path:resolve(__dirname,<span class="hljs-string">'src/index.js'</span>),<br><br>    <span class="hljs-comment">//输出</span><br>    output:&#123;<br>        <span class="hljs-comment">//输出文件名</span><br>        filename:<span class="hljs-string">'build.js'</span>,<br>        <span class="hljs-comment">//输出路径，__dirname代表当前文件的目录绝对路径，+build路径</span><br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;,<br><br>    <span class="hljs-comment">//loader配置</span><br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            <span class="hljs-comment">//详细配置</span><br>        ]<br>    &#125;,<br><br>    <span class="hljs-comment">//插件配置</span><br>    plugins:[<br>        <span class="hljs-comment">//详细配置</span><br>    ],<br><br>    <span class="hljs-comment">//模式</span><br>    mode：<span class="hljs-string">'development'</span>,<br>    或mode：<span class="hljs-string"><code class="language-hljs js"><span class="hljs-comment">//resolve用来拼接绝对路径的方法</span><br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-comment">//webpack配置</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br><br>    <span class="hljs-comment">//入口</span><br>    entry: path:resolve(__dirname,<span class="hljs-string">'src/index.js'</span>),<br><br>    <span class="hljs-comment">//输出</span><br>    output:&#123;<br>        <span class="hljs-comment">//输出文件名</span><br>        filename:<span class="hljs-string">'build.js'</span>,<br>        <span class="hljs-comment">//输出路径，__dirname代表当前文件的目录绝对路径，+build路径</span><br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;,<br><br>    <span class="hljs-comment">//loader配置</span><br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            <span class="hljs-comment">//详细配置</span><br>        ]<br>    &#125;,<br><br>    <span class="hljs-comment">//插件配置</span><br>    plugins:[<br>        <span class="hljs-comment">//详细配置</span><br>    ],<br><br>    <span class="hljs-comment">//模式</span><br>    mode：<span class="hljs-string">'development'</span>,<br>    或mode：<span class="hljs-string">'production'</span>,<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><hr><h2 id="一（1）、【打包普通js文件】"><a href="#一（1）、【打包普通js文件】" class="headerlink" title="一（1）、【打包普通js文件】"></a>一（1）、【打包普通js文件】</h2><p>src/index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 本来引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 本来引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>npm install jQuery -S 【安装jQuery】</li></ul><p>src/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-comment">//导入jQuery</span><br><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jquery'</span><br><br>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  $(<span class="hljs-string">'li:odd'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'blue'</span>)<br>  $(<span class="hljs-string">'li:even'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string"><code class="language-hljs js"><span class="hljs-comment">//导入jQuery</span><br><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jquery'</span><br><br>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  $(<span class="hljs-string">'li:odd'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'blue'</span>)<br>  $(<span class="hljs-string">'li:even'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'red'</span>)<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="1-项目根目录安装webpack"><a href="#1-项目根目录安装webpack" class="headerlink" title="1.项目根目录安装webpack"></a>1.项目根目录安装webpack</h3><ul><li><code>npm install webpack webpack-cli -D</code></li></ul><h3 id="2-根目录中创建一个-webpack-config-js-来配置webpack"><a href="#2-根目录中创建一个-webpack-config-js-来配置webpack" class="headerlink" title="2.根目录中创建一个 webpack.config.js 来配置webpack"></a>2.根目录中创建一个 <code>webpack.config.js</code> 来配置webpack</h3><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-built_in">module</span>.exports = &#123;<br>    mode:<span class="hljs-string"><code class="language-hljs js"><span class="hljs-built_in">module</span>.exports = &#123;<br>    mode:<span class="hljs-string">"development"</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3-修改项目中的关于node的-package-json-文件添加运行脚本dev【可有可无】"><a href="#3-修改项目中的关于node的-package-json-文件添加运行脚本dev【可有可无】" class="headerlink" title="3.修改项目中的关于node的 package.json 文件添加运行脚本dev【可有可无】"></a>3.修改项目中的关于node的 <code>package.json</code> 文件添加运行脚本dev【可有可无】</h3><ul><li>dev脚本，dev是自定义的名字</li></ul><p>package.json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>:<span class="hljs-string"><code class="language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>:<span class="hljs-string">"webpack"</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="4-设置webpack的打包入口-出口"><a href="#4-设置webpack的打包入口-出口" class="headerlink" title="4.设置webpack的打包入口/出口"></a>4.设置webpack的打包入口/出口</h3><ul><li>默认 <code>src/index.js</code> 打包<strong>入口</strong>js 文件</li><li>默认 <code>dist/main.js</code> 打包<strong>输出</strong> js 文件</li></ul><h3 id="5-不想使用默认的入口-出口js文件"><a href="#5-不想使用默认的入口-出口js文件" class="headerlink" title="5.不想使用默认的入口/出口js文件"></a>5.不想使用默认的入口/出口js文件</h3><ul><li>改变 <code>webpack.config.js</code> 来设置入口/出口的js文件</li></ul><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    mode:<span class="hljs-string">"development"</span>,<br>    <span class="hljs-comment">//入口文件路径</span><br>    entry: path.join(__dirname,<span class="hljs-string">"./src/a.js"</span>),<br>    <span class="hljs-comment">//出口文件路径</span><br>    output:&#123;<br>        <span class="hljs-comment">//设置路径</span><br>        path:path.join(__dirname,<span class="hljs-string">"./dist"</span>),<br>        <span class="hljs-comment">//设置文件名</span><br>        filename:<span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    mode:<span class="hljs-string">"development"</span>,<br>    <span class="hljs-comment">//入口文件路径</span><br>    entry: path.join(__dirname,<span class="hljs-string">"./src/a.js"</span>),<br>    <span class="hljs-comment">//出口文件路径</span><br>    output:&#123;<br>        <span class="hljs-comment">//设置路径</span><br>        path:path.join(__dirname,<span class="hljs-string">"./dist"</span>),<br>        <span class="hljs-comment">//设置文件名</span><br>        filename:<span class="hljs-string">"b.js"</span><br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="6-设置webpack的自动打包"><a href="#6-设置webpack的自动打包" class="headerlink" title="6.设置webpack的自动打包"></a>6.设置webpack的自动打包</h3><ul><li><p><code>webpack-dev-server</code> 自动打包的输出文件，默认放到了服务器的根目录中.</p></li><li><p>A.安装自动打包功能的包： <code>webpack-dev-server</code></p><ul><li><code>npm install webpack-dev-server -D</code></li></ul></li><li><p>B.修改node的 <code>package.json</code> 中的dev指令如下：</p></li></ul><p>package.json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>:<span class="hljs-string"><code class="language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>:<span class="hljs-string">"webpack-dev-server"</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="7-在页面中引入项目打包生成的js文件"><a href="#7-在页面中引入项目打包生成的js文件" class="headerlink" title="7.在页面中引入项目打包生成的js文件"></a>7.在页面中引入项目打包生成的js文件</h3><p>（找到默认的dist路径中生成的main.js文件，将其引入到html页面中）</p><ul><li><p>现入口文件：src/a.js</p></li><li><p>现出口文件：dist/b.js</p></li><li><p>本来html引入的资源是</p><ul><li><code>&lt;script src=&quot;src/a.js&quot;&gt;&lt;/script&gt;</code></li></ul></li><li><p>html引入的资源是（更改后,未自动打包）</p><ul><li><code>&lt;script src=&quot;src/b.js&quot;&gt;&lt;/script&gt;</code></li></ul></li><li><p>html引入的资源是（更改后,已自动打包）【重要】</p><ul><li><code>&lt;script src=&quot;/b.js&quot;&gt;&lt;/script&gt;</code></li></ul></li></ul><h3 id="8-启动webpack进行项目打包-运行打包后资源"><a href="#8-启动webpack进行项目打包-运行打包后资源" class="headerlink" title="8.启动webpack进行项目打包,运行打包后资源"></a>8.启动webpack进行项目打包,运行打包后资源</h3><p>方式一：<br>默认的webpack会以 ./src/index.js 为入口文件开始打包，<br>打包后输出到 .build/built.js ，<br>其打包环境mode为development  </p><ul><li>打包：<code>webpack ./src/index.js -o .build/built.js --mode=development</code></li><li>运行：<code>node .build/built.js</code></li></ul><p>方式二:</p><ul><li><p>因为<code>webpack-dev-server</code> $\color{red}默认打开服务器网页$</p><ul><li>自动运行在<code>http://localhost:8080/</code>,且文件直接托管于根目录，</li><li><code>http://localhost:8080/b.js</code>可直接看到源代码</li></ul></li><li><p><code>npm run dev</code></p></li></ul><p>方法三：【重要】</p><ul><li>A.配置html-webpack-plugin，$\color{red}现在是默认直接打开对应文件$<ul><li><code>http://localhost:8080/</code>可直接看到源代码</li><li><code>npm install html-webpack-plugin -D</code></li></ul></li><li>B.修改 <code>webpack.config.js</code> 文件</li></ul><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-comment">//导入包</span><br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-comment">//创建对象</span><br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    <span class="hljs-comment">//设置生成预览页面的模板文件</span><br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    <span class="hljs-comment">//设置生成的预览页面名称</span><br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><br><span class="hljs-built_in"><code class="language-hljs js"><span class="hljs-comment">//导入包</span><br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-comment">//创建对象</span><br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    <span class="hljs-comment">//设置生成预览页面的模板文件</span><br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    <span class="hljs-comment">//设置生成的预览页面名称</span><br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><br><span class="hljs-built_in">module</span>.exports = &#123;<br>                ......<br>                plugins:[ htmlPlugin ]<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>C.【运行的时候可自动弹出浏览器】两种方式等价</li></ul><p>方式一：打开 <code>package.json</code> 文件，修改dev命令</p><p>package.json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>: <span class="hljs-string"><code class="language-hljs js"><span class="hljs-string">"scripts"</span>:&#123;<br>    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"webpack-dev-server --open --host localhost --port 8080"</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>方式二</p><p>webpack.config.js:  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:&#123;...<br>    &#125;,<br>    output:&#123;...<br>    &#125;,<br>    <span class="hljs-built_in">module</span>:&#123;<br>    &#125;,<br>    plugins:&#123;<br>    &#125;,<br>    mode:&#123;<br>    &#125;,<br>    <span class="hljs-comment">//用于自动编译，打开浏览器并刷新（不用重复webpack进行编译）</span><br>    devServer:&#123;<br>        contentBase:resolve(__dirname,<span class="hljs-string">'build'</span>),<br>        <span class="hljs-comment">//启动gzip压缩</span><br>        compress:<span class="hljs-literal">true</span>,<br>        <span class="hljs-comment">//服务端口号</span><br>        port:<span class="hljs-number">3000</span>,<br>        <span class="hljs-comment">//保存后自动打开浏览器</span><br>        open:<span class="hljs-literal"><code class="language-hljs js"><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:&#123;...<br>    &#125;,<br>    output:&#123;...<br>    &#125;,<br>    <span class="hljs-built_in">module</span>:&#123;<br>    &#125;,<br>    plugins:&#123;<br>    &#125;,<br>    mode:&#123;<br>    &#125;,<br>    <span class="hljs-comment">//用于自动编译，打开浏览器并刷新（不用重复webpack进行编译）</span><br>    devServer:&#123;<br>        contentBase:resolve(__dirname,<span class="hljs-string">'build'</span>),<br>        <span class="hljs-comment">//启动gzip压缩</span><br>        compress:<span class="hljs-literal">true</span>,<br>        <span class="hljs-comment">//服务端口号</span><br>        port:<span class="hljs-number">3000</span>,<br>        <span class="hljs-comment">//保存后自动打开浏览器</span><br>        open:<span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>D.运行打包后的html<ul><li><code>npm run dev</code></li></ul></li></ul><hr><h2 id="一（2）、【打包js文件中的高级语法】"><a href="#一（2）、【打包js文件中的高级语法】" class="headerlink" title="一（2）、【打包js文件中的高级语法】"></a>一（2）、【打包js文件中的高级语法】</h2><h3 id="A-安装包"><a href="#A-安装包" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install babel-loader @babel/core @babel/runtime -D</code><ul><li>安装babel转换器</li></ul></li><li><code>npm install @babel/preset-env @babel/plugin-transform-runtime @babel/plugin-proposal-class-properties -D</code><ul><li>安装babel语法插件包</li></ul></li></ul><h3 id="B-配置规则【module中的rules数组】"><a href="#B-配置规则【module中的rules数组】" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>webpack.config.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.js$/</span>,<br>                use:<span class="hljs-string">"babel-loader"</span>,<br>                <span class="hljs-comment">//exclude为排除项，意思是不要处理node_modules中的js文件</span><br>                exclude:<span class="hljs-regexp">/node_modules/</span><br>            &#125;<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.js$/</span>,<br>                use:<span class="hljs-string">"babel-loader"</span>,<br>                <span class="hljs-comment">//exclude为排除项，意思是不要处理node_modules中的js文件</span><br>                exclude:<span class="hljs-regexp">/node_modules/</span><br>            &#125;<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string">'development'</span>,<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-根目录创建并配置-babel-config-js-文件"><a href="#C-根目录创建并配置-babel-config-js-文件" class="headerlink" title="C.根目录创建并配置 babel.config.js 文件"></a>C.根目录创建并配置 <code>babel.config.js</code> 文件</h3><p>babel.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-comment">// const presets = [</span><br><span class="hljs-comment">//     ["@babel/env",&#123;</span><br><span class="hljs-comment">//         targets:&#123;</span><br><span class="hljs-comment">//             edge:"17",</span><br><span class="hljs-comment">//             firefox:"60",</span><br><span class="hljs-comment">//             chrome:"67",</span><br><span class="hljs-comment">//             safari:"11.1"</span><br><span class="hljs-comment">//         &#125;</span><br><span class="hljs-comment">//     &#125;]</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>    presets:[<span class="hljs-string">"@babel/preset-env"</span>],<br>    plugins:[ <span class="hljs-string">"@babel/plugin-transform-runtime"</span>, <span class="hljs-string"><code class="language-hljs js"><span class="hljs-comment">// const presets = [</span><br><span class="hljs-comment">//     ["@babel/env",&#123;</span><br><span class="hljs-comment">//         targets:&#123;</span><br><span class="hljs-comment">//             edge:"17",</span><br><span class="hljs-comment">//             firefox:"60",</span><br><span class="hljs-comment">//             chrome:"67",</span><br><span class="hljs-comment">//             safari:"11.1"</span><br><span class="hljs-comment">//         &#125;</span><br><span class="hljs-comment">//     &#125;]</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>    presets:[<span class="hljs-string">"@babel/preset-env"</span>],<br>    plugins:[ <span class="hljs-string">"@babel/plugin-transform-runtime"</span>, <span class="hljs-string">"@babel/plugin-proposal-class-properties"</span> ]<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>src/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-comment">//高级js语法</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> info = <span class="hljs-string">'aaa'</span><br>&#125;<br><span class="hljs-built_in"><code class="language-hljs js"><span class="hljs-comment">//高级js语法</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> info = <span class="hljs-string">'aaa'</span><br>&#125;<br><span class="hljs-built_in">console</span>.log(Person.info)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>可以使用npx<strong>运行未打包前的高级js文件</strong><ul><li><code>npx babel-node src/index.js</code></li></ul></li></ul><p>src/index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="D-运行打包后的html"><a href="#D-运行打包后的html" class="headerlink" title="D.运行打包后的html"></a>D.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><h2 id="二、【打包非js模块】加载器"><a href="#二、【打包非js模块】加载器" class="headerlink" title="二、【打包非js模块】加载器"></a>二、【打包非js模块】加载器</h2><ul><li>1.css-loader,style-loader<ul><li>处理样式文件</li></ul></li><li>2.less-loader</li><li>3.sass-loader</li><li>4.url-loader,file-loader<ul><li>打包处理css中与url路径有关的文件</li></ul></li><li>5.postcss-loader<ul><li>自动添加css的兼容性前缀</li></ul></li><li>6.babel-loader<ul><li>处理高级js语法的加载器</li></ul></li></ul><p>注意：<br><strong>指定多个loader时的顺序是固定的，而调用loader的顺序是从后向前进行调用</strong></p><hr><h3 id="二（1）、【打包css、style样式模块】"><a href="#二（1）、【打包css、style样式模块】" class="headerlink" title="二（1）、【打包css、style样式模块】"></a>二（1）、【打包css、style样式模块】</h3><h3 id="A-安装包-1"><a href="#A-安装包-1" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install style-loader css-loader -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-1"><a href="#B-配置规则【module中的rules数组】-1" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.css$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string"><code class="language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.css$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>]<br>&#125;,<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-运行打包后的html"><a href="#C-运行打包后的html" class="headerlink" title="C.运行打包后的html"></a>C.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><h3 id="二（2）、【打包less样式模块】"><a href="#二（2）、【打包less样式模块】" class="headerlink" title="二（2）、【打包less样式模块】"></a>二（2）、【打包less样式模块】</h3><h3 id="A-安装包-2"><a href="#A-安装包-2" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install style-loader css-loader -D</code></li><li><code>npm install less-loader less -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-2"><a href="#B-配置规则【module中的rules数组】-2" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.less$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string"><code class="language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.less$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'less-loader'</span>]<br>&#125;,<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-运行打包后的html-1"><a href="#C-运行打包后的html-1" class="headerlink" title="C.运行打包后的html"></a>C.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><h3 id="二（3）、【打包scss样式模块】"><a href="#二（3）、【打包scss样式模块】" class="headerlink" title="二（3）、【打包scss样式模块】"></a>二（3）、【打包scss样式模块】</h3><h3 id="A-安装包-3"><a href="#A-安装包-3" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install style-loader css-loader -D</code></li><li><code>npm install sass-loader node-sass -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-3"><a href="#B-配置规则【module中的rules数组】-3" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.scss$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string"><code class="language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.scss$/</span>,<br>    use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'sass-loader'</span>]<br>&#125;,<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-运行打包后的html-2"><a href="#C-运行打包后的html-2" class="headerlink" title="C.运行打包后的html"></a>C.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><h3 id="二（4）、【打包图片以及字体文件】"><a href="#二（4）、【打包图片以及字体文件】" class="headerlink" title="二（4）、【打包图片以及字体文件】"></a>二（4）、【打包图片以及字体文件】</h3><h3 id="A-安装包-4"><a href="#A-安装包-4" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install url-loader file-loader -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-4"><a href="#B-配置规则【module中的rules数组】-4" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>规则1：</p><ul><li>限制输入的原大小</li><li>$\color{red}输出结果可能会少图片，因为被base64处理成字符串的形式$  </li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>    <span class="hljs-comment">//limit用来设置字节数，只有小于limit值的图片，才会转换成base64图片</span><br>    use:<span class="hljs-string"><code class="language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>    <span class="hljs-comment">//limit用来设置字节数，只有小于limit值的图片，才会转换成base64图片</span><br>    use:<span class="hljs-string">"url-loader?limit=16940"</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>规则2：</p><ul><li>限制输出后的大小</li><li>限制输出文件命名（hash随机10位+原文件的后缀名）<ul><li><code>ext</code> 表示原文件的后缀名</li></ul></li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>    loader:<span class="hljs-string">'url-loader'</span>,<br>    options:&#123;<br>        limit:<span class="hljs-number">8</span>*<span class="hljs-number">1024</span><br>        esModule:<span class="hljs-literal">false</span>,<br>        name：<span class="hljs-string"><code class="language-hljs js">&#123;<br>    test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>    loader:<span class="hljs-string">'url-loader'</span>,<br>    options:&#123;<br>        limit:<span class="hljs-number">8</span>*<span class="hljs-number">1024</span><br>        esModule:<span class="hljs-literal">false</span>,<br>        name：<span class="hljs-string">'[hash:10].[ext]'</span><br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-运行打包后的html-3"><a href="#C-运行打包后的html-3" class="headerlink" title="C.运行打包后的html"></a>C.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><h3 id="二（5）、【打包其他资源】"><a href="#二（5）、【打包其他资源】" class="headerlink" title="二（5）、【打包其他资源】"></a>二（5）、【打包其他资源】</h3><h3 id="A-安装包-5"><a href="#A-安装包-5" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install html-webpack-plugin -D</code><ul><li>直接打开对应导入的文件index.html</li></ul></li><li><code>npm install url-loader file-loader -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-5"><a href="#B-配置规则【module中的rules数组】-5" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><p><code>test</code> 设置需要匹配的文件类型，支持正则</p></li><li><p><code>use</code>  表示该文件类型需要调用的loader</p></li><li><p><strong>注意use的顺序：调用是从后往前</strong></p></li><li><p>打包其他资源（排除了css、js、html、less、图片资源等）<br>前4个的综合  </p></li></ul><p>webpack.config.js【部分】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&#123;<br>    exclude:<span class="hljs-regexp">/.(css|js|html|less|jpg|png|svg)/</span>,<br>    loader:<span class="hljs-string">'file-loader'</span>,<br>    options:&#123;<br>        name：<span class="hljs-string"><code class="language-hljs js">&#123;<br>    exclude:<span class="hljs-regexp">/.(css|js|html|less|jpg|png|svg)/</span>,<br>    loader:<span class="hljs-string">'file-loader'</span>,<br>    options:&#123;<br>        name：<span class="hljs-string">'[hash:10].[ext]'</span><br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-运行打包后的html-4"><a href="#C-运行打包后的html-4" class="headerlink" title="C.运行打包后的html"></a>C.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr><p>webpack.config.js【全部】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.css$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.less$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'less-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.scss$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'sass-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>                use:<span class="hljs-string">"url-loader?limit=16940"</span><br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>                loader:<span class="hljs-string">'url-loader'</span>,<br>                options:&#123;<br>                    limit:<span class="hljs-number">8</span>*<span class="hljs-number">1024</span><br>                    esModule:<span class="hljs-literal">false</span>,<br>                    name：<span class="hljs-string">'[hash:10].[ext]'</span><br>                &#125;<br>            &#125;,<br>            &#123;<br>                exclude:<span class="hljs-regexp">/.(css|js|html|less|jpg|png|svg)/</span>,<br>                loader:<span class="hljs-string">'file-loader'</span>,<br>                options:&#123;<br>                    name：<span class="hljs-string">'[hash:10].[ext]'</span><br>                &#125;<br>            &#125;<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.css$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.less$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'less-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.scss$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'sass-loader'</span>]<br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>                use:<span class="hljs-string">"url-loader?limit=16940"</span><br>            &#125;,<br>            &#123;<br>                test:<span class="hljs-regexp">/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/</span>,<br>                loader:<span class="hljs-string">'url-loader'</span>,<br>                options:&#123;<br>                    limit:<span class="hljs-number">8</span>*<span class="hljs-number">1024</span><br>                    esModule:<span class="hljs-literal">false</span>,<br>                    name：<span class="hljs-string">'[hash:10].[ext]'</span><br>                &#125;<br>            &#125;,<br>            &#123;<br>                exclude:<span class="hljs-regexp">/.(css|js|html|less|jpg|png|svg)/</span>,<br>                loader:<span class="hljs-string">'file-loader'</span>,<br>                options:&#123;<br>                    name：<span class="hljs-string">'[hash:10].[ext]'</span><br>                &#125;<br>            &#125;<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string">'development'</span>,<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>前五个所有文件</p><p>src/css/1.css(含图片)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">li &#123;<br>  list-style: none;<br>&#125;<br>::placeholder &#123;<br>  color: red;<br>&#125;<br>#box &#123;<br>  width: <span class="hljs-number">580</span>px;<br>  height: <span class="hljs-number">340</span>px;<br>  background-color: pink;<br>  background: url(<span class="hljs-string"><code class="language-hljs js">li &#123;<br>  list-style: none;<br>&#125;<br>::placeholder &#123;<br>  color: red;<br>&#125;<br>#box &#123;<br>  width: <span class="hljs-number">580</span>px;<br>  height: <span class="hljs-number">340</span>px;<br>  background-color: pink;<br>  background: url(<span class="hljs-string">'../images/1.jpg'</span>);<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>src/css/1.less</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs less"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-selector-tag">ul</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number"><code class="language-hljs less"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-selector-tag">ul</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>src/css/1.scss</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs scss"><span class="hljs-selector-tag">ul</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>  <span class="hljs-selector-tag">li</span> &#123;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number"><code class="language-hljs scss"><span class="hljs-selector-tag">ul</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>  <span class="hljs-selector-tag">li</span> &#123;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">30px</span>;<br>  &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>src/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jquery'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.css'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.less'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.scss'</span><br><br>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  $(<span class="hljs-string">'li:odd'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'blue'</span>)<br>  $(<span class="hljs-string">'li:even'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jquery'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.css'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.less'</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'./css/1.scss'</span><br><br>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  $(<span class="hljs-string">'li:odd'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'blue'</span>)<br>  $(<span class="hljs-string">'li:even'</span>).css(<span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'red'</span>)<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>src/index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"aaa"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第1个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第2个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第3个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>这是第4个li<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><hr><h3 id="二（6）、【打包css、style样式模块-自动添加css的兼容性前缀】"><a href="#二（6）、【打包css、style样式模块-自动添加css的兼容性前缀】" class="headerlink" title="二（6）、【打包css、style样式模块,自动添加css的兼容性前缀】"></a>二（6）、【打包css、style样式模块,自动添加css的兼容性前缀】</h3><h3 id="A-安装包-6"><a href="#A-安装包-6" class="headerlink" title="A.安装包"></a>A.安装包</h3><ul><li><code>npm install style-loader css-loader -D</code></li><li><code>npm install postcss-loader autoprefixer -D</code></li></ul><h3 id="B-配置规则【module中的rules数组】-6"><a href="#B-配置规则【module中的rules数组】-6" class="headerlink" title="B.配置规则【module中的rules数组】"></a>B.配置规则【module中的rules数组】</h3><ul><li><code>test</code> 设置需要匹配的文件类型，支持正则</li><li><code>use</code>  表示该文件类型需要调用的loader</li><li><strong>注意use的顺序：调用是从后往前</strong></li></ul><p>webpack.config.js:  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.css$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'postcss-loader'</span>]<br>            &#125;,<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> htmlPlugin = <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>    template:<span class="hljs-string">"./src/index.html"</span>,<br>    filename:<span class="hljs-string">"index.html"</span><br>&#125;)<br><span class="hljs-keyword">const</span>&#123; resolve &#125;=<span class="hljs-built_in">require</span>&#123;<span class="hljs-string">'path'</span>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry:<span class="hljs-string">'.src/index.js'</span>,<br>    output:&#123;<br>        filename:<span class="hljs-string">'build.js'</span>,<br>        path:resolve(__dirname,<span class="hljs-string">'dist'</span>)<br>    &#125;，<br>    <span class="hljs-built_in">module</span>:&#123;<br>        rules:[<br>            &#123;<br>                test:<span class="hljs-regexp">/\.css$/</span>,<br>                use:[<span class="hljs-string">'style-loader'</span>,<span class="hljs-string">'css-loader'</span>,<span class="hljs-string">'postcss-loader'</span>]<br>            &#125;,<br>        ]<br>    &#125;,<br>    plugins:[ htmlPlugin ],<br>    mode：<span class="hljs-string">'development'</span>,<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="C-根目录创建并配置postcss-config-js文件"><a href="#C-根目录创建并配置postcss-config-js文件" class="headerlink" title="C.根目录创建并配置postcss.config.js文件"></a>C.根目录创建并配置postcss.config.js文件</h3><p>postcss.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">const</span> autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"autoprefixer"</span>);<br>    <span class="hljs-built_in"><code class="language-hljs js"><span class="hljs-keyword">const</span> autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"autoprefixer"</span>);<br>    <span class="hljs-built_in">module</span>.exports = &#123;<br>        plugins:[ autoprefixer ]<br>    &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="D-运行打包后的html-1"><a href="#D-运行打包后的html-1" class="headerlink" title="D.运行打包后的html"></a>D.运行打包后的html</h3><ul><li><code>npm run dev</code></li></ul><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104749506&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;webpack–打包基础&lt;/a&gt;&lt;/p&gt;
&lt;h1 id
      
    
    </summary>
    
    
      <category term="webpack" scheme="http://lewis.qi.tk/categories/webpack/"/>
    
    
      <category term="webpack" scheme="http://lewis.qi.tk/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>cookie和session</title>
    <link href="http://lewis.qi.tk/2020/05/16/cookie%E5%92%8Csession/"/>
    <id>http://lewis.qi.tk/2020/05/16/cookie%E5%92%8Csession/</id>
    <published>2020-05-16T11:35:48.000Z</published>
    <updated>2020-05-16T11:53:16.380Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105281449" target="_blank" rel="noopener">cookie和session</a></p><h2 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h2><ul><li><p><code>cookie</code>是存储在客户端中，供$\color{red}服务器端$存储数据</p><ul><li>cookie中的数据以<strong>域名</strong>形式存储数据</li><li>cookie中的数据<strong>有过期时间</strong>,不设置的话，会在关闭浏览器时删除，在下次打开浏览器时服务器端会继续发送</li><li>cookie中的数据会随请求<strong>自动发送到服务器端</strong></li></ul></li><li><p>在网站中 <code>F12</code> 找到 </p><ul><li>方式一：<code>Application</code> 在 <code>Storge</code> 下的 <code>Cookies</code></li><li>方式二：<code>Network</code> 在当前主网站名中点击，找到 <code>Request Headers</code> 下的 <code>Cookie</code>(字符串形式)</li></ul></li><li><p><code>session</code>是对象，存储在服务器端的内存中</p><ul><li>session对象中可以存储多条数据</li><li>每一条数据都有一个 <code>sessionId</code> 做唯一标识</li></ul></li></ul><p>过程【重点】</p><ul><li>第一次访问  </li></ul><p>1.客户端将请求数据（用户名、密码）传递给服务器端<br>2.服务器端接收到请求参数，并<strong>验证请求参数</strong>成功后<br>3.服务器端使用 session，为该用户生成唯一的 sessionId ，在session对象中存储用户信息<br>4.服务器端将sessionId写入客户端的cookie，发送给客户端  </p><ul><li>以后访问  </li></ul><p>5.客户端下次访问浏览器时，cookie会自动发送给服务器端<br>6.服务器端拿到cookie中存储的sessionId，然后在服务器端存储的session对象中验证当前的sessionId<br>7.验证成功后，服务器端响应数据</p><h2 id="node-的-express-session模块"><a href="#node-的-express-session模块" class="headerlink" title="node 的 express-session模块"></a>node 的 express-session模块</h2><ul><li>在 <code>app.js</code> 中导入express-session模块,并配置session</li><li>用中间件 <code>app.use（）</code> 处理先拦截请求，再交给session处理<ul><li>session() 生成session对象</li><li><strong>secret参数</strong>：存储秘钥，对数据加密</li></ul></li></ul><p>app.js</p><pre class="line-numbers language-js"><span class="comment"><code class="language-js"><span class="comment">// 导入express-session模块</span><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'express-session'</span>);<span class="comment">// 配置session</span>app.use(session({  secret: <span class="string">'secret key'</span>,  saveUninitialized: <span class="literal">false</span>,  cookie: {    maxAge: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>  }}));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105281449&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cookie和session&lt;/a&gt;&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
    
      <category term="cookies、session" scheme="http://lewis.qi.tk/categories/cookies%E3%80%81session/"/>
    
    
      <category term="cookies" scheme="http://lewis.qi.tk/tags/cookies/"/>
    
      <category term="session" scheme="http://lewis.qi.tk/tags/session/"/>
    
  </entry>
  
  <entry>
    <title>sequelize、moudle简单使用</title>
    <link href="http://lewis.qi.tk/2020/05/16/sequelize%E3%80%81moudle%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>http://lewis.qi.tk/2020/05/16/sequelize%E3%80%81moudle%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2020-05-16T11:34:59.000Z</published>
    <updated>2020-05-16T11:48:50.877Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104836214" target="_blank" rel="noopener">sequelize、moudle简单使用</a></p><h1 id="MySQL-Node-js驱动程序"><a href="#MySQL-Node-js驱动程序" class="headerlink" title="MySQL Node.js驱动程序"></a>MySQL Node.js驱动程序</h1><h2 id="1-Node-js程序访问MySQL数据库"><a href="#1-Node-js程序访问MySQL数据库" class="headerlink" title="1.Node.js程序访问MySQL数据库"></a>1.Node.js程序访问MySQL数据库</h2><p>添加依赖包：<br>1.<strong>npm i mysql2</strong><br>2.<strong>npm i sequelize</strong>  </p><p>ORM、ODM区别：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript">ODM对象数据模型、ORM对象关系模型<br>ODM / ORM 能将网站中的数据表示为 JavaScript 对象，然后将它们映射到底层数据库<br><span class="hljs-number">1.</span>ODM 通常慢一些，因为在对象和数据库格式之间存在一层用于映射的翻译代码<br><span class="hljs-number"><code class="language-hljs angelscript">ODM对象数据模型、ORM对象关系模型<br>ODM / ORM 能将网站中的数据表示为 JavaScript 对象，然后将它们映射到底层数据库<br><span class="hljs-number">1.</span>ODM 通常慢一些，因为在对象和数据库格式之间存在一层用于映射的翻译代码<br><span class="hljs-number">2.</span>ORM 可以继续用 JavaScript 对象的思维而不用转向数据库语义的思维。 在（同一个或不同网站）使用不同数据库时尤为明显<br><br>Sequelize是一款基于Nodejs功能强大的异步ORM框架<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs asciidoc">mysql&gt; select * from pets;<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>| id | name   | birth      |<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>|  1 | Gaffey | 2007-07-07 |<br>|  2 | Odie   | 2008-08-08 |<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>2 rows in set (0.00 sec)<br><br>每一行可以用一个JavaScript对象<br>第一行：JSON表示<br>&#123;<br><span class="hljs-code">    "id": 1,</span><br><span class="hljs-code">    "name": "Gaffey",</span><br><span class="hljs-code">    "birth": "2007-07-07"</span><br>&#125;<br><br>用Sequelize查询pets表：(复杂)<br>Pet.findAll()<br><span class="hljs-code">   .then(function (pets) &#123;</span><br><span class="hljs-code">       for (let pet in pets) &#123;</span><br><span class="hljs-code">           console.log(`$&#123;pet.id&#125;: $&#123;pet.name&#125;`);</span><br><span class="hljs-code">       &#125;</span><br><span class="hljs-code">   &#125;)</span><br><span class="hljs-code">   .catch(function (err) &#123;</span><br><span class="hljs-code">       // error</span><br><span class="hljs-code"><code class="language-hljs asciidoc">mysql&gt; select * from pets;<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>| id | name   | birth      |<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>|  1 | Gaffey | 2007-07-07 |<br>|  2 | Odie   | 2008-08-08 |<br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br>2 rows in set (0.00 sec)<br><br>每一行可以用一个JavaScript对象<br>第一行：JSON表示<br>&#123;<br><span class="hljs-code">    "id": 1,</span><br><span class="hljs-code">    "name": "Gaffey",</span><br><span class="hljs-code">    "birth": "2007-07-07"</span><br>&#125;<br><br>用Sequelize查询pets表：(复杂)<br>Pet.findAll()<br><span class="hljs-code">   .then(function (pets) &#123;</span><br><span class="hljs-code">       for (let pet in pets) &#123;</span><br><span class="hljs-code">           console.log(`$&#123;pet.id&#125;: $&#123;pet.name&#125;`);</span><br><span class="hljs-code">       &#125;</span><br><span class="hljs-code">   &#125;)</span><br><span class="hljs-code">   .catch(function (err) &#123;</span><br><span class="hljs-code">       // error</span><br><span class="hljs-code">   &#125;);</span><br><br>注：<br>then()和catch()分别异步响应成功和失败<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>在koa的async异步函数中直接写await访问数据库<br>ES7的await来调用任何一个Promise对象：（简单）</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs clojure">(<span class="hljs-name">async</span> () =&gt; &#123;<br>    var pets = await Pet.findAll()<span class="hljs-comment">;</span><br>&#125;)()<span class="hljs-comment"><code class="language-hljs clojure">(<span class="hljs-name">async</span> () =&gt; &#123;<br>    var pets = await Pet.findAll()<span class="hljs-comment">;</span><br>&#125;)()<span class="hljs-comment">;</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>实例：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs 1c">hnode-MySQL/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- init.txt             &lt;-- 初始化SQL命令<br><span class="hljs-string">|</span><br>+- config.js            &lt;-- MySQL配置文件<br><span class="hljs-string"><code class="language-hljs 1c">hnode-MySQL/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- init.txt             &lt;-- 初始化SQL命令<br><span class="hljs-string">|</span><br>+- config.js            &lt;-- MySQL配置文件<br><span class="hljs-string">|</span><br>+- app.js               <-- 使用koa的js<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>config.js </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">//数据库连接配置文件</span><br><span class="hljs-keyword">var</span> config = &#123;<br>    database: <span class="hljs-string">'node_test'</span>,<br>    username: <span class="hljs-string">'root'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string">'localhost'</span>,<br>    port: <span class="hljs-number">3307</span><br>&#125;;<br><br><span class="hljs-comment">//暴露接口</span><br><span class="hljs-keyword">module</span>.<span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-comment">//数据库连接配置文件</span><br><span class="hljs-keyword">var</span> config = &#123;<br>    database: <span class="hljs-string">'node_test'</span>,<br>    username: <span class="hljs-string">'root'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string">'localhost'</span>,<br>    port: <span class="hljs-number">3307</span><br>&#125;;<br><br><span class="hljs-comment">//暴露接口</span><br><span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = config;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>app.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><br><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);<br><br><span class="hljs-comment">//config.js的自定义依赖包</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'init sequelize...'</span>);<br><br><span class="hljs-comment">//创建一个sequelize对象实例：</span><br><span class="hljs-comment">//单个进程连接到数据库，则应仅创建一个Sequelize实例</span><br><span class="hljs-keyword">var</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(config.database, config.username, config.password, &#123;<br>    host: config.host,<br>    <span class="hljs-comment">//连接数据库语言</span><br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    pool: &#123;<br>        <span class="hljs-comment">//连接池中的最大、小连接数</span><br>        max: <span class="hljs-number">5</span>,<br>        min: <span class="hljs-number">0</span>,<br>        <span class="hljs-comment">//连接释放之前可以空闲的最长时间（以毫秒为单位）</span><br>        idle: <span class="hljs-number">30000</span><br>    &#125;<br>&#125;);<br><span class="hljs-comment">//测试连接是否正常</span><br>sequelize<br>  .authenticate()<br>  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connection has been established successfully.'</span>);<br>  &#125;)<br>  .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Unable to connect to the database:'</span>, err);<br>  &#125;);<br><br>  <br><span class="hljs-comment">//Model模型Pet，告诉Sequelize如何映射数据库表</span><br><span class="hljs-comment">//第一个参数传入默认的表名pets</span><br><span class="hljs-comment">//第二个参数指定(列名:数据类型)，如果是主键，指定true</span><br><span class="hljs-comment">//第三个参数是额外的配置，传入&#123; timestamps: false &#125;</span><br><span class="hljs-comment">//是为了关闭Sequelize的自动添加timestamp的功能。</span><br><br><span class="hljs-comment">//sequelize 连接表的时候，会默认给你传进去的表名加上s, </span><br><span class="hljs-comment">//所以需要手动配置参数 freezeTableName: true</span><br><span class="hljs-keyword">var</span> Pet = sequelize.define(<span class="hljs-string">'pets'</span>, <br>    &#123;<br>    id: &#123;<span class="hljs-attr">type</span>: Sequelize.STRING(<span class="hljs-number">50</span>),<span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>&#125;,<br>    name: Sequelize.STRING(<span class="hljs-number">100</span>),<br>    gender: Sequelize.BOOLEAN,<br>    birth: Sequelize.STRING(<span class="hljs-number">10</span>),<br>    createdAt: Sequelize.BIGINT,<br>    updatedAt: Sequelize.BIGINT,<br>    version: Sequelize.BIGINT<br>    &#125;, <br>    &#123;<br>        timestamps: <span class="hljs-literal">false</span><br>    &#125;);<br><br><span class="hljs-comment">//日期对象</span><br><span class="hljs-keyword">var</span> now = <span class="hljs-built_in">Date</span>.now();<br><br><span class="hljs-comment">//往数据库添加数据（Promise方式）</span><br><span class="hljs-comment">//then()和catch()分别异步响应成功和失败</span><br>Pet.create(&#123;<br>    id: <span class="hljs-string">'g-'</span> + now,<br>    name: <span class="hljs-string">'cat'</span>,<br>    gender: <span class="hljs-literal">false</span>,<br>    birth: <span class="hljs-string">'2020-01-01'</span>,<br>    createdAt: now,<br>    updatedAt: now,<br>    version: <span class="hljs-number">0</span><br>&#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'created.'</span> + <span class="hljs-built_in">JSON</span>.stringify(p));<br>&#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'failed: '</span> + err);<br>&#125;);<br><br><span class="hljs-comment">//往数据库添加数据(await方式)</span><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">var</span> dog = <span class="hljs-keyword">await</span> Pet.create(&#123;<br>        id: <span class="hljs-string">'d-'</span> + now,<br>        name: <span class="hljs-string">'dog'</span>,<br>        gender: <span class="hljs-literal">false</span>,<br>        birth: <span class="hljs-string">'2020-01-02'</span>,<br>        createdAt: now,<br>        updatedAt: now,<br>        version: <span class="hljs-number">0</span><br>    &#125;);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'created: '</span> + <span class="hljs-built_in">JSON</span>.stringify(dog));<br>&#125;)();<br><br><span class="hljs-comment">//查询数据</span><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">var</span> pets = <span class="hljs-keyword">await</span> Pet.findAll(&#123;<br>        where: &#123;<br>            name: <span class="hljs-string">'dog'</span><br>        &#125;<br>    &#125;);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`find <span class="hljs-subst">$&#123;pets.length&#125;</span> pets:`</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> p <span class="hljs-keyword">of</span> pets) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(p));<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'update pet...'</span>);<br>        <span class="hljs-comment">//更新数据</span><br>        p.gender = <span class="hljs-literal">true</span>;<br>        p.updatedAt = <span class="hljs-built_in">Date</span>.now();<br>        p.version ++;<br>        <span class="hljs-keyword">await</span> p.save();<br>        <span class="hljs-comment">//删除数据</span><br>        <span class="hljs-keyword">if</span> (p.version === <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">await</span> p.destroy();<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;p.name&#125;</span> was destroyed.`</span>);<br>        &#125;<br>    &#125;<br>&#125;)();<br><br><br><span class="hljs-comment">// 单独更新数据，await p.save();保存</span><br><span class="hljs-comment">// (async () =&gt; &#123;</span><br><span class="hljs-comment">//     var p = await queryFromSomewhere();</span><br><span class="hljs-comment">//     p.gender = true;</span><br><span class="hljs-comment">//     p.updatedAt = Date.now();</span><br><span class="hljs-comment">//     p.version ++;</span><br><span class="hljs-comment">//     await p.save();</span><br><span class="hljs-comment">// &#125;)();</span><br><br><br><br><span class="hljs-comment">// 单独删除数据，await p.destroy();销毁</span><br><span class="hljs-comment">// (async () =&gt; &#123;</span><br><span class="hljs-comment">//     var p = await queryFromSomewhere();</span><br><span class="hljs-comment">//     await p.destroy();</span><br><span class="hljs-comment"><code class="language-hljs javascript"><br><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);<br><br><span class="hljs-comment">//config.js的自定义依赖包</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'init sequelize...'</span>);<br><br><span class="hljs-comment">//创建一个sequelize对象实例：</span><br><span class="hljs-comment">//单个进程连接到数据库，则应仅创建一个Sequelize实例</span><br><span class="hljs-keyword">var</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(config.database, config.username, config.password, &#123;<br>    host: config.host,<br>    <span class="hljs-comment">//连接数据库语言</span><br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    pool: &#123;<br>        <span class="hljs-comment">//连接池中的最大、小连接数</span><br>        max: <span class="hljs-number">5</span>,<br>        min: <span class="hljs-number">0</span>,<br>        <span class="hljs-comment">//连接释放之前可以空闲的最长时间（以毫秒为单位）</span><br>        idle: <span class="hljs-number">30000</span><br>    &#125;<br>&#125;);<br><span class="hljs-comment">//测试连接是否正常</span><br>sequelize<br>  .authenticate()<br>  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connection has been established successfully.'</span>);<br>  &#125;)<br>  .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Unable to connect to the database:'</span>, err);<br>  &#125;);<br><br>  <br><span class="hljs-comment">//Model模型Pet，告诉Sequelize如何映射数据库表</span><br><span class="hljs-comment">//第一个参数传入默认的表名pets</span><br><span class="hljs-comment">//第二个参数指定(列名:数据类型)，如果是主键，指定true</span><br><span class="hljs-comment">//第三个参数是额外的配置，传入&#123; timestamps: false &#125;</span><br><span class="hljs-comment">//是为了关闭Sequelize的自动添加timestamp的功能。</span><br><br><span class="hljs-comment">//sequelize 连接表的时候，会默认给你传进去的表名加上s, </span><br><span class="hljs-comment">//所以需要手动配置参数 freezeTableName: true</span><br><span class="hljs-keyword">var</span> Pet = sequelize.define(<span class="hljs-string">'pets'</span>, <br>    &#123;<br>    id: &#123;<span class="hljs-attr">type</span>: Sequelize.STRING(<span class="hljs-number">50</span>),<span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>&#125;,<br>    name: Sequelize.STRING(<span class="hljs-number">100</span>),<br>    gender: Sequelize.BOOLEAN,<br>    birth: Sequelize.STRING(<span class="hljs-number">10</span>),<br>    createdAt: Sequelize.BIGINT,<br>    updatedAt: Sequelize.BIGINT,<br>    version: Sequelize.BIGINT<br>    &#125;, <br>    &#123;<br>        timestamps: <span class="hljs-literal">false</span><br>    &#125;);<br><br><span class="hljs-comment">//日期对象</span><br><span class="hljs-keyword">var</span> now = <span class="hljs-built_in">Date</span>.now();<br><br><span class="hljs-comment">//往数据库添加数据（Promise方式）</span><br><span class="hljs-comment">//then()和catch()分别异步响应成功和失败</span><br>Pet.create(&#123;<br>    id: <span class="hljs-string">'g-'</span> + now,<br>    name: <span class="hljs-string">'cat'</span>,<br>    gender: <span class="hljs-literal">false</span>,<br>    birth: <span class="hljs-string">'2020-01-01'</span>,<br>    createdAt: now,<br>    updatedAt: now,<br>    version: <span class="hljs-number">0</span><br>&#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'created.'</span> + <span class="hljs-built_in">JSON</span>.stringify(p));<br>&#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'failed: '</span> + err);<br>&#125;);<br><br><span class="hljs-comment">//往数据库添加数据(await方式)</span><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">var</span> dog = <span class="hljs-keyword">await</span> Pet.create(&#123;<br>        id: <span class="hljs-string">'d-'</span> + now,<br>        name: <span class="hljs-string">'dog'</span>,<br>        gender: <span class="hljs-literal">false</span>,<br>        birth: <span class="hljs-string">'2020-01-02'</span>,<br>        createdAt: now,<br>        updatedAt: now,<br>        version: <span class="hljs-number">0</span><br>    &#125;);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'created: '</span> + <span class="hljs-built_in">JSON</span>.stringify(dog));<br>&#125;)();<br><br><span class="hljs-comment">//查询数据</span><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">var</span> pets = <span class="hljs-keyword">await</span> Pet.findAll(&#123;<br>        where: &#123;<br>            name: <span class="hljs-string">'dog'</span><br>        &#125;<br>    &#125;);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`find <span class="hljs-subst">$&#123;pets.length&#125;</span> pets:`</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> p <span class="hljs-keyword">of</span> pets) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(p));<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'update pet...'</span>);<br>        <span class="hljs-comment">//更新数据</span><br>        p.gender = <span class="hljs-literal">true</span>;<br>        p.updatedAt = <span class="hljs-built_in">Date</span>.now();<br>        p.version ++;<br>        <span class="hljs-keyword">await</span> p.save();<br>        <span class="hljs-comment">//删除数据</span><br>        <span class="hljs-keyword">if</span> (p.version === <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">await</span> p.destroy();<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;p.name&#125;</span> was destroyed.`</span>);<br>        &#125;<br>    &#125;<br>&#125;)();<br><br><br><span class="hljs-comment">// 单独更新数据，await p.save();保存</span><br><span class="hljs-comment">// (async () =&gt; &#123;</span><br><span class="hljs-comment">//     var p = await queryFromSomewhere();</span><br><span class="hljs-comment">//     p.gender = true;</span><br><span class="hljs-comment">//     p.updatedAt = Date.now();</span><br><span class="hljs-comment">//     p.version ++;</span><br><span class="hljs-comment">//     await p.save();</span><br><span class="hljs-comment">// &#125;)();</span><br><br><br><br><span class="hljs-comment">// 单独删除数据，await p.destroy();销毁</span><br><span class="hljs-comment">// (async () =&gt; &#123;</span><br><span class="hljs-comment">//     var p = await queryFromSomewhere();</span><br><span class="hljs-comment">//     await p.destroy();</span><br><span class="hljs-comment">// &#125;)();</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="2-使用module"><a href="#2-使用module" class="headerlink" title="2.使用module"></a>2.使用module</h2><p>一个大型Web App通常都有几十个映射表，一个映射表就是一个Model。<br>Model存放的文件夹必须在models</p><p>每个Model必须遵守一套规范</p><p>1.统一主键，名称必须是id，类型必须是STRING(50)；<br>2.所有字段默认为NOT NULL，除非显式指定；<br>3.统一timestamp机制，每个Model必须有<strong>createdAt、updatedAt和version</strong>，分别记录<strong>创建时间、修改时间和版本号</strong>。  </p><ul><li>createdAt和updatedAt以BIGINT存储时间戳，<strong>无需处理时区</strong>。</li><li>version每次修改时自增。</li></ul><p>目录：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs 1c">model-sequelize/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- models/              &lt;-- 存放所有Model<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- Pet.js            &lt;-- Pet</span><br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- User.js           &lt;-- User</span><br><span class="hljs-string">|</span><br>+- config.js            &lt;-- 配置文件入口<br><span class="hljs-string">|</span><br>+- config-default.js    &lt;-- 默认配置文件<br><span class="hljs-string">|</span><br>+- config-test.js       &lt;-- 测试配置文件<br><span class="hljs-string">|</span><br>+- db.js                &lt;-- 定义Model<br><span class="hljs-string">|</span><br>+- model.js             &lt;-- 导入Model<br><span class="hljs-string">|</span><br>+- init-db.js           &lt;-- 初始化数据库<br><span class="hljs-string"><code class="language-hljs 1c">model-sequelize/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- models/              &lt;-- 存放所有Model<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- Pet.js            &lt;-- Pet</span><br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- User.js           &lt;-- User</span><br><span class="hljs-string">|</span><br>+- config.js            &lt;-- 配置文件入口<br><span class="hljs-string">|</span><br>+- config-default.js    &lt;-- 默认配置文件<br><span class="hljs-string">|</span><br>+- config-test.js       &lt;-- 测试配置文件<br><span class="hljs-string">|</span><br>+- db.js                &lt;-- 定义Model<br><span class="hljs-string">|</span><br>+- model.js             &lt;-- 导入Model<br><span class="hljs-string">|</span><br>+- init-db.js           &lt;-- 初始化数据库<br><span class="hljs-string">|</span><br>+- app.js               <-- 业务代码<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：<br>1.<strong>npm i fs</strong><br>2.<strong>npm i sequelize</strong><br>3.<strong>npm i node-uuid</strong>(db.js中定义model使用)<br>4.<strong>npm i mysql2</strong></p><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>实现不同环境读取不同的配置文件</p><ul><li>先读取config-default.js；</li><li>如果不是测试环境，就读取config-override.js，如果文件不存在，就忽略。</li><li>如果是测试环境，就读取config-test.js</li></ul><p>1.开发环境下，团队统一使用默认的配置config-default.js；<br>2.生产环境下，部署到服务器时，配置好config-override.js；<br>3.测试环境下，统一使用config-test.js，测试数据库可以反复清空，不会影响开发。  </p><p>config-default.js(第一步，$\color{red}连接数据库$)<br>1.开发环境下默认的配置</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    database: <span class="hljs-string">'default'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string"><code class="language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    database: <span class="hljs-string">'default'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string">'localhost'</span>,<br>    port: 3307<br>&#125;;<br>module.exports = config;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>config-override.js（第二步，$\color{red}连接数据库$）<br>2.生产环境下，部署到服务器配置</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    database: <span class="hljs-string">'override'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string"><code class="language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    database: <span class="hljs-string">'override'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string">'192.168.1.199'</span>,<br>    port: 3307<br>&#125;;<br>module.exports = config;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>config-test.js（第三步，$\color{red}连接数据库$）<br>3.应用测试环境的配置：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    database: <span class="hljs-string">'nodetest'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string"><code class="language-hljs routeros">var<span class="hljs-built_in"> config </span>= &#123;<br>    dialect: <span class="hljs-string">'mysql'</span>,<br>    database: <span class="hljs-string">'nodetest'</span>,<br>    username: <span class="hljs-string">'Lewis'</span>,<br>    password: <span class="hljs-string">'123456'</span>,<br>    host: <span class="hljs-string">'localhost'</span>,<br>    port: 3307<br>&#125;;<br>module.exports = config;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>config.js（判断环境）<br>实现不同环境读取不同的配置文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">// 配置文件导入集合</span><br><span class="hljs-keyword">const</span> defaultConfig = <span class="hljs-string">'./config-default.js'</span>;<br><span class="hljs-keyword">const</span> overrideConfig = <span class="hljs-string">'./config-override.js'</span>;<br><span class="hljs-keyword">const</span> testConfig = <span class="hljs-string">'./config-test.js'</span>;<br><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> config = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span> (process.env.NODE_ENV === <span class="hljs-string">'test'</span>) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;testConfig&#125;</span>...`</span>);<br>    config = <span class="hljs-built_in">require</span>(testConfig);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;defaultConfig&#125;</span>...`</span>);<br>    config = <span class="hljs-built_in">require</span>(defaultConfig);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (fs.statSync(overrideConfig).isFile()) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;overrideConfig&#125;</span>...`</span>);<br>            config = <span class="hljs-built_in">Object</span>.assign(config, <span class="hljs-built_in">require</span>(overrideConfig));<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Cannot load <span class="hljs-subst">$&#123;overrideConfig&#125;</span>.`</span>);<br>    &#125;<br>&#125;<br><span class="hljs-built_in"><code class="language-hljs javascript"><span class="hljs-comment">// 配置文件导入集合</span><br><span class="hljs-keyword">const</span> defaultConfig = <span class="hljs-string">'./config-default.js'</span>;<br><span class="hljs-keyword">const</span> overrideConfig = <span class="hljs-string">'./config-override.js'</span>;<br><span class="hljs-keyword">const</span> testConfig = <span class="hljs-string">'./config-test.js'</span>;<br><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> config = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span> (process.env.NODE_ENV === <span class="hljs-string">'test'</span>) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;testConfig&#125;</span>...`</span>);<br>    config = <span class="hljs-built_in">require</span>(testConfig);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;defaultConfig&#125;</span>...`</span>);<br>    config = <span class="hljs-built_in">require</span>(defaultConfig);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (fs.statSync(overrideConfig).isFile()) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Load <span class="hljs-subst">$&#123;overrideConfig&#125;</span>...`</span>);<br>            config = <span class="hljs-built_in">Object</span>.assign(config, <span class="hljs-built_in">require</span>(overrideConfig));<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Cannot load <span class="hljs-subst">$&#123;overrideConfig&#125;</span>.`</span>);<br>    &#125;<br>&#125;<br><span class="hljs-built_in">module</span>.exports = config;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="第二步（定义Model、写Model、判断环境使用Model）"><a href="#第二步（定义Model、写Model、判断环境使用Model）" class="headerlink" title="第二步（定义Model、写Model、判断环境使用Model）"></a>第二步（定义Model、写Model、判断环境使用Model）</h3><p>db.js(定义Model，数据库连接池)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs typescript"><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);<br><span class="hljs-keyword">const</span> uuid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-uuid'</span>);<br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'init sequelize...'</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateId</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> uuid.v4();<br>&#125;<br><br><span class="hljs-keyword">var</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(config.database, config.username, config.password, &#123;<br>    host: config.host,<br>    dialect: config.dialect,<br>    pool: &#123;<br>        max: <span class="hljs-number">5</span>,<br>        min: <span class="hljs-number">0</span>,<br>        idle: <span class="hljs-number">10000</span><br>    &#125;<br>&#125;);<br><br><span class="hljs-keyword">const</span> ID_TYPE = Sequelize.STRING(<span class="hljs-number">50</span>);<br><br><span class="hljs-comment">//defineModel强制实现上述规则</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defineModel</span>(<span class="hljs-params">name, attributes</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> attrs = &#123;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> attributes) &#123;<br>        <span class="hljs-keyword">let</span> value = attributes[key];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value[<span class="hljs-string">'type'</span>]) &#123;<br>            value.allowNull = value.allowNull || <span class="hljs-literal">false</span>;<br>            attrs[key] = value;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            attrs[key] = &#123;<br>                <span class="hljs-keyword">type</span>: value,<br>                allowNull: <span class="hljs-literal">false</span><br>            &#125;;<br>        &#125;<br>    &#125;<br>    attrs.id = &#123;<br>        <span class="hljs-keyword">type</span>: ID_TYPE,<br>        primaryKey: <span class="hljs-literal">true</span><br>    &#125;;<br>    attrs.createdAt = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    attrs.updatedAt = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    attrs.version = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'model defined for table: '</span> + name + <span class="hljs-string">'\n'</span> + <span class="hljs-built_in">JSON</span>.stringify(attrs, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">k, v</span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (k === <span class="hljs-string">'type'</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> Sequelize) &#123;<br>                <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'ABSTRACT'</span> || key === <span class="hljs-string">'NUMBER'</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">let</span> dbType = Sequelize[key];<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> dbType === <span class="hljs-string">'function'</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (v <span class="hljs-keyword">instanceof</span> dbType) &#123;<br>                        <span class="hljs-keyword">if</span> (v._length) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;dbType.key&#125;</span>(<span class="hljs-subst">$&#123;v._length&#125;</span>)`</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">return</span> dbType.key;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (v === dbType) &#123;<br>                        <span class="hljs-keyword">return</span> dbType.key;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> v;<br>    &#125;, <span class="hljs-string">'  '</span>));<br>    <span class="hljs-keyword">return</span> sequelize.define(name, attrs, &#123;<br>        tableName: name,<br>        timestamps: <span class="hljs-literal">false</span>,<br>        hooks: &#123;<br>            beforeValidate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>&#123;<br>                <span class="hljs-keyword">let</span> now = <span class="hljs-built_in">Date</span>.now();<br>                <span class="hljs-keyword">if</span> (obj.isNewRecord) &#123;<br>                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'will create entity...'</span> + obj);<br>                    <span class="hljs-keyword">if</span> (!obj.id) &#123;<br>                        obj.id = generateId();<br>                    &#125;<br>                    obj.createdAt = now;<br>                    obj.updatedAt = now;<br>                    obj.version = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'will update entity...'</span>);<br>                    obj.updatedAt = now;<br>                    obj.version++;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> TYPES = [<span class="hljs-string">'STRING'</span>, <span class="hljs-string">'INTEGER'</span>, <span class="hljs-string">'BIGINT'</span>, <span class="hljs-string">'TEXT'</span>, <span class="hljs-string">'DOUBLE'</span>, <span class="hljs-string">'DATEONLY'</span>, <span class="hljs-string">'BOOLEAN'</span>];<br><br><span class="hljs-keyword">var</span> exp = &#123;<br>    defineModel: defineModel,<br>    sync: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-comment">// only allow create ddl in non-production environment:</span><br>        <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span>) &#123;<br>            sequelize.sync(&#123; force: <span class="hljs-literal">true</span> &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Cannot sync() when NODE_ENV is set to \'production\'.'</span>);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">type</span> of TYPES) &#123;<br>    exp[<span class="hljs-keyword">type</span>] = Sequelize[<span class="hljs-keyword">type</span>];<br>&#125;<br><br>exp.ID = ID_TYPE;<br>exp.generateId = generateId;<br><br><span class="hljs-built_in"><code class="language-hljs typescript"><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);<br><span class="hljs-keyword">const</span> uuid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-uuid'</span>);<br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'init sequelize...'</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateId</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> uuid.v4();<br>&#125;<br><br><span class="hljs-keyword">var</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(config.database, config.username, config.password, &#123;<br>    host: config.host,<br>    dialect: config.dialect,<br>    pool: &#123;<br>        max: <span class="hljs-number">5</span>,<br>        min: <span class="hljs-number">0</span>,<br>        idle: <span class="hljs-number">10000</span><br>    &#125;<br>&#125;);<br><br><span class="hljs-keyword">const</span> ID_TYPE = Sequelize.STRING(<span class="hljs-number">50</span>);<br><br><span class="hljs-comment">//defineModel强制实现上述规则</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defineModel</span>(<span class="hljs-params">name, attributes</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> attrs = &#123;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> attributes) &#123;<br>        <span class="hljs-keyword">let</span> value = attributes[key];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value[<span class="hljs-string">'type'</span>]) &#123;<br>            value.allowNull = value.allowNull || <span class="hljs-literal">false</span>;<br>            attrs[key] = value;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            attrs[key] = &#123;<br>                <span class="hljs-keyword">type</span>: value,<br>                allowNull: <span class="hljs-literal">false</span><br>            &#125;;<br>        &#125;<br>    &#125;<br>    attrs.id = &#123;<br>        <span class="hljs-keyword">type</span>: ID_TYPE,<br>        primaryKey: <span class="hljs-literal">true</span><br>    &#125;;<br>    attrs.createdAt = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    attrs.updatedAt = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    attrs.version = &#123;<br>        <span class="hljs-keyword">type</span>: Sequelize.BIGINT,<br>        allowNull: <span class="hljs-literal">false</span><br>    &#125;;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'model defined for table: '</span> + name + <span class="hljs-string">'\n'</span> + <span class="hljs-built_in">JSON</span>.stringify(attrs, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">k, v</span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (k === <span class="hljs-string">'type'</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> Sequelize) &#123;<br>                <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'ABSTRACT'</span> || key === <span class="hljs-string">'NUMBER'</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">let</span> dbType = Sequelize[key];<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> dbType === <span class="hljs-string">'function'</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (v <span class="hljs-keyword">instanceof</span> dbType) &#123;<br>                        <span class="hljs-keyword">if</span> (v._length) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;dbType.key&#125;</span>(<span class="hljs-subst">$&#123;v._length&#125;</span>)`</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">return</span> dbType.key;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (v === dbType) &#123;<br>                        <span class="hljs-keyword">return</span> dbType.key;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> v;<br>    &#125;, <span class="hljs-string">'  '</span>));<br>    <span class="hljs-keyword">return</span> sequelize.define(name, attrs, &#123;<br>        tableName: name,<br>        timestamps: <span class="hljs-literal">false</span>,<br>        hooks: &#123;<br>            beforeValidate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>&#123;<br>                <span class="hljs-keyword">let</span> now = <span class="hljs-built_in">Date</span>.now();<br>                <span class="hljs-keyword">if</span> (obj.isNewRecord) &#123;<br>                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'will create entity...'</span> + obj);<br>                    <span class="hljs-keyword">if</span> (!obj.id) &#123;<br>                        obj.id = generateId();<br>                    &#125;<br>                    obj.createdAt = now;<br>                    obj.updatedAt = now;<br>                    obj.version = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'will update entity...'</span>);<br>                    obj.updatedAt = now;<br>                    obj.version++;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> TYPES = [<span class="hljs-string">'STRING'</span>, <span class="hljs-string">'INTEGER'</span>, <span class="hljs-string">'BIGINT'</span>, <span class="hljs-string">'TEXT'</span>, <span class="hljs-string">'DOUBLE'</span>, <span class="hljs-string">'DATEONLY'</span>, <span class="hljs-string">'BOOLEAN'</span>];<br><br><span class="hljs-keyword">var</span> exp = &#123;<br>    defineModel: defineModel,<br>    sync: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-comment">// only allow create ddl in non-production environment:</span><br>        <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span>) &#123;<br>            sequelize.sync(&#123; force: <span class="hljs-literal">true</span> &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Cannot sync() when NODE_ENV is set to \'production\'.'</span>);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">type</span> of TYPES) &#123;<br>    exp[<span class="hljs-keyword">type</span>] = Sequelize[<span class="hljs-keyword">type</span>];<br>&#125;<br><br>exp.ID = ID_TYPE;<br>exp.generateId = generateId;<br><br><span class="hljs-built_in">module</span>.exports = exp;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>models/Pet.js（Model文件1,创建数据表结构，$\color{red}表名必须多一个s$）</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs stata"><span class="hljs-comment">//导入上一层文件夹中的db.js的定义Model文件</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">db</span> = require('../<span class="hljs-keyword">db</span>');<br><br>module.exports = <span class="hljs-keyword">db</span>.defineModel('pets', &#123;<br>    ownerId: <span class="hljs-keyword">db</span>.ID,<br>    name: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    gender: <span class="hljs-keyword">db</span>.BOOLEAN,<br>    birth: <span class="hljs-keyword">db</span>.<span class="hljs-built_in"><code class="language-hljs stata"><span class="hljs-comment">//导入上一层文件夹中的db.js的定义Model文件</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">db</span> = require('../<span class="hljs-keyword">db</span>');<br><br>module.exports = <span class="hljs-keyword">db</span>.defineModel('pets', &#123;<br>    ownerId: <span class="hljs-keyword">db</span>.ID,<br>    name: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    gender: <span class="hljs-keyword">db</span>.BOOLEAN,<br>    birth: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(10),<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>models/User.js（Model文件2，创建数据表结构,$\color{red}表名必须多一个s$）</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs stata"><span class="hljs-comment">//导入上一层文件夹中的db.js的定义Model文件</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">db</span> = require('../<span class="hljs-keyword">db</span>');<br><br><span class="hljs-comment">//User具有email、passwd、name和gender这4个业务字段</span><br>module.exports = <span class="hljs-keyword">db</span>.defineModel('users', &#123;<br>    email: &#123;<br>        <span class="hljs-keyword">type</span>: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>        unique: true<br>    &#125;,<br>    passwd: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    name: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    gender: <span class="hljs-keyword"><code class="language-hljs stata"><span class="hljs-comment">//导入上一层文件夹中的db.js的定义Model文件</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">db</span> = require('../<span class="hljs-keyword">db</span>');<br><br><span class="hljs-comment">//User具有email、passwd、name和gender这4个业务字段</span><br>module.exports = <span class="hljs-keyword">db</span>.defineModel('users', &#123;<br>    email: &#123;<br>        <span class="hljs-keyword">type</span>: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>        unique: true<br>    &#125;,<br>    passwd: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    name: <span class="hljs-keyword">db</span>.<span class="hljs-built_in">STRING</span>(100),<br>    gender: <span class="hljs-keyword">db</span>.BOOLEAN<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>model.js（合并，自动扫描并导入所有Model）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-comment">//导入当前文件夹中的db.js</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./db'</span>);<br><br><span class="hljs-keyword">let</span> files = fs.readdirSync(__dirname + <span class="hljs-string">'/models'</span>);<br><br><span class="hljs-keyword">let</span> js_files = files.filter(<span class="hljs-function">(<span class="hljs-params">f</span>)=&gt;</span>&#123;<br>    <span class="hljs-keyword">return</span> f.endsWith(<span class="hljs-string">'.js'</span>);<br>&#125;, files);<br><br><span class="hljs-built_in">module</span>.exports = &#123;&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> f <span class="hljs-keyword">of</span> js_files) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`import model from file <span class="hljs-subst">$&#123;f&#125;</span>...`</span>);<br>    <span class="hljs-keyword">let</span> name = f.substring(<span class="hljs-number">0</span>, f.length - <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">module</span>.exports[name] = <span class="hljs-built_in">require</span>(__dirname + <span class="hljs-string">'/models/'</span> + f);<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports.sync = <span class="hljs-function"><span class="hljs-params"><code class="language-hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-comment">//导入当前文件夹中的db.js</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./db'</span>);<br><br><span class="hljs-keyword">let</span> files = fs.readdirSync(__dirname + <span class="hljs-string">'/models'</span>);<br><br><span class="hljs-keyword">let</span> js_files = files.filter(<span class="hljs-function">(<span class="hljs-params">f</span>)=&gt;</span>&#123;<br>    <span class="hljs-keyword">return</span> f.endsWith(<span class="hljs-string">'.js'</span>);<br>&#125;, files);<br><br><span class="hljs-built_in">module</span>.exports = &#123;&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> f <span class="hljs-keyword">of</span> js_files) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`import model from file <span class="hljs-subst">$&#123;f&#125;</span>...`</span>);<br>    <span class="hljs-keyword">let</span> name = f.substring(<span class="hljs-number">0</span>, f.length - <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">module</span>.exports[name] = <span class="hljs-built_in">require</span>(__dirname + <span class="hljs-string">'/models/'</span> + f);<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports.sync = <span class="hljs-function"><span class="hljs-params">()</span> =></span> &#123;<br>    db.sync();<br>&#125;;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>init-db.js（测试时，用model.sync();方法自动创建出表结构）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs awk">require(<span class="hljs-string">'babel-core/register'</span>)(&#123;<br>    presets: [<span class="hljs-string">'stage-3'</span>]<br>&#125;);<br><span class="hljs-regexp">//</span>导入当前文件夹中的model.js导入所有Modelde<br>const model = require(<span class="hljs-string">'./model.js'</span>);<br><br>model.sync();<br><br>console.log(<span class="hljs-string">'init db ok.'</span>);<br><span class="hljs-regexp">//</span>process.<span class="hljs-keyword">exit</span>(<span class="hljs-number"><code class="language-hljs awk">require(<span class="hljs-string">'babel-core/register'</span>)(&#123;<br>    presets: [<span class="hljs-string">'stage-3'</span>]<br>&#125;);<br><span class="hljs-regexp">//</span>导入当前文件夹中的model.js导入所有Modelde<br>const model = require(<span class="hljs-string">'./model.js'</span>);<br><br>model.sync();<br><br>console.log(<span class="hljs-string">'init db ok.'</span>);<br><span class="hljs-regexp">//</span>process.<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="最后一步：数据库数据表更改插入数据"><a href="#最后一步：数据库数据表更改插入数据" class="headerlink" title="最后一步：数据库数据表更改插入数据"></a>最后一步：数据库数据表更改插入数据</h3><p>app.js</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">const model = require(<span class="hljs-string">'./model'</span>);<br><br>let<br>    Pet = model.Pet,<br>    <span class="hljs-keyword">User</span> = model.<span class="hljs-keyword">User</span>;<br><br>(async () =&gt; &#123;<br>    var <span class="hljs-keyword">user</span> = await <span class="hljs-keyword">User</span>.<span class="hljs-keyword">create</span>(&#123;<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'John'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        email: <span class="hljs-string">'john-'</span> + <span class="hljs-type">Date</span>.now() + <span class="hljs-string">'@garfield.pet'</span>,<br>        passwd: <span class="hljs-string">'hahaha'</span><br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type">JSON</span>.stringify(<span class="hljs-keyword">user</span>));<br><br>    var cat = await Pet.<span class="hljs-keyword">create</span>(&#123;<br>        ownerId: <span class="hljs-keyword">user</span>.id,<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'Garfield'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        birth: <span class="hljs-string">'2007-07-07'</span>,<br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type">JSON</span>.stringify(cat));<br><br>    var dog = await Pet.<span class="hljs-keyword">create</span>(&#123;<br>        ownerId: <span class="hljs-keyword">user</span>.id,<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'Odie'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        birth: <span class="hljs-string">'2008-08-08'</span>,<br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type"><code class="language-hljs pgsql">const model = require(<span class="hljs-string">'./model'</span>);<br><br>let<br>    Pet = model.Pet,<br>    <span class="hljs-keyword">User</span> = model.<span class="hljs-keyword">User</span>;<br><br>(async () =&gt; &#123;<br>    var <span class="hljs-keyword">user</span> = await <span class="hljs-keyword">User</span>.<span class="hljs-keyword">create</span>(&#123;<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'John'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        email: <span class="hljs-string">'john-'</span> + <span class="hljs-type">Date</span>.now() + <span class="hljs-string">'@garfield.pet'</span>,<br>        passwd: <span class="hljs-string">'hahaha'</span><br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type">JSON</span>.stringify(<span class="hljs-keyword">user</span>));<br><br>    var cat = await Pet.<span class="hljs-keyword">create</span>(&#123;<br>        ownerId: <span class="hljs-keyword">user</span>.id,<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'Garfield'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        birth: <span class="hljs-string">'2007-07-07'</span>,<br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type">JSON</span>.stringify(cat));<br><br>    var dog = await Pet.<span class="hljs-keyword">create</span>(&#123;<br>        ownerId: <span class="hljs-keyword">user</span>.id,<br>        <span class="hljs-type">name</span>: <span class="hljs-string">'Odie'</span>,<br>        gender: <span class="hljs-keyword">false</span>,<br>        birth: <span class="hljs-string">'2008-08-08'</span>,<br>    &#125;);<br>    console.log(<span class="hljs-string">'created: '</span> + <span class="hljs-type">JSON</span>.stringify(dog));<br>&#125;)();<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：<br>学习廖大文章，小改<br>我第一步就没有实现，mysql连不上node，心态崩了~~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104836214&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sequelize、moudle简单使用&lt;/a&gt;&lt;/p
      
    
    </summary>
    
    
      <category term="nodejs" scheme="http://lewis.qi.tk/categories/nodejs/"/>
    
    
      <category term="nodejs" scheme="http://lewis.qi.tk/tags/nodejs/"/>
    
      <category term="mysql" scheme="http://lewis.qi.tk/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>mysql远程访问以及Access denied for user root@localhost (using password: YES)错误</title>
    <link href="http://lewis.qi.tk/2020/05/16/mysql%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E4%BB%A5%E5%8F%8AAccess-denied-for-user-root-localhost-using-password-YES-%E9%94%99%E8%AF%AF/"/>
    <id>http://lewis.qi.tk/2020/05/16/mysql%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E4%BB%A5%E5%8F%8AAccess-denied-for-user-root-localhost-using-password-YES-%E9%94%99%E8%AF%AF/</id>
    <published>2020-05-16T11:34:41.000Z</published>
    <updated>2020-05-16T11:43:23.605Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104836144" target="_blank" rel="noopener">mysql远程访问以及Access denied for user root@localhost (using password: YES)错误</a></p><p>mysql8.0.18版本</p><h2 id="配置远程访问1"><a href="#配置远程访问1" class="headerlink" title="配置远程访问1"></a>配置远程访问1</h2><p>1.<strong>E:\WAMP\bin\mysql\mysql8.0.18\my.ini</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs routeros">找到<br>[mysqld]<br><span class="hljs-attribute">default_authentication_plugin</span>=mysql_native_password<br>port = 3307<br>方法一：(如果有这行，就添加#注释，或者改成skip-name-resolve)<br><span class="hljs-comment"><code class="language-hljs routeros">找到<br>[mysqld]<br><span class="hljs-attribute">default_authentication_plugin</span>=mysql_native_password<br>port = 3307<br>方法一：(如果有这行，就添加#注释，或者改成skip-name-resolve)<br><span class="hljs-comment">#bind-address = 127.0.0.1</span><br>方法二：（添加bind-address = 0.0.0.0）<br>bind-address = 0.0.0.0<br>skip-grant-tables<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>bind-address 服务监听在127.0.0.1和0.0.0.0上的区别:<br>0.0.0.0在服务器的环境中，指的就是服务器上所有的ipv4地址</p><ul><li>3307端口监听在127.0.0.1，只有本机客户端可以访问，其他服务器无法访问</li><li>3307端口监听在0.0.0.0上，如果没有端口限制，那么其他服务器则可以连接该服务器的该端口</li></ul><p>2.<strong>E:\WAMP\apps\phpmyadmin4.9.2\config.inc.php</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs markdown">if($wampConf['SupportMySQL'] == 'on') &#123;<br>/<span class="hljs-emphasis">* Server: localhost [1] *</span>/<br>$i++;<br>if($mariaFirst) $i++;<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'verbose'</span>] = 'MySQL';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'host'</span>] = '127.0.0.1';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'port'</span>] = $wampConf['mysqlPortUsed'];<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'extension'</span>] = 'mysqli';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'auth_type'</span>] = 'cookie';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'user'</span>] = '';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'password'</span>] = '';<br><br><br>把$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string"><code class="language-hljs markdown">if($wampConf['SupportMySQL'] == 'on') &#123;<br>/<span class="hljs-emphasis">* Server: localhost [1] *</span>/<br>$i++;<br>if($mariaFirst) $i++;<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'verbose'</span>] = 'MySQL';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'host'</span>] = '127.0.0.1';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'port'</span>] = $wampConf['mysqlPortUsed'];<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'extension'</span>] = 'mysqli';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'auth_type'</span>] = 'cookie';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'user'</span>] = '';<br>$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'password'</span>] = '';<br><br><br>把$cfg[<span class="hljs-string">'Servers'</span>][<span class="hljs-symbol">$i</span>][<span class="hljs-string">'host'</span>] = '127.0.0.1';<br>将127.0.0.1更改为0.0.0.0<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>3.配置防火墙以允许通过默认的Apache和MySQL端口进行连接</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs angelscript"><span class="hljs-number">1.</span>控制面板-&gt; Windows防火墙 - &gt;高级设置<br><span class="hljs-number">2.</span>在左侧窗格中，选择“入站规则”，选择“新建规则,选择“端口”并“下一步”<br><span class="hljs-number">3.</span>选择“TCP”并在“特定本地端口”旁边的文本框中输入Apache和MySQL的端口（<span class="hljs-number">80</span>,<span class="hljs-number">3307</span>）并点击下一步<br><span class="hljs-number">4.</span>选择“允许连接”并点击“下一步”<br><span class="hljs-number">5.</span>检查你何时应用规则? ( 勾选 : 域 , 专用 , 公用 )<br><span class="hljs-number"><code class="language-hljs angelscript"><span class="hljs-number">1.</span>控制面板-&gt; Windows防火墙 - &gt;高级设置<br><span class="hljs-number">2.</span>在左侧窗格中，选择“入站规则”，选择“新建规则,选择“端口”并“下一步”<br><span class="hljs-number">3.</span>选择“TCP”并在“特定本地端口”旁边的文本框中输入Apache和MySQL的端口（<span class="hljs-number">80</span>,<span class="hljs-number">3307</span>）并点击下一步<br><span class="hljs-number">4.</span>选择“允许连接”并点击“下一步”<br><span class="hljs-number">5.</span>检查你何时应用规则? ( 勾选 : 域 , 专用 , 公用 )<br><span class="hljs-number">6.</span>为此规则指定一个名称，然后单击“完成”<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>4.重新启动所有服务，现在可以远程连接数据库进行测试<br>service mysql restart</p><h2 id="配置远程访问2"><a href="#配置远程访问2" class="headerlink" title="配置远程访问2"></a>配置远程访问2</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql">先开启wamp（mysql服务开启）<br>再打开Navicat进行操作<br><br>//1.创建node_test库<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> node_test;<br><br>//2.新建用户Lewis<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">'Lewis'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">identified</span> <span class="hljs-keyword">by</span>  <span class="hljs-string">'123456'</span><br><br>//<span class="hljs-number">3.</span>远程访问mysql(@<span class="hljs-string">"%"</span>),只能访问数据库node-<span class="hljs-keyword">test</span>的所有表<br>//<span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">option</span>这个选项表示该用户可以将自己拥有的权限授权给别人<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> node_test.* <span class="hljs-keyword">to</span> <span class="hljs-string">'Lewis'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">option</span><br><br>//再授权权限<br><br><br>//<span class="hljs-number">4.</span>刷新权限<br><span class="hljs-keyword">flush</span> <span class="hljs-keyword">privileges</span>;<br><br>//5.把当前数据库切换为node-test<br><span class="hljs-keyword">use</span> node_test;<br><br>//6.建表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> pets (<br>    <span class="hljs-keyword">id</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">name</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    gender <span class="hljs-built_in">bool</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    birth <span class="hljs-built_in">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    createdAt <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    updatedAt <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">version</span> <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    primary <span class="hljs-keyword">key</span> (<span class="hljs-keyword">id</span>)<br>) <span class="hljs-keyword">engine</span>=<span class="hljs-keyword"><code class="language-hljs sql">先开启wamp（mysql服务开启）<br>再打开Navicat进行操作<br><br>//1.创建node_test库<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> node_test;<br><br>//2.新建用户Lewis<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">'Lewis'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">identified</span> <span class="hljs-keyword">by</span>  <span class="hljs-string">'123456'</span><br><br>//<span class="hljs-number">3.</span>远程访问mysql(@<span class="hljs-string">"%"</span>),只能访问数据库node-<span class="hljs-keyword">test</span>的所有表<br>//<span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">option</span>这个选项表示该用户可以将自己拥有的权限授权给别人<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> node_test.* <span class="hljs-keyword">to</span> <span class="hljs-string">'Lewis'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">option</span><br><br>//再授权权限<br><br><br>//<span class="hljs-number">4.</span>刷新权限<br><span class="hljs-keyword">flush</span> <span class="hljs-keyword">privileges</span>;<br><br>//5.把当前数据库切换为node-test<br><span class="hljs-keyword">use</span> node_test;<br><br>//6.建表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> pets (<br>    <span class="hljs-keyword">id</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">name</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    gender <span class="hljs-built_in">bool</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    birth <span class="hljs-built_in">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    createdAt <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    updatedAt <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">version</span> <span class="hljs-built_in">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>    primary <span class="hljs-keyword">key</span> (<span class="hljs-keyword">id</span>)<br>) <span class="hljs-keyword">engine</span>=<span class="hljs-keyword">innodb</span>;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="1、创建新用户"><a href="#1、创建新用户" class="headerlink" title="1、创建新用户"></a>1、创建新用户</h2><p>通过root用户登录之后创建<br>create user ‘Lewis’@’%’ identified by ‘123456’</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">//设置用户testuser，本地访问mysql(@localhost)<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;<br><br>//设置用户testuser，远程访问mysql(@"%")<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@"%";<br><br>//设置用户testuser，只能在客户端IP为<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>上才能远程访问mysql (@“<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>”)<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@“<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>”;<br><br>//禁止testuser用户在远程机器上访问mysql<br>&gt;&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>="testuser" <span class="hljs-keyword">and</span> host="%";<br><br>//设置用户root，远程访问mysql(@"%")<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> root@"%" ;<br><br>//禁止root用户在远程机器上访问mysql<br>&gt;&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>="root" <span class="hljs-keyword">and</span> host="%";<br><br>//查询mysql中所有用户权限<br>&gt;&gt; <span class="hljs-keyword">select</span> host,<span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br><br>//刷新MySQL的系统权限相关表，否则会出现拒绝访问，<br>&gt;&gt; flush <span class="hljs-keyword"><code class="language-hljs pgsql">//设置用户testuser，本地访问mysql(@localhost)<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;<br><br>//设置用户testuser，远程访问mysql(@"%")<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@"%";<br><br>//设置用户testuser，只能在客户端IP为<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>上才能远程访问mysql (@“<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>”)<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@“<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>”;<br><br>//禁止testuser用户在远程机器上访问mysql<br>&gt;&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>="testuser" <span class="hljs-keyword">and</span> host="%";<br><br>//设置用户root，远程访问mysql(@"%")<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> root@"%" ;<br><br>//禁止root用户在远程机器上访问mysql<br>&gt;&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>="root" <span class="hljs-keyword">and</span> host="%";<br><br>//查询mysql中所有用户权限<br>&gt;&gt; <span class="hljs-keyword">select</span> host,<span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br><br>//刷新MySQL的系统权限相关表，否则会出现拒绝访问，<br>&gt;&gt; flush <span class="hljs-keyword">privileges</span>;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>　　</p><h2 id="2、设置用户访问数据库权限"><a href="#2、设置用户访问数据库权限" class="headerlink" title="2、设置用户访问数据库权限"></a>2、设置用户访问数据库权限</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">//设置用户testuser，只能访问数据库test_db<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> test_db.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//设置用户testuser，可以访问mysql上的所有数据库<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//设置用户testuser，只能访问数据库test_db的表user_infor<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> test_db.user_infor <span class="hljs-keyword"><code class="language-hljs pgsql">//设置用户testuser，只能访问数据库test_db<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> test_db.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//设置用户testuser，可以访问mysql上的所有数据库<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//设置用户testuser，只能访问数据库test_db的表user_infor<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> test_db.user_infor <span class="hljs-keyword">to</span> testuser@localhost;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="3、设置用户操作权限"><a href="#3、设置用户操作权限" class="headerlink" title="3、设置用户操作权限"></a>3、设置用户操作权限</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs pgsql">//设置用户testuser，拥有所有的操作权限,授权给其他人<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost  <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;　　<br><br>//设置用户testuser，只拥有【查询\插入】操作权限<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//取消用户testuser的【查询\插入】操作权限 ；<br>&gt;&gt; <span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">ON</span> what <span class="hljs-keyword"><code class="language-hljs pgsql">//设置用户testuser，拥有所有的操作权限,授权给其他人<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost  <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;　　<br><br>//设置用户testuser，只拥有【查询\插入】操作权限<br>&gt;&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> testuser@localhost;　　<br><br>//取消用户testuser的【查询\插入】操作权限 ；<br>&gt;&gt; <span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">ON</span> what <span class="hljs-keyword">FROM</span> testuser;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>当然了，我搞鼓了一天愣是出现以下错误：  （输入密码，但拒绝访问）<br>Access denied for user ‘root’@’localhost’ (using password: YES)<br>我心态崩了，Navicat可以连上，可以进行增删查改，就是node连不上······<br><img src="https://img-blog.csdnimg.cn/2020031310524249.gif" alt="在这里插入图片描述"><br>哪位大神指导下</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104836144&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mysql远程访问以及Access denied fo
      
    
    </summary>
    
    
      <category term="mysql" scheme="http://lewis.qi.tk/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://lewis.qi.tk/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MVC（node-koa应用）</title>
    <link href="http://lewis.qi.tk/2020/05/16/MVC%EF%BC%88node-koa%E5%BA%94%E7%94%A8%EF%BC%89/"/>
    <id>http://lewis.qi.tk/2020/05/16/MVC%EF%BC%88node-koa%E5%BA%94%E7%94%A8%EF%BC%89/</id>
    <published>2020-05-16T11:34:09.000Z</published>
    <updated>2020-05-16T11:41:41.554Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104835542" target="_blank" rel="noopener">MVC（node-koa应用）</a></p><h1 id="文件目录"><a href="#文件目录" class="headerlink" title="文件目录"></a>文件目录</h1><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs 1c">MVC/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- controllers/         &lt;-- Controller控制器,处理异步请求函数（async函数，直接moudle.esports暴露）<br>   <span class="hljs-string">|</span><br>   +- index.js          &lt;--定义一个async函数处理首页URL<br>   <span class="hljs-string">|</span><br>   +- login.js          &lt;--定义一个async函数处理登录请求<br><span class="hljs-string">|</span><br>+- views/               &lt;-- html模板文件和html文件<br>   <span class="hljs-string">|</span><br>   +- base.html         &lt;- （第一层模板文件）<br>   <span class="hljs-string">|</span><br>   +- index.html        &lt;- 首页<br>   <span class="hljs-string">|</span><br>   +- login-success.html&lt;- 登录成功<br>   <span class="hljs-string">|</span><br>   +- login-failed.html &lt;- 登录失败<br><span class="hljs-string">|</span><br>+- static/              &lt;-- 静态资源文件<br>   <span class="hljs-string">|</span><br>   +- css/              &lt;- 存放bootstrap.css等<br>   <span class="hljs-string">|</span><br>   +- fonts/            &lt;- 存放字体文件<br>   <span class="hljs-string">|</span><br>   +- js/               &lt;- 存放bootstrap.js等<br><span class="hljs-string">|</span><br>+- controller.js        &lt;-- 扫描注册Controller控制器<br><span class="hljs-string">|</span><br>+- static-file.js        &lt;-- 编写处理静态文件的middleware的js文件<br><span class="hljs-string"><code class="language-hljs 1c">MVC/<br><span class="hljs-string">|</span><br>+- .vscode/<br><span class="hljs-string">|  |</span><br><span class="hljs-string">|  +- launch.json       &lt;-- VSCode 配置文件</span><br><span class="hljs-string">|</span><br>+- package.json         &lt;-- 项目描述文件<br><span class="hljs-string">|</span><br>+- node_modules/        &lt;-- npm安装的所有依赖包<br><span class="hljs-string">|</span><br>+- controllers/         &lt;-- Controller控制器,处理异步请求函数（async函数，直接moudle.esports暴露）<br>   <span class="hljs-string">|</span><br>   +- index.js          &lt;--定义一个async函数处理首页URL<br>   <span class="hljs-string">|</span><br>   +- login.js          &lt;--定义一个async函数处理登录请求<br><span class="hljs-string">|</span><br>+- views/               &lt;-- html模板文件和html文件<br>   <span class="hljs-string">|</span><br>   +- base.html         &lt;- （第一层模板文件）<br>   <span class="hljs-string">|</span><br>   +- index.html        &lt;- 首页<br>   <span class="hljs-string">|</span><br>   +- login-success.html&lt;- 登录成功<br>   <span class="hljs-string">|</span><br>   +- login-failed.html &lt;- 登录失败<br><span class="hljs-string">|</span><br>+- static/              &lt;-- 静态资源文件<br>   <span class="hljs-string">|</span><br>   +- css/              &lt;- 存放bootstrap.css等<br>   <span class="hljs-string">|</span><br>   +- fonts/            &lt;- 存放字体文件<br>   <span class="hljs-string">|</span><br>   +- js/               &lt;- 存放bootstrap.js等<br><span class="hljs-string">|</span><br>+- controller.js        &lt;-- 扫描注册Controller控制器<br><span class="hljs-string">|</span><br>+- static-file.js        &lt;-- 编写处理静态文件的middleware的js文件<br><span class="hljs-string">|</span><br>+- app.js               <-- 使用koa的js（主js）<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="controllers"><a href="#controllers" class="headerlink" title="controllers"></a>controllers</h2><p>index.js</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs dart"><span class="hljs-comment">//定义一个async函数处理首页URL/</span><br><span class="hljs-comment">//最后一步调用ctx.render(view, model)就完成了页面输出。</span><br>module.exports = &#123;<br>    <span class="hljs-string">'GET /'</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        ctx.render(<span class="hljs-string">'index.html'</span>, &#123;<br>            title: <span class="hljs-string"><code class="language-hljs dart"><span class="hljs-comment">//定义一个async函数处理首页URL/</span><br><span class="hljs-comment">//最后一步调用ctx.render(view, model)就完成了页面输出。</span><br>module.exports = &#123;<br>    <span class="hljs-string">'GET /'</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        ctx.render(<span class="hljs-string">'index.html'</span>, &#123;<br>            title: <span class="hljs-string">'Welcome（登录界面）'</span><br>        &#125;);<br>    &#125;<br>&#125;;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>login.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-comment">//再定义一个async函数处理登录请求/login</span><br><span class="hljs-comment">//直接moudle.esports暴露</span><br><span class="hljs-comment">//最后一步调用ctx.render(view, model)就完成了页面输出。</span><br><span class="hljs-comment">//登录成功时我们用login-success.html渲染，</span><br><span class="hljs-comment">//登录失败时我们用login-failed.html渲染</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>    <span class="hljs-string">'POST /signin'</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">var</span><br>            email = ctx.request.body.email || <span class="hljs-string">''</span>,<br>            password = ctx.request.body.password || <span class="hljs-string">''</span>;<br>        <span class="hljs-keyword">if</span> (email === <span class="hljs-string">'Lewis@qq.com'</span> &amp;&amp; password === <span class="hljs-string">'123456'</span>) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'login success!'</span>);<br>            <span class="hljs-comment">//寻找views目录下的html文件</span><br>            ctx.render(<span class="hljs-string">'login-success.html'</span>, &#123;<br>                title: <span class="hljs-string">'Sign In OK'</span>,<br>                name: <span class="hljs-string">'Mr Lewis'</span><br>            &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'login failed!'</span>);<br>            <span class="hljs-comment">//寻找views目录下的html文件</span><br>            ctx.render(<span class="hljs-string">'login-failed.html'</span>, &#123;<br>                title: <span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-comment">//再定义一个async函数处理登录请求/login</span><br><span class="hljs-comment">//直接moudle.esports暴露</span><br><span class="hljs-comment">//最后一步调用ctx.render(view, model)就完成了页面输出。</span><br><span class="hljs-comment">//登录成功时我们用login-success.html渲染，</span><br><span class="hljs-comment">//登录失败时我们用login-failed.html渲染</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>    <span class="hljs-string">'POST /signin'</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">var</span><br>            email = ctx.request.body.email || <span class="hljs-string">''</span>,<br>            password = ctx.request.body.password || <span class="hljs-string">''</span>;<br>        <span class="hljs-keyword">if</span> (email === <span class="hljs-string">'Lewis@qq.com'</span> &amp;&amp; password === <span class="hljs-string">'123456'</span>) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'login success!'</span>);<br>            <span class="hljs-comment">//寻找views目录下的html文件</span><br>            ctx.render(<span class="hljs-string">'login-success.html'</span>, &#123;<br>                title: <span class="hljs-string">'Sign In OK'</span>,<br>                name: <span class="hljs-string">'Mr Lewis'</span><br>            &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'login failed!'</span>);<br>            <span class="hljs-comment">//寻找views目录下的html文件</span><br>            ctx.render(<span class="hljs-string">'login-failed.html'</span>, &#123;<br>                title: <span class="hljs-string">'Sign In Failed!'</span><br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="static"><a href="#static" class="headerlink" title="static"></a>static</h2><p>静态文件</p><h2 id="views"><a href="#views" class="headerlink" title="views"></a>views</h2><p>base.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs django"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"learn javascript"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; title &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/bootstrap.css"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/bootstrap.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-static-top"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span>&gt;</span>Learn JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse navbar-collapse"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bs-navbar"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get one<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get two<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get three<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"important"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:#cdbfe3; background-color:#6f5499; padding:30px 0; margin:-20px 0 20px 0;"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:#fff; font-size:60px"</span>&gt;</span>Getting started<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size:24px; line-height:48px"</span>&gt;</span>Learn JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- 这两行为后续提供模板，插入使用 --&gt;</span></span><br><span class="xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><span class="xml"> </span><br><span class="xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %&#125;</span><br><span class="xml">    </span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-color:#ddd; padding: 20px 0;"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> - </span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> - </span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>created by <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Lewis<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs django"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"learn javascript"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; title &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/bootstrap.css"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/bootstrap.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-static-top"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span>&gt;</span>Learn JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse navbar-collapse"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bs-navbar"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get one<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get two<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com/"</span>&gt;</span>Get three<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"important"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:#cdbfe3; background-color:#6f5499; padding:30px 0; margin:-20px 0 20px 0;"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:#fff; font-size:60px"</span>&gt;</span>Getting started<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size:24px; line-height:48px"</span>&gt;</span>Learn JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- 这两行为后续提供模板，插入使用 --&gt;</span></span><br><span class="xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><span class="xml"> </span><br><span class="xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %&#125;</span><br><span class="xml">    </span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-color:#ddd; padding: 20px 0;"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> - </span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> - </span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.baidu.com/"</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>created by <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Lewis<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>index.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphicon-user"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/signin"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Email"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>Use email: admin@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>Use password: 123456<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>Sign In<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Get more ...<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name"><code class="language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphicon-user"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/signin"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Email"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>Use email: admin@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>Use password: 123456<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>Sign In<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Get more ...<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %&#125;</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>login-failed.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><span class="xml"> </span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><br><span class="xml"><span class="hljs-comment">&lt;!-- 测试格式是否输入正确 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Sign in failed!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Sorry!<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Your email or password does not match! Please try again.</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphicon-user"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/signin"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Email"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>示例: admin@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>示例: 123456<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>Sign In<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name"><code class="language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><span class="xml"> </span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><br><span class="xml"><span class="hljs-comment">&lt;!-- 测试格式是否输入正确 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Sign in failed!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Sorry!<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Your email or password does not match! Please try again.</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphicon-user"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/signin"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Email"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>示例: admin@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"help-block"</span>&gt;</span>示例: 123456<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>Sign In<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %&#125;</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>login-success.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><span class="xml"> </span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Sign in successfully!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Well done!<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> You successfully signed in as </span><span class="hljs-template-variable">&#123;&#123; name &#125;&#125;</span><span class="xml">!</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>Back to home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name"><code class="language-hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">extends</span></span> "base.html" %&#125;</span><span class="xml"> </span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">block</span></span> main %&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-12"</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Sign in successfully!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Well done!<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> You successfully signed in as </span><span class="hljs-template-variable">&#123;&#123; name &#125;&#125;</span><span class="xml">!</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>Back to home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %&#125;</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><p>controller.js</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs qml"><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-comment">// add url-route in /controllers:</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addMapping</span>(<span class="hljs-params">router, mapping</span>) </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> <span class="hljs-keyword">in</span> mapping) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'GET '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">4</span>);<br>            router.get(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: GET <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'POST '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">5</span>);<br>            router.post(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: POST <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'PUT '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">4</span>);<br>            router.put(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: PUT <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'DELETE '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">7</span>);<br>            router.del(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: DELETE <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-title">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`invalid URL: <span class="hljs-subst">$&#123;url&#125;</span>`</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//后面调用时，寻找controllers目录下的以js结尾的文件</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addControllers</span>(<span class="hljs-params">router, dir</span>) </span>&#123;<br>    fs.readdirSync(__dirname + <span class="hljs-string">'/'</span> + dir).filter((f) =&gt; &#123;<br>        <span class="hljs-keyword">return</span> f.endsWith(<span class="hljs-string">'.js'</span>);<br>    &#125;).forEach((f) =&gt; &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`process controller: <span class="hljs-subst">$&#123;f&#125;</span>...`</span>);<br>        <span class="hljs-keyword">let</span> mapping = <span class="hljs-built_in">require</span>(__dirname + <span class="hljs-string">'/'</span> + dir + <span class="hljs-string">'/'</span> + f);<br>        addMapping(router, mapping);<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">//寻找controllers目录下</span><br><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dir</span>) </span>&#123;<br>    <span class="hljs-keyword">let</span><br>        controllers_dir = dir || <span class="hljs-string">'controllers'</span>,<br>        router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-router'</span>)();<br>    addControllers(router, controllers_dir);<br>    <span class="hljs-keyword"><code class="language-hljs qml"><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-comment">// add url-route in /controllers:</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addMapping</span>(<span class="hljs-params">router, mapping</span>) </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> <span class="hljs-keyword">in</span> mapping) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'GET '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">4</span>);<br>            router.get(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: GET <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'POST '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">5</span>);<br>            router.post(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: POST <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'PUT '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">4</span>);<br>            router.put(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: PUT <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">url</span>.startsWith(<span class="hljs-string">'DELETE '</span>)) &#123;<br>            <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">url</span>.substring(<span class="hljs-number">7</span>);<br>            router.del(path, mapping[<span class="hljs-built_in">url</span>]);<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`register URL mapping: DELETE <span class="hljs-subst">$&#123;path&#125;</span>`</span>);<br>        &#125; <span class="hljs-title">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`invalid URL: <span class="hljs-subst">$&#123;url&#125;</span>`</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//后面调用时，寻找controllers目录下的以js结尾的文件</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addControllers</span>(<span class="hljs-params">router, dir</span>) </span>&#123;<br>    fs.readdirSync(__dirname + <span class="hljs-string">'/'</span> + dir).filter((f) =&gt; &#123;<br>        <span class="hljs-keyword">return</span> f.endsWith(<span class="hljs-string">'.js'</span>);<br>    &#125;).forEach((f) =&gt; &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`process controller: <span class="hljs-subst">$&#123;f&#125;</span>...`</span>);<br>        <span class="hljs-keyword">let</span> mapping = <span class="hljs-built_in">require</span>(__dirname + <span class="hljs-string">'/'</span> + dir + <span class="hljs-string">'/'</span> + f);<br>        addMapping(router, mapping);<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">//寻找controllers目录下</span><br><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dir</span>) </span>&#123;<br>    <span class="hljs-keyword">let</span><br>        controllers_dir = dir || <span class="hljs-string">'controllers'</span>,<br>        router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-router'</span>)();<br>    addControllers(router, controllers_dir);<br>    <span class="hljs-keyword">return</span> router.routes();<br>&#125;;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>static-file.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);<br><span class="hljs-keyword">const</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mime'</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mz/fs'</span>);<br><br><span class="hljs-comment">// url: 类似 '/static/'</span><br><span class="hljs-comment">// dir: 类似 __dirname + '/static'</span><br><span class="hljs-comment">//接收两个参数：URL前缀和一个目录，然后返回一个async函数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">staticFiles</span>(<span class="hljs-params">url, dir</span>) </span>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">let</span> rpath = ctx.request.path;<br>        <span class="hljs-comment">// 判断是否以指定的url开头:</span><br>        <span class="hljs-keyword">if</span> (rpath.startsWith(url)) &#123;<br>            <span class="hljs-comment">// 获取文件完整路径:</span><br>            <span class="hljs-keyword">let</span> fp = path.join(dir, rpath.substring(url.length));<br>            <span class="hljs-comment">// 判断文件是否存在:</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.exists(fp)) &#123;<br>                <span class="hljs-comment">// 查找文件的mime:</span><br>                ctx.response.type = mime.getType(rpath);<br>                <span class="hljs-comment">// 读取文件内容并赋值给response.body:</span><br>                ctx.response.body = <span class="hljs-keyword">await</span> fs.readFile(fp);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 文件不存在:</span><br>                ctx.response.status = <span class="hljs-number">404</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 不是指定前缀的URL，继续处理下一个middleware:</span><br>            <span class="hljs-keyword">await</span> next();<br>        &#125;<br>    &#125;;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = staticFiles;<br><br><br><span class="hljs-comment">//关于mime</span><br><span class="hljs-comment">//1.lookup() renamed to getType()</span><br><span class="hljs-comment">//2.extension() renamed to getExtension()</span><br><span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);<br><span class="hljs-keyword">const</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mime'</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mz/fs'</span>);<br><br><span class="hljs-comment">// url: 类似 '/static/'</span><br><span class="hljs-comment">// dir: 类似 __dirname + '/static'</span><br><span class="hljs-comment">//接收两个参数：URL前缀和一个目录，然后返回一个async函数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">staticFiles</span>(<span class="hljs-params">url, dir</span>) </span>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">let</span> rpath = ctx.request.path;<br>        <span class="hljs-comment">// 判断是否以指定的url开头:</span><br>        <span class="hljs-keyword">if</span> (rpath.startsWith(url)) &#123;<br>            <span class="hljs-comment">// 获取文件完整路径:</span><br>            <span class="hljs-keyword">let</span> fp = path.join(dir, rpath.substring(url.length));<br>            <span class="hljs-comment">// 判断文件是否存在:</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.exists(fp)) &#123;<br>                <span class="hljs-comment">// 查找文件的mime:</span><br>                ctx.response.type = mime.getType(rpath);<br>                <span class="hljs-comment">// 读取文件内容并赋值给response.body:</span><br>                ctx.response.body = <span class="hljs-keyword">await</span> fs.readFile(fp);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 文件不存在:</span><br>                ctx.response.status = <span class="hljs-number">404</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 不是指定前缀的URL，继续处理下一个middleware:</span><br>            <span class="hljs-keyword">await</span> next();<br>        &#125;<br>    &#125;;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = staticFiles;<br><br><br><span class="hljs-comment">//关于mime</span><br><span class="hljs-comment">//1.lookup() renamed to getType()</span><br><span class="hljs-comment">//2.extension() renamed to getExtension()</span><br><span class="hljs-comment">//3.charset() and load() methods have been removed</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>templating.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">const</span> nunjucks = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nunjucks'</span>);<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createEnv</span>(<span class="hljs-params">path, opts</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span><br>        autoescape = opts.autoescape === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">true</span> : opts.autoescape,<br>        noCache = opts.noCache || <span class="hljs-literal">false</span>,<br>        watch = opts.watch || <span class="hljs-literal">false</span>,<br>        throwOnUndefined = opts.throwOnUndefined || <span class="hljs-literal">false</span>,<br>        env = <span class="hljs-keyword">new</span> nunjucks.Environment(<br>            <span class="hljs-keyword">new</span> nunjucks.FileSystemLoader(path, &#123;<br>                noCache: noCache,<br>                watch: watch,<br>            &#125;), &#123;<br>                autoescape: autoescape,<br>                throwOnUndefined: throwOnUndefined<br>            &#125;);<br>    <span class="hljs-keyword">if</span> (opts.filters) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> opts.filters) &#123;<br>            env.addFilter(f, opts.filters[f]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> env;<br>&#125;<br><br><span class="hljs-comment">//集成Nunjucks的middleware</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">templating</span>(<span class="hljs-params">path, opts</span>) </span>&#123;<br>    <span class="hljs-comment">// 创建Nunjucks的env对象:</span><br>    <span class="hljs-keyword">var</span> env = createEnv(path, opts);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-comment">// 给ctx绑定render函数:（内部渲染模板）</span><br>        ctx.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">view, model</span>) </span>&#123;<br>            <span class="hljs-comment">// 把render后的内容赋值给response.body:</span><br>            ctx.response.body = env.render(view, <span class="hljs-built_in">Object</span>.assign(&#123;&#125;, ctx.state || &#123;&#125;, model || &#123;&#125;));<br>            <span class="hljs-comment">// 设置Content-Type:</span><br>            ctx.response.type = <span class="hljs-string">'text/html'</span>;<br>        &#125;;<br>        <span class="hljs-comment">// 继续处理请求:</span><br>        <span class="hljs-keyword">await</span> next();<br>    &#125;;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = templating;<br><br><br><span class="hljs-comment">// ctx.render内部渲染模板时，Model对象并不是传入的model变量，</span><br><span class="hljs-comment">// 而是：Object.assign(&#123;&#125;, ctx.state || &#123;&#125;, model || &#123;&#125;)</span><br><span class="hljs-comment">// 解析：</span><br><span class="hljs-comment">// Object.assign()会把除第一个参数外的其他参数的所有属性复制到第一个参数中。</span><br><span class="hljs-comment">// 第一个参数：ctx.state || &#123;&#125;，这个目的是为了能把一些公共的变量放入ctx.state并传给View。</span><br><span class="hljs-comment">// 第二个参数：model || &#123;&#125;确保了即使传入undefined，model也会变为默认值&#123;&#125;。</span><br><span class="hljs-comment">// 进阶：</span><br><span class="hljs-comment">// 例如，某个middleware负责检查用户权限，它可以把当前用户放入ctx.state中：</span><br><span class="hljs-comment">// 这样就没有必要在每个Controller的async函数中都把user变量放入model中。</span><br><span class="hljs-comment">// app.use(async (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment">//     var user = tryGetUserFromCookie(ctx.request);</span><br><span class="hljs-comment">//     if (user) &#123;</span><br><span class="hljs-comment">//         ctx.state.user = user;</span><br><span class="hljs-comment">//         await next();</span><br><span class="hljs-comment">//     &#125; else &#123;</span><br><span class="hljs-comment">//         ctx.response.status = 403;</span><br><span class="hljs-comment">//     &#125;</span><br><span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-keyword">const</span> nunjucks = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nunjucks'</span>);<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createEnv</span>(<span class="hljs-params">path, opts</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span><br>        autoescape = opts.autoescape === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">true</span> : opts.autoescape,<br>        noCache = opts.noCache || <span class="hljs-literal">false</span>,<br>        watch = opts.watch || <span class="hljs-literal">false</span>,<br>        throwOnUndefined = opts.throwOnUndefined || <span class="hljs-literal">false</span>,<br>        env = <span class="hljs-keyword">new</span> nunjucks.Environment(<br>            <span class="hljs-keyword">new</span> nunjucks.FileSystemLoader(path, &#123;<br>                noCache: noCache,<br>                watch: watch,<br>            &#125;), &#123;<br>                autoescape: autoescape,<br>                throwOnUndefined: throwOnUndefined<br>            &#125;);<br>    <span class="hljs-keyword">if</span> (opts.filters) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> opts.filters) &#123;<br>            env.addFilter(f, opts.filters[f]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> env;<br>&#125;<br><br><span class="hljs-comment">//集成Nunjucks的middleware</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">templating</span>(<span class="hljs-params">path, opts</span>) </span>&#123;<br>    <span class="hljs-comment">// 创建Nunjucks的env对象:</span><br>    <span class="hljs-keyword">var</span> env = createEnv(path, opts);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-comment">// 给ctx绑定render函数:（内部渲染模板）</span><br>        ctx.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">view, model</span>) </span>&#123;<br>            <span class="hljs-comment">// 把render后的内容赋值给response.body:</span><br>            ctx.response.body = env.render(view, <span class="hljs-built_in">Object</span>.assign(&#123;&#125;, ctx.state || &#123;&#125;, model || &#123;&#125;));<br>            <span class="hljs-comment">// 设置Content-Type:</span><br>            ctx.response.type = <span class="hljs-string">'text/html'</span>;<br>        &#125;;<br>        <span class="hljs-comment">// 继续处理请求:</span><br>        <span class="hljs-keyword">await</span> next();<br>    &#125;;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = templating;<br><br><br><span class="hljs-comment">// ctx.render内部渲染模板时，Model对象并不是传入的model变量，</span><br><span class="hljs-comment">// 而是：Object.assign(&#123;&#125;, ctx.state || &#123;&#125;, model || &#123;&#125;)</span><br><span class="hljs-comment">// 解析：</span><br><span class="hljs-comment">// Object.assign()会把除第一个参数外的其他参数的所有属性复制到第一个参数中。</span><br><span class="hljs-comment">// 第一个参数：ctx.state || &#123;&#125;，这个目的是为了能把一些公共的变量放入ctx.state并传给View。</span><br><span class="hljs-comment">// 第二个参数：model || &#123;&#125;确保了即使传入undefined，model也会变为默认值&#123;&#125;。</span><br><span class="hljs-comment">// 进阶：</span><br><span class="hljs-comment">// 例如，某个middleware负责检查用户权限，它可以把当前用户放入ctx.state中：</span><br><span class="hljs-comment">// 这样就没有必要在每个Controller的async函数中都把user变量放入model中。</span><br><span class="hljs-comment">// app.use(async (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment">//     var user = tryGetUserFromCookie(ctx.request);</span><br><span class="hljs-comment">//     if (user) &#123;</span><br><span class="hljs-comment">//         ctx.state.user = user;</span><br><span class="hljs-comment">//         await next();</span><br><span class="hljs-comment">//     &#125; else &#123;</span><br><span class="hljs-comment">//         ctx.response.status = 403;</span><br><span class="hljs-comment">//     &#125;</span><br><span class="hljs-comment">// &#125;);</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>app.js(主运行js文件)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa'</span>);<br><br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-bodyparser'</span>);<br><br><span class="hljs-comment">//导入控制器处理URL路由和集成Nunjucks模板</span><br><span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./controller'</span>);<br><span class="hljs-keyword">const</span> templating = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./templating'</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa();<br><br><span class="hljs-comment">//生产环境上必须配置环境变量NODE_ENV = 'production'，</span><br><span class="hljs-comment">//开发环境不需要配置，实际上NODE_ENV = 'undefined'.</span><br><span class="hljs-comment">//定义了一个常量isProduction，它判断当前环境是否是production环境。</span><br><span class="hljs-comment">//如果是，就使用缓存，如果不是，就关闭缓存</span><br><span class="hljs-keyword">const</span> isProduction = process.env.NODE_ENV === <span class="hljs-string">'production'</span>;<br><br><span class="hljs-comment">// 第一个middleware是记录URL以及页面执行时间：</span><br>app.use(<span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Process <span class="hljs-subst">$&#123;ctx.request.method&#125;</span> <span class="hljs-subst">$&#123;ctx.request.url&#125;</span>...`</span>);<br>    <span class="hljs-keyword">var</span><br>        start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(),<br>        execTime;<br>    <span class="hljs-keyword">await</span> next();<br>    execTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - start;<br>    ctx.response.set(<span class="hljs-string">'X-Response-Time'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;execTime&#125;</span>ms`</span>);<br>&#125;);<br><br><span class="hljs-comment">// 第二个middleware处理静态文件：</span><br><span class="hljs-comment">//内部let块，导入staticFiles自定义包(即目录+暴露js的文件名)</span><br><span class="hljs-comment">//接收两个参数：URL前缀和一个目录，url: 类似 '/static/';dir: 类似 __dirname + '/static'</span><br><span class="hljs-comment">//if (! isProduction)即根据环境变量判断NODE_ENV，生产production，开发undefined</span><br><span class="hljs-comment">//判断结果应为开发环境</span><br><span class="hljs-keyword">if</span> (! isProduction) &#123;<br>    <span class="hljs-keyword">let</span> staticFiles = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./static-files'</span>);<br>    app.use(staticFiles(<span class="hljs-string">'/static/'</span>, __dirname + <span class="hljs-string">'/static'</span>));<br>&#125;<br><br><span class="hljs-comment">// 第三个middleware解析POST请求：</span><br>app.use(bodyParser());<br><br><span class="hljs-comment">// 第四个middleware负责给ctx加上render()来使用Nunjucks：</span><br><span class="hljs-comment">//集成Nunjucks,调用这个方法来渲染模板</span><br>app.use(templating(<span class="hljs-string">'views'</span>, &#123;<br>    noCache: !isProduction,<br>    watch: !isProduction<br>&#125;));<br><br><span class="hljs-comment">//最后一个middleware处理URL路由：</span><br>app.use(controller());<br><br>app.listen(<span class="hljs-number">3000</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa'</span>);<br><br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-bodyparser'</span>);<br><br><span class="hljs-comment">//导入控制器处理URL路由和集成Nunjucks模板</span><br><span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./controller'</span>);<br><span class="hljs-keyword">const</span> templating = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./templating'</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa();<br><br><span class="hljs-comment">//生产环境上必须配置环境变量NODE_ENV = 'production'，</span><br><span class="hljs-comment">//开发环境不需要配置，实际上NODE_ENV = 'undefined'.</span><br><span class="hljs-comment">//定义了一个常量isProduction，它判断当前环境是否是production环境。</span><br><span class="hljs-comment">//如果是，就使用缓存，如果不是，就关闭缓存</span><br><span class="hljs-keyword">const</span> isProduction = process.env.NODE_ENV === <span class="hljs-string">'production'</span>;<br><br><span class="hljs-comment">// 第一个middleware是记录URL以及页面执行时间：</span><br>app.use(<span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Process <span class="hljs-subst">$&#123;ctx.request.method&#125;</span> <span class="hljs-subst">$&#123;ctx.request.url&#125;</span>...`</span>);<br>    <span class="hljs-keyword">var</span><br>        start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(),<br>        execTime;<br>    <span class="hljs-keyword">await</span> next();<br>    execTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - start;<br>    ctx.response.set(<span class="hljs-string">'X-Response-Time'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;execTime&#125;</span>ms`</span>);<br>&#125;);<br><br><span class="hljs-comment">// 第二个middleware处理静态文件：</span><br><span class="hljs-comment">//内部let块，导入staticFiles自定义包(即目录+暴露js的文件名)</span><br><span class="hljs-comment">//接收两个参数：URL前缀和一个目录，url: 类似 '/static/';dir: 类似 __dirname + '/static'</span><br><span class="hljs-comment">//if (! isProduction)即根据环境变量判断NODE_ENV，生产production，开发undefined</span><br><span class="hljs-comment">//判断结果应为开发环境</span><br><span class="hljs-keyword">if</span> (! isProduction) &#123;<br>    <span class="hljs-keyword">let</span> staticFiles = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./static-files'</span>);<br>    app.use(staticFiles(<span class="hljs-string">'/static/'</span>, __dirname + <span class="hljs-string">'/static'</span>));<br>&#125;<br><br><span class="hljs-comment">// 第三个middleware解析POST请求：</span><br>app.use(bodyParser());<br><br><span class="hljs-comment">// 第四个middleware负责给ctx加上render()来使用Nunjucks：</span><br><span class="hljs-comment">//集成Nunjucks,调用这个方法来渲染模板</span><br>app.use(templating(<span class="hljs-string">'views'</span>, &#123;<br>    noCache: !isProduction,<br>    watch: !isProduction<br>&#125;));<br><br><span class="hljs-comment">//最后一个middleware处理URL路由：</span><br>app.use(controller());<br><br>app.listen(<span class="hljs-number">3000</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'app started at port 3000...'</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>学完廖大的文章，模仿小改</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104835542&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MVC（node-koa应用）&lt;/a&gt;&lt;/p&gt;
&lt;h1
      
    
    </summary>
    
    
      <category term="设计模式" scheme="http://lewis.qi.tk/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="nodejs" scheme="http://lewis.qi.tk/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>hex（base16）、base32、base64三种编码方式区别</title>
    <link href="http://lewis.qi.tk/2020/05/16/hex%EF%BC%88base16%EF%BC%89%E3%80%81base32%E3%80%81base64%E4%B8%89%E7%A7%8D%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%8C%BA%E5%88%AB/"/>
    <id>http://lewis.qi.tk/2020/05/16/hex%EF%BC%88base16%EF%BC%89%E3%80%81base32%E3%80%81base64%E4%B8%89%E7%A7%8D%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%8C%BA%E5%88%AB/</id>
    <published>2020-05-16T11:33:48.000Z</published>
    <updated>2020-05-16T11:38:39.227Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104785166" target="_blank" rel="noopener">hex（base16）、base32、base64三种编码方式区别</a></p><h1 id="总体："><a href="#总体：" class="headerlink" title="总体："></a>总体：</h1><p>hex编码不区分大小写，base32与base64编码区分大小写<br>三种都是稳定的把二进制数组变成可见字符的编码方式</p><h2 id="hex（-base16）"><a href="#hex（-base16）" class="headerlink" title="hex（=base16）"></a>hex（=base16）</h2><p>1.使用16个可见字符来表示一个二进制数组，编码后数据大小将x2<br>2.1个字符需要用2个可见字符来表示</p><h2 id="base32"><a href="#base32" class="headerlink" title="base32"></a>base32</h2><p>1.使用32个可见字符来表示一个二进制数组，编码后数据大小变成原来的8/5<br>2.5个字符用8个可见字符表示,不足8个字符，将用=来补充</p><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>1.使用64个可见字符来表示一个二进制数组，编码后数据大小变成原来的4/3<br>2.3个字符用4个可见字符来表示</p><p>测试：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs reasonml">@Test<br>public void test<span class="hljs-literal">()</span>&#123;<br>    String data = <span class="hljs-string">"测试编码内容"</span> ;<br>    byte<span class="hljs-literal">[]</span> <span class="hljs-built_in">bytes</span> = data.get<span class="hljs-constructor">Bytes()</span> ;<br>    <span class="hljs-comment">//测试hex</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        long start = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> ;<br>        String encryStr = <span class="hljs-string">""</span> ;<br>        String decryStr = <span class="hljs-string">""</span> ;<br><br>        for(<span class="hljs-built_in">int</span> i= <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10000</span> ; i++) &#123;<br>            encryStr = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Hex</span>.</span></span>encode<span class="hljs-constructor">HexString(<span class="hljs-params">bytes</span>)</span> ;<br>            decryStr = <span class="hljs-keyword">new</span> <span class="hljs-constructor">String(Hex.<span class="hljs-params">decodeHex</span>(<span class="hljs-params">encryStr</span>.<span class="hljs-params">toCharArray</span>()</span>)) ;<br>        &#125;<br>        print(<span class="hljs-string">"Hex:"</span>  + (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> - start ) + <span class="hljs-string">" ms "</span> +  encryStr  + <span class="hljs-string">" | "</span> + decryStr) ;<br>    &#125; catch (Exception e) &#123;<br>        e.print<span class="hljs-constructor">StackTrace()</span>;<br>    &#125;<br>    <span class="hljs-comment">//测试base64</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        long start = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> ;<br>        String encryStr = <span class="hljs-string">""</span> ;<br>        String decryStr = <span class="hljs-string">""</span> ;<br><br>        for(<span class="hljs-built_in">int</span> i= <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10000</span> ; i++) &#123;<br>            encryStr = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Base64</span>.</span></span>encode<span class="hljs-constructor">Base64String(<span class="hljs-params">bytes</span>)</span> ;<br>            decryStr = <span class="hljs-keyword">new</span> <span class="hljs-constructor">String(Base64.<span class="hljs-params">decodeBase64</span>(<span class="hljs-params">encryStr</span>.<span class="hljs-params">getBytes</span>()</span>) );<br>        &#125;<br>        print(<span class="hljs-string">"base64: "</span> + (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> - start ) + <span class="hljs-string">" ms "</span> +  encryStr  + <span class="hljs-string">" | "</span> + decryStr) ;<br>        &#125; catch (Exception e) &#123;<br>            e.print<span class="hljs-constructor"><code class="language-hljs reasonml">@Test<br>public void test<span class="hljs-literal">()</span>&#123;<br>    String data = <span class="hljs-string">"测试编码内容"</span> ;<br>    byte<span class="hljs-literal">[]</span> <span class="hljs-built_in">bytes</span> = data.get<span class="hljs-constructor">Bytes()</span> ;<br>    <span class="hljs-comment">//测试hex</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        long start = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> ;<br>        String encryStr = <span class="hljs-string">""</span> ;<br>        String decryStr = <span class="hljs-string">""</span> ;<br><br>        for(<span class="hljs-built_in">int</span> i= <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10000</span> ; i++) &#123;<br>            encryStr = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Hex</span>.</span></span>encode<span class="hljs-constructor">HexString(<span class="hljs-params">bytes</span>)</span> ;<br>            decryStr = <span class="hljs-keyword">new</span> <span class="hljs-constructor">String(Hex.<span class="hljs-params">decodeHex</span>(<span class="hljs-params">encryStr</span>.<span class="hljs-params">toCharArray</span>()</span>)) ;<br>        &#125;<br>        print(<span class="hljs-string">"Hex:"</span>  + (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> - start ) + <span class="hljs-string">" ms "</span> +  encryStr  + <span class="hljs-string">" | "</span> + decryStr) ;<br>    &#125; catch (Exception e) &#123;<br>        e.print<span class="hljs-constructor">StackTrace()</span>;<br>    &#125;<br>    <span class="hljs-comment">//测试base64</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        long start = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> ;<br>        String encryStr = <span class="hljs-string">""</span> ;<br>        String decryStr = <span class="hljs-string">""</span> ;<br><br>        for(<span class="hljs-built_in">int</span> i= <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10000</span> ; i++) &#123;<br>            encryStr = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Base64</span>.</span></span>encode<span class="hljs-constructor">Base64String(<span class="hljs-params">bytes</span>)</span> ;<br>            decryStr = <span class="hljs-keyword">new</span> <span class="hljs-constructor">String(Base64.<span class="hljs-params">decodeBase64</span>(<span class="hljs-params">encryStr</span>.<span class="hljs-params">getBytes</span>()</span>) );<br>        &#125;<br>        print(<span class="hljs-string">"base64: "</span> + (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span> - start ) + <span class="hljs-string">" ms "</span> +  encryStr  + <span class="hljs-string">" | "</span> + decryStr) ;<br>        &#125; catch (Exception e) &#123;<br>            e.print<span class="hljs-constructor">StackTrace()</span>;<br>        &#125;<br>    &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>结论：<br>hex编码速度快，体积大；base64编码速度慢，体积小</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104785166&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;hex（base16）、base32、base64三种
      
    
    </summary>
    
    
      <category term="编码" scheme="http://lewis.qi.tk/categories/%E7%BC%96%E7%A0%81/"/>
    
    
      <category term="编码" scheme="http://lewis.qi.tk/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>node.js语法以及npm、webpack打包</title>
    <link href="http://lewis.qi.tk/2020/05/16/node-js%E8%AF%AD%E6%B3%95%E4%BB%A5%E5%8F%8Anpm%E3%80%81webpack%E6%89%93%E5%8C%85/"/>
    <id>http://lewis.qi.tk/2020/05/16/node-js%E8%AF%AD%E6%B3%95%E4%BB%A5%E5%8F%8Anpm%E3%80%81webpack%E6%89%93%E5%8C%85/</id>
    <published>2020-05-16T11:33:28.000Z</published>
    <updated>2020-05-16T11:37:11.445Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/104722319" target="_blank" rel="noopener">node.js语法以及npm、webpack打包</a></p><p>异步编程的直接体现就是回调,处理大量的并发请求<br>一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作</p><h2 id="cmd（npm、node-js）"><a href="#cmd（npm、node-js）" class="headerlink" title="cmd（npm、node.js）"></a>cmd（npm、node.js）</h2><p>允许用户从NPM服务器下载别人编写的第三方包到本地使用。<br>允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。<br>允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。  </p><h3 id="1-查看版本"><a href="#1-查看版本" class="headerlink" title="1.查看版本"></a>1.查看版本</h3><p>node-v<br>npm -v</p><h3 id="2-npm-命令来升级"><a href="#2-npm-命令来升级" class="headerlink" title="2.npm 命令来升级"></a>2.npm 命令来升级</h3><p>sudo npm install npm -g<br>npm install npm -g</p><hr><p>在E:\webpack-demo新建文件如webpack-test并进入<br>cd E:\webpack-demo\webpack-test  </p><h3 id="3-创建一个新的本地项目目录名为webpack-demo"><a href="#3-创建一个新的本地项目目录名为webpack-demo" class="headerlink" title="3.创建一个新的本地项目目录名为webpack-demo"></a>3.创建一个新的本地项目目录名为webpack-demo</h3><p>mkdir webpack-test</p><h3 id="4-进入目录"><a href="#4-进入目录" class="headerlink" title="4.进入目录"></a>4.进入目录</h3><p>cd webpack-test</p><h3 id="5-安装webpack"><a href="#5-安装webpack" class="headerlink" title="5.安装webpack"></a>5.安装webpack</h3><p>(安装最新版本) + <a href="mailto:webpack@4.41.6">webpack@4.41.6</a><br>npm install –save-dev webpack<br>(安装你需要的版本)<br>npm install –save-dev <a href="mailto:webpack@3.12.0">webpack@3.12.0</a></p><h3 id="6-安装webpack-cli-webpack-cli-3-3-11"><a href="#6-安装webpack-cli-webpack-cli-3-3-11" class="headerlink" title="6.安装webpack-cli  + webpack-cli@3.3.11"></a>6.安装webpack-cli  + <a href="mailto:webpack-cli@3.3.11">webpack-cli@3.3.11</a></h3><p>npm install –save-dev webpack-cli</p><h3 id="7-引入依赖（打包）"><a href="#7-引入依赖（打包）" class="headerlink" title="7.引入依赖（打包）"></a>7.引入依赖（打包）</h3><ul><li>安装一个要打包到<strong>生产环境</strong>的安装包<br>使用 npm install –save</li><li>安装一个用于<strong>开发环境</strong>的安装包（例如，linter, 测试库等）<br>使用 npm install –save-dev</li></ul><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>要在 index.js 中打包 <strong>lodash 依赖</strong>，我们需要在本地安装 library：<br>(注意更改package.json不要有//之类的注释)<br>npm install –save lodash  </p><h3 id="8-更新-index-html-文件"><a href="#8-更新-index-html-文件" class="headerlink" title="8.更新 index.html 文件"></a>8.更新 index.html 文件</h3><p>现在，由于通过打包来合成脚本，我们必须更新 index.html 文件。<br>因为现在是通过 import 引入 lodash，所以将 lodash &lt;script&gt; 删除，<br>然后修改另一个 &lt;script&gt; 标签来加载 bundle，而不是原始的 /src 文件：</p><h3 id="9-将我们的脚本作为入口起点"><a href="#9-将我们的脚本作为入口起点" class="headerlink" title="9.将我们的脚本作为入口起点"></a>9.将我们的脚本作为入口起点</h3><p>npx webpack<br>然后输出为 main.js</p><h3 id="10-删除"><a href="#10-删除" class="headerlink" title="10.删除"></a>10.删除</h3><p>1.删除全局webpack-cli<br>npm uninstall -g webpack-cli<br>2.删除全局webpack<br>npm uninstall -g webpack<br>3.删除本地（局部）webpack-cli<br>npm uninstall webpack-cli<br>4.删除本地webpack<br>npm un webpack<br>5.检查webpack残余文件<br>rm -rf node_modules package-lock.json package.json  </p><hr><h3 id="1-创建package-json文件"><a href="#1-创建package-json文件" class="headerlink" title="1.创建package.json文件"></a>1.创建package.json文件</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs stata"><span class="hljs-comment">//1.手动输  </span><br>npm init  <br><span class="hljs-comment">//2.自动建立package.json(-y 的含义:在init的时候省去了敲回车的步骤，少用)  </span><br>npm init -y<br>会出现warn警告1：<br><span class="hljs-keyword">No</span> description: 这个警告是说这个项目的描述为空<br>会出现warn警告2：<br><span class="hljs-keyword">No</span> repository field：这个警告就是说git仓库字段没有设置<br>可以添加<br>&#123;<br>    ....<br>    <span class="hljs-string">"scripts"</span>: &#123;<br>        <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"</span><span class="hljs-keyword">Error</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">test</span> specified\<span class="hljs-string">" &amp;&amp; exit 1"</span><br>      &#125;,<br>     <span class="hljs-string">"private"</span>: true, #加这个声明私有<br>    <span class="hljs-string">"author"</span>: <span class="hljs-string"><code class="language-hljs stata"><span class="hljs-comment">//1.手动输  </span><br>npm init  <br><span class="hljs-comment">//2.自动建立package.json(-y 的含义:在init的时候省去了敲回车的步骤，少用)  </span><br>npm init -y<br>会出现warn警告1：<br><span class="hljs-keyword">No</span> description: 这个警告是说这个项目的描述为空<br>会出现warn警告2：<br><span class="hljs-keyword">No</span> repository field：这个警告就是说git仓库字段没有设置<br>可以添加<br>&#123;<br>    ....<br>    <span class="hljs-string">"scripts"</span>: &#123;<br>        <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"</span><span class="hljs-keyword">Error</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">test</span> specified\<span class="hljs-string">" &amp;&amp; exit 1"</span><br>      &#125;,<br>     <span class="hljs-string">"private"</span>: true, #加这个声明私有<br>    <span class="hljs-string">"author"</span>: <span class="hljs-string">"xxxx"</span>,<br>    ....<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>Package.json属性说明:位于 node_modules/express/package.json 内容</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs properties"><span class="hljs-attr">name</span>            <span class="hljs-string">包名。</span><br><span class="hljs-attr">version</span>         <span class="hljs-string">包的版本号。</span><br><span class="hljs-attr">description</span>     <span class="hljs-string">包的描述。</span><br><span class="hljs-attr">homepage</span>        <span class="hljs-string">包的官网 url 。</span><br><span class="hljs-attr">author</span>          <span class="hljs-string">包的作者姓名。</span><br><span class="hljs-attr">contributors</span>    <span class="hljs-string">包的其他贡献者姓名。</span><br><span class="hljs-attr">dependencies</span>    <span class="hljs-string">依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module目录下。</span><br><span class="hljs-attr">repository</span>      <span class="hljs-string">包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。</span><br><span class="hljs-attr">main</span>            <span class="hljs-string">指定了程序的主入口文件，require('moduleName') 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。</span><br><span class="hljs-attr">keywords</span>        <span class="hljs-string"><code class="language-hljs properties"><span class="hljs-attr">name</span>            <span class="hljs-string">包名。</span><br><span class="hljs-attr">version</span>         <span class="hljs-string">包的版本号。</span><br><span class="hljs-attr">description</span>     <span class="hljs-string">包的描述。</span><br><span class="hljs-attr">homepage</span>        <span class="hljs-string">包的官网 url 。</span><br><span class="hljs-attr">author</span>          <span class="hljs-string">包的作者姓名。</span><br><span class="hljs-attr">contributors</span>    <span class="hljs-string">包的其他贡献者姓名。</span><br><span class="hljs-attr">dependencies</span>    <span class="hljs-string">依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module目录下。</span><br><span class="hljs-attr">repository</span>      <span class="hljs-string">包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。</span><br><span class="hljs-attr">main</span>            <span class="hljs-string">指定了程序的主入口文件，require('moduleName') 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。</span><br><span class="hljs-attr">keywords</span>        <span class="hljs-string">关键字</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-安装模块【可以通过-require-来引入本地安装的包】"><a href="#2-安装模块【可以通过-require-来引入本地安装的包】" class="headerlink" title="2.安装模块【可以通过 require() 来引入本地安装的包】"></a>2.安装模块【可以通过 require() 来引入本地安装的包】</h3><p>npm install &lt;Module Name模块名&gt;      (本地安装)<br>npm install &lt;Module Name模块名&gt;  -g  (全局安装)<br>//express 包就放在了工程目录下的 node_modules 目录中<br>安装：npm install express<br>调用：var express = require(‘express’);  </p><p>注：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql">我自己在项目的本地总共安装了这些<br>npm <span class="hljs-keyword">install</span> express             //路由、<span class="hljs-keyword">HTTP</span>帮助程序（重定向，缓存等）<br>npm <span class="hljs-keyword">install</span> fs                  //文件<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">http</span>                //开发<span class="hljs-keyword">HTTP</span>服务器程序<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">url</span>                 //解析<span class="hljs-keyword">URL</span><br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">path</span>                //处理本地文件目录<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">http</span>-<span class="hljs-keyword">server</span><br>npm <span class="hljs-keyword">install</span> crypto              //提供通用的加密和哈希算法<br>npm <span class="hljs-keyword">install</span> stream              //提供的仅在服务区端可用的模块,支持“流”这种数据结构<br>npm <span class="hljs-keyword"><code class="language-hljs sql">我自己在项目的本地总共安装了这些<br>npm <span class="hljs-keyword">install</span> express             //路由、<span class="hljs-keyword">HTTP</span>帮助程序（重定向，缓存等）<br>npm <span class="hljs-keyword">install</span> fs                  //文件<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">http</span>                //开发<span class="hljs-keyword">HTTP</span>服务器程序<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">url</span>                 //解析<span class="hljs-keyword">URL</span><br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">path</span>                //处理本地文件目录<br>npm <span class="hljs-keyword">install</span> <span class="hljs-keyword">http</span>-<span class="hljs-keyword">server</span><br>npm <span class="hljs-keyword">install</span> crypto              //提供通用的加密和哈希算法<br>npm <span class="hljs-keyword">install</span> stream              //提供的仅在服务区端可用的模块,支持“流”这种数据结构<br>npm <span class="hljs-keyword">install</span> steam<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3-查看、卸载、更新、搜索模块"><a href="#3-查看、卸载、更新、搜索模块" class="headerlink" title="3.查看、卸载、更新、搜索模块"></a>3.查看、卸载、更新、搜索模块</h3><p>（以express模块举例）<br>查看所有全局安装的模块：<br>npm list -g<br>查看某个模块的版本号：<br>npm list express<br>卸载模块<br>npm uninstall express<br>卸载后，你可以到 /node_modules/ 目录下查看包是否还存在<br>npm ls<br>更新模块<br>npm update express<br>搜索模块<br>npm search express<br>启动模块<br>npm start  xxx<br>停止模块<br>npm stop  xxx  </p><h3 id="创建自己的模块"><a href="#创建自己的模块" class="headerlink" title="创建自己的模块"></a>创建自己的模块</h3><p>在 npm 资源库中注册用户（使用邮箱注册）<br>npm adduser<br>发布模块<br>npm publish<br>然后就可以安装自己的模块<br>npm install xxxxx</p><h3 id="3-创建-Node-js-应用"><a href="#3-创建-Node-js-应用" class="headerlink" title="3.创建 Node.js 应用"></a>3.创建 Node.js 应用</h3><ul><li>引入 required 模块，将实例化的 HTTP 赋值给变量 http  <blockquote><p>var http = require(“http”);  </p></blockquote></li><li>创建HTTP服务器<blockquote><p>http.createServer(function (request, response) {<br>  // 发送 HTTP 头部 （HTTP 状态值: 200 : OK 和 内容类型: text/plain）<br>  response.writeHead(200, {‘Content-Type’: ‘text/plain’});<br>  // 发送响应数据 “Hello World”<br>  response.end(‘Hello World\n’);<br>}).listen(8888);  </p></blockquote></li><li>终端打印如下信息<blockquote><p>console.log(‘Server running at <a href="http://127.0.0.1:8888/&#39;" target="_blank" rel="noopener">http://127.0.0.1:8888/&#39;</a>);</p></blockquote></li></ul><p>如下：<br>server.js  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    response.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>&#125;);<br>    response.end(<span class="hljs-string">'Hello World\n'</span>);<br>&#125;).listen(<span class="hljs-number">8888</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    response.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>&#125;);<br>    response.end(<span class="hljs-string">'Hello World\n'</span>);<br>&#125;).listen(<span class="hljs-number">8888</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running at http://127.0.0.1:8888/'</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="4-node-命令"><a href="#4-node-命令" class="headerlink" title="4. node 命令"></a>4. node 命令</h2><p>node server.js<br>再打开<a href="http://127.0.0.1:8888/，即可看到Hello" target="_blank" rel="noopener">http://127.0.0.1:8888/，即可看到Hello</a> World</p><hr><h2 id="Node-js-REPL-交互式解释器"><a href="#Node-js-REPL-交互式解释器" class="headerlink" title="Node.js REPL(交互式解释器)"></a>Node.js REPL(交互式解释器)</h2><p>1.启动 Node 的终端<br>node  </p><p>2.使用 var 关键字的变量可以使用 console.log() 来输出变量  </p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs crmsh">$ <span class="hljs-keyword">node</span><span class="hljs-title"></span><br><span class="hljs-title">&gt; x</span> = <span class="hljs-number">10</span><br><span class="hljs-number">10</span><br>&gt; var y = <span class="hljs-number"><code class="language-hljs crmsh">$ <span class="hljs-keyword">node</span><span class="hljs-title"></span><br><span class="hljs-title">&gt; x</span> = <span class="hljs-number">10</span><br><span class="hljs-number">10</span><br>&gt; var y = <span class="hljs-number">10</span><br>undefined<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>3.使用下划线(_)获取上一个表达式的运算结果</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gml">&gt; <span class="hljs-symbol">x</span> + <span class="hljs-symbol">y</span><br><span class="hljs-number">30</span><br>&gt; <span class="hljs-keyword">var</span> sum = _<br><span class="hljs-literal"><code class="language-hljs gml">&gt; <span class="hljs-symbol">x</span> + <span class="hljs-symbol">y</span><br><span class="hljs-number">30</span><br>&gt; <span class="hljs-keyword">var</span> sum = _<br><span class="hljs-literal">undefined</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs crmsh">ctrl + c                退出当前终端。<br>ctrl + c 按下两次        退出 <span class="hljs-keyword">Node</span> <span class="hljs-title">REPL</span>。<br>ctrl + d                退出 <span class="hljs-keyword">Node</span> <span class="hljs-title"><code class="language-hljs crmsh">ctrl + c                退出当前终端。<br>ctrl + c 按下两次        退出 <span class="hljs-keyword">Node</span> <span class="hljs-title">REPL</span>。<br>ctrl + d                退出 <span class="hljs-keyword">Node</span> <span class="hljs-title">REPL</span>.<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>回调函数callbak一般作为函数的最后一个参数出现<br>function foo1(name, age, callback) { }<br>function foo2(value, callback1, callback2) { }</p><h2 id="基本模块"><a href="#基本模块" class="headerlink" title="基本模块"></a>基本模块</h2><p><strong>在Node环境中，一个.js文件就称之为一个模块</strong></p><h3 id="color-red-1-自定义模块"><a href="#color-red-1-自定义模块" class="headerlink" title="$\color{red}1.自定义模块$"></a>$\color{red}1.自定义模块$</h3><ul><li>一个模块想要对外暴露变量（函数也是变量）<br> module.exports = variable;</li><li>一个模块要引用其他模块暴露的变量<br> var ref = require(‘module_name模块名’); 或<br> var ref = require(‘path_name相对目录名’);</li><li>原理：<strong>支持闭包</strong>。<ul><li>如果我们把一段JavaScript代码用一个函数包装起来，这段代码的<strong>所有“全局”变量就变成了函数内部的局部变量</strong></li></ul></li></ul><p>实例：</p><p>hello.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> s = <span class="hljs-string">'Hello'</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">greet</span>(<span class="hljs-params">name</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(s + <span class="hljs-string">', '</span> + name + <span class="hljs-string">'!'</span>);<br>&#125;<br><span class="hljs-built_in">module</span>.exports = greet;   <span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> s = <span class="hljs-string">'Hello'</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">greet</span>(<span class="hljs-params">name</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(s + <span class="hljs-string">', '</span> + name + <span class="hljs-string">'!'</span>);<br>&#125;<br><span class="hljs-built_in">module</span>.exports = greet;   <span class="hljs-comment">//对外暴露变量(greet函数名)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-comment">// 引入hello模块,引入的模块作为变量保存在greet变量中</span><br><span class="hljs-keyword">var</span> greet = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./hello'</span>);  <br><span class="hljs-keyword">var</span> s = <span class="hljs-string">'world'</span>;<br>greet(s); <span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-comment">// 引入hello模块,引入的模块作为变量保存在greet变量中</span><br><span class="hljs-keyword">var</span> greet = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./hello'</span>);  <br><span class="hljs-keyword">var</span> s = <span class="hljs-string">'world'</span>;<br>greet(s); <span class="hljs-comment">// s使用hello.js内的函数，输出Hello, world!</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="color-red-2-fs模块"><a href="#color-red-2-fs模块" class="headerlink" title="$\color{red}2.fs模块$"></a>$\color{red}2.fs模块$</h3><p>fs模块就是文件系统模块，负责读写文件。同时提供了异步和同步的方法</p><p>1.异步读文本文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;               <span class="hljs-comment">//js的严格模式</span><br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.readFile(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;               <span class="hljs-comment">//js的严格模式</span><br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.readFile(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(data);<br>    &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：</p><ul><li>sample.txt文件必须在当前目录下，且文件编码为utf-8</li><li>当正常读取时，err参数为null，data参数为读取到的String</li><li>当读取发生错误时，err参数代表一个错误对象，data为undefined</li></ul><p>2.异步读二进制文件（图片）  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.readFile(<span class="hljs-string">'sample.png'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(data);<br>        <span class="hljs-built_in">console</span>.log(data.length + <span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.readFile(<span class="hljs-string">'sample.png'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(data);<br>        <span class="hljs-built_in">console</span>.log(data.length + <span class="hljs-string">' bytes'</span>);<br>    &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：</p><ul><li>回调函数的data参数将返回一个Buffer对象，是一个包含零个或任意个字节的数组（注意和Array不同）</li><li>Buffer对象转换成String<blockquote><p>// Buffer -&gt; String<br>var text = data.toString(‘utf-8’);<br>console.log(text);  </p></blockquote></li><li>String转换成Buffer<blockquote><p>// String -&gt; Buffer<br>var buf = Buffer.from(text, ‘utf-8’);<br>console.log(buf);  </p></blockquote></li></ul><p>3.同步读文件(少用)<br>多了一个Sync后缀，并且不接收回调函数，函数直接返回结果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">var</span> data = fs.readFileSync(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>    <span class="hljs-built_in">console</span>.log(data);<br>&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-comment"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">var</span> data = fs.readFileSync(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>    <span class="hljs-built_in">console</span>.log(data);<br>&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-comment">// 出错了</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>4.异步写文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-keyword">var</span> data = <span class="hljs-string">'Hello, Node.js'</span>;<br>fs.writeFile(<span class="hljs-string">'output.txt'</span>, data, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-keyword">var</span> data = <span class="hljs-string">'Hello, Node.js'</span>;<br>fs.writeFile(<span class="hljs-string">'output.txt'</span>, data, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ok.'</span>);<br>    &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：  </p><ul><li>参数依次为文件名、数据和回调函数</li><li>回调函数由于只关心成功与否，因此只需要一个err参数</li></ul><p>5.异步写文件（忽略）</p><p>6.获取文件大小，创建时间等信息</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.stat(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stat</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 是否是文件:</span><br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'isFile: '</span> + stat.isFile());<br>        <span class="hljs-comment">// 是否是目录:</span><br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'isDirectory: '</span> + stat.isDirectory());<br>        <span class="hljs-keyword">if</span> (stat.isFile()) &#123;<br>            <span class="hljs-comment">// 文件大小:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'size: '</span> + stat.size);<br>            <span class="hljs-comment">// 创建时间, Date对象:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'birth time: '</span> + stat.birthtime);<br>            <span class="hljs-comment">// 修改时间, Date对象:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br>fs.stat(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stat</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">console</span>.log(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 是否是文件:</span><br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'isFile: '</span> + stat.isFile());<br>        <span class="hljs-comment">// 是否是目录:</span><br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'isDirectory: '</span> + stat.isDirectory());<br>        <span class="hljs-keyword">if</span> (stat.isFile()) &#123;<br>            <span class="hljs-comment">// 文件大小:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'size: '</span> + stat.size);<br>            <span class="hljs-comment">// 创建时间, Date对象:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'birth time: '</span> + stat.birthtime);<br>            <span class="hljs-comment">// 修改时间, Date对象:</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'modified time: '</span> + stat.mtime);<br>        &#125;<br>    &#125;<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：使用fs.stat()，它返回一个Stat对象，能告诉我们文件或目录的详细信息</p><h3 id="color-red-3-stream模块（主要是fs模块）"><a href="#color-red-3-stream模块（主要是fs模块）" class="headerlink" title="$\color{red}3.stream模块（主要是fs模块）$"></a>$\color{red}3.stream模块（主要是fs模块）$</h3><p>标准输出流（stdout）。<br>流的特点是数据是有序的，而且必须<strong>依次读取，或者依次写入</strong>，不能像Array那样随机定位.<br>流也是一个对象</p><ul><li>data事件表示流的数据已经可以读取<ul><li>data事件可能会有多次，每次传递的chunk是流的一部分数据</li></ul></li><li>end事件表示这个流已经到末尾了</li><li>error事件表示出错了</li><li>所有可以<strong>读取</strong>数据的流都继承自stream.Readable</li><li>所有可以<strong>写入</strong>数据的流都继承自stream.Writable</li><li>一个Readable流和一个Writable流串起来后，所有的数据自动从Readable流进入Writable流，这种操作为<strong>pipe()方法</strong></li></ul><p>1.文件流读取文本</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-comment">// 打开一个流:</span><br><span class="hljs-keyword">var</span> rs = fs.createReadStream(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>rs.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'DATA:'</span>)<br>    <span class="hljs-built_in">console</span>.log(chunk);<br>&#125;);<br>rs.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'END'</span>);<br>&#125;);<br>rs.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-comment">// 打开一个流:</span><br><span class="hljs-keyword">var</span> rs = fs.createReadStream(<span class="hljs-string">'sample.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>rs.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'DATA:'</span>)<br>    <span class="hljs-built_in">console</span>.log(chunk);<br>&#125;);<br>rs.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'END'</span>);<br>&#125;);<br>rs.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ERROR: '</span> + err);<br>&#125;);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>2.文件流写入文本，不断调用write()方法，最后以end()结束</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> ws1 = fs.createWriteStream(<span class="hljs-string">'output1.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>ws1.write(<span class="hljs-string">'使用Stream写入文本数据...\n'</span>);<br>ws1.write(<span class="hljs-string">'END.'</span>);<br>ws1.end();<br><br><span class="hljs-keyword">var</span> ws2 = fs.createWriteStream(<span class="hljs-string">'output2.txt'</span>);<br>ws2.write(<span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'使用Stream写入二进制数据...\n'</span>, <span class="hljs-string">'utf-8'</span>));<br>ws2.write(<span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'END.'</span>, <span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> ws1 = fs.createWriteStream(<span class="hljs-string">'output1.txt'</span>, <span class="hljs-string">'utf-8'</span>);<br>ws1.write(<span class="hljs-string">'使用Stream写入文本数据...\n'</span>);<br>ws1.write(<span class="hljs-string">'END.'</span>);<br>ws1.end();<br><br><span class="hljs-keyword">var</span> ws2 = fs.createWriteStream(<span class="hljs-string">'output2.txt'</span>);<br>ws2.write(<span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'使用Stream写入二进制数据...\n'</span>, <span class="hljs-string">'utf-8'</span>));<br>ws2.write(<span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'END.'</span>, <span class="hljs-string">'utf-8'</span>));<br>ws2.end();<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>3.读取源文件的所有数据都自动写入到目标文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> rs = fs.createReadStream(<span class="hljs-string">'sample.txt'</span>);<br><span class="hljs-keyword">var</span> ws = fs.createWriteStream(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><br><span class="hljs-keyword">var</span> rs = fs.createReadStream(<span class="hljs-string">'sample.txt'</span>);<br><span class="hljs-keyword">var</span> ws = fs.createWriteStream(<span class="hljs-string">'copied.txt'</span>);<br><br>rs.pipe(ws);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="color-red-4-http模块（包含path、url模块）"><a href="#color-red-4-http模块（包含path、url模块）" class="headerlink" title="$\color{red}4.http模块（包含path、url模块）$"></a>$\color{red}4.http模块（包含path、url模块）$</h3><p>提供的request和response对象</p><ul><li>request对象封装了HTTP请求，调用request对象属性和方法可以拿到所有HTTP请求信息</li><li>response对象封装了HTTP响应，操作response对象方法，可以把HTTP响应返回给浏览器</li></ul><p>1.Web程序</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript">hello.js<br><br><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br><span class="hljs-comment">// 创建http server，并传入回调函数:</span><br><span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    <span class="hljs-comment">// 回调函数接收request和response对象,</span><br>    <span class="hljs-comment">// 获得HTTP请求的method和url:</span><br>    <span class="hljs-built_in">console</span>.log(request.method + <span class="hljs-string">': '</span> + request.url);<br>    <span class="hljs-comment">// 将HTTP响应200写入response, 同时设置Content-Type: text/html:</span><br>    response.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span>&#125;);<br>    <span class="hljs-comment">// 将HTTP响应的HTML内容写入response:</span><br>    response.end(<span class="hljs-string">'&lt;h1&gt;Hello world!&lt;/h1&gt;'</span>);<br>&#125;);<br>server.listen(<span class="hljs-number">8080</span>);           <span class="hljs-comment">// 让服务器监听8080端口:</span><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript">hello.js<br><br><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br><span class="hljs-comment">// 创建http server，并传入回调函数:</span><br><span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    <span class="hljs-comment">// 回调函数接收request和response对象,</span><br>    <span class="hljs-comment">// 获得HTTP请求的method和url:</span><br>    <span class="hljs-built_in">console</span>.log(request.method + <span class="hljs-string">': '</span> + request.url);<br>    <span class="hljs-comment">// 将HTTP响应200写入response, 同时设置Content-Type: text/html:</span><br>    response.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span>&#125;);<br>    <span class="hljs-comment">// 将HTTP响应的HTML内容写入response:</span><br>    response.end(<span class="hljs-string">'&lt;h1&gt;Hello world!&lt;/h1&gt;'</span>);<br>&#125;);<br>server.listen(<span class="hljs-number">8080</span>);           <span class="hljs-comment">// 让服务器监听8080端口:</span><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server is running at http://127.0.0.1:8080/'</span>);<br><br>再node hello.js 输出<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>2.文件服务器(url和path模块)</p><p>将一个字符串解析为一个Url对象：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);<br><span class="hljs-built_in">console</span>.log(url.parse(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);<br><span class="hljs-built_in">console</span>.log(url.parse(<span class="hljs-string">'http://user:pass@host.com:8080/path/to/file?query=string#hash'</span>));<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>构造目录：<br>这样，我们就不关心怎么拼接路径了</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);<br><span class="hljs-keyword">var</span> workDir = path.resolve(<span class="hljs-string">'.'</span>); <span class="hljs-comment">// 解析当前目录:为'/Users/michael'</span><br><span class="hljs-comment">// 组合完整文件路径:当前目录+'pub'+'index.html':为'/Users/michael/pub/index.html'</span><br><span class="hljs-keyword">var</span> filePath = path.join(workDir, <span class="hljs-string">'pub'</span>, <span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);<br><span class="hljs-keyword">var</span> workDir = path.resolve(<span class="hljs-string">'.'</span>); <span class="hljs-comment">// 解析当前目录:为'/Users/michael'</span><br><span class="hljs-comment">// 组合完整文件路径:当前目录+'pub'+'index.html':为'/Users/michael/pub/index.html'</span><br><span class="hljs-keyword">var</span> filePath = path.join(workDir, <span class="hljs-string">'pub'</span>, <span class="hljs-string">'index.html'</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>实现一个文件服务器：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span><br>    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>),<br>    url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>),<br>    path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>),<br>    http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br><span class="hljs-comment">// 从命令行参数获取root目录，默认是当前目录:</span><br><span class="hljs-keyword">var</span> root = path.resolve(process.argv[<span class="hljs-number">2</span>] || <span class="hljs-string">'.'</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'静态根目录: '</span> + root);<br><span class="hljs-comment">// 创建服务器:</span><br><span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    <span class="hljs-comment">// 获得URL的path，类似 '/css/bootstrap.css':</span><br>    <span class="hljs-keyword">var</span> pathname = url.parse(request.url).pathname;<br>    <span class="hljs-comment">// 获得对应的本地文件路径，类似 '/srv/www/css/bootstrap.css':</span><br>    <span class="hljs-keyword">var</span> filepath = path.join(root, pathname);<br>    <span class="hljs-comment">// 获取文件状态:</span><br>    fs.stat(filepath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stats</span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!err &amp;&amp; stats.isFile()) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'200 '</span> + request.url);              <span class="hljs-comment">// 没有出错并且文件存在:</span><br>            response.writeHead(<span class="hljs-number">200</span>);                        <span class="hljs-comment">// 发送200响应:</span><br>            fs.createReadStream(filepath).pipe(response);   <span class="hljs-comment">// 将文件流导向response:</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'404 '</span> + request.url);              <span class="hljs-comment">// 出错了或者文件不存在:</span><br>            response.writeHead(<span class="hljs-number">404</span>);                        <span class="hljs-comment">// 发送404响应:</span><br>            response.end(<span class="hljs-string">'404 Not Found'</span>);<br>        &#125;<br>    &#125;);<br>&#125;);<br>server.listen(<span class="hljs-number">8080</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string"><code class="language-hljs javascript"><span class="hljs-meta">'use strict'</span>;<br><span class="hljs-keyword">var</span><br>    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>),<br>    url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>),<br>    path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>),<br>    http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br><span class="hljs-comment">// 从命令行参数获取root目录，默认是当前目录:</span><br><span class="hljs-keyword">var</span> root = path.resolve(process.argv[<span class="hljs-number">2</span>] || <span class="hljs-string">'.'</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'静态根目录: '</span> + root);<br><span class="hljs-comment">// 创建服务器:</span><br><span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br>    <span class="hljs-comment">// 获得URL的path，类似 '/css/bootstrap.css':</span><br>    <span class="hljs-keyword">var</span> pathname = url.parse(request.url).pathname;<br>    <span class="hljs-comment">// 获得对应的本地文件路径，类似 '/srv/www/css/bootstrap.css':</span><br>    <span class="hljs-keyword">var</span> filepath = path.join(root, pathname);<br>    <span class="hljs-comment">// 获取文件状态:</span><br>    fs.stat(filepath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stats</span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!err &amp;&amp; stats.isFile()) &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'200 '</span> + request.url);              <span class="hljs-comment">// 没有出错并且文件存在:</span><br>            response.writeHead(<span class="hljs-number">200</span>);                        <span class="hljs-comment">// 发送200响应:</span><br>            fs.createReadStream(filepath).pipe(response);   <span class="hljs-comment">// 将文件流导向response:</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'404 '</span> + request.url);              <span class="hljs-comment">// 出错了或者文件不存在:</span><br>            response.writeHead(<span class="hljs-number">404</span>);                        <span class="hljs-comment">// 发送404响应:</span><br>            response.end(<span class="hljs-string">'404 Not Found'</span>);<br>        &#125;<br>    &#125;);<br>&#125;);<br>server.listen(<span class="hljs-number">8080</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server is running at http://127.0.0.1:8080/'</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>注：运行node file_server.js /path/to/dir，把/path/to/dir改成你本地的一个有效的目录，然后在浏览器中输入<a href="http://localhost:8080/index.html，只要当前目录下存在文件index.html，服务器就可以把文件内容发送给浏览器。" target="_blank" rel="noopener">http://localhost:8080/index.html，只要当前目录下存在文件index.html，服务器就可以把文件内容发送给浏览器。</a></p><h3 id="color-red-5-crypto模块"><a href="#color-red-5-crypto模块" class="headerlink" title="$\color{red}5.crypto模块$"></a>$\color{red}5.crypto模块$</h3><p>。。。。</p><hr><p>这是我的学习笔记，待续（详见廖雪峰的官方网站）</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/104722319&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;node.js语法以及npm、webpack打包&lt;/a
      
    
    </summary>
    
    
      <category term="nodejs" scheme="http://lewis.qi.tk/categories/nodejs/"/>
    
    
      <category term="nodejs" scheme="http://lewis.qi.tk/tags/nodejs/"/>
    
      <category term="npm" scheme="http://lewis.qi.tk/tags/npm/"/>
    
      <category term="webpack" scheme="http://lewis.qi.tk/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>nginx基本结构分析</title>
    <link href="http://lewis.qi.tk/2020/05/16/nginx%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/"/>
    <id>http://lewis.qi.tk/2020/05/16/nginx%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/</id>
    <published>2020-05-16T11:26:13.000Z</published>
    <updated>2020-05-16T11:31:48.386Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105583416" target="_blank" rel="noopener">nginx基本结构分析</a></p><h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><p>源码的安装一般由有这三个步骤：配置(configure)、编译(make)、安装(make install)<br>端口默认80<br>windows语法路径：<br>Linux语法路径：/<br>【注意，不管什么系统，nginx的路径都是<code>/</code>】</p><p>nginx是轻量级的Web服务器、反向代理服务器、电子邮件（IMAP、POP3）代理服务器。占用内存小、并发能力强</p><p>在低并发时，用户可以直接访问Tomcat服务器，然后Tomcat服务器返回消息给用户【单个tomcat服务器IP是有限制的】</p><p><code>nginx</code>：高并发、高性能、热部署（修改时不需要把服务器关闭）</p><p><code>PCRE</code> ：<strong>让 Nginx 支持 Rewrite 功能。</strong></p><h2 id="高并发"><a href="#高并发" class="headerlink" title="高并发"></a>高并发</h2><ul><li>响应时间<ul><li>如处理一个请求200ms</li></ul></li><li>吞吐量<ul><li>每秒处理的请求数量</li></ul></li><li>QPS<ul><li>每秒响应的请求数量</li></ul></li><li>并发用户数<ul><li>同时承载使用功能的用户数</li></ul></li></ul><h2 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h2><p>正向代理：<br>内网里不能直接访问外网的谷歌，可以借助VNP。。。来实现。</p><ul><li>正向代理“代理”的是$\color{red}客户端$，而且客户端是知道目标的，但目标是不知道客户端是通过VPN访问的。</li></ul><p>反向代理：<br>外网访问百度时，其实会进行一个转发，代理到内网去。</p><ul><li>反向代理“代理”的是$\color{red}服务器端$，而且这一个过程对于客户端而言是透明的</li></ul><p>Master进程的作用:</p><ul><li>读取并验证配置文件nginx.conf；管理worker进程；</li></ul><p>Worker进程的作用是？</p><ul><li>每一个Worker进程都维护一个线程（避免线程切换），处理连接和请求</li><li>注意Worker进程的个数由配置文件决定，一般和CPU个数相关（有利于进程切换），配置几个就有几个Worker进程</li></ul><hr><h2 id="nginx-conf核心配置文件"><a href="#nginx-conf核心配置文件" class="headerlink" title="nginx.conf核心配置文件"></a>nginx.conf核心配置文件</h2><p>nginx.conf【简介】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">... #全局块<br>events &#123; #events块<br>...<br>&#125;<br><br>http #http块<br>&#123;<br>    ... #http全局块<br><br>    server #server块<br>    &#123;<br>        ... #server全局块<br>        location [PATTERN] #location块<br>        &#123;<br>            ...<br>        &#125;<br>        location [PATTERN]#location块<br>        &#123;<br>            ...<br>        &#125;<br>     &#125;<br><br>    server #server块<br>    &#123;<br>        ...<br>    &#125;<br><br>    ... #http全局块<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>nginx.conf【Windows完整】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"><br>#user  nobody;<br>worker_processes  1;<br><br>#error_log  logs&#x2F;error.log;<br>#error_log  logs&#x2F;error.log  notice;<br>#error_log  logs&#x2F;error.log  info;<br><br>#pid        logs&#x2F;nginx.pid;<br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br><br>http &#123;<br>    include       mime.types;<br>    default_type  application&#x2F;octet-stream;<br><br>    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '<br>    #                  '$status $body_bytes_sent "$http_referer" '<br>    #                  '"$http_user_agent" "$http_x_forwarded_for"';<br><br>    #access_log  logs&#x2F;access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br><br>        #charset koi8-r;<br><br>        #access_log  logs&#x2F;host.access.log  main;<br><br>        location &#x2F; &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br><br>        #error_page  404              &#x2F;404.html;<br><br>        # redirect server error pages to the static page &#x2F;50x.html<br>        #<br>        error_page   500 502 503 504  &#x2F;50x.html;<br>        location &#x3D; &#x2F;50x.html &#123;<br>            root   html;<br>        &#125;<br><br>        # proxy the PHP scripts to Apache listening on 127.0.0.1:80<br>        #<br>        #location ~ \.php$ &#123;<br>        #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;<br>        #&#125;<br><br>        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000<br>        #<br>        #location ~ \.php$ &#123;<br>        #    root           html;<br>        #    fastcgi_pass   127.0.0.1:9000;<br>        #    fastcgi_index  index.php;<br>        #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;<br>        #    include        fastcgi_params;<br>        #&#125;<br><br>        # deny access to .htaccess files, if Apache's document root<br>        # concurs with nginx's one<br>        #<br>        #location ~ &#x2F;\.ht &#123;<br>        #    deny  all;<br>        #&#125;<br>    &#125;<br><br><br>    # another virtual host using mix of IP-, name-, and port-based configuration<br>    #<br>    #server &#123;<br>    #    listen       8000;<br>    #    listen       somename:8080;<br>    #    server_name  somename  alias  another.alias;<br><br>    #    location &#x2F; &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br><br>    # HTTPS server<br>    #<br>    #server &#123;<br>    #    listen       443 ssl;<br>    #    server_name  localhost;<br><br>    #    ssl_certificate      cert.pem;<br>    #    ssl_certificate_key  cert.key;<br><br>    #    ssl_session_cache    shared:SSL:1m;<br>    #    ssl_session_timeout  5m;<br><br>    #    ssl_ciphers  HIGH:!aNULL:!MD5;<br>    #    ssl_prefer_server_ciphers  on;<br><br>    #    location &#x2F; &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>nginx.conf【Linux完整】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"># For more information on configuration, see:<br>#   * Official English Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;<br>#   * Official Russian Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;<br><br>user nginx;<br>worker_processes auto;<br>error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;<br>pid &#x2F;run&#x2F;nginx.pid;<br><br># Load dynamic modules. See &#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx&#x2F;README.dynamic.<br>include &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;modules&#x2F;*.conf;<br><br>events &#123;<br>    worker_connections 1024;<br>&#125;<br><br>http &#123;<br>    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '<br>                      '$status $body_bytes_sent "$http_referer" '<br>                      '"$http_user_agent" "$http_x_forwarded_for"';<br><br>    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;<br><br>    sendfile            on;<br>    tcp_nopush          on;<br>    tcp_nodelay         on;<br>    keepalive_timeout   65;<br>    types_hash_max_size 2048;<br><br>    include             &#x2F;etc&#x2F;nginx&#x2F;mime.types;<br>    default_type        application&#x2F;octet-stream;<br><br>    # Load modular configuration files from the &#x2F;etc&#x2F;nginx&#x2F;conf.d directory.<br>    # See http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;ngx_core_module.html#include<br>    # for more information.<br>    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;<br><br>    server &#123;<br>        listen       80 default_server;<br>        listen       [::]:80 default_server;<br>        server_name  _;<br>        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br><br>        # Load configuration files for the default server block.<br>        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br><br>        location &#x2F; &#123;<br>        &#125;<br><br>        error_page 404 &#x2F;404.html;<br>            location &#x3D; &#x2F;40x.html &#123;<br>        &#125;<br><br>        error_page 500 502 503 504 &#x2F;50x.html;<br>            location &#x3D; &#x2F;50x.html &#123;<br>        &#125;<br>    &#125;<br><br># Settings for a TLS enabled server.<br>#<br>#    server &#123;<br>#        listen       443 ssl http2 default_server;<br>#        listen       [::]:443 ssl http2 default_server;<br>#        server_name  _;<br>#        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br>#<br>#        ssl_certificate "&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;server.crt";<br>#        ssl_certificate_key "&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;private&#x2F;server.key";<br>#        ssl_session_cache shared:SSL:1m;<br>#        ssl_session_timeout  10m;<br>#        ssl_ciphers PROFILE&#x3D;SYSTEM;<br>#        ssl_prefer_server_ciphers on;<br>#<br>#        # Load configuration files for the default server block.<br>#        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br>#<br>#        location &#x2F; &#123;<br>#        &#125;<br>#<br>#        error_page 404 &#x2F;404.html;<br>#            location &#x3D; &#x2F;40x.html &#123;<br>#        &#125;<br>#<br>#        error_page 500 502 503 504 &#x2F;50x.html;<br>#            location &#x3D; &#x2F;50x.html &#123;<br>#        &#125;<br>#    &#125;<br><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="分析nginx-conf核心配置"><a href="#分析nginx-conf核心配置" class="headerlink" title="分析nginx.conf核心配置"></a>分析nginx.conf核心配置</h2><h3 id="全局块配置"><a href="#全局块配置" class="headerlink" title="全局块配置"></a>全局块配置</h3><ul><li>影响nginx全局的指令<ul><li>有运行nginx服务器的用户组</li><li>nginx进程pid存放路径</li><li>日志存放路径</li><li>配置文件引入</li><li>允许生成worker process</li></ul></li></ul><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">#user  nobody;                      #配置用户或组，默认nobody<br>#user www www;                      #定义Nginx运行的用户和用户组<br>worker_processes  1;                #允许生成的进程数，默认1<br><br>#error_log  logs&#x2F;error.log;         #制定日志路径和级别<br>                                    # http块，server块，级别为：debug|info|notice|warn|error|crit|alert|emerg<br>#error_log  logs&#x2F;error.log  notice;<br>#error_log  logs&#x2F;error.log  info;<br><br>#pid        logs&#x2F;nginx.pid;         #指定nginx进程运行文件存放地址<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="events块配置【工作模式及连接数上限】"><a href="#events块配置【工作模式及连接数上限】" class="headerlink" title="events块配置【工作模式及连接数上限】"></a>events块配置【工作模式及连接数上限】</h2><ul><li><p>影响nginx服务器或与用户的网络连接</p><ul><li>开启多个网络拦截序列化</li><li>一个进程是否允许同时接受多个网络连接</li><li>选取哪种事件驱动模型处理连接请求</li><li>每个进程的最大连接数</li></ul></li><li><p>参考事件模型（nginx针对不同的操作系统，有不同的事件模型）</p><ul><li><code>use [ kqueue | rtsig | epoll | /dev/poll | select | poll ];</code></li></ul></li></ul><p>A）高效事件模型</p><ul><li>Kqueue<ul><li>使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处理器的MacOS X系统使用kqueue可能会造成内核崩溃。</li></ul></li><li>Epoll<ul><li>使用于Linux内核2.6版本及以后的系统。</li></ul></li><li>/dev/poll<ul><li>使用于Solaris 7 11/99+，HP/UX 11.22+ (eventport)，IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。</li></ul></li><li>Eventport<ul><li>使用于Solaris 10。 为了防止出现内核崩溃的问题， 有必要</li></ul></li></ul><p>B）标准事件模型</p><ul><li>Select、poll属于标准事件模型<ul><li>如果当前系统不存在更有效的方法，nginx会选择select或poll</li></ul></li></ul><p>C) 选择</p><ul><li><p>linux建议epoll</p></li><li><p>FreeBSD建议kqueue</p></li><li><p>worker_connections单个进程最大连接数（最大连接数=连接数*进程数）</p><ul><li>理论上每台nginx服务器的最大连接数为 = 65535</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">注意:<br>计算最大客户端连接数:&#96;max_clients&#96;<br>全局中当前工作的进程数:&#96;worker_process&#96;<br>每个进程的最大连接数:&#96;worker_connections&#96;<br><br>- 当nginx作为http服务器时<br>  - &#96;max_clients &#x3D; worker_process * worker_connections&#96;<br>- 当nginx作为反向代理服务器时<br>  - 浏览器默认开启2个连接到server服务器，同时nginx还会使用fds从同一个连接池建立连接到外网的后端服务器，所以除以4<br>  - &#96;max_clients &#x3D; worker_process * worker_connections &#x2F; 4&#96;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">events &#123;<br>    accept_mutex on;            #设置网络连接序列化，防止惊群现象发生，默认on<br>    multi_accept on;            #设置 一个进程是否允许同时接受多个网络连接<br>    #use epoll                  #有select|poll|kqueue|epoll|resig|&#x2F;dev&#x2F;poll|eventport事件模型<br>    worker_connections  1024;   #每个进程的最大连接数,默认1024<br>    #keepalive_timeout 60;      #keepalive超时时间。<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="http块配置【自身，http服务器】"><a href="#http块配置【自身，http服务器】" class="headerlink" title="http块配置【自身，http服务器】"></a>http块配置【自身，http服务器】</h2><ul><li>可以嵌套多个server<ul><li>配置代理、缓存、日志定义和第三方配置</li><li>可以文件引入</li><li>mime-type定义</li><li>是否使用sendfile传输文件</li><li>连接超时时间</li><li>单连接请求数</li></ul></li></ul><p>1、点击一个网站加载开启过慢，可以通过 <code>sendfile on</code> 来高效传输，<code>tcp_nopush on;</code>优化网络阻塞问题<br>2、<strong>HTTP/1.0默认短连接</strong>，客户端和服务器每进行一次HTTP操作就建立一次连接<br>3、<strong>HTTP/1.1后默认长连接</strong>，省去频繁创建和关闭连接的时间，<br> 在打开一个网页完成后，用于传输HTTP数据TCP连接不会马上关闭（连接时间长），当客户端再次访问这个服务器时，会继续使用这条已建立的连接。<br>4、<strong>HTTP的短连接和长连接，实际就是TCP的短连接和长连接</strong>。  </p><p>5、<code>upstream</code></p><ul><li>定义上游服务器集群，在反向代理中proxy_pass使用，用于负载均衡。</li><li>nginx的upstream目前支持4种方式的分配<ul><li><code>轮询weight</code></li><li><code>ip_hash</code></li><li><code>fair</code>（第三方）</li><li><code>url_hash</code>（第三方）</li></ul></li><li>每个设备的状态设置为:<ul><li><code>down</code><ul><li>当前的server暂时不参与负载</li></ul></li><li><code>weight</code><ul><li>weight越大，负载的权重就越大。</li></ul></li><li><code>max_fails</code><ul><li>允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream模块定义的错误</li></ul></li><li><code>fail_timeout</code><ul><li>max_fails次失败后，暂停的时间。</li></ul></li><li><code>backup</code><ul><li>其它所有的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。</li></ul></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"><br>    1、轮询weight（默认）<br>    #每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。<br>    #指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。<br>    upstream bakend &#123;<br>        server 192.xxx weight&#x3D;10;<br>        server 192.xxx weight&#x3D;10;<br>    &#125;<br><br>    2、ip_hash<br>    #每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。<br>    upstream bakend &#123;<br>        ip_hash;<br>        server 192.xxx:88;<br>        server 192.xxx:80;<br>    &#125;<br><br>    3、fair（第三方）<br>    #按后端服务器的响应时间来分配请求，响应时间短的优先分配。<br>    upstream backend &#123;<br>        server server1;<br>        server server2;<br>        fair;<br>    &#125;<br>  <br>    4、url_hash（第三方）<br>    #按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。<br>    #例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法<br>    upstream backend &#123;<br>        server squid1:3128;<br>        server squid2:3128;<br>        hash $request_uri;<br>        hash_method crc32;<br>    &#125;<br><br>    #tips:<br>    upstream bakend&#123;#定义负载均衡设备的Ip及设备状态&#125;&#123;<br>        ip_hash;<br>        server 127.0.0.1:9090 down;<br>        server 127.0.0.1:8080 weight&#x3D;2;<br>        server 127.0.0.1:6060;<br>        server 127.0.0.1:7070 backup;<br>    &#125;<br>    #在需要使用负载均衡的server中增加 proxy_pass http:&#x2F;&#x2F;bakend&#x2F;;<br><br>    #nginx支持同时设置多组的负载均衡，用来给不用的server来使用。<br>    #client_body_in_file_only设置为On 可以讲client post过来的数据记录到文件中用来做debug<br>    #client_body_temp_path设置记录文件的目录 可以设置最多3层目录<br>    #location对URL进行匹配.可以进行重定向或者进行新的代理 负载均衡<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">http &#123;<br>    #配置支持哪些文件扩展名与文件类型映射表，在conf&#x2F;mime.confs中查看【不支持jsp】<br>    include       mime.types;<br><br>    #默认的文件流类型<br>    default_type  application&#x2F;octet-stream;<br><br>    #默认编码<br>    #charset utf-8;<br><br>    #取消服务访问日志<br>    #access_log off;  <br><br>    #自定义打印日志的格式<br>    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '<br>    #                  '$status $body_bytes_sent "$http_referer" '<br>    #                  '"$http_user_agent" "$http_x_forwarded_for"';<br><br>    #打印日志的名字<br>    #access_log  logs&#x2F;access.log  main;<br><br>    #自己添加部分--1【开始】#<br><br>    #服务器名字的hash表大小<br>    server_names_hash_bucket_size 128;<br>    #客户端请求头部的缓冲区大小<br>    client_header_buffer_size 32k;<br>    #客户请求头缓冲大小<br>    large_client_header_buffers 4 64k;<br><br>    #设定通过nginx上传文件的大小<br>    client_max_body_size 8m;<br><br>    #自己添加部分--1【结束】#<br><br>    #允许sendfile方式传输文件，开启高效传输模式默认为off【可以在http块，server块，location块。】<br>    # sendfile系统调用不需要将数据拷贝或者映射到应用程序地址空间中去<br>    sendfile        on;<br>    # 每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。<br>    # sendfile_max_chunk  100k;<br>    #防止网络阻塞【此选项仅在使用sendfile的时候使用】<br>    #tcp_nopush     on;<br><br>    #长连接超时时间（秒）【可以在http，server，location块】<br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br><br>    #开启限制IP连接数的时候需要使用<br>    #limit_zone crawler $binary_remote_addr 10m;<br><br>    #自己添加部分（gzip压缩）---2【开始】#<br><br>    #开启gzip压缩输出<br>    gzip on;<br>    #最小压缩文件大小<br>    gzip_min_length 1k;<br>    #压缩缓冲区<br>    gzip_buffers 4 16k;<br>    #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）<br>    gzip_http_version 1.0;  <br>    #压缩等级  <br>    gzip_comp_level 2;<br>    #压缩类型，默认就已经包含textml，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。<br>    gzip_types text&#x2F;plain application&#x2F;x-javascript text&#x2F;css application&#x2F;xml;<br>    gzip_vary on;<br><br>    #自己添加部分（gzip压缩）---2【结束】#<br><br><br><br>    #自己添加部分（FastCGI）---3【开始】#<br><br>    #改善网站的性能：减少资源占用，提高访问速度。<br>    fastcgi_connect_timeout 300;<br>    fastcgi_send_timeout 300;<br>    fastcgi_read_timeout 300;<br>    fastcgi_buffer_size 64k;<br>    fastcgi_buffers 4 64k;<br>    fastcgi_busy_buffers_size 128k;<br>    fastcgi_temp_file_write_size 128k;<br>    #自己添加部分（FastCGI）---3【结束】#<br><br><br>    #自己添加部分（负载均衡）---4【开始】#<br><br>    #设定实际的服务器列表<br>   upstream mysvr1 &#123;<br>    # 热备(其它所有的非backup机器down或者忙的时候，请求backup机器))<br>     server 127.0.0.1:7878;<br>     server 192.xxx:3333 backup;<br>   &#125;<br>   upstream mysvr2 &#123;<br>    # weigth参数表示权值，权值越高被分配到的几率越大<br>     server 192.xxx:80 weight&#x3D;5;<br>     server 192.xxx:80 weight&#x3D;1;<br>     server 192.xxx:80 weight&#x3D;6;<br>   &#125;<br>   upstream https-svr &#123;<br>    # 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题<br>     ip_hash;<br>     server 192.xxx:90;<br>     server 192.xxx:90;<br>   &#125;<br>    # 错误页<br>    error_page 404 https:&#x2F;&#x2F;www.baidu.com;<br><br>    #自己添加部分（负载均衡）---4【结束】#<br>    ···<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="http块配置中的server块配置1【自身】"><a href="#http块配置中的server块配置1【自身】" class="headerlink" title="http块配置中的server块配置1【自身】"></a>http块配置中的server块配置1【自身】</h2><ul><li>每个http块可以包括多个server块</li><li>每个server块相当于一个$\color{red}虚拟主机$，可以包括全局server块和多个location块</li></ul><p>全局server块</p><ul><li>本虚拟机主机的监听配置 \ 监听HTTP端口</li><li>本虚拟机主机的名称/IP配置 \ 监听地址  </li></ul><p>$\color{red}注意location块的规则$</p><p>用于匹配URL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">location[&#x3D; | ~ | ~* | ^~] uri &#123;<br>  ···<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>1、<code>=</code> :<ul><li>用于不含正则表达式的uri前，要求请求字符串与uri严格匹配。</li><li>如果匹配成功，就停止继续向下搜索并立即处理该请求。</li></ul></li><li>2、<code>~</code> :<ul><li>用于表示uri包含正则表达式，并且区分大小写。</li></ul></li><li>3、<code>~*</code> :<ul><li>用于表示uri包含正则表达式，并且不区分大小写。</li></ul></li><li>4、<code>^</code> :<ul><li>用于不含正则表达式的 uri前，要求Nginx服务器找到标识uri 和请求字符串匹配度最高的location 后，立即使用此location 处理请求，而不再使用location块中的正则uri和请求字符串做匹配。</li></ul></li><li>注意:<ul><li>如果uri包含正则表达式，则必须要有 <code>~</code> 或者 <code>~*</code> 标识。</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">server &#123;<br>        # 本虚拟机主机的监听配置 # 监听HTTP端口<br>        listen       80;<br>        # 本虚拟机主机的名称&#x2F;IP配置 # 监听地址, 域名可以有多个，用空格隔开<br>        server_name  localhost;<br><br>        #charset koi8-r;<br><br>        #access_log  logs&#x2F;host.access.log  main;<br><br>        location &#x2F; &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br><br>        # 将服务器错误页重定向到静态页 &#x2F;50x.html<br>        #error_page  404              &#x2F;404.html;<br>        error_page   500 502 503 504  &#x2F;50x.html;<br>        location &#x3D; &#x2F;50x.html &#123;<br>            root   html;<br>        &#125;<br><br>        # 将PHP脚本代理给Apache监听127.0.0.1:80<br>        location ~ \.php$ &#123;<br>            proxy_pass   http:&#x2F;&#x2F;127.0.0.1;<br>        &#125;<br><br>        # 将PHP脚本传递给正在侦听的FastCGI服务器127.0.0.1:9000<br>        location ~ \.php$ &#123;<br>            root           html;<br>            fastcgi_pass   127.0.0.1:9000;<br>            fastcgi_index  index.php;<br>            fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;<br>            include        fastcgi_params;<br>        &#125;<br><br>        # 如果Apache的文档根目录与nginx的文档根目录一致，则拒绝对.htaccess文件的访问<br>        location ~ &#x2F;\.ht &#123;<br>            deny  all;<br>        &#125;<br>    &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="http块配置中的server块配置2【自身】"><a href="#http块配置中的server块配置2【自身】" class="headerlink" title="http块配置中的server块配置2【自身】"></a>http块配置中的server块配置2【自身】</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"># 另一个虚拟主机混合使用基于IP、name、端口的配置<br>server &#123;<br>    listen       8000;<br>    listen       somename:8080;<br>    server_name  somename  alias  another.alias;<br><br>    location &#x2F; &#123;<br>        root   html;<br>        index  index.html index.htm;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="http块配置中的server块配置3【自身】"><a href="#http块配置中的server块配置3【自身】" class="headerlink" title="http块配置中的server块配置3【自身】"></a>http块配置中的server块配置3【自身】</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"># HTTPS服务<br>server &#123;<br>    listen       443 ssl;<br>    server_name  localhost;<br><br>    ssl_certificate      cert.pem;<br>    ssl_certificate_key  cert.key;<br><br>    ssl_session_cache    shared:SSL:1m;<br>    ssl_session_timeout  5m;<br><br>    ssl_ciphers  HIGH:!aNULL:!MD5;<br>    ssl_prefer_server_ciphers  on;<br><br>    location &#x2F; &#123;<br>        root   html;<br>        index  index.html index.htm;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105583416&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;nginx基本结构分析&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="nginx" scheme="http://lewis.qi.tk/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Windows---nginx</title>
    <link href="http://lewis.qi.tk/2020/05/16/Windows-nginx/"/>
    <id>http://lewis.qi.tk/2020/05/16/Windows-nginx/</id>
    <published>2020-05-16T11:25:57.000Z</published>
    <updated>2020-05-16T11:30:36.836Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105577092" target="_blank" rel="noopener">Windows—nginx</a></p><h2 id="Windows版nginx"><a href="#Windows版nginx" class="headerlink" title="Windows版nginx"></a>Windows版nginx</h2><h3 id="1、Windows常用命令：【在安装目录下打开cmd】"><a href="#1、Windows常用命令：【在安装目录下打开cmd】" class="headerlink" title="1、Windows常用命令：【在安装目录下打开cmd】"></a>1、Windows常用命令：【在安装目录下打开cmd】</h3><ul><li>安装目录<ul><li><code>D:\nginx\nginx-1.16.1</code></li></ul></li><li>启动nginx【我已默认开机自启】<ul><li><code>start nginx</code></li></ul></li><li>快速关闭nginx<ul><li><code>nginx.exe -s stop</code></li></ul></li><li>平稳关闭nginx<ul><li><code>nginx.exe -s quit</code></li></ul></li><li><strong>重启：如果更改配置，重新加载配置指令</strong><ul><li><code>nginx.exe -s reload</code></li></ul></li><li>重新打开日志文件<ul><li><code>nginx.exe -s reopen</code></li></ul></li><li>为nginx指定一个配置文件<ul><li><code>nginx.exe -s filename</code></li></ul></li><li>不运行nginx，仅测试nginx配置文件<ul><li><code>nginx.exe -t</code></li></ul></li><li>查看nginx版本<ul><li><code>nginx -v</code></li></ul></li><li>查看nginx版本和编译器版本和配置参数<ul><li><code>nginx -V</code></li></ul></li></ul><h3 id="2、不想每次敲命令，在安装目录下配置启动批处理文件"><a href="#2、不想每次敲命令，在安装目录下配置启动批处理文件" class="headerlink" title="2、不想每次敲命令，在安装目录下配置启动批处理文件"></a>2、不想每次敲命令，在安装目录下配置<strong>启动批处理文件</strong></h3><p>startup.bat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-comment">rem 如果启动前已经启动nginx并记录下pid文件，会kill指定进程</span><br>nginx.exe -s stop<br><br><span class="hljs-comment">rem 测试配置文件语法正确性</span><br>nginx.exe -t -c conf/nginx.conf<br><br><span class="hljs-comment">rem 显示版本信息</span><br>nginx.exe -v<br><br><span class="hljs-comment"><code class="language-hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-comment">rem 如果启动前已经启动nginx并记录下pid文件，会kill指定进程</span><br>nginx.exe -s stop<br><br><span class="hljs-comment">rem 测试配置文件语法正确性</span><br>nginx.exe -t -c conf/nginx.conf<br><br><span class="hljs-comment">rem 显示版本信息</span><br>nginx.exe -v<br><br><span class="hljs-comment">rem 按照指定配置去启动nginx</span><br>nginx.exe -c conf/nginx.conf<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3、配置文件目录"><a href="#3、配置文件目录" class="headerlink" title="3、配置文件目录"></a>3、配置文件目录</h3><ul><li>安装目录<ul><li>D:\nginx\nginx-1.16.1</li><li><code>conf</code><ul><li><code>fastcgi.conf</code></li><li><code>fastcgi_params</code></li><li><code>mime.types</code></li><li><code>nginx.conf</code></li></ul></li><li><code>contrib</code></li><li><code>docs</code></li><li><code>html</code><ul><li><code>50x.html</code></li><li><code>index.html</code></li></ul></li><li><code>logs</code><ul><li><code>access.log</code></li><li><code>error.log</code></li><li><code>nginx.pid</code></li></ul></li><li><code>temp</code></li><li><code>nginx.exe</code></li></ul></li></ul><h3 id="4、Windows版应用【注意，不管什么系统，nginx的路径都是-】"><a href="#4、Windows版应用【注意，不管什么系统，nginx的路径都是-】" class="headerlink" title="4、Windows版应用【注意，不管什么系统，nginx的路径都是/】"></a>4、Windows版应用【注意，不管什么系统，nginx的路径都是<code>/</code>】</h3><h3 id="4-1、静态资源"><a href="#4-1、静态资源" class="headerlink" title="4.1、静态资源"></a>4.1、静态资源</h3><p>在<code>D:\nginx\nginx-1.16.1</code>目录下直接新建文件夹<code>static</code></p><p>例如一个完整的简单项目目录,项目名<code>Confession</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">Confession&#x2F;<br>|<br>+- css&#x2F;<br>|<br>+- images&#x2F;<br>|<br>+- js&#x2F;<br>|<br>+ index.html<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>在nginx中的静态目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">static&#x2F;Confession&#x2F;<br>|<br>+- css&#x2F;<br>|<br>+- images&#x2F;<br>|<br>+- js&#x2F;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>在server块的location块中设置root路径<code>D:/nginx/nginx-1.16.1/static/Confession</code></li><li>运行<ul><li><code>start nginx</code></li></ul></li><li>访问设置好后的项目静态资源<ul><li><code>localhost/images/1.gif</code></li></ul></li><li>重启<ul><li><code>nginx.exe -s reload</code></li></ul></li><li>关闭<ul><li><code>nginx.exe -s quit</code></li></ul></li></ul><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">location &#x2F; &#123;<br>            root   D:&#x2F;nginx&#x2F;nginx-1.16.1&#x2F;static&#x2F;Confession;<br>            index  index.html index.htm;<br>        &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200417115104756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MDYyNTg2,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h3 id="4-2、反向代理"><a href="#4-2、反向代理" class="headerlink" title="4.2、反向代理"></a>4.2、反向代理</h3><p>当用户发送请求，通过反向代理配置，将请求转发到指定的服务器上</p><p>需要配置一个tomcat</p><p>分析：</p><ul><li>location块中的root<ul><li>表示当匹配到这个请求路径时，将会在这个文件夹内寻找相应的文件</li></ul></li><li>location块中的index<ul><li>表示当没有指定主页是，默认选择这个文件</li><li>可以有多个指定主页，并按顺序加载，如果第一个不存在，则找第二个，以此类推</li></ul></li><li>server块中的error_page<ul><li>表示代表错误的页面</li></ul></li><li>访问路径server_name  <ul><li><code>localhost</code></li></ul></li><li>反向代理配置proxy_pass<ul><li>代表代理路径</li><li>当我们访问localhost时会被nginx转发到<code>localhost:8080</code>上</li></ul></li></ul><p>实验：</p><ul><li>安装apache-tomcat-9.0.34<ul><li><code>D:\nginx\apache-tomcat-9.0.34</code></li></ul></li><li>在<code>D:\nginx\apache-tomcat-9.0.34\webapps\ROOT</code>目录下加静态资源<ul><li>写demo.html</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>启动apache-tomcat<ul><li>找到D:\nginx\apache-tomcat-9.0.34\bin下</li><li>双击startup.bat运行</li><li>双击shutdown.bat关闭</li><li>或者直接双击tomcat9.exe</li></ul></li><li>运行<ul><li><code>start nginx</code></li></ul></li><li>访问当前<ul><li><code>localhost</code></li><li><code>localhost/demo.html</code></li></ul></li><li>访问<strong>转发</strong>设置好后的项目静态资源<ul><li><code>localhost:8080</code></li><li><code>localhost:8080/demo.html</code></li></ul></li><li>重启<ul><li><code>nginx.exe -s reload</code></li></ul></li><li>关闭<ul><li><code>nginx.exe -s quit</code></li></ul></li></ul><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">server &#123;<br>        listen       80;<br>        server_name  localhost;<br><br>        #charset koi8-r;<br><br>        #access_log  logs&#x2F;host.access.log  main;<br><br>        location &#x2F; &#123;<br>            proxy_pass localhost:8080;<br>            index  index.html index.htm;<br>        &#125;<br><br>        #error_page  404              &#x2F;404.html;<br><br>        # redirect server error pages to the static page &#x2F;50x.html<br>        #<br><br>        error_page   500 502 503 504  &#x2F;50x.html;<br><br>        location &#x3D; &#x2F;50x.html &#123;<br>            root   html;<br>        &#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="4-3、动静分离"><a href="#4-3、动静分离" class="headerlink" title="4.3、动静分离"></a>4.3、动静分离</h3><h3 id="4-4、集群–负载均衡"><a href="#4-4、集群–负载均衡" class="headerlink" title="4.4、集群–负载均衡"></a>4.4、集群–负载均衡</h3><p>同一个业务部署在多个服务器上<br>即一个应用程序部署到多服务器上，通过负载均衡来调优选择哪台服务器去执行</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105577092&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Windows—nginx&lt;/a&gt;&lt;/p&gt;
&lt;h2 i
      
    
    </summary>
    
    
      <category term="Liunx" scheme="http://lewis.qi.tk/categories/Liunx/"/>
    
    
      <category term="nginx" scheme="http://lewis.qi.tk/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>centos6和8---keepalived.conf+高可用集群配置</title>
    <link href="http://lewis.qi.tk/2020/05/16/centos6%E5%92%8C8-keepalived-conf-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/"/>
    <id>http://lewis.qi.tk/2020/05/16/centos6%E5%92%8C8-keepalived-conf-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/</id>
    <published>2020-05-16T11:25:39.000Z</published>
    <updated>2020-05-16T11:29:09.908Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105576919" target="_blank" rel="noopener">centos6和8—keepalived.conf+高可用集群配置</a></p><p>keepalived.conf【centos8】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">! Configuration File for keepalived<br><br>global_defs &#123;<br>   notification_email &#123;<br>     acassen@firewall.loc<br>     failover@firewall.loc<br>     sysadmin@firewall.loc<br>   &#125;<br>   notification_email_from Alexandre.Cassen@firewall.loc<br>   smtp_server 192.168.200.1<br>   smtp_connect_timeout 30<br>   router_id LVS_DEVEL<br>   vrrp_skip_check_adv_addr<br>   vrrp_strict<br>   vrrp_garp_interval 0<br>   vrrp_gna_interval 0<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state MASTER<br>    interface eth0<br>    virtual_router_id 51<br>    priority 100<br>    advert_int 1<br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.200.16<br>        192.168.200.17<br>        192.168.200.18<br>    &#125;<br>&#125;<br><br>virtual_server 192.168.200.100 443 &#123;<br>    delay_loop 6<br>    lb_algo rr<br>    lb_kind NAT<br>    persistence_timeout 50<br>    protocol TCP<br><br>    real_server 192.168.201.100 443 &#123;<br>        weight 1<br>        SSL_GET &#123;<br>            url &#123;<br>              path &#x2F;<br>              digest ff20ad2481f97b1754ef3e12ecd3a9cc<br>            &#125;<br>            url &#123;<br>              path &#x2F;mrtg&#x2F;<br>              digest 9b3a0c85a887a256d6939da88aabd8cd<br>            &#125;<br>            connect_timeout 3<br>            retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><br>virtual_server 10.10.10.2 1358 &#123;<br>    delay_loop 6<br>    lb_algo rr<br>    lb_kind NAT<br>    persistence_timeout 50<br>    protocol TCP<br><br>    sorry_server 192.168.200.200 1358<br><br>    real_server 192.168.200.2 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123;<br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br><br>    real_server 192.168.200.3 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123;<br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334c<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334c<br>            &#125;<br>            connect_timeout 3<br>            retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><br>virtual_server 10.10.10.3 1358 &#123;<br>    delay_loop 3<br>    lb_algo rr<br>    lb_kind NAT<br>    persistence_timeout 50<br>    protocol TCP<br><br>    real_server 192.168.200.4 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123;<br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br><br>    real_server 192.168.200.5 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123;<br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123;<br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>keepalived.conf【centos6】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">! Configuration File for keepalived<br><br>global_defs &#123;<br>   notification_email &#123;<br>     acassen@firewall.loc<br>     failover@firewall.loc<br>     sysadmin@firewall.loc<br>   &#125;<br>   notification_email_from Alexandre.Cassen@firewall.loc<br>   smtp_server 192.168.200.1<br>   smtp_connect_timeout 30<br>   router_id LVS_DEVEL<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state MASTER<br>    interface eth0<br>    virtual_router_id 51<br>    priority 100<br>    advert_int 1<br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.200.16<br>        192.168.200.17<br>        192.168.200.18<br>    &#125;<br>&#125;<br><br>virtual_server 192.168.200.100 443 &#123;<br>    delay_loop 6<br>    lb_algo rr<br>    lb_kind NAT<br>    nat_mask 255.255.255.0<br>    persistence_timeout 50<br>    protocol TCP<br><br>    real_server 192.168.201.100 443 &#123;<br>        weight 1<br>        SSL_GET &#123;<br>            url &#123;<br>              path &#x2F;<br>              digest ff20ad2481f97b1754ef3e12ecd3a9cc<br>            &#125;<br>            url &#123;<br>              path &#x2F;mrtg&#x2F;<br>              digest 9b3a0c85a887a256d6939da88aabd8cd<br>            &#125;<br>            connect_timeout 3<br>            nb_get_retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><br>virtual_server 10.10.10.2 1358 &#123;<br>    delay_loop 6<br>    lb_algo rr <br>    lb_kind NAT<br>    persistence_timeout 50<br>    protocol TCP<br><br>    sorry_server 192.168.200.200 1358<br><br>    real_server 192.168.200.2 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123; <br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            nb_get_retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br><br>    real_server 192.168.200.3 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123; <br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334c<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334c<br>            &#125;<br>            connect_timeout 3<br>            nb_get_retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><br>virtual_server 10.10.10.3 1358 &#123;<br>    delay_loop 3<br>    lb_algo rr <br>    lb_kind NAT<br>    nat_mask 255.255.255.0<br>    persistence_timeout 50<br>    protocol TCP<br><br>    real_server 192.168.200.4 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123; <br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            nb_get_retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br><br>    real_server 192.168.200.5 1358 &#123;<br>        weight 1<br>        HTTP_GET &#123;<br>            url &#123; <br>              path &#x2F;testurl&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl2&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            url &#123; <br>              path &#x2F;testurl3&#x2F;test.jsp<br>              digest 640205b7b0fc66c1ea91c463fac6334d<br>            &#125;<br>            connect_timeout 3<br>            nb_get_retry 3<br>            delay_before_retry 3<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="两个高可用集群centos6和8"><a href="#两个高可用集群centos6和8" class="headerlink" title="两个高可用集群centos6和8"></a>两个高可用集群centos6和8</h2><ul><li>centos8主服务器/etc/keepalived/keepalived.conf</li></ul><p>keepalived.conf【8】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">global_defs &#123;                 #全局定义<br><br>    notification_email &#123;<br>        acassen@firewall.loc<br>        failover@firewall.loc<br>        sysadmin@firewall.loc<br>    &#125;<br><br>    notification_email_from Alexandre.Cassen@firewall.loc<br>    smtp_server 192.168.xxx.xxx  #当前虚拟机ip<br>    smtp_connect_timeout 30<br>    router_id LVS_DEVEL<br>&#125;<br><br>vrrp_script chk_http_port &#123;     #自定义的检测脚本<br>    script "&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx_check.sh"  #脚本路径<br>    interval 2                  #（检测脚本执行的间隔）<br>    weight 2<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state MASTER         #  MASTER 是主服务器<br>    interface eth0       #  主服务器的网卡eth0<br>    virtual_router_id 51 # 主、备机的 virtual_router_id 必须相同<br>    priority 100         # 主、备机取不同的优先级，主机值较大，备份机值较小<br>    advert_int 1<br><br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.xxx.50          # VRRP H 虚拟地址<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>centos6从服务器/etc/keepalived/keepalived.conf</li></ul><p>keepalived.conf【6】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf">global_defs &#123;                 #全局定义<br><br>    notification_email &#123;<br>        acassen@firewall.loc<br>        failover@firewall.loc<br>        sysadmin@firewall.loc<br>    &#125;<br><br>    notification_email_from Alexandre.Cassen@firewall.loc<br>    smtp_server 192.168.xxx.xxx   #当前虚拟机ip<br>    smtp_connect_timeout 30<br>    router_id LVS_DEVEL<br>&#125;<br><br>vrrp_script chk_http_port &#123;     #自定义的检测脚本<br>    script "&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx_check.sh"  #脚本路径<br>    interval 2                  #（检测脚本执行的间隔）<br>    weight 2<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state BACKUP         #  BACKUP 是从服务器<br>    interface eth0       #  主服务器的网卡eth0<br>    virtual_router_id 51 # 主、备机的 virtual_router_id 必须相同<br>    priority 90         # 主、备机取不同的优先级，主机值较大，备份机值较小<br>    advert_int 1<br><br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.xxx.50          # VRRP H 虚拟地址<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>添加自定义的检测脚本<ul><li>路径：<code>/usr/local/src/nginx_check.sh</code></li></ul></li></ul><p>nginx_check.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sh"><span class="hljs-meta">#!/bin/bash</span><br>A=`ps -C nginx –no-header |wc -l`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$A</span> -eq 0 ];<span class="hljs-keyword">then</span><br> /usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx<br> sleep 2<br> <span class="hljs-keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq 0 ];<span class="hljs-keyword">then</span><br> killall keepalived<br> <span class="hljs-keyword">fi</span><br><span class="hljs-keyword"><code class="language-hljs sh"><span class="hljs-meta">#!/bin/bash</span><br>A=`ps -C nginx –no-header |wc -l`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$A</span> -eq 0 ];<span class="hljs-keyword">then</span><br> /usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx<br> sleep 2<br> <span class="hljs-keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq 0 ];<span class="hljs-keyword">then</span><br> killall keepalived<br> <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105576919&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;centos6和8—keepalived.conf+高
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="centos8" scheme="http://lewis.qi.tk/tags/centos8/"/>
    
      <category term="centos6" scheme="http://lewis.qi.tk/tags/centos6/"/>
    
  </entry>
  
  <entry>
    <title>centos6下的nginx安装</title>
    <link href="http://lewis.qi.tk/2020/05/16/centos6%E4%B8%8B%E7%9A%84nginx%E5%AE%89%E8%A3%85/"/>
    <id>http://lewis.qi.tk/2020/05/16/centos6%E4%B8%8B%E7%9A%84nginx%E5%AE%89%E8%A3%85/</id>
    <published>2020-05-16T11:25:22.000Z</published>
    <updated>2020-05-16T11:27:37.039Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105576865" target="_blank" rel="noopener">centos6下的nginx安装</a></p><p>安装pcre依赖</p><ul><li><code>cd /usr/src</code></li><li><code>ls</code></li><li><code>tar -xvf pcre-8.44.tar.gz</code>  【解压】</li><li><code>cd pcre-8.44/</code></li><li><code>./configure</code> 【编译检查】</li><li><code>make &amp;&amp; make install</code> 【编译并安装】</li><li><code>pcre-config --version</code> 【看版本】</li></ul><p>安装openssl、zlib【当前目录】</p><ul><li><code>yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</code></li></ul><p>安装nginx</p><ul><li><code>cd ..</code>【root@www src】</li><li><code>tar -xvf nginx-1.16.1.tar.gz</code></li><li><code>cd nginx-1.16.1/</code></li><li><code>./configure</code> 【编译检查】</li><li><code>make &amp;&amp; make install</code> 【编译并安装】</li></ul><p>添加防火墙端口</p><ul><li>`vim /etc/sysconfig/iptables</li><li><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</code></li><li><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT</code></li><li><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 8081 -j ACCEPT</code></li><li><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 9001 -j ACCEPT</code></li></ul><p>设置防火墙[root@localhost ~]</p><ul><li>查看防火墙状态<ul><li><code>service iptables status</code></li></ul></li><li>停止防火墙<ul><li><code>service iptables stop</code></li></ul></li><li>启动防火墙<ul><li><code>service iptables start</code></li></ul></li><li>重启防火墙<ul><li><code>service iptables restart</code></li></ul></li><li>永久关闭防火墙<ul><li><code>chkconfig iptables off</code></li></ul></li><li>永久关闭后重启<ul><li><code>chkconfig iptables on</code></li></ul></li></ul><p>$\color{red}启动nginx$</p><ul><li><code>ls -l libpcre.so*</code></li><li><code>ln -s /usr/local/lib/libpcre.so.1.2.10 libpcre.so.1</code></li><li><code>export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</code></li><li><code>cd /usr/local/nginx/sbin/</code></li><li><code>ls</code></li><li><code>[root@www sbin]# ./nginx</code></li></ul><p>再查看进程</p><ul><li><code>[root@www sbin]# ps -ef | grep nginx</code></li></ul><p>在LIunx中输入IP地址和端口，测试访问</p><ul><li><code>localhost</code></li></ul><p>在Windows中输入IP地址和端口，测试访问</p><ul><li><code>192.168.186.128</code></li></ul><p>$\color{red}查看nginx.conf$</p><ul><li><code>cd /usr/local/nginx/conf/</code></li><li><code>ls</code></li><li><code>[root@www conf]# vi nginx.conf</code></li></ul><ul><li>启动keepalived<ul><li><code>/etc/init.d/keepalived start</code></li></ul></li><li>查看keepalived的进程<ul><li><code>ps -ef | grep keepalived</code></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105576865&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;centos6下的nginx安装&lt;/a&gt;&lt;/p&gt;
&lt;p
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="centos6" scheme="http://lewis.qi.tk/tags/centos6/"/>
    
  </entry>
  
  <entry>
    <title>用fiddler简单抓包</title>
    <link href="http://lewis.qi.tk/2020/05/16/%E7%94%A8fiddler%E7%AE%80%E5%8D%95%E6%8A%93%E5%8C%85/"/>
    <id>http://lewis.qi.tk/2020/05/16/%E7%94%A8fiddler%E7%AE%80%E5%8D%95%E6%8A%93%E5%8C%85/</id>
    <published>2020-05-16T11:21:52.000Z</published>
    <updated>2020-05-16T11:23:56.628Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105606004" target="_blank" rel="noopener">用fiddler简单抓包</a></p><h1 id="命令行工具QuickExec"><a href="#命令行工具QuickExec" class="headerlink" title="命令行工具QuickExec"></a>命令行工具QuickExec</h1><p>左下角黑色的QuickExec</p><ul><li><code>help</code>  <ul><li>打开官方的使用页面介绍</li></ul></li><li><code>select</code>  <ul><li>选择会话的命令</li></ul></li><li><code>cls</code><ul><li>清屏</li></ul></li><li><code>?.png</code><ul><li>用来选择png后缀的图片</li></ul></li><li><code>bpu</code><ul><li>截获request</li></ul></li></ul><p>快捷键</p><ul><li>Ctrl+x 清屏</li></ul><h2 id="抓包https设置"><a href="#抓包https设置" class="headerlink" title="抓包https设置"></a>抓包https设置</h2><p>Tools-》Options-》点击https标签-》都勾选-》下载https根证书</p><p>设置火狐的地理，变成系统自动代理</p><h2 id="过滤会话filters请求选项卡"><a href="#过滤会话filters请求选项卡" class="headerlink" title="过滤会话filters请求选项卡"></a>过滤会话filters请求选项卡</h2><p>Hosts选择过滤方式</p><ul><li>1、Filters选项卡</li><li>2、use filter</li></ul><h3 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h3><ul><li>3、no zone filter过滤方式【少用】<ul><li>show only intranet hosts【只显示内网hosts】</li><li>show only internet hosts【只显示外网hosts】</li></ul></li><li>4、no host filter过滤方式【多用】<ul><li>hide the following hosts【隐藏以下hosts】</li><li>show only the following hosts【只显示以下hosts，重要】</li><li>flag the following hosts【标记以下hosts，在左侧session中会加粗】</li></ul></li></ul><h3 id="client-process【根据进程选择过滤请求】"><a href="#client-process【根据进程选择过滤请求】" class="headerlink" title="client process【根据进程选择过滤请求】"></a>client process【根据进程选择过滤请求】</h3><ul><li>5、show only traffic form【只选择来自后面选进程的请求】</li><li>6、Show only Internet Explorer traffic【只选择来自IE的请求】</li><li>7、Hide traffic from Service Host【隐藏来自service host的请求】</li></ul><h3 id="request-headers-【根据请求头进行过滤】"><a href="#request-headers-【根据请求头进行过滤】" class="headerlink" title="request headers 【根据请求头进行过滤】"></a>request headers 【根据请求头进行过滤】</h3><ul><li>8、show only if URL contains 【只显示URL包含什么东西，多个则空格分开】</li><li>9、Hide if URL contains【隐藏URL包含什么东西，多个则空格分开】</li><li>10、Flag requests with headers【加粗显示包含指定的HTTP请求头类型名】</li><li>11、Delete request headers【删除指定的HTTP请求头类型名】】</li><li>12、Set request header【创建一个指定名称和值的HTTP请求头/更新HTTP请求头为指定值】</li></ul><h3 id="breakpoints【断点】"><a href="#breakpoints【断点】" class="headerlink" title="breakpoints【断点】"></a>breakpoints【断点】</h3><ul><li>13、Break request on POST【针对所有post请求设置断点】</li><li>14、Break request on GET with query string【针对所有get请求设置断点，包含params参数】</li><li>15、Break on XMLHttpRequest【通过xmlhttprequest对象发送的请求设置断点，是否含有x-requested-with和x-download-initiator】</li><li>16、Break response on Content- Type【响应头content-type中包含指定的文本设置断点】</li></ul><h3 id="Response-Status-Code【使用请求状态码】"><a href="#Response-Status-Code【使用请求状态码】" class="headerlink" title="Response Status Code【使用请求状态码】"></a>Response Status Code【使用请求状态码】</h3><ul><li>17、Hide success (2xx)【隐藏状态码200-299的响应】</li><li>18、Hide non-2xx【隐藏所有非状态码200-299的响应】</li><li>19、Hide Authentication demands(401,407)【隐藏状态码400,407的响应】</li><li>20、Hide redirects (300,301,302,303,307)【隐藏状态码300-303,307的重定向响应】</li><li>21、Hide Not Modified (304)【隐藏状态码304的响应】</li></ul><h3 id="actions运行"><a href="#actions运行" class="headerlink" title="actions运行"></a>actions运行</h3><ul><li>run filterset now</li></ul><h2 id="composer选项卡"><a href="#composer选项卡" class="headerlink" title="composer选项卡"></a>composer选项卡</h2><p>把会话拖入后直接改</p><h2 id="设置断点修改Request请求"><a href="#设置断点修改Request请求" class="headerlink" title="设置断点修改Request请求"></a>设置断点修改Request请求</h2><p>方法一：</p><ul><li>中断所有的会话<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Before Requests</code></li></ul></li><li>消除命令<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Disabled</code></li></ul></li></ul><p>方法二：</p><ul><li>只会中断<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a><ul><li>在命令行中输入命令<code>bpu www.baidu.com</code></li></ul></li><li>消除命令<ul><li>在命令行中输入命令 <code>bpu</code></li></ul></li></ul><h3 id="实例1"><a href="#实例1" class="headerlink" title="实例1"></a>实例1</h3><ul><li>1、打开登录界面  <code>http://passport.cnblogs.com/login.aspx</code></li><li>2、打开Fiddler,  在命令行中输入<ul><li><code>bpu http://passport.cnblogs.com/login.aspx</code></li></ul></li><li>3、输入<strong>错误</strong>的用户名和密码 点击登录</li><li>4、 Fiddler 能中断这次会话，选择被中断的会话，<ul><li>点击<code>Inspectors tab</code> 下的 <code>WebForms tab</code></li><li>修改用户名密码，然后点击<code>Run to Completion</code></li></ul></li><li>5、结果是<strong>正确</strong>登录</li></ul><h3 id="实例2【请求报文的修改】"><a href="#实例2【请求报文的修改】" class="headerlink" title="实例2【请求报文的修改】"></a>实例2【请求报文的修改】</h3><ul><li>1、进入<code>http://ask.testfan.cn/</code>，点击登录，打开<code>http://ask.testfan.cn/login</code>登录页面</li><li>2、中断所有的会话<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Before Requests</code></li></ul></li><li>3、会跳出相应链接<ul><li>在<code>inspectors</code>中找到row的文本显示形式，可以直接拦截请求修改后</li><li>点击<code>run to completion</code>再提交</li></ul></li><li>4.消除命令<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Disabled</code></li></ul></li></ul><h2 id="设置断点修改Response响应"><a href="#设置断点修改Response响应" class="headerlink" title="设置断点修改Response响应"></a>设置断点修改Response响应</h2><p>方法一：</p><ul><li>中断所有的会话<ul><li><code>Rules</code>-&gt; <code>Automatic Breakpoint</code>  -&gt; <code>After Response</code></li></ul></li><li>消除命令<ul><li><code>Rules</code>-&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Disabled</code></li></ul></li></ul><p>方法二：</p><ul><li>只会中断<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a><ul><li>在命令行中输入命令<code>bpafter www.baidu.com</code></li></ul></li><li>消除命令<ul><li>在命令行中输入命令 <code>bpafter</code></li></ul></li></ul><h3 id="实例1【响应报文的修改】"><a href="#实例1【响应报文的修改】" class="headerlink" title="实例1【响应报文的修改】"></a>实例1【响应报文的修改】</h3><ul><li>1、进入<code>http://conf.wsm.360.cn/</code>，显示的是nginx的错误页面</li><li>2、中断所有的会话<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>After Requests</code></li></ul></li><li>3、会跳出相应链接<ul><li>再在第二个框下，点击row修改，再发送</li><li>点击<code>run to completion</code>再提交</li></ul></li><li>4、如果还想把响应报文返回一些信息<ul><li>可以在choose response中选择响应返回的状态码</li><li>如200_diddlergif.dat</li><li>200_simplehtml.dat</li></ul></li><li>4.消除命令<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Disabled</code></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">HTTP&#x2F;1.1 403 Forbidden<br>Server: nginx&#x2F;1.9.15<br>Date: Sat, 18 Apr 2020 11:32:55 GMT<br>Content-Type: text&#x2F;html<br>Connection: close<br>Content-Length: 169<br><br><html><br><head><title>403 Forbidden<&#x2F;title><&#x2F;head><br><body bgcolor&#x3D;"white"><br><center><h1>403 Forbidden<&#x2F;h1><&#x2F;center><br><hr><center>nginx&#x2F;1.9.15<&#x2F;center><br><&#x2F;body><br><&#x2F;html><br><br>改成：<br><br>HTTP&#x2F;1.1 403 Forbidden<br>Server: nginx&#x2F;1.9.15<br>Date: Sat, 18 Apr 2020 11:32:55 GMT<br>Content-Type: text&#x2F;html<br>Connection: close<br>Content-Length: 169<br><br><html><br><head><title>403 Forbidden这就是个错误<&#x2F;title><&#x2F;head><br><body bgcolor&#x3D;"white"><br><center><h1>403 Forbidden<&#x2F;h1><&#x2F;center><br><hr><center>nginx&#x2F;9.9.9<&#x2F;center><br><&#x2F;body><br><&#x2F;html><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="实例2【响应报文的修改】"><a href="#实例2【响应报文的修改】" class="headerlink" title="实例2【响应报文的修改】"></a>实例2【响应报文的修改】</h3><ul><li>1、进入<code>https://t.qianzhan.com/caijing/detail/200418-4a7c3321.html</code>，显示的是页面</li><li>2、中断所有的会话<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>After Requests</code></li></ul></li><li>3、会跳出相应链接<ul><li>再在第二个框下，点击row修改，再发送</li><li>点击<code>run to completion</code>再提交</li></ul></li><li>4、如果还想把响应报文返回一些信息<ul><li>可以在choose response中选择响应返回的状态码</li><li>如200_diddlergif.dat</li><li>200_simplehtml.dat</li></ul></li><li>4.消除命令<ul><li><code>Rules</code> -&gt; <code>Automatic Breakpoint</code>  -&gt; <code>Disabled</code></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">HTTP&#x2F;1.1 200 OK<br>Date: Sat, 18 Apr 2020 12:05:28 GMT<br>Content-Type: text&#x2F;html; charset&#x3D;utf-8<br>Content-Length: 62409<br>Connection: keep-alive<br>Server: nginx<br>Cache-Control: private<br>Last-Modified: Sat, 18 Apr 2020 12:00:00 GMT<br>X-NWS-UUID-VERIFY: cbe94da3f4fec551e970bbf78f743f8b<br>Vary: Accept-Encoding<br>X-NWS-LOG-UUID: 707fa9f9-af2f-4b06-9b04-065632bfc552<br>X-Daa-Tunnel: hop_count&#x3D;3<br>X-Cache-Lookup: Hit From Upstream<br>X-Cache-Lookup: Hit From Inner Cluster<br>X-Cache-Lookup: Hit From Upstream<br><br><br><br><!DOCTYPE html PUBLIC "-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN" "http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd"><br><html xmlns&#x3D;"http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml" xml:lang&#x3D;"en"><br><head><br>    <meta http-equiv&#x3D;"Content-Type" content&#x3D;"text&#x2F;html; charset&#x3D;utf-8" &#x2F;><br>    <meta name&#x3D;"applicable-device" content&#x3D;"pc" &#x2F;><br>    <title>张文宏：中国做的是饱和式的诊断，世界上很多国家还做不到_产经_前瞻经济学人<&#x2F;title><br>    <meta name&#x3D;"Keywords" content&#x3D;"张文宏,饱和式诊断" &#x2F;><br>    <meta name&#x3D;"Description" content&#x3D;"4月18日，中国和新加坡医疗专家就新冠疫情交流防疫经验，上海市新冠肺炎医疗救治专家组组长张文宏表示，中国做的是饱和式的诊断，世界上很多国家还做不到的。" &#x2F;><br>    <link rel&#x3D;"apple-touch-icon-precomposed" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;img&#x2F;apple-touch-icon.png" &#x2F;><br>    <link rel&#x3D;"stylesheet" type&#x3D;"text&#x2F;css" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;2017&#x2F;css&#x2F;common.css?v&#x3D;20190930" &#x2F;><br>    <link rel&#x3D;"stylesheet" type&#x3D;"text&#x2F;css" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;2017&#x2F;css&#x2F;art.css?v&#x3D;20190113" &#x2F;><br>    <script type&#x3D;"text&#x2F;javascript" src&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;scripts&#x2F;jquery-1.8.2.min.2017.js?v&#x3D;20170401" charset&#x3D;"UTF-8"><&#x2F;script><br><br>    <meta name&#x3D;"mobile-agent" content&#x3D;"format&#x3D;xhtml;url&#x3D;&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1" &#x2F;><br>    <link rel&#x3D;"alternate" media&#x3D;"only screen and(max-width: 760px)" href&#x3D;"&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1" &#x2F;><br>    <script type&#x3D;"text&#x2F;javascript"><br>        if (top.location !&#x3D; self.location) &#123;<br>            top.location &#x3D; self.location.href;<br>        &#125;<br>        if (window.location.href.indexOf("?from&#x3D;xw") > 0) &#123;<br>            sDialog.setCookie('computer', '1', 30, '.qianzhan.com');<br>        &#125;<br>        if (&#x2F;AppleWebKit.*Mobile&#x2F;i.test(navigator.userAgent) || (&#x2F;MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE&#x2F;.test(navigator.userAgent))) &#123;<br>            var computer &#x3D; sDialog.getCookie('computer');<br>            if (computer!&#x3D;"1") &#123;<br>                try &#123;<br>                    if (&#x2F;Android|Windows Phone|webOS|iPhone|iPod|BlackBerry&#x2F;i.test(navigator.userAgent)) &#123;<br>                        window.location.href &#x3D; '&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1';<br>                    &#125;<br>                &#125; catch (e) &#123; &#125;<br>            &#125;<br>        &#125;<br>    <&#x2F;script><br><&#x2F;head><br><br><br>改成：<br><br>HTTP&#x2F;1.1 200 OK<br>Date: Sat, 18 Apr 2020 12:05:28 GMT<br>Content-Type: text&#x2F;html; charset&#x3D;utf-8<br>Content-Length: 62409<br>Connection: keep-alive<br>Server: nginx<br>Cache-Control: private<br>Last-Modified: Sat, 18 Apr 2020 12:00:00 GMT<br>X-NWS-UUID-VERIFY: cbe94da3f4fec551e970bbf78f743f8b<br>Vary: Accept-Encoding<br>X-NWS-LOG-UUID: 707fa9f9-af2f-4b06-9b04-065632bfc552<br>X-Daa-Tunnel: hop_count&#x3D;3<br>X-Cache-Lookup: Hit From Upstream<br>X-Cache-Lookup: Hit From Inner Cluster<br>X-Cache-Lookup: Hit From Upstream<br><br><br><br><!DOCTYPE html PUBLIC "-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN" "http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd"><br><html xmlns&#x3D;"http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml" xml:lang&#x3D;"en"><br><head><br>    <meta http-equiv&#x3D;"Content-Type" content&#x3D;"text&#x2F;html; charset&#x3D;utf-8" &#x2F;><br>    <meta name&#x3D;"applicable-device" content&#x3D;"pc" &#x2F;><br>    <title>张文宏：对对对<&#x2F;title><br>    <meta name&#x3D;"Keywords" content&#x3D;"张文宏,饱和式诊断" &#x2F;><br>    <meta name&#x3D;"Description" content&#x3D;"4月18日，中国和新加坡医疗专家就新冠疫情交流防疫经验，上海市新冠肺炎医疗救治专家组组长张文宏表示，中国做的是饱和式的诊断，世界上很多国家还做不到的。" &#x2F;><br>    <link rel&#x3D;"apple-touch-icon-precomposed" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;img&#x2F;apple-touch-icon.png" &#x2F;><br>    <link rel&#x3D;"stylesheet" type&#x3D;"text&#x2F;css" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;2017&#x2F;css&#x2F;common.css?v&#x3D;20190930" &#x2F;><br>    <link rel&#x3D;"stylesheet" type&#x3D;"text&#x2F;css" href&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;2017&#x2F;css&#x2F;art.css?v&#x3D;20190113" &#x2F;><br>    <script type&#x3D;"text&#x2F;javascript" src&#x3D;"https:&#x2F;&#x2F;img1.qianzhan.com&#x2F;scripts&#x2F;jquery-1.8.2.min.2017.js?v&#x3D;20170401" charset&#x3D;"UTF-8"><&#x2F;script><br><br>    <meta name&#x3D;"mobile-agent" content&#x3D;"format&#x3D;xhtml;url&#x3D;&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1" &#x2F;><br>    <link rel&#x3D;"alternate" media&#x3D;"only screen and(max-width: 760px)" href&#x3D;"&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1" &#x2F;><br>    <script type&#x3D;"text&#x2F;javascript"><br>        if (top.location !&#x3D; self.location) &#123;<br>            top.location &#x3D; self.location.href;<br>        &#125;<br>        if (window.location.href.indexOf("?from&#x3D;xw") > 0) &#123;<br>            sDialog.setCookie('computer', '1', 30, '.qianzhan.com');<br>        &#125;<br>        if (&#x2F;AppleWebKit.*Mobile&#x2F;i.test(navigator.userAgent) || (&#x2F;MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE&#x2F;.test(navigator.userAgent))) &#123;<br>            var computer &#x3D; sDialog.getCookie('computer');<br>            if (computer!&#x3D;"1") &#123;<br>                try &#123;<br>                    if (&#x2F;Android|Windows Phone|webOS|iPhone|iPod|BlackBerry&#x2F;i.test(navigator.userAgent)) &#123;<br>                        window.location.href &#x3D; '&#x2F;&#x2F;xw.qianzhan.com&#x2F;t&#x2F;detail&#x2F;556&#x2F;200418-4a7c3321.html?r&#x3D;1';<br>                    &#125;<br>                &#125; catch (e) &#123; &#125;<br>            &#125;<br>        &#125;<br>    <&#x2F;script><br><&#x2F;head><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="创建AutoResponder规则"><a href="#创建AutoResponder规则" class="headerlink" title="创建AutoResponder规则"></a>创建AutoResponder规则</h2><p>允许你从本地返回文件，而不用将http request 发送到服务器上</p><ul><li>1、打开百度，把logo图片保存到本地，并且对图片做些修改。</li><li>2、打开Fiddler 找到logo图片的会话，<code>https://www.baidu.com/img/bd_logo1.png</code>,把这个会话拖到<code>AutoResponer Tab</code>下</li><li>3 、选择AutoResponder选项卡【三个都选】<ul><li><code>Enable automatic reaponses</code>【是否启用自动匹配的规则】</li><li><code>Unmatched requests passthrough</code>【没有匹配搭配规则默认通过】</li><li><code>Enable Latency</code>【是否启用延迟】</li></ul></li><li>4、add rules</li><li>5、在<code>Rule Editor</code> 下面选择<ul><li><code>Find a file...</code> 选择本地保存的图片</li><li>最后点击Save 保存下。</li></ul></li><li>6、再打开百度, 你会看到首页的图片用的是本地的</li></ul><p>一些内置的bat的rules，存放在D:\fiddler4\ResponseTemplates</p><p>可以自己写规则,通用的匹配规则如下：</p><ul><li>无前缀<ul><li>表示基本搜索，搜索到字符串就匹配，只要match中包含了rules的字符串即可</li></ul></li><li>前缀为“<code>EXACT</code>”<ul><li>表示完全匹配，大小写敏感</li></ul></li><li>前缀为“<code>NOT</code>”<ul><li>表示发现就不匹配</li></ul></li><li>前缀为“<code>REGEX</code>”<ul><li>表示正则匹配</li><li><code>.+</code> ：匹配1个或多个字符<ul><li>如：<code>regex:.+jpg</code>，表示包含有jpg字符串且以jpg结尾即匹配</li></ul></li><li><code>.*</code> : 匹配0个或多个字符<ul><li>如：<code>regex:.+.jpg.*</code>，表示包含有.jpg字符串即匹配</li></ul></li><li><code>^</code> ： 匹配字符串开始位置</li><li><code>$</code> ： 匹配字符串结束位置<ul><li>如：<code>regex:(?insx).+.(jpg|png|bmp)$</code>，表示包含以jpg或png或bmp字符串结尾的，不区分大小写，且是单行的即匹配</li></ul></li></ul></li><li>前缀为<code>regex:(?insx)</code>的匹配方式<ul><li><code>i</code>：不区分大小写</li><li><code>n</code>：指定唯一有效的捕获是显示命名或编号的形式</li><li><code>s</code>：单行</li><li><code>x</code>：空格</li></ul></li></ul><p>规则实例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">- EXACT:http:&#x2F;&#x2F;www.baidu.com<br>- regex:(?inx).+\.jpg$  #匹配以jpg结尾的字符串<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="实例1【更改图片】"><a href="#实例1【更改图片】" class="headerlink" title="实例1【更改图片】"></a>实例1【更改图片】</h3><ul><li>1、进入<code>https://t.qianzhan.com/caijing/detail/200418-4a7c3321.html</code>，显示的是页面</li><li>2、找到显示图片的会话<ul><li><code>https://img3.qianzhan.com/news/202004/18/20200418-a7359eb01ab847fb_700x5000.jpg</code></li><li>inspectors选项卡中最下面栏中的Imageview可以显示图片</li></ul></li><li>3、选择AutoResponder选项卡,全选</li><li>4、add rules</li><li>5、在<code>Rule Editor</code> 下面选择<ul><li><code>Find a file...</code> 选择本地保存的图片</li><li>最后点击Save 保存下。</li></ul></li><li>6、再打开百度, 你会看到首页的图片用的是本地的</li></ul><h2 id="移动端抓包"><a href="#移动端抓包" class="headerlink" title="移动端抓包"></a>移动端抓包</h2><ul><li><p>tools -》 options -》 connectoins - 》 Allow remote computers to connect【勾选】</p></li><li><p>端口8888</p></li><li><p>cmd -》 ipconfig 【查看自己的IP地址】</p><ul><li>看无线连接</li><li>ipv4：xxx.xxx.xxx.xxx</li></ul></li><li><p>在手机上勾选手动代理</p><ul><li>输入代理服务器主机名：xxx.xxx.xxx.xxx</li><li>输入代理服务器端口：8888</li></ul></li><li><p>在手机上输入：<code>http://xxx.xxx.xxx.xxx:8888</code></p><ul><li>下载证书，显示<code>FiddlerRoot.cer</code></li><li>会输入锁屏密码</li><li>证书名称自定义为：fiddlerroot证书</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105606004&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;用fiddler简单抓包&lt;/a&gt;&lt;/p&gt;
&lt;h1 id
      
    
    </summary>
    
    
      <category term="渗透" scheme="http://lewis.qi.tk/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="fiddler" scheme="http://lewis.qi.tk/tags/fiddler/"/>
    
  </entry>
  
  <entry>
    <title>Liunx服务设置开机自启</title>
    <link href="http://lewis.qi.tk/2020/05/16/Liunx%E6%9C%8D%E5%8A%A1%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/"/>
    <id>http://lewis.qi.tk/2020/05/16/Liunx%E6%9C%8D%E5%8A%A1%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/</id>
    <published>2020-05-16T11:08:26.000Z</published>
    <updated>2020-05-16T11:20:47.402Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105884436" target="_blank" rel="noopener">Liunx服务设置开机自启</a></p><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><ul><li>init是所有进程的顶层，所有的启动脚本放置在<code>/etc/rc.d/init.d/</code>中</li><li>init始终是第一个进程（其进程编号始终为1）</li></ul><h2 id="bash脚本"><a href="#bash脚本" class="headerlink" title="bash脚本"></a>bash脚本</h2><p>第一部分</p><p>1、在系统/etc目录下</p><ul><li>可以找到rc0.d ~ rc6.d 启动文件夹，启动分为0~6一共7个级别</li></ul><p>2、rc?.d/ 中放置的是 init.d 中脚本的<strong>链接文件</strong>，命名格式如下:</p><ul><li><strong><em>/etc/rc?.d/链接文件链接到/etc/init.d/目录下的脚本</em></strong><ul><li><code>S{number}{name}</code><ul><li>S 开始的文件向脚本传递 start 参数</li></ul></li><li><code>K{number}{name}</code>【number 决定执行的顺序】<ul><li>K 开始的文件向脚本传递 stop 参数</li></ul></li></ul></li></ul><p>3、分析</p><ul><li>number 决定执行的顺序<ul><li>0代表停止</li><li>1代表单用户模式</li><li>2-5代表多用户模式</li><li>6代表重启</li></ul></li><li>查看权限和详细链接情况<ul><li>cd /etc/rc?.d/</li><li>ls -l</li></ul></li></ul><p>第二部分【脚本编写，我未来再来深究】</p><ul><li>4、在/etc/init.d/目录下<strong>编写脚本</strong>，脚本格式如下</li><li>#! /bin/sh<ul><li>这是bash脚本的头，必须要添加，是为了设置defaults的值。</li></ul></li></ul><p>这个是挂载共享文件夹的脚本名字任意 这里命名为mount</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sh">这是bash脚本的头 必须要添加 应该是为了设置defaults的值 否则不成功<br><span class="hljs-meta">#! /bin/sh</span><br><span class="hljs-comment">### BEGIN INIT INFO</span><br><span class="hljs-comment"># Provides: OnceDoc</span><br><span class="hljs-comment"># Required-Start: $network $remote_fs $local_fs</span><br><span class="hljs-comment"># Required-Stop: $network $remote_fs $local_fs</span><br><span class="hljs-comment"># Default-Start: 2 3 4 5</span><br><span class="hljs-comment"># Default-Stop: 0 1 6</span><br><span class="hljs-comment"># Short-Description: start and stop node</span><br><span class="hljs-comment"># Description: OnceDoc</span><br><span class="hljs-comment">### END INIT INFO</span><br>vmware-hgfsclient | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> folder; <span class="hljs-keyword">do</span><br>  vmwpath=<span class="hljs-string">"/mnt/hgfs/<span class="hljs-variable">$&#123;folder&#125;</span>"</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">"[i] Mounting <span class="hljs-variable">$&#123;folder&#125;</span>   (<span class="hljs-variable">$&#123;vmwpath&#125;</span>)"</span><br>  mkdir -p <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span><br>  umount -f <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span> 2&gt;/dev/null<br>  vmhgfs-fuse -o allow_other -o auto_unmount <span class="hljs-string">".host:/<span class="hljs-variable">$&#123;folder&#125;</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span><br><span class="hljs-keyword"><code class="language-hljs sh">这是bash脚本的头 必须要添加 应该是为了设置defaults的值 否则不成功<br><span class="hljs-meta">#! /bin/sh</span><br><span class="hljs-comment">### BEGIN INIT INFO</span><br><span class="hljs-comment"># Provides: OnceDoc</span><br><span class="hljs-comment"># Required-Start: $network $remote_fs $local_fs</span><br><span class="hljs-comment"># Required-Stop: $network $remote_fs $local_fs</span><br><span class="hljs-comment"># Default-Start: 2 3 4 5</span><br><span class="hljs-comment"># Default-Stop: 0 1 6</span><br><span class="hljs-comment"># Short-Description: start and stop node</span><br><span class="hljs-comment"># Description: OnceDoc</span><br><span class="hljs-comment">### END INIT INFO</span><br>vmware-hgfsclient | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> folder; <span class="hljs-keyword">do</span><br>  vmwpath=<span class="hljs-string">"/mnt/hgfs/<span class="hljs-variable">$&#123;folder&#125;</span>"</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">"[i] Mounting <span class="hljs-variable">$&#123;folder&#125;</span>   (<span class="hljs-variable">$&#123;vmwpath&#125;</span>)"</span><br>  mkdir -p <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span><br>  umount -f <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span> 2&gt;/dev/null<br>  vmhgfs-fuse -o allow_other -o auto_unmount <span class="hljs-string">".host:/<span class="hljs-variable">$&#123;folder&#125;</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$&#123;vmwpath&#125;</span>"</span><br><span class="hljs-keyword">done</span><br>sleep 2s<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="使用自启动命令"><a href="#使用自启动命令" class="headerlink" title="使用自启动命令"></a>使用自启动命令</h2><ul><li>1、添加开机自启项【xxx服务名】<ul><li>update-rc.d xxx defaults 99<ul><li>(99是启动顺序)</li><li>重启即可</li></ul></li></ul></li><li>2、查看开机启动项<ul><li>cat /etc/rc*.d</li></ul></li><li>3、移除开机启动项<ul><li>update-rc.d -f xxx remove</li></ul></li></ul><h2 id="例子：开机自启apache2"><a href="#例子：开机自启apache2" class="headerlink" title="例子：开机自启apache2"></a>例子：开机自启apache2</h2><ul><li>update-rc.d -f apache2 defaults</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105884436&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Liunx服务设置开机自启&lt;/a&gt;&lt;/p&gt;
&lt;h2 i
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="centos8" scheme="http://lewis.qi.tk/tags/centos8/"/>
    
      <category term="centos6" scheme="http://lewis.qi.tk/tags/centos6/"/>
    
      <category term="kali" scheme="http://lewis.qi.tk/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>Liunx-centos8 yum操作+安装mysql8+安装nginx</title>
    <link href="http://lewis.qi.tk/2020/05/16/Liunx-centos8-yum%E6%93%8D%E4%BD%9C-%E5%AE%89%E8%A3%85mysql8-%E5%AE%89%E8%A3%85nginx/"/>
    <id>http://lewis.qi.tk/2020/05/16/Liunx-centos8-yum%E6%93%8D%E4%BD%9C-%E5%AE%89%E8%A3%85mysql8-%E5%AE%89%E8%A3%85nginx/</id>
    <published>2020-05-16T11:08:09.000Z</published>
    <updated>2020-05-16T11:19:09.220Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105471864" target="_blank" rel="noopener">Liunx-centos8 yum操作+安装mysql8+安装nginx</a></p><h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><p>1、Yum仓库是Linux软件仓库(保存RPM包)。</p><ul><li>YUM仓库可以设置在本地（本地磁盘），也可以设置在或远端（FTP，HTTP或HTTPS）。</li></ul><p>2、RPM包是Red Hat Package Manager管理的文件， RPM包可以在Red Hat / CentOS上快速轻松地安装软件。</p><p>将yum源设置为163 yum，提升软件包安装和更新的速度</p><p>列出所有可更新的软件清单：</p><ul><li><code>yum check-update</code></li></ul><p>更新所有软件命令：</p><ul><li><code>yum update</code></li></ul><p>仅安装指定的软件命令：</p><ul><li><code>yum -y install &lt;package_name&gt;</code></li></ul><p>仅更新指定的软件命令：</p><ul><li><code>yum update &lt;package_name&gt;</code></li></ul><p>列出所有可安裝的软件清单命令：</p><ul><li><code>yum list</code></li></ul><p>删除软件包命令：</p><ul><li><code>yum remove &lt;package_name&gt;</code></li></ul><p>查找软件包 命令：</p><ul><li><code>yum search &lt;keyword&gt;</code></li></ul><p>清除缓存目录下的软件包</p><ul><li><code>yum clean packages</code></li></ul><p>清除缓存目录下的 headers</p><ul><li><code>yum clean headers</code></li></ul><h2 id="安装OpenSSL"><a href="#安装OpenSSL" class="headerlink" title="安装OpenSSL"></a>安装OpenSSL</h2><p>先看一下有无安装</p><ul><li><p>安装</p></li><li><p><code>yum install openssh-server</code></p></li></ul><h2 id="安装mysql8"><a href="#安装mysql8" class="headerlink" title="安装mysql8"></a>安装mysql8</h2><p>下载 关于myssql的Yum 资源包</p><ul><li><code>wget https://dev.mysql.com/get/mysql80-community-release-el8-1.noarch.rpm</code></li><li><code>rpm -Uvh mysql80-community-release-el8-1.noarch.rpm</code></li></ul><p>查看rpm包里可用mysql版本</p><ul><li><code>yum repolist all | grep mysql</code></li></ul><p>启用和禁用安装服务</p><ul><li><code>yum config-manager --enable mysql80-community</code></li><li><code>yum config-manager --disable mysql80-community</code></li></ul><p>查看所有启用状态的可安装服务</p><ul><li><code>yum repolist enabled | grep mysql</code></li></ul><p>安装mysql服务</p><ul><li><code>yum install mysql-server</code></li></ul><p>更新mysql</p><ul><li><code>yum update mysql-server</code></li></ul><p>初始化mysql数据库</p><ul><li><code>mysqld --initialize</code></li></ul><p>启动mysql</p><ul><li><code>chown mysql:mysql -R /var/lib/mysql</code></li><li><code>service mysqld start</code></li><li><code>systemctl status mysqld</code></li></ul><p>查看mysql版本</p><ul><li><code>mysql -V</code></li></ul><p>获取mysql初始密码</p><ul><li><code>grep &quot;password&quot; /var/log/mysql/mysqld.log</code></li></ul><p>登录并修改密码</p><ul><li><code>mysql -u root -p</code></li><li><code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;</code></li><li><code>flush privileges;</code></li><li><code>exit;</code></li></ul><p>再次登录</p><ul><li><code>mysql -u root -p</code></li></ul><p>设置远程连接</p><ul><li><code>use mysql;</code></li><li><code>update user set host = &#39;%&#39; where user = &#39;root&#39;;</code></li><li><code>select host, user from user;</code></li><li><code>flush privileges;</code></li><li><code>exit;</code></li></ul><p>重启mysql服务</p><ul><li><code>service mysqld restart;</code></li></ul><p>查看mysql、防火墙服务状态、关闭防火墙</p><ul><li><code>service mysqld status</code></li><li><code>:q</code>【退出查看】</li><li><code>systemctl status firewalld</code></li><li><code>systemctl stop firewalld</code></li><li><code>systemctl disable firewalld</code> 【永久关闭防火墙】</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">[root@www ~]# systemct1 disable firewalld<br>Removed &#x2F;etc&#x2F; systemd&#x2F; system&#x2F; multi-user. target . wants&#x2F; firewalld. service .<br>Removed &#x2F; etc&#x2F; systemd&#x2F; system&#x2F; dbus- org. fedoraproject . FirewallD1. service.<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>设置mysql开机自启</p><ul><li><code>systemctl enable mysqld</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">[ root@www ~]# systemctl enable mysqld<br>Created symlink &#x2F; etc&#x2F; sy stemd&#x2F; system&#x2F; multi user .target wants&#x2F;mysq1d. service +&#x2F;usr&#x2F; 1ib&#x2F; systemd &#x2F; system&#x2F; mysqld. service .<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><p>安装</p><ul><li><code>yum install nginx -y</code></li></ul><p>设置开机启动</p><ul><li><code>systemctl enable nginx</code></li></ul><p>启动软件</p><ul><li><code>systemctl start nginx</code></li></ul><p>查看安装版本</p><ul><li><code>nginx -V</code></li></ul><p>设置防火墙规则</p><ul><li><code>firewall-cmd --permanent --zone=public --add-service=http</code></li><li><code>firewall-cmd --permanent --zone=public --add-service=https</code></li><li><code>firewall-cmd --reload</code></li></ul><p>测试，打开浏览器，访问IP或者访问主机名www即可</p><ul><li><code>你自己设的IP地址</code> 【windows的IP是<code>127.0.0.1</code>】</li><li><code>你自己设的主机名</code> 【windows的主机名是<code>localhost</code>】</li></ul><p>配置文件目录<br>主配置文件：/etc/nginx/nginx.conf<br>默认文件目录：/usr/share/nginx/html<br>错误日志：/var/log/nginx/error.log<br>访问日志：/var/log/nginx/access.log  </p><ul><li><code>cd nginx.conf</code></li><li><code>cat nginx.conf</code></li></ul><p>nginx.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs conf"><code class="language-hljs conf"># For more information on configuration, see:<br>#   * Official English Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;<br>#   * Official Russian Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;<br><br>user nginx;<br>worker_processes auto;<br>error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;<br>pid &#x2F;run&#x2F;nginx.pid;<br><br># Load dynamic modules. See &#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx&#x2F;README.dynamic.<br>include &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;modules&#x2F;*.conf;<br><br>events &#123;<br>    worker_connections 1024;<br>&#125;<br><br>http &#123;<br>    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '<br>                      '$status $body_bytes_sent "$http_referer" '<br>                      '"$http_user_agent" "$http_x_forwarded_for"';<br><br>    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;<br><br>    sendfile            on;<br>    tcp_nopush          on;<br>    tcp_nodelay         on;<br>    keepalive_timeout   65;<br>    types_hash_max_size 2048;<br><br>    include             &#x2F;etc&#x2F;nginx&#x2F;mime.types;<br>    default_type        application&#x2F;octet-stream;<br><br>    # Load modular configuration files from the &#x2F;etc&#x2F;nginx&#x2F;conf.d directory.<br>    # See http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;ngx_core_module.html#include<br>    # for more information.<br>    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;<br><br>    server &#123;<br>        listen       80 default_server;<br>        listen       [::]:80 default_server;<br>        server_name  _;<br>        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br><br>        # Load configuration files for the default server block.<br>        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br><br>        location &#x2F; &#123;<br>        &#125;<br><br>        error_page 404 &#x2F;404.html;<br>            location &#x3D; &#x2F;40x.html &#123;<br>        &#125;<br><br>        error_page 500 502 503 504 &#x2F;50x.html;<br>            location &#x3D; &#x2F;50x.html &#123;<br>        &#125;<br>    &#125;<br><br># Settings for a TLS enabled server.<br>#<br>#    server &#123;<br>#        listen       443 ssl http2 default_server;<br>#        listen       [::]:443 ssl http2 default_server;<br>#        server_name  _;<br>#        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br>#<br>#        ssl_certificate "&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;server.crt";<br>#        ssl_certificate_key "&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;private&#x2F;server.key";<br>#        ssl_session_cache shared:SSL:1m;<br>#        ssl_session_timeout  10m;<br>#        ssl_ciphers PROFILE&#x3D;SYSTEM;<br>#        ssl_prefer_server_ciphers on;<br>#<br>#        # Load configuration files for the default server block.<br>#        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br>#<br>#        location &#x2F; &#123;<br>#        &#125;<br>#<br>#        error_page 404 &#x2F;404.html;<br>#            location &#x3D; &#x2F;40x.html &#123;<br>#        &#125;<br>#<br>#        error_page 500 502 503 504 &#x2F;50x.html;<br>#            location &#x3D; &#x2F;50x.html &#123;<br>#        &#125;<br>#    &#125;<br><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105471864&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Liunx-centos8 yum操作+安装mysql
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="centos8" scheme="http://lewis.qi.tk/tags/centos8/"/>
    
  </entry>
  
  <entry>
    <title>Liunx-centos8入门+配置网络</title>
    <link href="http://lewis.qi.tk/2020/05/16/Liunx-centos8%E5%85%A5%E9%97%A8-%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C/"/>
    <id>http://lewis.qi.tk/2020/05/16/Liunx-centos8%E5%85%A5%E9%97%A8-%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C/</id>
    <published>2020-05-16T11:07:51.000Z</published>
    <updated>2020-05-16T11:17:45.931Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105471808" target="_blank" rel="noopener">Liunx-centos8入门+配置网络</a></p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>Linux 用户登陆输入密码时，字符是不显示的，防止别人看见你密码的位数<br>Linux预设提供了<strong>六个命令窗口终端机</strong>让我们来登录。</p><ul><li>Liunx系统<ul><li>命令窗口切换的快捷键为 <code>Ctrl + Alt + F1 ~ F6</code></li><li>命令窗口界面返回图形界面,按下Ctrl + Alt + F7 就回来</li></ul></li><li>vm虚拟机的Liunx系统<ul><li>命令窗口切换的快捷键为 <code>Alt + Space + F1 ~ F6</code></li><li>图形界面界面返回命令窗口按 <code>Alt + Shift + Ctrl + F1~F6</code></li></ul></li></ul><p>查看LIunx版本</p><ul><li><code>cat /etc/redhat-release</code></li></ul><p>添加终端快捷方式</p><ul><li><p><code>terminal</code></p></li><li><p><code>/usr/bin/gnome-terminal</code></p></li><li><p><code>ctrl+</code>`</p></li></ul><p>命令解析器</p><ul><li><p>unix系统</p><ul><li>shell</li></ul></li><li><p>Linux系统</p><ul><li>bash·····</li></ul></li><li><p><code>Bourne Shell</code></p><ul><li>（/usr/bin/sh或/bin/sh）</li></ul></li><li><p><code>Bourne Again Shell</code> 【即bash】</p><ul><li>（/bin/bash）</li></ul></li><li><p><code>C Shell</code></p><ul><li>（/usr/bin/csh）</li></ul></li><li><p><code>K Shell</code></p><ul><li>（/usr/bin/ksh）</li></ul></li><li><p><code>Shell for Root</code></p><ul><li>（/sbin/sh）</li></ul></li></ul><p>Linux快捷键</p><ul><li><code>Tab键</code><ul><li>自动补全路径</li></ul></li><li><code>cd /xxx</code><ul><li>进入目录</li></ul></li><li><code>ctrl + p</code>  或 上<ul><li>上一条执行过的命令</li></ul></li><li><code>ctrl + n</code>  或 下<ul><li>下一条执行过的命令</li></ul></li><li><code>ctrl + b</code> 或 左<ul><li>光标左移</li></ul></li><li><code>ctrl + f</code> 或 右<ul><li>光标右移</li></ul></li><li><code>ctrl + a</code><ul><li>光标移到行首</li></ul></li><li><code>ctrl + e</code><ul><li>光标移到行尾</li></ul></li></ul><h2 id="开机过程"><a href="#开机过程" class="headerlink" title="开机过程"></a>开机过程</h2><p>1.内核的引导。<br>2.运行 init。<br>3.系统初始化。<br>4.建立终端 。<br>5.用户登录系统。  </p><ul><li>1.BIOS 开机自检，按照BIOS中设置的启动设备（通常是硬盘）来启动<ul><li><code>/boot</code> 目录下的内核文件</li></ul></li><li>2.init 进程是系统所有进程的起点<ul><li><code>/etc/inittab</code> 读取配置文件</li></ul></li><li>运行这些开机启动的程序，叫做”守护进程”（daemon）</li><li>启动时根据”运行级别”，确定要运行哪些程序<ul><li>运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动</li><li>运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆</li><li>运行级别2：多用户状态(没有NFS)</li><li>运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式</li><li>运行级别4：系统未使用，保留</li><li>运行级别5：X11控制台，登陆后进入图形GUI模式</li><li>运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动</li></ul></li><li>系统初始化<ul><li><code>si::sysinit:/etc/rc.d/rc.sysinit</code>它调用执行了<code>/etc/rc.d/rc.sysinit</code></li><li>激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务</li></ul></li><li>用户登录系统<ul><li>如果用户名不是 root，且存在 <code>/etc/nologin</code> 文件，login 将输出 nologin 文件的内容，然后退出。</li><li>只有 <code>/etc/securetty</code> 中登记了的终端才允许 root 用户登录</li></ul></li></ul><h2 id="关机、重启"><a href="#关机、重启" class="headerlink" title="关机、重启"></a>关机、重启</h2><p>选项关机</p><ul><li>System -&gt; Shut down -&gt;Shut down</li></ul><p>将数据由内存同步到硬盘中</p><ul><li><code>sync</code></li></ul><p>关机</p><ul><li><code>shutdown -h now</code>  <ul><li>【root，最安全】立即关机</li></ul></li><li><code>shutdown –h 20:25</code><ul><li>【root】今天20:25关机</li></ul></li><li><code>shutdown –h +10</code><ul><li>【root】十分钟后关机，单位：分</li></ul></li><li><code>poweroff</code><ul><li>【最常用】</li></ul></li><li><code>halt</code>  <ul><li>【最简单】等同于shutdown –h now 或 poweroff</li></ul></li><li><code>init 0</code><ul><li>init定义了8个运行级别，<code>init 0</code> 为<strong>关机</strong>，<code>init 1</code> 为<strong>重启</strong></li></ul></li></ul><p>取消关机</p><ul><li><code>shutdown -c</code><ul><li>【root】</li></ul></li></ul><p>重启</p><ul><li><code>reboot</code><ul><li>立马重启</li></ul></li><li><code>shutdown –r now</code><ul><li>立马重启</li></ul></li><li><code>shutdown –r +10</code><ul><li>十分钟后重启</li></ul></li></ul><p>正确的关机流程为：</p><ul><li><code>sync &gt; shutdown &gt; reboot &gt; halt</code></li></ul><h2 id="系统文件"><a href="#系统文件" class="headerlink" title="系统文件"></a>系统文件</h2><h2 id="1-用户"><a href="#1-用户" class="headerlink" title="1.用户"></a>1.用户</h2><p>用户分为</p><ul><li><strong>owner [属主]</strong></li><li><strong>group [属组]</strong></li><li><strong>others [其他]</strong></li><li><strong>all [所有用户]</strong></li></ul><p>查看文件权限信息</p><ul><li><code>ls -l</code><ul><li>第一列：<code>-</code> 表示文件、 <code>d</code> 表示目录</li><li>第一列还有所有者权限、用户组权限、其他用户权限</li><li>以上共10个数字：1|3|3|3、-/d|owner|group|others</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)<br>数字    说明                                            权限<br>0       没有任何权限                                     ---<br>1       执行权限                                        --x<br>2       写入权限                                        -w-<br>3       执行权限和写入权限：1 (执行) + 2 (写入) &#x3D; 3       -wx<br>4       读取权限                                        r--<br>5       读取和执行权限：4 (读取) + 1 (执行) &#x3D; 5          r-x<br>6       读取和写入权限：4 (读取) + 2 (写入) &#x3D; 6          rw-<br>7       所有权限: 4 (读取) + 2 (写入) + 1 (执行) &#x3D; 7     rwx<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>更改文件属性【加上-R的参数，那么该目录下的所有文件的属组都会更改】</p><p>1、chgrp：更改文件属组</p><ul><li><code>chgrp [-R] 属组名 文件名</code></li></ul><p>2、chown：更改文件属主，也可以同时更改文件属组</p><ul><li><code>chown [–R] 属主名 文件名</code></li><li><code>chown [-R] 属主名：属组名 文件名</code></li></ul><p>3、chmod：更改文件9个属性【xyz 为数字，就是 rwx 属性数值的相加】</p><ul><li><code>chmod [-R] xyz 文件或目录</code></li><li><code>chmod [-R] u=rwx,g=rwx,o=rwx 文件名</code></li></ul><h3 id="2-文件"><a href="#2-文件" class="headerlink" title="2.文件"></a>2.文件</h3><p>文件目录系统是<strong>树结构</strong></p><p>使用 <code>man [命令]</code> 来查看各个命令的使用文档，如 ：<code>man cp</code></p><p>显示目前的目录</p><ul><li><code>pwd</code> 【以连结档的数据显示】</li><li><code>pwd -P</code> 【不以连结档的数据显示，而是显示正确的完整路径】</li></ul><p>创建一个新的目录</p><ul><li><code>mkdir</code></li></ul><p>删除一个空的目录</p><ul><li><code>rmdir</code></li></ul><p>查看目录</p><ul><li><code>ls /</code></li></ul><p>查看文件</p><ul><li><code>ls</code></li></ul><p>查看所有文件（隐藏文件）</p><ul><li><code>ls -a</code></li></ul><p>查看当前目录下的所有文件列表</p><ul><li><code>ls -al</code></li><li><code>[权限][文件数][所有者][用户组][文件容量][修改日期][文件名]</code></li></ul><p>【注：查看用户】</p><ul><li>1.<code>cd /home</code></li><li>2.<code>ls</code></li></ul><p>切换用户目录</p><ul><li>绝对目录：从根目录开始写<ul><li><code>cd /root/aaa/</code>  【使用绝对路径切换到 aaa 目录】</li></ul></li><li>相对目录：相对于当前工作目录而言<ul><li><code>.</code> 【当前目录】</li><li><code>cd ./aaa/</code>  【使用相对路径切换到 aaa 目录】</li><li><code>..</code> 【当前的上一级目录，如 cd ../man】</li><li><code>cd -</code> 【在两个临近的目录间切换】</li><li><code>cd ~</code> 【切换到根目录】</li></ul></li></ul><h3 id="3-文件的操作"><a href="#3-文件的操作" class="headerlink" title="3.文件的操作"></a>3.文件的操作</h3><p>创建</p><ul><li><code>touch filename</code></li></ul><p>编辑</p><ul><li><code>vi filename</code></li></ul><p>查看</p><ul><li><code>cat filename</code></li></ul><p>复制</p><ul><li><code>cp filename copyfile</code></li></ul><p>重命名</p><ul><li><code>mv filename newfile</code></li></ul><p>删除</p><ul><li><code>rm filename filename2</code></li></ul><p>统计词数</p><ul><li><code>wc filename</code></li></ul><p>重定向【改变输入输出设备，$\color{red}箭头的方向注入$】</p><ul><li><code>echo hello &gt; hello.txt</code><ul><li>把hello打印到hello.txt的文本中【覆盖】</li></ul></li><li><code>echo hello &gt;&gt; hello.txt</code><ul><li>把hello打印到hello.txt的文本中【追加】</li></ul></li><li><code>cat &lt; hello.txt</code><ul><li>把hello.txt输出查看</li></ul></li></ul><p>管道【将前一个命令的标准输出作为下一个程序的标准输入】</p><ul><li><code>cat hello.txt | grep -n 8</code><ul><li>先查看<code>hello.txt</code>文件，再查找<code>8</code>数字，<code>-n</code> 是显示行号</li></ul></li><li><code>cat hello.txt | grep -n 8 &gt; cat.txt</code><ul><li>先查看<code>hello.txt</code>文件，再查找<code>8</code>数字，<code>-n</code> 是显示行号，写入<code>cat.txt</code>文件</li></ul></li></ul><p>Linux程序运行时都会创建三个文件流</p><ul><li><strong>标准输入流(stdin)</strong><ul><li>stdin的文件描述符为0，Linux程序默认从stdin<strong>读取</strong>数据。</li></ul></li><li><strong>标准输出流(stdout)</strong><ul><li>stdout 的文件描述符为1，Linux程序默认向stdout<strong>输出</strong>数据。</li></ul></li><li><strong>标准错误流(stderr)</strong><ul><li>stderr的文件描述符为2，Linux程序会向stderr流中<strong>写入错误</strong>信息。</li></ul></li></ul><h2 id="文件链接"><a href="#文件链接" class="headerlink" title="文件链接"></a>文件链接</h2><p>硬链接（Hard Link），软（符号）链接（Symbolic Link）</p><p><strong>硬链接</strong></p><ul><li>硬连接指通过索引节点来进行连接。多个文件名指向同一索引节点是存在的</li><li>作用：$\color{red}允许一个文件拥有多个有效路径名，防止“误删”$</li><li>A 是 B 的硬链接（A 和 B 都是文件名）<ul><li>则 A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号相同。</li><li>一个 inode 节点对应两个不同的文件名</li><li>删除其中任何一个都不会影响另外一个的访问。</li></ul></li></ul><p><strong>软链接</strong></p><ul><li>类似于 Windows 的快捷方式</li><li>文件实际上是一个文本文件，其中包含的有另一文件的位置信息</li><li>A 是 B 的软链接（A 和 B 都是文件名）<ul><li>A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号不相同。</li><li>A 和 B 指向的是两个不同的 inode，继而指向两块不同的数据块。但是 A 的数据块中存放的只是 B 的路径名（可以根据这个找到 B 的目录项）</li></ul></li></ul><p>测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">[oracle@Linux]$ touch f1          #创建测试文件f1<br>[oracle@Linux]$ ln f1 f2          #创建f1的一个硬连接文件f2<br>[oracle@Linux]$ ln -s f1 f3       #创建f1的一个符号连接文件f3<br>[oracle@Linux]$ ls -li            # -i参数显示文件的inode节点信息<br>total 0<br>9797648 -rw-r--r--  2 oracle oinstall 0 Apr 21 08:11 f1<br>9797648 -rw-r--r--  2 oracle oinstall 0 Apr 21 08:11 f2<br>9797649 lrwxrwxrwx  1 oracle oinstall 2 Apr 21 08:11 f3 -> f1<br><br>#在f1文件输入内容<br>[oracle@Linux]$ echo "I am f1 file" >>f1<br><br>#查看f1<br>[oracle@Linux]$ cat f1<br>I am f1 file<br><br>#删除f1后<br>[oracle@Linux]$ rm -f f1<br><br>#查看f2,f3<br>[oracle@Linux]$ cat f2<br>I am f1 file<br>[oracle@Linux]$ cat f3<br>cat: f3: No such file or directory<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li>第一列是inode节点</li><li>原文件 <code>f1</code> 与硬连接文件 <code>f2</code> 的 <strong>inode节点相同</strong>，均为 9797648。</li><li>原文件 <code>f1</code> 与软连接文件 <code>f3</code> 的 <strong>inode节点相同</strong>。</li><li>删除原始文件 <code>f1</code> 后，硬连接 <code>f2</code> 不受影响，软连接 <code>f3</code> 文件无效</li></ul><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>添加账号</p><ul><li><code>useradd 选项 用户名</code></li><li><code>useradd –d  /home/sam -m sam -s /bin/sh -g group –G adm,root gem</code><ul><li>选项</li><li><code>-c</code> 注释。</li><li><code>-d</code> 指定用户主目录，如果目录不存在，则同时 <code>-m</code> ，创建主目录。</li><li><code>-g</code> 指定用户所属的用户组。</li><li><code>-G</code> 指定用户所属的附加组。</li><li><code>-s</code> 指定用户的登录Shell。</li><li><code>-u</code> 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。</li></ul></li></ul><p>删除帐号</p><ul><li><code>userdel 选项 用户名</code></li><li><code>userdel -r sam</code><ul><li>选项</li><li><code>-r</code> 把用户的主目录一起删除。</li></ul></li></ul><p>修改帐号</p><ul><li><code>usermod 选项 用户名</code></li><li><code>usermod -s /bin/ksh -d /home/z –g developer sam</code><ul><li>选项</li><li><code>-c, -d, -m, -g, -G, -s, -u</code> 同上</li><li><code>-o</code></li></ul></li></ul><p>用户口令密码管理</p><ul><li><code>passwd 选项 用户名</code><ul><li>选项</li><li><code>-l</code> 禁用账号，不能登录。【passwd -l sam】</li><li><code>-u</code> 口令解锁。</li><li><code>-d</code> 使账号无口令。【passwd -d sam】</li><li><code>-f</code> 强迫用户下次登录时修改口令。</li></ul></li></ul><p>普通用户<br>$ <code>passwd</code><br>Old password:<br>New password:<br>Re-enter new password:  </p><p>超级用户<br>$ <code>passwd sam</code><br>New password:<br>Re-enter new password:  </p><h2 id="用户组管理"><a href="#用户组管理" class="headerlink" title="用户组管理"></a>用户组管理</h2><p>增加一个新的用户组【新组标识号GID是在当前已有的最大组标识号的基础上加1】</p><ul><li><code>groupadd 选项 用户组</code></li><li><code>groupadd -g 101 group1</code><ul><li>选项</li><li><code>-g</code> 指定GID。</li><li><code>-o</code> 与-g选项同时使用，表示新用户组GID与已有用户组GID相同。</li></ul></li></ul><p>删除用户组</p><ul><li><code>groupdel 用户组</code></li></ul><p>修改用户组</p><ul><li><code>groupmod 选项 用户组</code></li><li><code>groupmod –g 10000 -n group1 group2</code> 【组group1的GID改为10000，组名修改为group2】<ul><li>选项</li><li><code>-g、-G</code> 同上</li><li><code>-n</code> 将用户组名字改为新名字</li></ul></li></ul><p>一个用户同时属于多个用户组，用户可以在用户组之间切换</p><ul><li>作用：具有不同用户组的权限。</li></ul><p>切换到要到的用户组</p><ul><li><code>newgrp 目的用户组</code></li><li><code>newgrp root</code></li></ul><p>查看用户管理</p><p>一、<code>cat /etc/passwd</code></p><ul><li><code>用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell</code></li><li>大多都是伪用户</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash<br>···<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>二、<code>cat /etc/shadow</code></p><ul><li><code>登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志</code></li><li>/etc/shadow中的记录行与/etc/passwd中的一一对应</li></ul><p>三、<code>cat /etc/group</code></p><ul><li><code>组名:口令:组标识号:组内用户列表</code></li><li>用户组的所有信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">root:x:0:<br>bin:x:1:bin,daemon<br>daemon:x:2:bin,daemon<br>sys:x:3:bin,adm<br>···<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="超级用户root"><a href="#超级用户root" class="headerlink" title="超级用户root"></a>超级用户root</h2><p>切换到超级用户</p><ul><li><code>sudo su</code></li></ul><p>退出超级用户</p><ul><li><code>exit</code></li></ul><h2 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h2><p>检查文件系统的磁盘空间占用<strong>大小</strong>情况</p><ul><li><code>df [-ahikHTm] [目录或文件名]</code></li><li><code>df -h</code><ul><li>选项【默认Kbytes，8 Kbytes = 1 KBytes】</li><li><code>-a</code> ：列出所有的文件系统。</li><li><code>-k</code> ：KBytes容量显示。</li><li><code>-m</code> ：MBytes容量显示。</li><li><code>-h</code> ：GBytes, MBytes, KBytes 格式自行容量显示。</li><li><code>-H</code> ：以 M=1000K 取代 M=1024K 的进位方式。</li><li><code>-T</code> ：显示文件系统类型。</li><li><code>-i</code> ：以 inode 的数量显示。</li></ul></li></ul><p>检查文件系统的磁盘空间占用<strong>数量</strong>情况</p><ul><li><code>du [-ahskm] 文件或目录名称</code></li><li><code>du -h / du</code><ul><li>选项</li><li><code>-a 、-k 、-m 、-h</code> 同上</li><li><code>-s</code> ：列出总量而已，而不列出每个各别的目录占用容量；</li><li><code>-S</code> ：不包括子目录下的总计，与 -s 有点差别。</li></ul></li></ul><p>磁盘分区表操作工具</p><ul><li><code>fdisk [-l] 装置名称</code></li><li><code>fdisk</code><ul><li>选项</li><li><code>-l</code> ：输出后面接的装置所有的分区内容</li></ul></li></ul><h2 id="mount挂载"><a href="#mount挂载" class="headerlink" title="mount挂载"></a>mount挂载</h2><p>首先增加硬盘，然后格式化硬盘，在硬盘上创建分区，创建目录，最后再挂载</p><p>1.Windows下的mount挂载，就是给磁盘分区提供一个盘符（C,D,E,…）</p><ul><li>U盘插入为mount</li><li>U盘拔出为unmount</li></ul><p>2.Linux下只有一个根目录/，分配给linux的所有区都在/下的某个位置</p><ul><li><code>mount /dev/sdb1  ~/Share/</code><ul><li><code>/dev</code>是目录，<code>/dev/sdb1</code>不是目录，<code>ls /dev/sdb1</code>无法执行。</li><li>因为/dev/sdb1，是一个类似指针的东西，指向这个分区的原始数据块。</li><li>mount前，系统并不知道这个数据块哪部分数据代表文件，如何对它们操作。</li></ul></li></ul><p>分析：</p><ul><li>把新硬盘区<code>sdb1</code>挂载到工作目录的<code>~/Share/</code>文件夹下</li><li>之后访问这个<code>~/Share/</code>文件夹就相当于访问这个硬盘的<code>sdb1</code>分区了</li></ul><h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p><code>sudo</code>是linux系统管理指令<br>允许让普通用户执行一些或者全部的root命令的一个工具，如halt，reboot，su等等</p><h2 id="centos8"><a href="#centos8" class="headerlink" title="centos8"></a>centos8</h2><p>CentOS 8主要使用AppStream, BaseOS, Extras三个仓库</p><p>打开终端</p><ul><li><code>CTRL + ALT + T</code></li></ul><h3 id="连接网络，设置IP地址"><a href="#连接网络，设置IP地址" class="headerlink" title="连接网络，设置IP地址"></a>连接网络，设置IP地址</h3><p>1、手动更改网络接口配置文件，查看网络接口</p><ul><li><code>ip link show</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000<br>    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>2: ens160: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000<br>    link&#x2F;ether 这里是你的MAC地址 brd ff:ff:ff:ff:ff:ff<br>···<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>2、选择第二个ens160网络接口，进入网络配置文件目录</p><ul><li><code>cd  /etc/sysconfig/network-scripts/</code></li></ul><p>3、在vim编辑器中修改：文件名称是ifcfg- 网卡名称</p><ul><li><code>vi ifcfg-ens160</code></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs vim">···<br>BROWSER_ONLY=<span class="hljs-keyword">no</span><br>BOOTPROTO=static<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=<span class="hljs-keyword">no</span><br>IPV6INIT=yes<br>IPV6_AUTOCONF=yes<br>IPV6_DEFROUTE=yes<br>IPV6_FAILURE_FATAL=<span class="hljs-keyword">no</span><br>IPV6_ADDR_GEN_MODE=stable-privacy<br>NAME=ens160<br>UUID=你自己的UUID<br>DEVICE=ens160<br>ONBOOT=yes<br>IPADDR=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.60</span><br>PREFIX=<span class="hljs-number">24</span><br>GATEWAY=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.2</span><br>DNS1=<span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span><br>DNS2=<span class="hljs-number">8.8</span>.<span class="hljs-number"><code class="language-hljs vim">···<br>BROWSER_ONLY=<span class="hljs-keyword">no</span><br>BOOTPROTO=static<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=<span class="hljs-keyword">no</span><br>IPV6INIT=yes<br>IPV6_AUTOCONF=yes<br>IPV6_DEFROUTE=yes<br>IPV6_FAILURE_FATAL=<span class="hljs-keyword">no</span><br>IPV6_ADDR_GEN_MODE=stable-privacy<br>NAME=ens160<br>UUID=你自己的UUID<br>DEVICE=ens160<br>ONBOOT=yes<br>IPADDR=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.60</span><br>PREFIX=<span class="hljs-number">24</span><br>GATEWAY=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.2</span><br>DNS1=<span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span><br>DNS2=<span class="hljs-number">8.8</span>.<span class="hljs-number">4.4</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>4、重新加载网络配置</p><p>方式一：【一步到位，后面不用】</p><ul><li><code>ip addr flush dev ens160 &amp;&amp; systemctl restart NetworkManager.service</code></li></ul><p>方式二：</p><ul><li><code>nmcli c reload</code></li></ul><p>5、CentOS 8默认不支持network.service服务<br>安装network.service服务  </p><ul><li><code>yum install network-scripts</code></li></ul><p>6、重启网络服务</p><ul><li><code>service network restart</code></li></ul><p>7、重启网络服务</p><ul><li><code>systemctl  restart  network.service</code></li></ul><p>8、测试网络是否正常</p><ul><li><code>ping www.baidu.com</code></li></ul><p>9、查看ip地址</p><ul><li><code>ip addr show</code></li></ul><h3 id="设置主机名为www"><a href="#设置主机名为www" class="headerlink" title="设置主机名为www"></a>设置主机名为www</h3><ul><li><code>hostname  www</code></li></ul><p>编辑配置文件</p><ul><li><code>vi /etc/hostname</code><ul><li>把<code>localhost.localdomain</code>改为<code>www</code></li></ul></li><li><code>vi /etc/hosts</code><ul><li>把<code>127.0.0.1   localhost  localhost.localdomain</code>  改为<code>127.0.0.1   localhost  www</code></li></ul></li></ul><h3 id="把网卡名称ifcfg-ens160改为ifcfg-eth0"><a href="#把网卡名称ifcfg-ens160改为ifcfg-eth0" class="headerlink" title="把网卡名称ifcfg-ens160改为ifcfg-eth0"></a>把网卡名称ifcfg-ens160改为ifcfg-eth0</h3><p>1、进入目录</p><ul><li><code>cd  /etc/sysconfig/network-scripts/</code></li></ul><p>2、改文件名</p><ul><li><code>mv  ifcfg-ens160  ifcfg-eth0</code></li></ul><p>3、编辑</p><ul><li><code>vi  ifcfg-eth0</code></li></ul><p>4、修改</p><ul><li><code>NAME=eth0</code></li><li><code>DEVICE=eth0</code></li></ul><p>5、编辑</p><ul><li><code>vi /etc/sysconfig/grub</code></li><li>在<code>GRUB_CMDLINE_LINUX</code>变量中添加一句<code>net.ifnames=0 biosdevname=0</code></li></ul><p>6、重新生成grub配置并更新内核参数</p><ul><li><code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li></ul><p>7、添加udev的规则</p><ul><li><code>cd  /etc/udev/rules.d</code></li><li><code>vi  70-persistent-net.rules</code></li><li>输入<code>SUBSYSTEM==&quot;net&quot;,ACTION==&quot;add&quot;,DRIVERS==&quot;?*&quot;,ATTR{address}==&quot;这里是你的MAC地址&quot;,ATTR｛type｝==&quot;1&quot; ,KERNEL==&quot;eth*&quot;,NAME=&quot;eth0&quot;</code></li></ul><p>8、重启系统</p><ul><li><code>shutdown -r now</code></li></ul><h2 id="运行ffmepg视频转码"><a href="#运行ffmepg视频转码" class="headerlink" title="运行ffmepg视频转码"></a>运行ffmepg视频转码</h2><ul><li>在Vidoes打开终端</li><li>转码<ul><li><code>ffmpeg -i a.mp4 a_h264.mp4</code></li></ul></li><li>播放<ul><li><code>mplayer -vo caca -quiet a_h264.mp4</code></li></ul></li><li>右下角连接声卡</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105471808&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Liunx-centos8入门+配置网络&lt;/a&gt;&lt;/p
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://lewis.qi.tk/categories/Linux/"/>
    
    
      <category term="centos8" scheme="http://lewis.qi.tk/tags/centos8/"/>
    
  </entry>
  
  <entry>
    <title>x-shell和xftp连接Linux</title>
    <link href="http://lewis.qi.tk/2020/05/16/x-shell%E5%92%8Cxftp%E8%BF%9E%E6%8E%A5Linux/"/>
    <id>http://lewis.qi.tk/2020/05/16/x-shell%E5%92%8Cxftp%E8%BF%9E%E6%8E%A5Linux/</id>
    <published>2020-05-16T11:07:26.000Z</published>
    <updated>2020-05-16T11:15:51.568Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105430274" target="_blank" rel="noopener">x-shell和xftp连接Linux</a></p><h2 id="在xshell中建立连接"><a href="#在xshell中建立连接" class="headerlink" title="在xshell中建立连接"></a>在xshell中建立连接</h2><p>Linux 终端输入查看IP地址</p><ul><li>在CentOs6中，输入 <code>ifconfig -a</code><ul><li>第一段显示的Inet addr后边的就是Linux的IP地址</li></ul></li><li>在CentOs7中，输入 <code>ip addr</code></li></ul><p>以下为CentOs6输出，我把IP地址用xxx替代</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">eth0    Link encap:Ethernet  HWaddr 00:0C:29:12:3E:2D  <br>        inet addr:xxx.xxx.xxx.xxx  Bcast:xxx.xxx.xxxxxx  Mask:255.255.255.0<br>        inet6 addr:xxxx::xxx:xxxx:xxxx:xxxx&#x2F;64 Scope:Link<br>        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>        RX packets:10885 errors:0 dropped:0 overruns:0 frame:0<br>        TX packets:5127 errors:0 dropped:0 overruns:0 carrier:0<br>        collisions:0 txqueuelen:1000<br>        RX bytes:15058180 (14.3 MiB)  TX bytes:338736 (330.7 KiB)<br><br>lo      Link encap:Local Loopback  <br>        inet addr:127.0.0.1  Mask:255.0.0.0<br>        inet6 addr: ::1&#x2F;128 Scope:Host<br>        UP LOOPBACK RUNNING  MTU:16436  Metric:1<br>        RX packets:10 errors:0 dropped:0 overruns:0 frame:0<br>        TX packets:10 errors:0 dropped:0 overruns:0 carrier:0<br>        collisions:0 txqueuelen:0<br>        RX bytes:582 (582.0 b)  TX bytes:582 (582.0 b)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>再在Linux中输入</p><ul><li><code>which ssh</code> 查看是否安装有 openssh-server 服务</li><li>如果返回目录，则说明安装</li><li>如果没有返回，则执行 <code>yum install -y openssh-server</code> 安装命令</li></ul><p>在xshell中文件-&gt;新建-&gt;</p><ul><li>名称：自定义</li><li>协议：SSH</li><li>主机：服务器IP地址（Linux的IP：xxx.xxx.xxx.xxx)</li><li>端口号：默认22</li></ul><p>确定建立连接后，再双击连接，输入Linux的用户名和密码</p><ul><li>用户名：xxx</li><li>密码：xxx</li></ul><p>连接结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs txt"><code class="language-hljs txt">Connecting to xxx. xxx.xxx.xxx:xx...<br>Connection established .<br>To escape to local shell, press' Ctrl +Alt+ ] ' .<br><br>&#x2F;usr&#x2F; bin&#x2F;xauth: creating new authority file &#x2F;home&#x2F;xxx&#x2F; .Xauthority<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="在cmd中建立连接"><a href="#在cmd中建立连接" class="headerlink" title="在cmd中建立连接"></a>在cmd中建立连接</h2><ul><li>直接输入<ul><li><code>ssh xxx@ xxx. xxx.xxx.xxx:xx</code></li><li><code>ssh 用户名@远程服务器IP地址</code></li><li>再输入Linux的密码即可</li></ul></li></ul><h2 id="xftp"><a href="#xftp" class="headerlink" title="xftp"></a>xftp</h2><p>新建连接同上，可以通过客户端进行互联</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li>点击向左或向右传输</li><li>直接拖动</li></ul><p>显示Linux隐藏文件</p><ul><li>xftp -&gt; 工具 -&gt; 选项 -&gt; 常规 -&gt; 显示隐藏文件</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105430274&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;x-shell和xftp连接Linux&lt;/a&gt;&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="Liunx" scheme="http://lewis.qi.tk/categories/Liunx/"/>
    
    
      <category term="centos8" scheme="http://lewis.qi.tk/tags/centos8/"/>
    
      <category term="centos6" scheme="http://lewis.qi.tk/tags/centos6/"/>
    
  </entry>
  
  <entry>
    <title>vue组件化深入--day03</title>
    <link href="http://lewis.qi.tk/2020/05/16/vue%E7%BB%84%E4%BB%B6%E5%8C%96%E6%B7%B1%E5%85%A5-day03/"/>
    <id>http://lewis.qi.tk/2020/05/16/vue%E7%BB%84%E4%BB%B6%E5%8C%96%E6%B7%B1%E5%85%A5-day03/</id>
    <published>2020-05-16T10:51:54.000Z</published>
    <updated>2020-05-16T11:05:19.591Z</updated>
    
    <content type="html"><![CDATA[<p>CSDN文章链接：<a href="https://blog.csdn.net/qq_45062586/article/details/105719652" target="_blank" rel="noopener">vue组件化深入</a></p><h2 id="vue–自定义-component-标签"><a href="#vue–自定义-component-标签" class="headerlink" title="vue–自定义 component 标签"></a>vue–自定义 component 标签</h2><ul><li><p>先仔细看下components命名规则对比</p></li><li><p><code>is</code> 关键字</p><ul><li><code>&lt;component :is=&quot;xxx&quot;&gt;&lt;/component&gt;</code></li></ul></li><li><p>ComponentA: ComponentA 的缩写—-&gt;ComponentA  </p></li><li><p>即这个变量名同时是：</p><ul><li><strong>用在模板中的自定义元素的名称</strong></li><li><strong>包含了这个组件选项的变量名</strong></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">import</span> ComponentA <span class="hljs-keyword">from</span> <span class="hljs-string">'./ComponentA.vue'</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  components: &#123;<br>    ComponentA  <br>  &#125;,<br>  <span class="hljs-comment"><code class="language-hljs js"><span class="hljs-keyword">import</span> ComponentA <span class="hljs-keyword">from</span> <span class="hljs-string">'./ComponentA.vue'</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  components: &#123;<br>    ComponentA  <br>  &#125;,<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>实例1：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;script type=<span class="hljs-string">"text/javascript"</span>&gt;<br>    <span class="hljs-keyword">var</span> HelloTom = &#123;<br>      data: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          msg: <span class="hljs-string">'HelloTom'</span><br>        &#125;<br>      &#125;,<br>      template: <span class="hljs-string">'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;'</span><br>    &#125;;<br>    <span class="hljs-keyword">var</span> HelloJerry = &#123;<br>      data: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          msg: <span class="hljs-string">'HelloJerry'</span><br>        &#125;<br>      &#125;,<br>      template: <span class="hljs-string">'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;'</span><br>    &#125;;<br>    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> Vue(&#123;<br>      el: <span class="hljs-string">'#app'</span>,<br>      data: &#123;<br>      &#125;,<br>      components: &#123;<br>        <span class="hljs-string">'hello-tom'</span>: HelloTom,<br>        <span class="hljs-string">'hello-jerry'</span>: HelloJerry<br>      &#125;<br>    &#125;);<br>  &lt;<span class="hljs-regexp"><code class="language-hljs js">&lt;script type=<span class="hljs-string">"text/javascript"</span>&gt;<br>    <span class="hljs-keyword">var</span> HelloTom = &#123;<br>      data: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          msg: <span class="hljs-string">'HelloTom'</span><br>        &#125;<br>      &#125;,<br>      template: <span class="hljs-string">'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;'</span><br>    &#125;;<br>    <span class="hljs-keyword">var</span> HelloJerry = &#123;<br>      data: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          msg: <span class="hljs-string">'HelloJerry'</span><br>        &#125;<br>      &#125;,<br>      template: <span class="hljs-string">'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;'</span><br>    &#125;;<br>    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> Vue(&#123;<br>      el: <span class="hljs-string">'#app'</span>,<br>      data: &#123;<br>      &#125;,<br>      components: &#123;<br>        <span class="hljs-string">'hello-tom'</span>: HelloTom,<br>        <span class="hljs-string">'hello-jerry'</span>: HelloJerry<br>      &#125;<br>    &#125;);<br>  &lt;<span class="hljs-regexp">/script></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="动态组件-amp-异步组件"><a href="#动态组件-amp-异步组件" class="headerlink" title="动态组件 &amp; 异步组件"></a>动态组件 &amp; 异步组件</h2><h3 id="的’is’-关键字"><a href="#的’is’-关键字" class="headerlink" title=" 的’is’ 关键字"></a><component> 的’is’ 关键字</h3><ul><li>$\color{red}’is’ 关键字$ 用来动态切换组件<ul><li>其属性值可以是 <strong>值</strong>、也可以是 <strong>函数</strong></li><li>绑定key数据，根据key的值不同，调用不同的组件。</li></ul></li></ul><p>例1：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>    &lt;component :is=<span class="hljs-string">"key"</span>&gt;&lt;<span class="hljs-regexp">/component&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">var</span> componentA = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:red"&gt;我是A组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> componentB = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:blank"&gt;我是B组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> componentC = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:pink"&gt;我是C组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    components: &#123;<br>        <span class="hljs-string">"comA"</span>: componentA,<br>        <span class="hljs-string">"comB"</span>: componentB,<br>        <span class="hljs-string">"comC"</span>: componentC<br>    &#125;,<br>    data:&#123;<br>        key:<span class="hljs-string"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>    &lt;component :is=<span class="hljs-string">"key"</span>&gt;&lt;<span class="hljs-regexp">/component&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">var</span> componentA = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:red"&gt;我是A组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> componentB = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:blank"&gt;我是B组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> componentC = &#123;<br>    template: <span class="hljs-string">`&lt;div style="color:pink"&gt;我是C组件&lt;/div&gt;`</span><br>&#125;<br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    components: &#123;<br>        <span class="hljs-string">"comA"</span>: componentA,<br>        <span class="hljs-string">"comB"</span>: componentB,<br>        <span class="hljs-string">"comC"</span>: componentC<br>    &#125;,<br>    data:&#123;<br>        key:<span class="hljs-string">'comB'</span><br>    &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>例2：</p><ul><li>多个组件使用同一个挂载点，并动态切换【动态组件】</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;component :is="currentView"&gt;&lt;/</span>component&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">var home = &#123;template:'&lt;div&gt;我是主页&lt;/</span>div&gt;<span class="hljs-string">'&#125;;</span><br><span class="hljs-string">var post = &#123;template:'</span>&lt;div&gt;我是提交页&lt;<span class="hljs-regexp">/div&gt;'&#125;;</span><br><span class="hljs-regexp">var archive = &#123;template:'&lt;div&gt;我是存档页&lt;/</span>div&gt;<span class="hljs-string">'&#125;;</span><br><span class="hljs-string">new Vue(&#123;</span><br>  el: '#example',<br>  components: &#123;<br>    home,<br>    post,<br>    archive,<br>  &#125;,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>    arr:[<span class="hljs-string">'home'</span>,<span class="hljs-string">'post'</span>,<span class="hljs-string">'archive'</span>],<br>  &#125;,<br>  computed:&#123;<br>    currentView()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.arr[<span class="hljs-keyword">this</span>.index];<br>    &#125;<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword">this</span>.index)%<span class="hljs-number"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;component :is="currentView"&gt;&lt;/</span>component&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">var home = &#123;template:'&lt;div&gt;我是主页&lt;/</span>div&gt;<span class="hljs-string">'&#125;;</span><br><span class="hljs-string">var post = &#123;template:'</span>&lt;div&gt;我是提交页&lt;<span class="hljs-regexp">/div&gt;'&#125;;</span><br><span class="hljs-regexp">var archive = &#123;template:'&lt;div&gt;我是存档页&lt;/</span>div&gt;<span class="hljs-string">'&#125;;</span><br><span class="hljs-string">new Vue(&#123;</span><br>  el: '#example',<br>  components: &#123;<br>    home,<br>    post,<br>    archive,<br>  &#125;,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>    arr:[<span class="hljs-string">'home'</span>,<span class="hljs-string">'post'</span>,<span class="hljs-string">'archive'</span>],<br>  &#125;,<br>  computed:&#123;<br>    currentView()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.arr[<span class="hljs-keyword">this</span>.index];<br>    &#125;<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword">this</span>.index)%<span class="hljs-number">3</span>;<br>    &#125;<br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>例2的另一种实现形式：</p><ul><li>直接绑定到组件对象上，位于data中，用数组表示</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;component :is="currentView"&gt;&lt;/</span>component&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">new Vue(&#123;</span><br><span class="hljs-regexp">  el: '#example',</span><br><span class="hljs-regexp">  data:&#123;</span><br><span class="hljs-regexp">    index:0,</span><br><span class="hljs-regexp">    arr:[</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是主页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是提交页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是存档页&lt;/div&gt;`&#125;</span><br><span class="hljs-regexp">    ],</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  computed:&#123;</span><br><span class="hljs-regexp">    currentView()&#123;</span><br><span class="hljs-regexp">        return this.arr[this.index];</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods:&#123;</span><br><span class="hljs-regexp">    change()&#123;</span><br><span class="hljs-regexp">      this.index = (++this.index)%3;</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;component :is="currentView"&gt;&lt;/</span>component&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">new Vue(&#123;</span><br><span class="hljs-regexp">  el: '#example',</span><br><span class="hljs-regexp">  data:&#123;</span><br><span class="hljs-regexp">    index:0,</span><br><span class="hljs-regexp">    arr:[</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是主页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是提交页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是存档页&lt;/div&gt;`&#125;</span><br><span class="hljs-regexp">    ],</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  computed:&#123;</span><br><span class="hljs-regexp">    currentView()&#123;</span><br><span class="hljs-regexp">        return this.arr[this.index];</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods:&#123;</span><br><span class="hljs-regexp">    change()&#123;</span><br><span class="hljs-regexp">      this.index = (++this.index)%3;</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp">&#125;)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="lt-keep-alive-gt-标签"><a href="#lt-keep-alive-gt-标签" class="headerlink" title="&lt;keep-alive&gt;标签"></a><code>&lt;keep-alive&gt;</code>标签</h2><ul><li>包裹动态组件【含is】时，会缓存不活动的组件实例，而不是销毁它们<ul><li>失活的组件将会被缓存！</li></ul></li><li>是一个抽象组件：它自身不会渲染一个 DOM 元素，也不会出现在父组件链中</li><li>和 <code>&lt;transition&gt;</code> 相似</li></ul><p>实例1：</p><ul><li>如果有多个条件性的子元素，<code>&lt;keep-alive&gt;</code> 要求同时只能有一个子元素被渲染<ul><li>子元素home</li><li>子元素posts</li><li>子元素archive</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive&gt;</span><br><span class="hljs-regexp">    &lt;home v-if="index===0"&gt;&lt;/</span>home&gt;<br>    &lt;posts v-<span class="hljs-keyword">else</span>-<span class="hljs-keyword">if</span>=<span class="hljs-string">"index===1"</span>&gt;&lt;<span class="hljs-regexp">/posts&gt;</span><br><span class="hljs-regexp">    &lt;archive v-else&gt;&lt;/</span>archive&gt;  <br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">new</span> Vue(&#123;<br>  el: <span class="hljs-string">'#example'</span>,<br>  components:&#123;<br>    home:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是主页&lt;/div&gt;`</span>&#125;,<br>    posts:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是提交页&lt;/div&gt;`</span>&#125;,<br>    archive:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是存档页&lt;/div&gt;`</span>&#125;,<br>  &#125;,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">let</span> len = <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.$options.components).length;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive&gt;</span><br><span class="hljs-regexp">    &lt;home v-if="index===0"&gt;&lt;/</span>home&gt;<br>    &lt;posts v-<span class="hljs-keyword">else</span>-<span class="hljs-keyword">if</span>=<span class="hljs-string">"index===1"</span>&gt;&lt;<span class="hljs-regexp">/posts&gt;</span><br><span class="hljs-regexp">    &lt;archive v-else&gt;&lt;/</span>archive&gt;  <br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">new</span> Vue(&#123;<br>  el: <span class="hljs-string">'#example'</span>,<br>  components:&#123;<br>    home:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是主页&lt;/div&gt;`</span>&#125;,<br>    posts:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是提交页&lt;/div&gt;`</span>&#125;,<br>    archive:&#123;<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是存档页&lt;/div&gt;`</span>&#125;,<br>  &#125;,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">let</span> len = <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.$options.components).length;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword">this</span>.index) % len;<br>    &#125;<br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="lt-keep-alive-gt-的属性【-include-和-exclude】"><a href="#lt-keep-alive-gt-的属性【-include-和-exclude】" class="headerlink" title="&lt;keep-alive&gt; 的属性【:include 和 :exclude】"></a><code>&lt;keep-alive&gt;</code> 的属性【<code>:include</code> 和 <code>:exclude</code>】</h2><p>用法：</p><ul><li>include（包括） 和 exclude （不包括）属性允许组件有条件地缓存。<ul><li>首先检查组件自身的 name 选项，【匹配到后则缓存匹配的值】</li><li>如果 name 选项不可用，则匹配它的局部注册名称（父组件 components 选项的键值）【匹配到后则缓存匹配的值】</li></ul></li><li>(使用 v-bind)</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs html"><span class="hljs-comment">&lt;!-- 逗号分隔字符串 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">include</span>=<span class="hljs-string">"a,b"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 正则表达式  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"/a|b/"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Array --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"['a', 'b']"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-comment">&lt;!-- 逗号分隔字符串 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">include</span>=<span class="hljs-string">"a,b"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 正则表达式  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"/a|b/"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Array --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"['a', 'b']"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>分析：</p><ul><li>这里是检查了自己的name属性，发现未找到</li><li>再检查局部注册名称（父组件） components 选项的键值<ul><li>所以【include】<strong>只缓存home和archive，不缓存posts</strong></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive include="home,archive"&gt;</span><br><span class="hljs-regexp">    &lt;component :is="currentView"&gt;&lt;/</span>component&gt; <br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">new</span> Vue(&#123;<br>  el: <span class="hljs-string">'#example'</span>,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>    arr:[<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'home'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是主页&lt;/div&gt;`</span>&#125;,<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'posts'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是提交页&lt;/div&gt;`</span>&#125;,<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'archive'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是存档页&lt;/div&gt;`</span>&#125;<br>    ],<br>  &#125;,<br>  computed:&#123;<br>    currentView()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.arr[<span class="hljs-keyword">this</span>.index];<br>    &#125;<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>.arr.length;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive include="home,archive"&gt;</span><br><span class="hljs-regexp">    &lt;component :is="currentView"&gt;&lt;/</span>component&gt; <br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><br><span class="hljs-keyword">new</span> Vue(&#123;<br>  el: <span class="hljs-string">'#example'</span>,<br>  data:&#123;<br>    index:<span class="hljs-number">0</span>,<br>    arr:[<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'home'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是主页&lt;/div&gt;`</span>&#125;,<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'posts'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是提交页&lt;/div&gt;`</span>&#125;,<br>      &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'archive'</span>,<span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;div&gt;我是存档页&lt;/div&gt;`</span>&#125;<br>    ],<br>  &#125;,<br>  computed:&#123;<br>    currentView()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.arr[<span class="hljs-keyword">this</span>.index];<br>    &#125;<br>  &#125;,<br>  methods:&#123;<br>    change()&#123;<br>      <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>.arr.length;<br>      <span class="hljs-keyword">this</span>.index = (++<span class="hljs-keyword">this</span>.index)% len;<br>    &#125;,<br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="lt-keep-alive-gt-的【activated-和-deactivated-】函数"><a href="#lt-keep-alive-gt-的【activated-和-deactivated-】函数" class="headerlink" title="&lt;keep-alive&gt; 的【activated() 和 deactivated()】函数"></a><code>&lt;keep-alive&gt;</code> 的【<code>activated()</code> 和 <code>deactivated()</code>】函数</h2><p>用法：</p><ul><li>在 <code>&lt;keep-alive&gt;</code> 树内的所有嵌套组件中触发<ul><li>activated()  点击开始时</li><li>deactivated() 切换结束时</li></ul></li></ul><p>分析：</p><ul><li>:is=”currentView”，函数在计算属性中定义</li><li>data的arr中存放模板<ul><li>注意：【activated()和deactivated()中的重写<code>$emit</code>函数，是vue<strong>自定义事件</strong>pass-data】</li></ul></li><li>当按顺序点击，轮到下标是 我是主页 的模板是触发自定义函数<br>@pass-data，其参数则触发getData延迟（先显示$emit的第二个参数值，再消失””）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive&gt;</span><br><span class="hljs-regexp">    &lt;component :is="currentView" @pass-data="getData"&gt;&lt;/</span>component&gt;<br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">  &lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;/</span>p&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">new Vue(&#123;</span><br><span class="hljs-regexp">  el: '#example',</span><br><span class="hljs-regexp">  data:&#123;</span><br><span class="hljs-regexp">    index:0,</span><br><span class="hljs-regexp">    msg:'',</span><br><span class="hljs-regexp">    arr:[</span><br><span class="hljs-regexp">      &#123;</span><br><span class="hljs-regexp">        template:`&lt;div&gt;我是主页&lt;/div&gt;`,</span><br><span class="hljs-regexp">        activated()&#123;</span><br><span class="hljs-regexp">          this.$emit('pass-data','主页被添加');</span><br><span class="hljs-regexp">        &#125;,</span><br><span class="hljs-regexp">        deactivated()&#123;</span><br><span class="hljs-regexp">          this.$emit('pass-data','主页被移除');</span><br><span class="hljs-regexp">        &#125;,</span><br><span class="hljs-regexp">      &#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是提交页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是存档页&lt;/div&gt;`&#125;</span><br><span class="hljs-regexp">    ],</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  computed:&#123;</span><br><span class="hljs-regexp">    currentView()&#123;</span><br><span class="hljs-regexp">        return this.arr[this.index];</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods:&#123;</span><br><span class="hljs-regexp">    change()&#123;</span><br><span class="hljs-regexp">      var len = this.arr.length;</span><br><span class="hljs-regexp">      this.index = (++this.index)% len;</span><br><span class="hljs-regexp">    &#125;,</span><br><span class="hljs-regexp">    getData(value)&#123;</span><br><span class="hljs-regexp">      this.msg = value;</span><br><span class="hljs-regexp">      setTimeout(()=&gt;&#123;</span><br><span class="hljs-regexp">        this.msg = '';</span><br><span class="hljs-regexp">      &#125;,500)</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"example"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">"change"</span>&gt;切换页面&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">  &lt;keep-alive&gt;</span><br><span class="hljs-regexp">    &lt;component :is="currentView" @pass-data="getData"&gt;&lt;/</span>component&gt;<br>  &lt;<span class="hljs-regexp">/keep-alive&gt;</span><br><span class="hljs-regexp">  &lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;/</span>p&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">new Vue(&#123;</span><br><span class="hljs-regexp">  el: '#example',</span><br><span class="hljs-regexp">  data:&#123;</span><br><span class="hljs-regexp">    index:0,</span><br><span class="hljs-regexp">    msg:'',</span><br><span class="hljs-regexp">    arr:[</span><br><span class="hljs-regexp">      &#123;</span><br><span class="hljs-regexp">        template:`&lt;div&gt;我是主页&lt;/div&gt;`,</span><br><span class="hljs-regexp">        activated()&#123;</span><br><span class="hljs-regexp">          this.$emit('pass-data','主页被添加');</span><br><span class="hljs-regexp">        &#125;,</span><br><span class="hljs-regexp">        deactivated()&#123;</span><br><span class="hljs-regexp">          this.$emit('pass-data','主页被移除');</span><br><span class="hljs-regexp">        &#125;,</span><br><span class="hljs-regexp">      &#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是提交页&lt;/div&gt;`&#125;,</span><br><span class="hljs-regexp">      &#123;template:`&lt;div&gt;我是存档页&lt;/div&gt;`&#125;</span><br><span class="hljs-regexp">    ],</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  computed:&#123;</span><br><span class="hljs-regexp">    currentView()&#123;</span><br><span class="hljs-regexp">        return this.arr[this.index];</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods:&#123;</span><br><span class="hljs-regexp">    change()&#123;</span><br><span class="hljs-regexp">      var len = this.arr.length;</span><br><span class="hljs-regexp">      this.index = (++this.index)% len;</span><br><span class="hljs-regexp">    &#125;,</span><br><span class="hljs-regexp">    getData(value)&#123;</span><br><span class="hljs-regexp">      this.msg = value;</span><br><span class="hljs-regexp">      setTimeout(()=&gt;&#123;</span><br><span class="hljs-regexp">        this.msg = '';</span><br><span class="hljs-regexp">      &#125;,500)</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp">&#125;)</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h2><ul><li>以一个工厂函数的方式定义你的组件，它会异步解析你的组件定义</li><li>只有在这个组件需要被渲染的时候才会触发该工厂函数，且会把结果缓存起来供未来重渲染</li></ul><p>核心：  </p><ul><li>是第二个参数<code>function (resolve, reject) {...}</code></li></ul><p>实现：  </p><ul><li>resolve加载成功后，执行处理的逻辑</li><li>reject加载失败后，执行处理的逻辑</li></ul><p>普通组件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">Vue.component(<span class="hljs-string">'async-example'</span>, &#123;<br>    template: <span class="hljs-string"><code class="language-hljs js">Vue.component(<span class="hljs-string">'async-example'</span>, &#123;<br>    template: <span class="hljs-string">`<div>this is a global component</div>`</span><br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>异步组件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">Vue.component(<span class="hljs-string">'async-example'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;<br>    <span class="hljs-comment">// do some thing 处理其它逻辑，并在完成后向 `resolve` 回调传递组件定义</span><br>    resolve(&#123;<br>      template: <span class="hljs-string">'&lt;div&gt;I am async!&lt;/div&gt;'</span><br>      <span class="hljs-comment">// 组件定义的其它选项</span><br>    &#125;)<br><br>    <span class="hljs-comment">// 或者调用reject回调表示失败</span><br>    reject(&#123;<br>        template: <span class="hljs-string"><code class="language-hljs js">Vue.component(<span class="hljs-string">'async-example'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;<br>    <span class="hljs-comment">// do some thing 处理其它逻辑，并在完成后向 `resolve` 回调传递组件定义</span><br>    resolve(&#123;<br>      template: <span class="hljs-string">'&lt;div&gt;I am async!&lt;/div&gt;'</span><br>      <span class="hljs-comment">// 组件定义的其它选项</span><br>    &#125;)<br><br>    <span class="hljs-comment">// 或者调用reject回调表示失败</span><br>    reject(&#123;<br>        template: <span class="hljs-string">`<div>result is failed</div>`</span><br>    &#125;)<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="异步组件变成单文件-vue-webpack-的-code-splitting"><a href="#异步组件变成单文件-vue-webpack-的-code-splitting" class="headerlink" title="异步组件变成单文件.vue +  webpack 的 code-splitting"></a>异步组件变成单文件<code>.vue</code> +  webpack 的 <code>code-splitting</code></h2><p>【定义为异步加载的组件，在打包时，打包成单独js文件存储在static/js文件夹】</p><ul><li><code>require</code></li></ul><p>my-async-component.vue【变成单组件】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">Vue.component(<span class="hljs-string">'async-webpack-example'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) </span>&#123;<br>    <span class="hljs-comment">// do some thing</span><br>    <span class="hljs-comment">// 这个特殊的 `require` 语法将会告诉 webpack</span><br>    <span class="hljs-comment">// 自动将你的构建代码切割成多个包，这些包</span><br>    <span class="hljs-comment">// 会通过 Ajax 请求加载</span><br>    <span class="hljs-built_in">require</span>([<span class="hljs-string"><code class="language-hljs js">Vue.component(<span class="hljs-string">'async-webpack-example'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) </span>&#123;<br>    <span class="hljs-comment">// do some thing</span><br>    <span class="hljs-comment">// 这个特殊的 `require` 语法将会告诉 webpack</span><br>    <span class="hljs-comment">// 自动将你的构建代码切割成多个包，这些包</span><br>    <span class="hljs-comment">// 会通过 Ajax 请求加载</span><br>    <span class="hljs-built_in">require</span>([<span class="hljs-string">'./my-async-component'</span>], resolve)<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><ul><li><code>import</code>会返回一个 <code>Promise</code> 对象</li><li>可自定义异步加载状态【根据加载处理的状态来改变要渲染的组件】<ul><li>loading</li><li>error</li><li>delay</li><li>timeout</li></ul></li></ul><p>async-webpack-example.vue【在组件引用这个组件】</p><p>情况1：全局注册组件，并异步加载</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">Vue.component(<span class="hljs-string">'async-webpack-example'</span>,<br>    () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./my-async-component'</span>)<br>)<br><br><span class="hljs-comment">//-----------或者--------------------</span><br>Vue.component(<span class="hljs-string">'async-webpack-example'</span>,<br>    () =&gt; (&#123;<br>        component: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./MyComponent.vue'</span>),<br>        <span class="hljs-comment">// 加载时使用的组件</span><br>        loading: LoadingComponent,<br>        <span class="hljs-comment">// 加载失败时使用的组件</span><br>        error: ErrorComponent,<br>        <span class="hljs-comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span><br>        delay: <span class="hljs-number">200</span>,<br>        <span class="hljs-comment">// 如果提供了超时时间且组件加载也超时了，</span><br>        <span class="hljs-comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span><br>        timeout: <span class="hljs-number"><code class="language-hljs js">Vue.component(<span class="hljs-string">'async-webpack-example'</span>,<br>    () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./my-async-component'</span>)<br>)<br><br><span class="hljs-comment">//-----------或者--------------------</span><br>Vue.component(<span class="hljs-string">'async-webpack-example'</span>,<br>    () =&gt; (&#123;<br>        component: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./MyComponent.vue'</span>),<br>        <span class="hljs-comment">// 加载时使用的组件</span><br>        loading: LoadingComponent,<br>        <span class="hljs-comment">// 加载失败时使用的组件</span><br>        error: ErrorComponent,<br>        <span class="hljs-comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span><br>        delay: <span class="hljs-number">200</span>,<br>        <span class="hljs-comment">// 如果提供了超时时间且组件加载也超时了，</span><br>        <span class="hljs-comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span><br>        timeout: <span class="hljs-number">3000</span><br>    &#125;)<br>)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>情况2：局部注册组件，并异步加载【根实例】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  components: &#123;<br>    <span class="hljs-string">'async-webpack-example'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string"><code class="language-hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  components: &#123;<br>    <span class="hljs-string">'async-webpack-example'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./my-async-component'</span>)<br>  &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="处理边界情况"><a href="#处理边界情况" class="headerlink" title="处理边界情况"></a>处理边界情况</h2><p>处理边界情况之<code>$root</code>，<code>$parents</code>，<code>$refs</code><br>【可替代将数据以 prop 的方式传入子组件】</p><ul><li><code>$root</code>，<code>$parents</code>都能实现访问父组件的属性和方法<ul><li><code>$root</code>访问到的是<strong>它的根组件</strong></li><li><code>$parents</code>访问到的是<strong>最近一级的父组件</strong></li></ul></li><li><code>$refs</code>只会在组件渲染完成之后生效，并且它们不是响应式的。<ul><li>避免在模板或计算属性中访问 $refs</li></ul></li></ul><h3 id="子组件访问根实例【-root】"><a href="#子组件访问根实例【-root】" class="headerlink" title="子组件访问根实例【$root】"></a>子组件访问根实例【$root】</h3><ul><li><code>new Vue</code> 根实例，其子组件可以通过 <code>$root</code> 属性进行访问</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  data: &#123;<br>    foo: <span class="hljs-number">1</span><br>  &#125;,<br>  computed: &#123;<br>    a: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">/* ... */</span> &#125;<br>  &#125;,<br>  methods: &#123;<br>    b: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">/* ... */</span> &#125;<br>  &#125;<br>&#125;)<br><span class="hljs-comment">// 获取根组件的数据</span><br><span class="hljs-keyword">this</span>.$root.foo<br><span class="hljs-comment">// 写入根组件的数据</span><br><span class="hljs-keyword">this</span>.$root.foo = <span class="hljs-number">2</span><br><span class="hljs-comment">// 访问根组件的计算属性</span><br><span class="hljs-keyword">this</span>.$root.a<br><span class="hljs-comment">// 调用根组件的方法</span><br><span class="hljs-keyword"><code class="language-hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  data: &#123;<br>    foo: <span class="hljs-number">1</span><br>  &#125;,<br>  computed: &#123;<br>    a: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">/* ... */</span> &#125;<br>  &#125;,<br>  methods: &#123;<br>    b: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">/* ... */</span> &#125;<br>  &#125;<br>&#125;)<br><span class="hljs-comment">// 获取根组件的数据</span><br><span class="hljs-keyword">this</span>.$root.foo<br><span class="hljs-comment">// 写入根组件的数据</span><br><span class="hljs-keyword">this</span>.$root.foo = <span class="hljs-number">2</span><br><span class="hljs-comment">// 访问根组件的计算属性</span><br><span class="hljs-keyword">this</span>.$root.a<br><span class="hljs-comment">// 调用根组件的方法</span><br><span class="hljs-keyword">this</span>.$root.b()<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="子组件访问最近一级的父组件【-parents】"><a href="#子组件访问最近一级的父组件【-parents】" class="headerlink" title="子组件访问最近一级的父组件【$parents】"></a>子组件访问最近一级的父组件【$parents】</h3><ul><li>最近一级的父组件，其子组件可以通过 <code>$parents</code> 属性进行访问</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>    &lt;root-obj&gt;&lt;<span class="hljs-regexp">/root-obj&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><span class="hljs-comment">//子组件（是子子组件的父组件）</span><br>Vue.component(<span class="hljs-string">'root-obj'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;div&gt;</span><br><span class="hljs-string">                    &lt;button @click='getRoot'&gt;子组件&lt;/button&gt;</span><br><span class="hljs-string">                    &lt;child-component&gt;&lt;/child-component&gt;</span><br><span class="hljs-string">                &lt;/div&gt;`</span>,<br>    methods: &#123;<br>        getRoot() &#123;<br>            <span class="hljs-comment">//得到自己</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>)]<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)【根组件即这个的父组件】</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$parent)<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$root)<br>        &#125;<br>    &#125;<br>&#125;)<br><span class="hljs-comment">//子子组件</span><br>Vue.component(<span class="hljs-string">'child-component'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;div&gt;</span><br><span class="hljs-string">                &lt;button @click='getRoot'&gt;子子组件&lt;/button&gt;</span><br><span class="hljs-string">                &lt;/div&gt;`</span>,<br>    methods: &#123;<br>        getRoot() &#123;<br>            <span class="hljs-comment">//得到自己</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>)]<br>            <span class="hljs-comment">//得到Vue.component('root-obj', &#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$parent)<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$root)<br>        &#125;<br>    &#125;<br>&#125;)<br><span class="hljs-comment">//根组件</span><br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    data: &#123;<br>        msg: <span class="hljs-string"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>    &lt;root-obj&gt;&lt;<span class="hljs-regexp">/root-obj&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><span class="hljs-comment">//子组件（是子子组件的父组件）</span><br>Vue.component(<span class="hljs-string">'root-obj'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;div&gt;</span><br><span class="hljs-string">                    &lt;button @click='getRoot'&gt;子组件&lt;/button&gt;</span><br><span class="hljs-string">                    &lt;child-component&gt;&lt;/child-component&gt;</span><br><span class="hljs-string">                &lt;/div&gt;`</span>,<br>    methods: &#123;<br>        getRoot() &#123;<br>            <span class="hljs-comment">//得到自己</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>)]<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)【根组件即这个的父组件】</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$parent)<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$root)<br>        &#125;<br>    &#125;<br>&#125;)<br><span class="hljs-comment">//子子组件</span><br>Vue.component(<span class="hljs-string">'child-component'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;div&gt;</span><br><span class="hljs-string">                &lt;button @click='getRoot'&gt;子子组件&lt;/button&gt;</span><br><span class="hljs-string">                &lt;/div&gt;`</span>,<br>    methods: &#123;<br>        getRoot() &#123;<br>            <span class="hljs-comment">//得到自己</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>)]<br>            <span class="hljs-comment">//得到Vue.component('root-obj', &#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$parent)<br>            <span class="hljs-comment">//得到var app = new Vue(&#123;&#125;)</span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$root)<br>        &#125;<br>    &#125;<br>&#125;)<br><span class="hljs-comment">//根组件</span><br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    data: &#123;<br>        msg: <span class="hljs-string">'Root'</span><br>    &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="父组件访问子组件实例【-ref-和-refs-最常用】"><a href="#父组件访问子组件实例【-ref-和-refs-最常用】" class="headerlink" title="父组件访问子组件实例【 ref 和 $refs 最常用】"></a>父组件访问子组件实例【 <code>ref</code> 和 <code>$refs</code> 最常用】</h3><ul><li>最近一级的父组件，其子组件可以通过 <code>$parents</code> 属性进行访问<ul><li>避免在模板或计算属性中访问 $refs</li><li>只会在组件渲染完成之后生效</li></ul></li></ul><p>实例1：vue-cli的单组件形式<br>首先子组件需添加<code>ref=&quot;属性值&quot;</code>，然后即可使用使用<code>$refs.ref的属性值</code></p><p>父组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;template&gt;<br>    &lt;base-alert ref=<span class="hljs-string">"baseAlert"</span>&gt;&lt;<span class="hljs-regexp">/base-alert&gt;</span><br><span class="hljs-regexp">    &lt;div @click="clickMe"&gt;click me&lt;/</span>div&gt;<br>&lt;<span class="hljs-regexp">/template&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">&lt;script&gt;</span><br><span class="hljs-regexp">import BaseAlert from '@/</span>components/BaseAlert<span class="hljs-string">'</span><br><span class="hljs-string"></span><br><span class="hljs-string">export default &#123;</span><br><span class="hljs-string">    components: &#123;</span><br><span class="hljs-string">        BaseAlert</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    methods: &#123;</span><br><span class="hljs-string">        clickMe () &#123;</span><br><span class="hljs-string">          //popUp 方法在子组件中定义</span><br><span class="hljs-string">          this.$refs.baseAlert.popUp()</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&lt;/script&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;style scoped&gt;</span><br><span class="hljs-string">div &#123;</span><br><span class="hljs-string">  width: 20px;</span><br><span class="hljs-string">  height: 20px;</span><br><span class="hljs-string">  background: red;</span><br><span class="hljs-string">  margin-top: 100px</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"><code class="language-hljs js">&lt;template&gt;<br>    &lt;base-alert ref=<span class="hljs-string">"baseAlert"</span>&gt;&lt;<span class="hljs-regexp">/base-alert&gt;</span><br><span class="hljs-regexp">    &lt;div @click="clickMe"&gt;click me&lt;/</span>div&gt;<br>&lt;<span class="hljs-regexp">/template&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">&lt;script&gt;</span><br><span class="hljs-regexp">import BaseAlert from '@/</span>components/BaseAlert<span class="hljs-string">'</span><br><span class="hljs-string"></span><br><span class="hljs-string">export default &#123;</span><br><span class="hljs-string">    components: &#123;</span><br><span class="hljs-string">        BaseAlert</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    methods: &#123;</span><br><span class="hljs-string">        clickMe () &#123;</span><br><span class="hljs-string">          //popUp 方法在子组件中定义</span><br><span class="hljs-string">          this.$refs.baseAlert.popUp()</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&lt;/script&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;style scoped&gt;</span><br><span class="hljs-string">div &#123;</span><br><span class="hljs-string">  width: 20px;</span><br><span class="hljs-string">  height: 20px;</span><br><span class="hljs-string">  background: red;</span><br><span class="hljs-string">  margin-top: 100px</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></style></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>子组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;div&gt;child component&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  &lt;/</span>div&gt;<br>&lt;<span class="hljs-regexp">/template&gt;</span><br><span class="hljs-regexp">&lt;script&gt;</span><br><span class="hljs-regexp">export default &#123;</span><br><span class="hljs-regexp">  data () &#123;</span><br><span class="hljs-regexp">    return &#123;</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods: &#123;</span><br><span class="hljs-regexp">    popUp () &#123;</span><br><span class="hljs-regexp">      alert(abc)</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp">&#125;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp"><code class="language-hljs js">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;div&gt;child component&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  &lt;/</span>div&gt;<br>&lt;<span class="hljs-regexp">/template&gt;</span><br><span class="hljs-regexp">&lt;script&gt;</span><br><span class="hljs-regexp">export default &#123;</span><br><span class="hljs-regexp">  data () &#123;</span><br><span class="hljs-regexp">    return &#123;</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;,</span><br><span class="hljs-regexp">  methods: &#123;</span><br><span class="hljs-regexp">    popUp () &#123;</span><br><span class="hljs-regexp">      alert(abc)</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">  &#125;</span><br><span class="hljs-regexp">&#125;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp"></</span>script><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p>实例2：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">'refView'</span>&gt;通过ref访问子组件&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><span class="hljs-comment">//子组件</span><br>Vue.component(<span class="hljs-string">'base-input'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            msg: <span class="hljs-string">'base-input'</span><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;input type='text'/&gt;`</span><br>&#125;)<br><br><span class="hljs-comment">//根实例</span><br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    data: &#123;<br>        msg: <span class="hljs-string">'Root'</span><br>    &#125;,<br>    methods: &#123;<br>        refView() &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$refs.baseInput)<br>            <span class="hljs-keyword"><code class="language-hljs js">&lt;div id=<span class="hljs-string">"app"</span>&gt;<br>  &lt;button @click=<span class="hljs-string">'refView'</span>&gt;通过ref访问子组件&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp">&lt;/</span>div&gt;<br><span class="hljs-comment">//子组件</span><br>Vue.component(<span class="hljs-string">'base-input'</span>, &#123;<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            msg: <span class="hljs-string">'base-input'</span><br>        &#125;<br>    &#125;,<br>    template: <span class="hljs-string">`&lt;input type='text'/&gt;`</span><br>&#125;)<br><br><span class="hljs-comment">//根实例</span><br><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> Vue(&#123;<br>    el: <span class="hljs-string">'#app'</span>,<br>    data: &#123;<br>        msg: <span class="hljs-string">'Root'</span><br>    &#125;,<br>    methods: &#123;<br>        refView() &#123;<br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$refs.baseInput)<br>            <span class="hljs-keyword">this</span>.$refs.baseInput.$el.focus()<br>        &#125;<br>    &#125;<br>&#125;)<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="依赖注入-provide选项-和-inject选项"><a href="#依赖注入-provide选项-和-inject选项" class="headerlink" title="依赖注入 provide选项 和 inject选项"></a>依赖注入 <strong>provide选项</strong> 和 <strong>inject选项</strong></h3><ul><li>把依赖注入看作一部分“大范围有效的 prop”<ul><li>明天再写，这里不太会</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSDN文章链接：&lt;a href=&quot;https://blog.csdn.net/qq_45062586/article/details/105719652&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;vue组件化深入&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;vu
      
    
    </summary>
    
    
      <category term="vue" scheme="http://lewis.qi.tk/categories/vue/"/>
    
    
      <category term="vue" scheme="http://lewis.qi.tk/tags/vue/"/>
    
  </entry>
  
</feed>
